import{C as E,G as O,a as Y,m as W,T as k,E as J,b as K,D as j,M as s,F as N}from"./index-jg0arK8r.js";import{P as Q}from"./PerspectiveCamera-AIROWfhJ.js";import{N as $}from"./Node-DuQUmuyq.js";import{S as X}from"./Scene-B2emtRuX.js";var Z="@group(0)@binding(0)var<uniform>meshModelViewProjection: mat4x4f;fn GetVertexClipSpace(position: vec4f)->vec4f{return meshModelViewProjection*position;}@vertex fn vertex(@location(0)position: vec4f)->@builtin(position)vec4f {return GetVertexClipSpace(position);}";let ee=class{#r;#t;#i;Transparent=!1;#s=crypto.randomUUID();#o;#n;#e=new E(0,0);constructor(e=16777215,t="Mesh"){this.Color=e,this.#r=t}CreateColorBuffer(e,t=this.#r){const{color:i,buffer:r}=e.CreateUniformBuffer("color",{label:`${t} Color Buffer`});this.#t=i,this.#i=e,this.#n=r,this.#t.set(this.#o),e.WriteBuffer(r,i)}SetBlendConstant(e){if(!e?.BlendConstant||!this.#e.Equals(e.BlendConstant))return this.#i.BlendConstant=this.#e}set BlendConstant(e){typeof e=="number"&&this.#e.Set(e)||(this.#e.rgba=O(e))}get BlendConstant(){return this.#e}get ColorBuffer(){return this.#n}set Color(e){this.#o=typeof e=="number"&&Y(e)||O(e),this.#t?.fill(1).set(this.#o),this.#i?.WriteBuffer(this.#n,this.#t)}get Color(){return this.#o}get ID(){return this.#s}Destroy(){this.#i=void 0,this.#n?.destroy(),this.#n=void 0}},z=class extends ${#r;Visible=!0;#t;#i;#s;#o=[];constructor(e,t,i="Mesh",r=null){super(i,r),this.#r=e,this.#i=t===void 0&&new ee||t}SetRenderPipeline(e,t){this.#t=e,this.#r.CreateBuffers(e),this.#i?.CreateColorBuffer(e),this.#n(t)}#n(e,t){const{projection:i,buffer:r}=this.#t.CreateUniformBuffer("meshModelViewProjection",{label:`${this.Label} Projection Buffer`,...t});this.ProjectionMatrix=W.identity(i),this.#s=r,e=K(e),this.#o=this.#t.SetBindGroupFromResources([r,this.#i?.ColorBuffer,...e].filter(Boolean),0,0,`${this.Label} Bind Group`)}UpdateProjectionMatrix(e){const t=super.UpdateProjectionMatrix(e);this.#t.WriteBuffer(this.#s,t)}SetBindGroups(){!this.#t&&k(J.PIPELINE_NOT_FOUND,"RenderPipeline.\n            Call `Mesh.SetRenderPipeline` method before setting its data."),this.#t.BindGroups=this.#o}get ProjectionBuffer(){return this.#s}get Geometry(){return this.#r}get Material(){return this.#i}get Pipeline(){return this.#t}Destroy(){this.#r.Destroy(),this.#i?.Destroy(),this.#t=void 0,this.#o.splice(0),this.#s.destroy(),this.#s=void 0}};class te{#r;Label;IndexFormat;#t=crypto.randomUUID();VertexBuffers;IndexBuffer;constructor(e="Mesh",t){this.IndexFormat=t,this.Label=e}CreateVertexBuffer(e,t,i=this.Label){const r=e.CreateVertexBuffer(t,{label:`${i} Vertex Buffer`});this.VertexBuffers=e.SetVertexBuffers(r),e.WriteBuffer(r,t)}CreateIndexBuffer(e,t,i=this.Label){const r=e.CreateIndexBuffer(t,{label:`${i} Index Buffer`});this.IndexBuffer=e.SetIndexBuffer(r,this.IndexFormat),e.SetDrawParams(this.#r=t.length),e.WriteBuffer(r,t)}get Vertices(){return this.#r}get ID(){return this.#t}Destroy(){this.IndexBuffer?.buffer.destroy(),this.IndexBuffer=void 0,this.VertexBuffers&&(this.VertexBuffers[0]?.buffer.destroy(),this.VertexBuffers.splice(0),this.VertexBuffers=void 0)}}class re extends te{#r;#t;constructor(e="Cube"){super(e,"uint16")}GetPositionBufferLayout(e,t={name:"position",format:"float32x3"},i="vertex",r="vertex"){return e.CreateVertexBufferLayout(t,i,r)}CreateTextureCoordsBuffer(e,t,i="vertex",r="vertex"){!Array.isArray(t)&&t?.name,t??="textureCoords";const c=new Float32Array([.5,.5,.75,.5,.5,1,.75,1,.25,.5,.5,.5,.25,1,.5,1,0,0,0,.5,.25,0,.25,.5,.5,0,.5,.5,.75,0,.75,.5,0,.5,.25,.5,0,1,.25,1,.25,0,.5,0,.25,.5,.5,.5]);return this.AddVertexBuffer(e,c,t,i,r)}AddVertexBuffer(e,t,i,r="vertex",c="vertex"){const{buffer:o,layout:f}=e.CreateVertexBuffer(i,this.Vertices,r,c);return this.VertexBuffers=e.AddVertexBuffers(o),e.WriteBuffer(o,t),{buffer:o,layout:f}}#i(e,t=this.Label){super.CreateVertexBuffer(e,this.#t??new Float32Array([-.5,.5,.5,.5,.5,.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5,.5,-.5,-.5,.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,.5,-.5,-.5,.5,.5,.5,.5,.5,-.5,.5,.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,-.5,-.5,.5,-.5,.5]),t)}#s(e,t=this.Label){super.CreateIndexBuffer(e,this.#r??new Uint16Array([0,1,2,2,1,3,4,5,6,6,5,7,8,9,10,10,9,11,12,13,14,14,13,15,16,17,18,18,17,19,20,21,22,22,21,23]),t)}CreateBuffers(e,t=this.Label){this.#i(e,t),this.#s(e,t)}set VertexData(e){this.#t=e}set IndexData(e){this.#r=e}get Vertices(){return(this.#t&&this.#t.length/3)??this.#r?.length??super.Vertices??24}Destroy(){super.Destroy(),this.#r=void 0,this.#t=void 0}}class ie extends ${#r=1;#t=1e3;#i=0;#s=innerWidth;#o=innerHeight;#n=0;#e=new Float32Array(24);constructor(e=1,t=1e3,i=0,r=innerWidth,c=innerHeight,o=0){if(super("OrthographicCamera"),this.#r=e,this.#t=t,this.#i=i,this.#n=o,typeof r!="number"){const[f,p]=r.CanvasSize;this.#s=f,this.#o=p}else this.#s=r,this.#o=c;this.UpdateProjectionMatrix()}#a(e=!1){const[t,i,r,c,o,f,p,b,L,S,C,B,u,n,V,y]=this.ProjectionMatrix;if(this.#e[0]=u+L,this.#e[1]=n+S,this.#e[2]=V+C,this.#e[3]=y+B,this.#e[4]=u-L,this.#e[5]=n-S,this.#e[6]=V-C,this.#e[7]=y-B,this.#e[8]=u-o,this.#e[9]=n-f,this.#e[10]=V-p,this.#e[11]=y-b,this.#e[12]=u-t,this.#e[13]=n-i,this.#e[14]=V-r,this.#e[15]=y-c,this.#e[16]=u+o,this.#e[17]=n+f,this.#e[18]=V+p,this.#e[19]=y+b,this.#e[20]=u+t,this.#e[21]=n+i,this.#e[22]=V+r,this.#e[23]=y+c,!e)return this.#e;for(let w=0;w<6;++w){const g=w*4,m=Math.hypot(this.#e[g+0],this.#e[g+1],this.#e[g+2])||1;this.#e[g+0]/=m,this.#e[g+1]/=m,this.#e[g+2]/=m,this.#e[g+3]/=m}return this.#e}UpdateProjectionMatrix(){return W.ortho(this.#n,this.#s,this.#o,this.#i,this.#r,this.#t,this.ProjectionMatrix),this.#a(),this.ProjectionMatrix}get Frustum(){return this.#e}set Near(e){this.#r=e,this.UpdateProjectionMatrix()}get Near(){return this.#r}set Far(e){this.#t=e,this.UpdateProjectionMatrix()}get Far(){return this.#t}set Top(e){this.#i=e,this.UpdateProjectionMatrix()}get Top(){return this.#i}set Right(e){this.#s=e,this.UpdateProjectionMatrix()}get Right(){return this.#s}set Bottom(e){this.#o=e,this.UpdateProjectionMatrix()}get Bottom(){return this.#o}set Left(e){this.#n=e,this.UpdateProjectionMatrix()}get Left(){return this.#n}}const se=""+new URL("dice-Vcs4qiRq.jpg",import.meta.url).href;var oe="struct VertexOutput{@location(0)textureCoords: vec2f,@builtin(position)position: vec4f};@group(0)@binding(1)var Sampler: sampler;@group(0)@binding(2)var Texture: texture_2d<f32>;@vertex fn cubeVertex(@location(0)position: vec4f,@location(1)textureCoords: vec2f)->VertexOutput {return VertexOutput(textureCoords,GetVertexClipSpace(position));}@fragment fn fragment(@location(0)textureCoords: vec2f)->@location(0)vec4f {return textureSample(Texture,Sampler,textureCoords);}";/**
 * @example Cube / Cameras
 * @author Ustym Ukhman <ustym.ukhman@gmail.com>
 * @description This example is developed by using a version listed below.
 * Please note that this code may be simplified in future
 * thanks to more recent library APIs.
 * @version 0.2.0
 * @license MIT
 */let D,l,T,U;const v=new X;async function le(P){try{l=new(await j.Renderer(P,"Cube / Cameras"))}catch(x){alert(x)}let e,t,i,r=1/0;const c=new re,o=new l.Pipeline,f=s.Vec3.create(),p=new Q,b=new ie,L=s.Vec3.create(),S=s.Vec3.create(),C=new z(c,null),B=new z(c,null),u=s.Vec3.create(),n=s.Vec3.create(),V=s.Vec3.create(),y=o.CreateShaderModule([Z,oe]),{buffer:w,layout:g}=c.CreateTextureCoordsBuffer(o,void 0,void 0,"cubeVertex");await l.AddPipeline(o,{primitive:o.CreatePrimitiveState(),fragment:o.CreateFragmentState(y),multisample:o.CreateMultisampleState(),depthStencil:o.CreateDepthStencilState(),vertex:o.CreateVertexState(y,[c.GetPositionBufferLayout(o),g],void 0,"cubeVertex")});const m=new(await j.Texture(l)),_=await m.CreateImageBitmap(se);T=await m.CopyImageToTexture(_),B.SetRenderPipeline(o,[m.CreateSampler({filter:N.LINEAR}),T.createView()]),C.SetRenderPipeline(o,[m.CreateSampler({filter:N.LINEAR}),T.createView()]),l.CreatePassDescriptor(l.CreateColorAttachment(new E(1657907)),l.CreateDepthStencilAttachment()),o.AddVertexBuffers(w),o.AddVertexBuffers(w),v.Add([C,B]),v.AddCamera(b),v.AddCamera(p);function q(){r=1/0,clearTimeout(i),cancelAnimationFrame(D)}function F(){i=setTimeout(()=>{const x=-e||0,a=s.RandomInt(-2,2)||1/0,h=s.RandomInt(-2,2)||1/0,d=s.RandomInt(-2,2)||1/0;u[0]=Math.PI/a,u[1]=Math.PI/h,u[2]=Math.PI/d,n[0]=Math.PI/a+e,n[1]=!isFinite(a)&&e||Math.abs(a)<2&&x,n[2]=Math.abs(a)===2&&Math.sign(a)*x,n[1]&&=n[1]+Math.PI/h,n[2]&&=n[2]+Math.PI/d,r=Date.now()},1e3)}function G(x){D=requestAnimationFrame(G),x=(Date.now()-r)/1e3;const a=s.SmoothStep(x);let h=s.SmootherStep(x*2);.5<=a&&(h=(.5-(a-.5))*2,a===1&&(s.Vec3.copy(u,V),s.Vec3.copy(n,S),r=1/0,F()));{const[d,R,I]=V;f[0]=s.Lerp(d,u[0],a),f[1]=s.Lerp(R,u[1],a),f[2]=s.Lerp(I,u[2],a),C.Transform=[[0,s.Lerp(0,4,h),0],f],C.Visible=!(B.Visible=!1),v.MainCamera=p,l.Render(v,!1)}{const[d,R,I]=L,[M,A,H]=S;f[0]=s.Lerp(M,n[0],a),f[1]=s.Lerp(A,n[1],a),f[2]=s.Lerp(H,n[2],a),B.Transform=[[d,s.Lerp(R,t,h),I],f],B.Visible=!(C.Visible=!1),v.MainCamera=b,l.Render(v)}}U=new ResizeObserver(x=>{for(const a of x){let{inlineSize:h,blockSize:d}=a.contentBoxSize[0];h=h<=960&&h||h-240,l.SetCanvasSize(h,d),p.ResetLocalMatrix(),b.Bottom=d,b.Right=h,b.Near=-100,l.MultisampleTexture=m.CreateMultisampleTexture(),p.AspectRatio=l.AspectRatio,p.Position=[h/360,2,8],p.UpdateViewProjectionMatrix();const R=d-d/3.6,I=(h-360)/1320;e=I*.2+.1,t=R*.39;const M=I+1;C.Scaling=[M,M,M];const A=(1-(d-1e3)/-400)*36+72;B.Scaling=[A*M,A*M,A*M],s.Vec3.set(.2,e,0,S),s.Vec3.set(h-(I*250+100),R,0,L)}q(),F(),D=requestAnimationFrame(G)}),U.observe(document.body)}function de(){j.OnLost=()=>{},cancelAnimationFrame(D),U.disconnect(),l.Destroy(),v.Destroy(),j.Destroy(void 0,T)}export{de as destroy,le as run};
