import{D as E,C as D,F as U}from"./index-D5xHqY2S.js";import{S as Y,a as O}from"./Shape-DlckO2KJ.js";const V=""+new URL("logo-DEvozEyj.jpg",import.meta.url).href;var I="struct VertexOutput{@location(0)textureCoord: vec2f,@builtin(position)position: vec4f,@location(1)@interpolate(flat)instance: u32};@group(1)@binding(0)var Sampler: sampler;@group(1)@binding(1)var Texture: texture_2d<f32>;@group(1)@binding(2)var<uniform>devicePixelRatio: f32;@group(1)@binding(3)var<storage,read>visible: array<u32>;@vertex fn vertex(@location(0)position: vec2f,@location(1)translation: vec2f,@builtin(instance_index)instance: u32)->VertexOutput{var output: VertexOutput;let dpr=devicePixelRatio*2.75;let aspect=resolution.xy/resolution.y;let clipSpace=GetVertexClipSpace(position).xy;output.position=vec4f(clipSpace+translation,0,1);output.textureCoord=clipSpace*aspect*dpr+0.5;output.instance=instance;return output;}@fragment fn fragment(@location(0)textureCoord: vec2f,@location(1)@interpolate(flat)instance: u32)->@location(0)vec4f{if(visible[instance]==0){discard;}return textureSample(Texture,Sampler,textureCoord);}";/**
 * @example Textures / Instancing
 * @author Ustym Ukhman <ustym.ukhman@gmail.com>
 * @description This example is developed by using a version listed below.
 * Please note that this code may be simplified in future
 * thanks to more recent library APIs.
 * @version 0.0.5
 * @license MIT
 */let l,m,S,p,u,d,t;async function W(i){try{t=new(await E.RenderPipeline(i,"Textures / Instancing"))}catch(e){alert(e)}const g=128,s=256;let n,B,C,f,o=512,T=performance.now()-o;const v=t.CreateShaderModule([Y,I]),y=t.CreateColorAttachment();y.clearValue=new D(1651532).rgba,t.CreatePassDescriptor(y),t.CreatePipeline({fragment:t.CreateFragmentState(v),vertex:t.CreateVertexState(v,void 0,[{arrayStride:Float32Array.BYTES_PER_ELEMENT*2,attributes:[t.CreateVertexBufferAttribute("float32x2")]},{stepMode:"instance",arrayStride:Float32Array.BYTES_PER_ELEMENT*2,attributes:[t.CreateVertexBufferAttribute("float32x2",1)]}])});function _(){cancelAnimationFrame(l),clearTimeout(C),T=performance.now()-o}async function b(){h(),w(),F(),M(),await G(),requestAnimationFrame(P),C=setTimeout(()=>o=~(f=-1),o*3)}function h(){const e=new O({renderer:t,segments:4,radius:g});e.Position=[i.width/2,i.height/2],e.Rotation=Math.PI/4,B=e.Update().Vertices}function w(){const e=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,r=Float32Array.BYTES_PER_ELEMENT;p=t.CreateBuffer({size:r,usage:e}),t.WriteBuffer(p,new Float32Array([devicePixelRatio]))}function F(){const e=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST,r=Uint32Array.BYTES_PER_ELEMENT*s;n=new Uint32Array(r/Uint32Array.BYTES_PER_ELEMENT),u=t.CreateBuffer({size:r,usage:e}),t.WriteBuffer(u,n)}function M(){const e=1-Math.sqrt(2)*g/i.height,r=1-Math.sqrt(2)*g/i.width,a=Float32Array.BYTES_PER_ELEMENT*2,c=a*s,L=GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,N=a/Float32Array.BYTES_PER_ELEMENT,A=new Float32Array(c/Float32Array.BYTES_PER_ELEMENT);for(let R=s;R--;)A.set([x(-r,r),x(-e,e)],N*R);d=t.CreateBuffer({size:c,usage:L}),t.WriteBuffer(d,A),t.AddVertexBuffers(d)}async function G(){const e=new(await E.Texture()),r=await e.CreateBitmapImage(await(await fetch(V)).blob(),{colorSpaceConversion:"none"});S=e.CopyImageToTexture(r,{flipY:!0,create:{usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST,format:"rgba8unorm",mipmaps:!1}}),t.AddBindGroups(t.CreateBindGroup(t.CreateBindGroupEntries([e.CreateSampler({magFilter:U.LINEAR,minFilter:U.LINEAR}),S.createView(),{buffer:p},{buffer:u}]),1))}function x(e,r){return e===void 0?(e=0,r=1):r===void 0&&(r=e,e=0),Math.random()*(r-e)+e}function P(e){l=requestAnimationFrame(P),!(e-T<o)&&(o?n.fill(0)&&(f=x(n.length)|0):++f===n.length-1&&cancelAnimationFrame(l),T=e,n[f]=1,t.WriteBuffer(u,n),t.Render([B,s]))}m=new ResizeObserver(e=>{for(const r of e){let{inlineSize:a,blockSize:c}=r.contentBoxSize[0];a=a<=960&&a||a-240,t.SetCanvasSize(a,c)}_(),b()}),m.observe(document.body)}function j(){E.OnDeviceLost=()=>{},cancelAnimationFrame(l),m.disconnect(),t.Destroy(),E.Destroy([p,u,d],S)}export{j as destroy,W as run};
