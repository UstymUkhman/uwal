var Lt=Object.defineProperty;var Mt=s=>{throw TypeError(s)};var Et=(s,r,t)=>r in s?Lt(s,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[r]=t;var ct=(s,r,t)=>Et(s,typeof r!="symbol"?r+"":r,t),ht=(s,r,t)=>r.has(s)||Mt("Cannot "+t);var e=(s,r,t)=>(ht(s,r,"read from private field"),t?t.call(s):r.get(s)),h=(s,r,t)=>r.has(s)?Mt("Cannot add the same private member more than once"):r instanceof WeakSet?r.add(s):r.set(s,t),o=(s,r,t,m)=>(ht(s,r,"write to private field"),m?m.call(s,t):r.set(s,t),t),$=(s,r,t)=>(ht(s,r,"access private method"),t);import{G as Gt,m as i,a as Nt,D as K,v as c,C as Yt,F as St,U as bt}from"./index-BNSavNwh.js";var Q,w,O,g,p,C,v,A,b,Rt,Ut,wt;class Tt{constructor(r,t){h(this,b);h(this,Q,new Float32Array([.5,.5,.75,.5,.5,1,.75,1,.25,.5,.5,.5,.25,1,.5,1,0,0,0,.5,.25,0,.25,.5,.5,0,.5,.5,.75,0,.75,.5,0,.5,.25,.5,0,1,.25,1,.25,0,.5,0,.25,.5,.5,.5]));h(this,w);h(this,O);h(this,g);h(this,p);h(this,C);h(this,v,[]);h(this,A,new Float32Array(16));o(this,p,r),o(this,w,t??"Cube"),$(this,b,Rt).call(this),$(this,b,Ut).call(this),$(this,b,wt).call(this)}AddVertexBuffers(r){e(this,v).push(...Gt(r))}UpdateTransformBuffer(){e(this,p).WriteBuffer(e(this,C),e(this,A))}Render(r=!0){e(this,p).SavePipelineState(),e(this,p).Render(this.Update(),r),e(this,p).RestorePipelineState()}Update(){return e(this,p).WriteBuffer(e(this,C),e(this,A)),e(this,p).SetIndexBuffer(e(this,g),"uint16"),e(this,p).SetVertexBuffers(e(this,v)),e(this,O)}get PositionAttribute(){return{name:"position",format:"float32x3"}}get TransformBuffer(){return e(this,C)}get Transform(){return e(this,A)}get Vertices(){return e(this,O)}get UV(){return e(this,Q)}Destroy(){o(this,C,e(this,C).destroy()),e(this,v).forEach(r=>r.destroy()),o(this,g,e(this,g).destroy()),e(this,v).splice(0)}}Q=new WeakMap,w=new WeakMap,O=new WeakMap,g=new WeakMap,p=new WeakMap,C=new WeakMap,v=new WeakMap,A=new WeakMap,b=new WeakSet,Rt=function(){const r=new Uint16Array([0,1,2,2,1,3,4,5,6,6,5,7,8,9,10,10,9,11,12,13,14,14,13,15,16,17,18,18,17,19,20,21,22,22,21,23]);o(this,g,e(this,p).CreateIndexBuffer(r,{label:`${e(this,w)} Index Buffer`})),e(this,p).WriteBuffer(e(this,g),r),e(this,p).SetIndexBuffer(e(this,g),"uint16"),o(this,O,r.length)},Ut=function(){const r=new Float32Array([-1,1,1,1,1,1,-1,1,-1,1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,-1,-1,-1,-1,1,1,-1,-1,1,1,1,1,1,-1,1,1,1,-1,1,-1,-1,-1,1,-1,-1,-1,-1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,-1,1,1,-1,1,1,1,1,-1,-1,1,-1,1]),t=e(this,p).CreateVertexBuffer(r,{label:`${e(this,w)} Vertex Buffer`});e(this,p).WriteBuffer(t,r),e(this,p).SetVertexBuffers(t),e(this,v).push(t)},wt=function(){o(this,C,e(this,p).CreateBuffer({size:e(this,A).length*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,label:`${e(this,w)} Uniform Buffer`}))};class At{constructor(){ct(this,"Matrix",i.identity());ct(this,"Projection",i.identity())}get Matrix(){return this.Matrix}get Projection(){return this.Projection}}var V,j,F,M,S,I;class Ot extends At{constructor(t=1,m=1e3,y=0,P=innerWidth,_=innerHeight,x=0){super();h(this,V,1);h(this,j,1e3);h(this,F,0);h(this,M,innerWidth);h(this,S,innerHeight);h(this,I,0);if(o(this,V,t),o(this,j,m),o(this,F,y),o(this,I,x),typeof P!="number"){const[l,T]=P.CanvasSize;o(this,M,l),o(this,S,T)}else o(this,M,P),o(this,S,_);this.UpdateProjection()}UpdateProjection(){return i.ortho(e(this,I),e(this,M),e(this,S),e(this,F),e(this,V),e(this,j),this.Projection)}set Near(t){o(this,V,t),this.UpdateProjection()}get Near(){return e(this,V)}set Far(t){o(this,j,t),this.UpdateProjection()}get Far(){return e(this,j)}set Top(t){o(this,F,t),this.UpdateProjection()}get Top(){return e(this,F)}set Right(t){o(this,M,t),this.UpdateProjection()}get Right(){return e(this,M)}set Bottom(t){o(this,S,t),this.UpdateProjection()}get Bottom(){return e(this,S)}set Left(t){o(this,I,t),this.UpdateProjection()}get Left(){return e(this,I)}}V=new WeakMap,j=new WeakMap,F=new WeakMap,M=new WeakMap,S=new WeakMap,I=new WeakMap;var W,tt,D,L,E,G,et,rt;class Wt extends At{constructor(t=60,m=1,y=1e3,P=innerWidth/innerHeight){super();h(this,W,i.identity());h(this,tt,i.identity());h(this,D,60);h(this,L,1);h(this,E,1e3);h(this,G,innerWidth/innerHeight);h(this,et,new Float32Array([0,1,0]));h(this,rt,new Float32Array([0,0,0]));o(this,D,t),o(this,L,m),o(this,E,y),o(this,G,typeof P!="number"?P.AspectRatio:P),this.UpdateProjection()}UpdateProjection(){return i.perspective(Nt(e(this,D)),e(this,G),e(this,L),e(this,E),this.Projection)}UpdateViewProjection(t=!0){return t&&i.inverse(this.Matrix,e(this,W)),i.multiply(this.Projection,e(this,W),e(this,tt))}LookAt(t,m=e(this,et)){i.lookAt(this.Position,t,m,e(this,W))}Translate(t){i.translate(this.Matrix,t,this.Matrix)}SetRotationAxis(t,m){i.rotation(t,m,this.Matrix)}RotateAxis(t,m){i.rotate(this.Matrix,t,m,this.Matrix)}RotateX(t){i.rotateX(this.Matrix,t,this.Matrix)}RotateY(t){i.rotateY(this.Matrix,t,this.Matrix)}RotateZ(t){i.rotateZ(this.Matrix,t,this.Matrix)}set FieldOfView(t){o(this,D,t),this.UpdateProjection()}get FieldOfView(){return e(this,D)}set Near(t){o(this,L,t),this.UpdateProjection()}get Near(){return e(this,L)}set Far(t){o(this,E,t),this.UpdateProjection()}get Far(){return e(this,E)}set AspectRatio(t){o(this,G,typeof t!="number"?t.AspectRatio:t),this.UpdateProjection()}get AspectRatio(){return e(this,G)}set Position(t){i.setTranslation(this.Matrix,t,this.Matrix)}get Position(){return i.getTranslation(this.Matrix,e(this,rt))}set RotationX(t){i.rotationX(t,this.Matrix)}set RotationY(t){i.rotationY(t,this.Matrix)}set RotationZ(t){i.rotationZ(t,this.Matrix)}}W=new WeakMap,tt=new WeakMap,D=new WeakMap,L=new WeakMap,E=new WeakMap,G=new WeakMap,et=new WeakMap,rt=new WeakMap;const zt=""+new URL("dice-Vcs4qiRq.jpg",import.meta.url).href;var Xt="struct VertexOutput{@location(0)textureCoord: vec2f,@builtin(position)position: vec4f};@group(0)@binding(0)var Sampler: sampler;@group(0)@binding(1)var Texture: texture_2d<f32>;@group(0)@binding(2)var<uniform>projection: mat4x4f;@vertex fn vertex(@location(1)textureCoord: vec2f,@location(0)position: vec4f)->VertexOutput{var output: VertexOutput;output.position=projection*position;output.textureCoord=textureCoord;return output;}@fragment fn fragment(@location(0)textureCoord: vec2f)->@location(0)vec4f {return textureSample(Texture,Sampler,textureCoord);}";/**
 * @example Cube / Cameras
 * @author Ustym Ukhman <ustym.ukhman@gmail.com>
 * @description This example is developed by using a version listed below.
 * Please note that this code may be simplified in future
 * thanks to more recent library APIs.
 * @version 0.0.12
 * @license MIT
 */let J,n,k,ut;async function _t(s){try{n=new(await K.RenderPipeline(s,"Cube / Cameras"))}catch(u){alert(u)}const r=c.create(),t=c.create();let m,y=1/0,P,_;const x=c.create(),l=c.create(),T=new Wt,R=new Tt(n),q=new Ot,H=new Tt(n),N=new(await K.LegacyTexture(n)),ft=await N.CreateBitmapImage(await(await fetch(zt)).blob(),{colorSpaceConversion:"none"}),pt=n.CreateColorAttachment();pt.clearValue=new Yt(1657907).rgba,k=N.CreateTextureFromSource(ft);const lt=n.CreateShaderModule(Xt);N.CopyImageToTexture(ft,{texture:k}),n.CreatePassDescriptor(pt,void 0,n.CreateDepthAttachment()),n.CreatePipeline({primitive:{cullMode:"back"},fragment:n.CreateFragmentState(lt),multisample:n.CreateMultisampleState(),depthStencil:n.CreateDepthStencilState(),vertex:n.CreateVertexState(lt,void 0,[n.CreateVertexBufferLayout(R.PositionAttribute),n.CreateVertexBufferLayout("textureCoord")])}),n.AddBindGroups([n.CreateBindGroup(n.CreateBindGroupEntries([N.CreateSampler({filter:St.LINEAR}),k.createView(),{buffer:R.TransformBuffer}])),n.CreateBindGroup(n.CreateBindGroupEntries([N.CreateSampler({filter:St.LINEAR}),k.createView(),{buffer:H.TransformBuffer}]))]),T.Position=[0,-2,8],T.LookAt([0,0,0]);const Vt=T.UpdateViewProjection(!1),it=n.CreateVertexBuffer(R.UV);n.WriteBuffer(it,R.UV),H.AddVertexBuffers(it),R.AddVertexBuffers(it);const dt=c.create(),z=c.create(),ot=c.create(),X=c.create(),mt=c.create(),xt=c.create(),st=c.create(),Z=c.create(),Pt=c.create();function Y(u=-2,f=2){return(Math.random()*(f-u+1)|0)+u}function B(u,f,d){return u+d*(f-u)}function jt(){y=1/0,clearTimeout(m),cancelAnimationFrame(J)}function gt(){m=setTimeout(()=>{let u=Y()||1/0;const f=Y()||1/0;x[0]=Math.PI/u,x[1]=Math.PI/f,x[2]=Math.PI/(Y()||1/0);const d=((Math.abs(f)===1||!isFinite(f))&&-(u===-2||!isFinite(u))*2+1||Math.sign(f))*(isFinite(f)*2-1);x[0]+=z[0],x[1]+=z[1],x[2]+=z[2]*d,u=Y()||1/0,l[0]=Math.PI/u+.35,l[1]=!isFinite(u)&&.35||Math.abs(u)<2&&-.35||0,l[2]=Math.abs(u)===2&&Math.sign(u)*-.35||0,l[1]&&(l[1]=l[1]+Math.PI/(Y()||1/0)),l[2]&&(l[2]=l[2]+Math.PI/(Y()||1/0)),y=Date.now()},1e3)}function Ct(u){J=requestAnimationFrame(Ct),u=(Date.now()-y)/1e3;const f=bt.SmoothStep(u);let d=bt.SmootherStep(u*2);.5<=f&&(d=(.5-(f-.5))*2,f===1&&(c.copy(l,Z),c.copy(x,X),y=1/0,gt()));{const a=R.Transform;i.copy(Vt,a),c.copy(ot,r),r[1]=B(ot[1],P,d),i.translate(a,r,a),t[0]=B(X[0],x[0],f),t[1]=B(X[1],x[1],f),t[2]=B(X[2],x[2],f),i.rotateX(a,t[0],a),i.rotateY(a,t[1],a),i.rotateZ(a,t[2],a),i.scale(a,mt,a),n.SetActiveBindGroups(0),R.Render(!1)}{const a=H.Transform;i.copy(q.Projection,a),c.copy(st,r),r[1]=B(st[1],_,d),i.translate(a,r,a),t[0]=B(Z[0],l[0],f),t[1]=B(Z[1],l[1],f),t[2]=B(Z[2],l[2],f),i.rotateX(a,t[0],a),i.rotateY(a,t[1],a),i.rotateZ(a,t[2],a),i.scale(a,Pt,a),n.SetActiveBindGroups(1),H.Render()}}ut=new ResizeObserver(u=>{for(const f of u){let{inlineSize:d,blockSize:a}=f.contentBoxSize[0];d=d<=960&&d||d-240,n.SetCanvasSize(d,a),n.MultisampleTexture=N.CreateMultisampleTexture(),T.AspectRatio=n.AspectRatio,T.UpdateViewProjection(!1),q.Bottom=a,q.Right=d,q.Near=-100;const U=(d-360)/1272,Ft=U*245+110,at=U*.5+.5,nt=U*80+30,It=U*-3-1,yt=U*-1-1,Dt=U*-.05;c.set(at,at,at,mt),c.set(It,yt,0,dt),c.set(.35,0,Dt,z);const Bt=1-(U*.13+.61),vt=Bt*a;P=yt*-1,_=a-vt-Bt*d,c.set(nt,nt,nt,Pt),c.set(.35,.35,0,Z),c.set(d-Ft,a-vt,0,xt),c.copy(xt,st),c.copy(dt,ot),c.copy(z,X)}jt(),gt(),J=requestAnimationFrame(Ct)}),ut.observe(document.body)}function qt(){K.OnDeviceLost=()=>{},cancelAnimationFrame(J),ut.disconnect(),n.Destroy(),K.Destroy(void 0,k)}export{qt as destroy,_t as run};
