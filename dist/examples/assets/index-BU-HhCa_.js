var Lt=Object.defineProperty;var Mt=s=>{throw TypeError(s)};var Et=(s,i,t)=>i in s?Lt(s,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[i]=t;var ht=(s,i,t)=>Et(s,typeof i!="symbol"?i+"":i,t),ct=(s,i,t)=>i.has(s)||Mt("Cannot "+t);var e=(s,i,t)=>(ct(s,i,"read from private field"),t?t.call(s):i.get(s)),c=(s,i,t)=>i.has(s)?Mt("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(s):i.set(s,t),o=(s,i,t,m)=>(ct(s,i,"write to private field"),m?m.call(s,t):i.set(s,t),t),J=(s,i,t)=>(ct(s,i,"access private method"),t);import{m as r,a as Nt,D as Q,v as h,C as Yt,F as St,U as bt}from"./index-D5xHqY2S.js";var tt,w,O,p,g,C,v,A,b,Rt,Ut,wt;class Tt{constructor(i,t){c(this,b);c(this,tt,new Float32Array([.5,.5,.75,.5,.5,1,.75,1,.25,.5,.5,.5,.25,1,.5,1,0,0,0,.5,.25,0,.25,.5,.5,0,.5,.5,.75,0,.75,.5,0,.5,.25,.5,0,1,.25,1,.25,0,.5,0,.25,.5,.5,.5]));c(this,w);c(this,O);c(this,p);c(this,g);c(this,C);c(this,v,[]);c(this,A,new Float32Array(16));o(this,p,i),o(this,w,t??"Cube"),J(this,b,Rt).call(this),J(this,b,Ut).call(this),J(this,b,wt).call(this)}AddVertexBuffers(i){e(this,v).push(...Array.isArray(i)&&i||[i])}UpdateTransformBuffer(){e(this,p).WriteBuffer(e(this,C),e(this,A))}Render(i=!0){e(this,p).SavePipelineState(),e(this,p).Render(this.Update(),i),e(this,p).RestorePipelineState()}Update(){return e(this,p).WriteBuffer(e(this,C),e(this,A)),e(this,p).SetIndexBuffer(e(this,g),"uint16"),e(this,p).SetVertexBuffers(e(this,v)),e(this,O)}get PositionAttribute(){return{name:"position",format:"float32x3"}}get TransformBuffer(){return e(this,C)}get Transform(){return e(this,A)}get Vertices(){return e(this,O)}get UV(){return e(this,tt)}Destroy(){o(this,C,e(this,C).destroy()),e(this,v).forEach(i=>i.destroy()),o(this,g,e(this,g).destroy()),e(this,v).splice(0)}}tt=new WeakMap,w=new WeakMap,O=new WeakMap,p=new WeakMap,g=new WeakMap,C=new WeakMap,v=new WeakMap,A=new WeakMap,b=new WeakSet,Rt=function(){const i=new Uint16Array([0,1,2,2,1,3,4,5,6,6,5,7,8,9,10,10,9,11,12,13,14,14,13,15,16,17,18,18,17,19,20,21,22,22,21,23]);o(this,g,e(this,p).CreateIndexBuffer(i,{label:`${e(this,w)} Index Buffer`})),e(this,p).WriteBuffer(e(this,g),i),e(this,p).SetIndexBuffer(e(this,g),"uint16"),o(this,O,i.length)},Ut=function(){const i=new Float32Array([-1,1,1,1,1,1,-1,1,-1,1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,-1,-1,-1,-1,1,1,-1,-1,1,1,1,1,1,-1,1,1,1,-1,1,-1,-1,-1,1,-1,-1,-1,-1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,-1,1,1,-1,1,1,1,1,-1,-1,1,-1,1]),t=e(this,p).CreateVertexBuffer(i,{label:`${e(this,w)} Vertex Buffer`});e(this,p).WriteBuffer(t,i),e(this,p).SetVertexBuffers(t),e(this,v).push(t)},wt=function(){o(this,C,e(this,p).CreateBuffer({size:e(this,A).length*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,label:`${e(this,w)} Uniform Buffer`}))};class At{constructor(){ht(this,"Matrix",r.identity());ht(this,"Projection",r.identity())}get Matrix(){return this.Matrix}get Projection(){return this.Projection}}var V,j,F,M,S,I;class Gt extends At{constructor(t=1,m=1e3,y=0,P=innerWidth,q=innerHeight,x=0){super();c(this,V,1);c(this,j,1e3);c(this,F,0);c(this,M,innerWidth);c(this,S,innerHeight);c(this,I,0);if(o(this,V,t),o(this,j,m),o(this,F,y),o(this,I,x),typeof P!="number"){const[l,T]=P.CanvasSize;o(this,M,l),o(this,S,T)}else o(this,M,P),o(this,S,q);this.UpdateProjection()}UpdateProjection(){return r.ortho(e(this,I),e(this,M),e(this,S),e(this,F),e(this,V),e(this,j),this.Projection)}set Near(t){o(this,V,t),this.UpdateProjection()}get Near(){return e(this,V)}set Far(t){o(this,j,t),this.UpdateProjection()}get Far(){return e(this,j)}set Top(t){o(this,F,t),this.UpdateProjection()}get Top(){return e(this,F)}set Right(t){o(this,M,t),this.UpdateProjection()}get Right(){return e(this,M)}set Bottom(t){o(this,S,t),this.UpdateProjection()}get Bottom(){return e(this,S)}set Left(t){o(this,I,t),this.UpdateProjection()}get Left(){return e(this,I)}}V=new WeakMap,j=new WeakMap,F=new WeakMap,M=new WeakMap,S=new WeakMap,I=new WeakMap;var k,_,D,L,E,N,et,it;class Ot extends At{constructor(t=60,m=1,y=1e3,P=innerWidth/innerHeight){super();c(this,k,r.identity());c(this,_,r.identity());c(this,D,60);c(this,L,1);c(this,E,1e3);c(this,N,innerWidth/innerHeight);c(this,et,new Float32Array([0,1,0]));c(this,it,new Float32Array([0,0,0]));o(this,D,t),o(this,L,m),o(this,E,y),o(this,N,typeof P!="number"?P.AspectRatio:P),this.UpdateProjection()}UpdateProjection(){return r.perspective(Nt(e(this,D)),e(this,N),e(this,L),e(this,E),this.Projection)}UpdateViewProjection(t=!0){return t&&r.inverse(this.Matrix,e(this,_)),r.multiply(this.Projection,e(this,k),e(this,_))}LookAt(t,m=e(this,et)){r.lookAt(this.Position,t,m,e(this,k))}Translate(t){r.translate(this.Matrix,t,this.Matrix)}SetRotationAxis(t,m){r.rotation(t,m,this.Matrix)}RotateAxis(t,m){r.rotate(this.Matrix,t,m,this.Matrix)}RotateX(t){r.rotateX(this.Matrix,t,this.Matrix)}RotateY(t){r.rotateY(this.Matrix,t,this.Matrix)}RotateZ(t){r.rotateZ(this.Matrix,t,this.Matrix)}set FieldOfView(t){o(this,D,t),this.UpdateProjection()}get FieldOfView(){return e(this,D)}set Near(t){o(this,L,t),this.UpdateProjection()}get Near(){return e(this,L)}set Far(t){o(this,E,t),this.UpdateProjection()}get Far(){return e(this,E)}set AspectRatio(t){o(this,N,typeof t!="number"?t.AspectRatio:t),this.UpdateProjection()}get AspectRatio(){return e(this,N)}set Position(t){r.setTranslation(this.Matrix,t,this.Matrix)}get Position(){return r.getTranslation(this.Matrix,e(this,it))}set RotationX(t){r.rotationX(t,this.Matrix)}set RotationY(t){r.rotationY(t,this.Matrix)}set RotationZ(t){r.rotationZ(t,this.Matrix)}}k=new WeakMap,_=new WeakMap,D=new WeakMap,L=new WeakMap,E=new WeakMap,N=new WeakMap,et=new WeakMap,it=new WeakMap;const Wt=""+new URL("dice-Vcs4qiRq.jpg",import.meta.url).href;var zt="struct VertexOutput{@location(0)textureCoord: vec2f,@builtin(position)position: vec4f};@group(0)@binding(0)var Sampler: sampler;@group(0)@binding(1)var Texture: texture_2d<f32>;@group(0)@binding(2)var<uniform>projection: mat4x4f;@vertex fn vertex(@location(1)textureCoord: vec2f,@location(0)position: vec4f)->VertexOutput{var output: VertexOutput;output.position=projection*position;output.textureCoord=textureCoord;return output;}@fragment fn fragment(@location(0)textureCoord: vec2f)->@location(0)vec4f {return textureSample(Texture,Sampler,textureCoord);}";/**
 * @example Cube / Cameras
 * @author Ustym Ukhman <ustym.ukhman@gmail.com>
 * @description This example is developed by using a version listed below.
 * Please note that this code may be simplified in future
 * thanks to more recent library APIs.
 * @version 0.0.12
 * @license MIT
 */let K,n,Z,ut;async function kt(s){try{n=new(await Q.RenderPipeline(s,"Cube / Cameras"))}catch(u){alert(u)}const i=h.create(),t=h.create();let m,y=1/0,P,q;const x=h.create(),l=h.create(),T=new Ot,R=new Tt(n),H=new Gt,$=new Tt(n),Y=new(await Q.Texture(n)),ft=await Y.CreateBitmapImage(await(await fetch(Wt)).blob(),{colorSpaceConversion:"none"}),pt=n.CreateColorAttachment();pt.clearValue=new Yt(1657907).rgba,Z=Y.CreateTextureFromSource(ft);const lt=n.CreateShaderModule(zt);Y.CopyImageToTexture(ft,{texture:Z}),n.CreatePassDescriptor(pt,void 0,n.CreateDepthAttachment()),n.CreatePipeline({primitive:{cullMode:"back"},fragment:n.CreateFragmentState(lt),multisample:n.CreateMultisampleState(),depthStencil:n.CreateDepthStencilState(),vertex:n.CreateVertexState(lt,void 0,[n.CreateVertexBufferLayout(R.PositionAttribute),n.CreateVertexBufferLayout("textureCoord")])}),n.AddBindGroups([n.CreateBindGroup(n.CreateBindGroupEntries([Y.CreateSampler({filter:St.LINEAR}),Z.createView(),{buffer:R.TransformBuffer}])),n.CreateBindGroup(n.CreateBindGroupEntries([Y.CreateSampler({filter:St.LINEAR}),Z.createView(),{buffer:$.TransformBuffer}]))]),T.Position=[0,-2,8],T.LookAt([0,0,0]);const Vt=T.UpdateViewProjection(!1),rt=n.CreateVertexBuffer(R.UV);n.WriteBuffer(rt,R.UV),$.AddVertexBuffers(rt),R.AddVertexBuffers(rt);const dt=h.create(),W=h.create(),ot=h.create(),z=h.create(),mt=h.create(),xt=h.create(),st=h.create(),X=h.create(),Pt=h.create();function G(u=-2,f=2){return(Math.random()*(f-u+1)|0)+u}function B(u,f,d){return u+d*(f-u)}function jt(){y=1/0,clearTimeout(m),cancelAnimationFrame(K)}function gt(){m=setTimeout(()=>{let u=G()||1/0;const f=G()||1/0;x[0]=Math.PI/u,x[1]=Math.PI/f,x[2]=Math.PI/(G()||1/0);const d=((Math.abs(f)===1||!isFinite(f))&&-(u===-2||!isFinite(u))*2+1||Math.sign(f))*(isFinite(f)*2-1);x[0]+=W[0],x[1]+=W[1],x[2]+=W[2]*d,u=G()||1/0,l[0]=Math.PI/u+.35,l[1]=!isFinite(u)&&.35||Math.abs(u)<2&&-.35||0,l[2]=Math.abs(u)===2&&Math.sign(u)*-.35||0,l[1]&&(l[1]=l[1]+Math.PI/(G()||1/0)),l[2]&&(l[2]=l[2]+Math.PI/(G()||1/0)),y=Date.now()},1e3)}function Ct(u){K=requestAnimationFrame(Ct),u=(Date.now()-y)/1e3;const f=bt.SmoothStep(u);let d=bt.SmootherStep(u*2);.5<=f&&(d=(.5-(f-.5))*2,f===1&&(h.copy(l,X),h.copy(x,z),y=1/0,gt()));{const a=R.Transform;r.copy(Vt,a),h.copy(ot,i),i[1]=B(ot[1],P,d),r.translate(a,i,a),t[0]=B(z[0],x[0],f),t[1]=B(z[1],x[1],f),t[2]=B(z[2],x[2],f),r.rotateX(a,t[0],a),r.rotateY(a,t[1],a),r.rotateZ(a,t[2],a),r.scale(a,mt,a),n.SetActiveBindGroups(0),R.Render(!1)}{const a=$.Transform;r.copy(H.Projection,a),h.copy(st,i),i[1]=B(st[1],q,d),r.translate(a,i,a),t[0]=B(X[0],l[0],f),t[1]=B(X[1],l[1],f),t[2]=B(X[2],l[2],f),r.rotateX(a,t[0],a),r.rotateY(a,t[1],a),r.rotateZ(a,t[2],a),r.scale(a,Pt,a),n.SetActiveBindGroups(1),$.Render()}}ut=new ResizeObserver(u=>{for(const f of u){let{inlineSize:d,blockSize:a}=f.contentBoxSize[0];d=d<=960&&d||d-240,n.SetCanvasSize(d,a),n.MultisampleTexture=Y.CreateMultisampleTexture(),T.AspectRatio=n.AspectRatio,T.UpdateViewProjection(!1),H.Bottom=a,H.Right=d,H.Near=-100;const U=(d-360)/1272,Ft=U*245+110,at=U*.5+.5,nt=U*80+30,It=U*-3-1,yt=U*-1-1,Dt=U*-.05;h.set(at,at,at,mt),h.set(It,yt,0,dt),h.set(.35,0,Dt,W);const Bt=1-(U*.13+.61),vt=Bt*a;P=yt*-1,q=a-vt-Bt*d,h.set(nt,nt,nt,Pt),h.set(.35,.35,0,X),h.set(d-Ft,a-vt,0,xt),h.copy(xt,st),h.copy(dt,ot),h.copy(W,z)}jt(),gt(),K=requestAnimationFrame(Ct)}),ut.observe(document.body)}function _t(){Q.OnDeviceLost=()=>{},cancelAnimationFrame(K),ut.disconnect(),n.Destroy(),Q.Destroy(void 0,Z)}export{_t as destroy,kt as run};
