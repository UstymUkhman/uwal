import{G as M,C as P,D as y}from"./index-CE6-3cgY.js";import{S as U,a as D,b as x}from"./Shape-DlQiQpme.js";import{M as o}from"./Math-Cr7J2GA5.js";var _="@group(0)@binding(2)var<uniform>color: vec4f;@fragment fn fragment()->@location(0)vec4f {return color;}";const G=`${U}

${_}`;class O{#t;#n;#o;#e;constructor(t=16777215){this.Color=t}CreateColorBuffer(t,h="Shape"){const{color:i,buffer:f}=t.CreateUniformBuffer("color",{label:`${h} Color Buffer`});this.#t=i,this.#n=t,this.#e=f,this.#t.set(this.#o),t.WriteBuffer(f,i)}get ColorBuffer(){return this.#e}set Color(t){this.#o=typeof t=="number"&&M(t)||t instanceof P&&t.rgba||Object.values(t),this.#t?.fill(1).set(this.#o),this.#n?.WriteBuffer(this.#e,this.#t)}get Color(){return this.#o}Destroy(){this.#n=void 0,this.#e.destroy(),this.#e=void 0}}/**
 * @example 2D Shapes
 * @author Ustym Ukhman <ustym.ukhman@gmail.com>
 * @description This example is developed by using a version listed below.
 * Please note that this code may be simplified in future
 * thanks to more recent library APIs.
 * @version 0.2.0
 * @license MIT
 */let R,r;const d=[];let v;async function W(p){try{r=new(await y.Renderer(p,"2D Shapes"))}catch(s){alert(s)}const t=new P(3349069),h=[],i=[],f=[],c=new r.Pipeline,b=new D(new x),w=c.CreateShaderModule(G);await r.AddPipeline(c,{fragment:c.CreateFragmentState(w),vertex:c.CreateVertexState(w,b.GetPositionBufferLayout(c))}),r.CreatePassDescriptor(r.CreateColorAttachment(t));function A(){h.splice(0),i.splice(0),d.splice(0),f.splice(0),cancelAnimationFrame(R)}function z(){b.Destroy(),$(),R=requestAnimationFrame(B)}function g(){return t.rgb=[o.Random(.3),o.Random(.2),o.Random(.4)]}function $(){const[s,u]=r.CanvasSize;for(let e=3;e<=12;e++){const m=e===11&&64||e;for(let n=0;n<2;n++){const a=o.Random(50,100),C=o.Random(.75,.95)*a,S=new x({segments:m,radius:a,innerRadius:C*n}),l=new D(S,new O(g()));l.SetRenderPipeline(c,r.ResolutionBuffer),l.Rotation=o.Random(0,o.TAU),l.Position=[o.Random(a,s-a),o.Random(a,u-a)],i.push(o.Random(1,10)),h.push(o.Random(0,.1)),f.push([o.Random(-1,1),o.Random(-1,1)]),d.push(l)}}}function B(){const[s,u]=r.CanvasSize;for(let e=0,m=d.length;e<m;e++){const n=d[e],a=f[e],{min:C,max:S}=n.BoundingBox,[l,F]=n.Position;(C[0]<=0||S[0]>=s)&&(a[0]*=-1,n.Material.Color=g()),(C[1]<=0||S[1]>=u)&&(a[1]*=-1,n.Material.Color=g()),n.Position=[l+a[0]*i[e],F+a[1]*i[e]],n.Rotation+=h[e],n.Update(),n.SetPipelineData(),r.Render(!1)}r.Submit(),R=requestAnimationFrame(B)}v=new ResizeObserver(s=>{for(const u of s){let{inlineSize:e,blockSize:m}=u.contentBoxSize[0];e=e<=960&&e||e-240,r.SetCanvasSize(e,m)}A(),z()}),v.observe(document.body)}function j(){d.forEach(p=>p.Destroy()),y.OnLost=()=>{},cancelAnimationFrame(R),v.disconnect(),r.Destroy(),d.splice(0),y.Destroy()}export{j as destroy,W as run};
