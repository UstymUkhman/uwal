import{G as it,m as e,v as s,a as ot,D as V,C as st,F as q,U as H}from"./index-DM-yqRiN.js";class ${#a=new Float32Array([.5,.5,.75,.5,.5,1,.75,1,.25,.5,.5,.5,.25,1,.5,1,0,0,0,.5,.25,0,.25,.5,.5,0,.5,.5,.75,0,.75,.5,0,.5,.25,.5,0,1,.25,1,.25,0,.5,0,.25,.5,.5,.5]);#o;#i;#r;#t;#e;#s=[];#n=new Float32Array(16);constructor(t,i){this.#t=t,this.#o=i??"Cube",this.#h(),this.#c(),this.#u()}#h(){const t=new Uint16Array([0,1,2,2,1,3,4,5,6,6,5,7,8,9,10,10,9,11,12,13,14,14,13,15,16,17,18,18,17,19,20,21,22,22,21,23]);this.#r=this.#t.CreateIndexBuffer(t,{label:`${this.#o} Index Buffer`}),this.#t.WriteBuffer(this.#r,t),this.#t.SetIndexBuffer(this.#r,"uint16"),this.#i=t.length}#c(){const t=new Float32Array([-1,1,1,1,1,1,-1,1,-1,1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,-1,-1,-1,-1,1,1,-1,-1,1,1,1,1,1,-1,1,1,1,-1,1,-1,-1,-1,1,-1,-1,-1,-1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,-1,1,1,-1,1,1,1,1,-1,-1,1,-1,1]),i=this.#t.CreateVertexBuffer(t,{label:`${this.#o} Vertex Buffer`});this.#t.WriteBuffer(i,t),this.#t.SetVertexBuffers(i),this.#s.push(i)}#u(){this.#e=this.#t.CreateBuffer({size:this.#n.length*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,label:`${this.#o} Uniform Buffer`})}AddVertexBuffers(t){this.#s.push(...it(t))}UpdateTransformBuffer(){this.#t.WriteBuffer(this.#e,this.#n)}Render(t=!0){this.#t.SavePipelineState(),this.#t.Render(this.Update(),t),this.#t.RestorePipelineState()}Update(){return this.#t.WriteBuffer(this.#e,this.#n),this.#t.SetIndexBuffer(this.#r,"uint16"),this.#t.SetVertexBuffers(this.#s),this.#i}get PositionAttribute(){return{name:"position",format:"float32x3"}}get TransformBuffer(){return this.#e}get Transform(){return this.#n}get Vertices(){return this.#i}get UV(){return this.#a}Destroy(){this.#e=this.#e.destroy(),this.#s.forEach(t=>t.destroy()),this.#r=this.#r.destroy(),this.#s.splice(0)}}class J{Matrix=e.identity();Projection=e.identity();ResetProjection(){return this.Projection=e.identity(),this}ResetMatrix(){return this.Matrix=e.identity(),this}get Matrix(){return this.Matrix}get Projection(){return this.Projection}}class nt extends J{#a=1;#o=1e3;#i=0;#r=innerWidth;#t=innerHeight;#e=0;constructor(t=1,i=1e3,x=0,u=innerWidth,R=innerHeight,S=0){if(super(),this.#a=t,this.#o=i,this.#i=x,this.#e=S,typeof u!="number"){const[f,c]=u.CanvasSize;this.#r=f,this.#t=c}else this.#r=u,this.#t=R;this.UpdateProjection()}UpdateProjection(){return e.ortho(this.#e,this.#r,this.#t,this.#i,this.#a,this.#o,this.Projection)}set Near(t){this.#a=t,this.UpdateProjection()}get Near(){return this.#a}set Far(t){this.#o=t,this.UpdateProjection()}get Far(){return this.#o}set Top(t){this.#i=t,this.UpdateProjection()}get Top(){return this.#i}set Right(t){this.#r=t,this.UpdateProjection()}get Right(){return this.#r}set Bottom(t){this.#t=t,this.UpdateProjection()}get Bottom(){return this.#t}set Left(t){this.#e=t,this.UpdateProjection()}get Left(){return this.#e}}class at extends J{#a=s.set(0,1,0);#o=s.zero();#i=e.identity();#r=e.identity();#t=60;#e=1;#s=1e3;#n=innerWidth/innerHeight;constructor(t=60,i=1,x=1e3,u=innerWidth/innerHeight){super(),this.#t=t,this.#e=i,this.#s=x,this.#n=typeof u!="number"?u.AspectRatio:u,this.UpdateProjection()}UpdateProjection(){return e.perspective(ot(this.#t),this.#n,this.#e,this.#s,this.Projection)}UpdateViewProjection(t=!0){return t&&e.inverse(this.Matrix,this.#i),e.multiply(this.Projection,this.#i,this.#r)}LookAt(t,i=this.#a){return e.lookAt(this.Position,t,i,this.#i),this}Translate(t){return e.translate(this.Matrix,t,this.Matrix),this}SetRotationAxis(t,i){return e.rotation(t,i,this.Matrix),this}RotateAxis(t,i){return e.rotate(this.Matrix,t,i,this.Matrix),this}RotateX(t){return e.rotateX(this.Matrix,t,this.Matrix),this}RotateY(t){return e.rotateY(this.Matrix,t,this.Matrix),this}RotateZ(t){return e.rotateZ(this.Matrix,t,this.Matrix),this}set FieldOfView(t){this.#t=t,this.UpdateProjection()}get FieldOfView(){return this.#t}set Near(t){this.#e=t,this.UpdateProjection()}get Near(){return this.#e}set Far(t){this.#s=t,this.UpdateProjection()}get Far(){return this.#s}set AspectRatio(t){this.#n=typeof t!="number"?t.AspectRatio:t,this.UpdateProjection()}get AspectRatio(){return this.#n}set Position(t){e.setTranslation(this.Matrix,t,this.Matrix)}get Position(){return e.getTranslation(this.Matrix,this.#o)}set RotationX(t){e.rotationX(t,this.Matrix)}set RotationY(t){e.rotationY(t,this.Matrix)}set RotationZ(t){e.rotationZ(t,this.Matrix)}}const ht=""+new URL("dice-Vcs4qiRq.jpg",import.meta.url).href;var ct="struct VertexOutput{@location(0)textureCoord: vec2f,@builtin(position)position: vec4f};@group(0)@binding(0)var Sampler: sampler;@group(0)@binding(1)var Texture: texture_2d<f32>;@group(0)@binding(2)var<uniform>projection: mat4x4f;@vertex fn vertex(@location(1)textureCoord: vec2f,@location(0)position: vec4f)->VertexOutput{var output: VertexOutput;output.position=projection*position;output.textureCoord=textureCoord;return output;}@fragment fn fragment(@location(0)textureCoord: vec2f)->@location(0)vec4f {return textureSample(Texture,Sampler,textureCoord);}";/**
 * @example Cube / Cameras
 * @author Ustym Ukhman <ustym.ukhman@gmail.com>
 * @description This example is developed by using a version listed below.
 * Please note that this code may be simplified in future
 * thanks to more recent library APIs.
 * @version 0.0.12
 * @license MIT
 */let U,o,M,D;async function ft(g){try{o=new(await V.RenderPipeline(g,"Cube / Cameras"))}catch(n){alert(n)}const t=s.create(),i=s.create();let x,u=1/0,R,S;const f=s.create(),c=s.create(),C=new at,l=new $(o),b=new nt,T=new $(o),m=new(await V.LegacyTexture(o)),L=await m.CreateBitmapImage(await(await fetch(ht)).blob(),{colorSpaceConversion:"none"}),O=o.CreateColorAttachment();O.clearValue=new st(1657907).rgba,M=m.CreateTextureFromSource(L);const E=o.CreateShaderModule(ct);m.CopyImageToTexture(L,{texture:M}),o.CreatePassDescriptor(O,void 0,o.CreateDepthAttachment()),o.CreatePipeline({primitive:{cullMode:"back"},fragment:o.CreateFragmentState(E),multisample:o.CreateMultisampleState(),depthStencil:o.CreateDepthStencilState(),vertex:o.CreateVertexState(E,void 0,[o.CreateVertexBufferLayout(l.PositionAttribute),o.CreateVertexBufferLayout("textureCoord")])}),o.AddBindGroups([o.CreateBindGroup(o.CreateBindGroupEntries([m.CreateSampler({filter:q.LINEAR}),M.createView(),{buffer:l.TransformBuffer}])),o.CreateBindGroup(o.CreateBindGroupEntries([m.CreateSampler({filter:q.LINEAR}),M.createView(),{buffer:T.TransformBuffer}]))]),C.Position=[0,-2,8],C.LookAt([0,0,0]);const K=C.UpdateViewProjection(!1),w=o.CreateVertexBuffer(l.UV);o.WriteBuffer(w,l.UV),T.AddVertexBuffers(w),l.AddVertexBuffers(w);const G=s.create(),y=s.create(),j=s.create(),B=s.create(),N=s.create(),Y=s.create(),A=s.create(),v=s.create(),W=s.create();function P(n=-2,a=2){return(Math.random()*(a-n+1)|0)+n}function p(n,a,h){return n+h*(a-n)}function Q(){u=1/0,clearTimeout(x),cancelAnimationFrame(U)}function z(){x=setTimeout(()=>{let n=P()||1/0;const a=P()||1/0;f[0]=Math.PI/n,f[1]=Math.PI/a,f[2]=Math.PI/(P()||1/0);const h=((Math.abs(a)===1||!isFinite(a))&&-(n===-2||!isFinite(n))*2+1||Math.sign(a))*(isFinite(a)*2-1);f[0]+=y[0],f[1]+=y[1],f[2]+=y[2]*h,n=P()||1/0,c[0]=Math.PI/n+.35,c[1]=!isFinite(n)&&.35||Math.abs(n)<2&&-.35||0,c[2]=Math.abs(n)===2&&Math.sign(n)*-.35||0,c[1]&&=c[1]+Math.PI/(P()||1/0),c[2]&&=c[2]+Math.PI/(P()||1/0),u=Date.now()},1e3)}function X(n){U=requestAnimationFrame(X),n=(Date.now()-u)/1e3;const a=H.SmoothStep(n);let h=H.SmootherStep(n*2);.5<=a&&(h=(.5-(a-.5))*2,a===1&&(s.copy(c,v),s.copy(f,B),u=1/0,z()));{const r=l.Transform;e.copy(K,r),s.copy(j,t),t[1]=p(j[1],R,h),e.translate(r,t,r),i[0]=p(B[0],f[0],a),i[1]=p(B[1],f[1],a),i[2]=p(B[2],f[2],a),e.rotateX(r,i[0],r),e.rotateY(r,i[1],r),e.rotateZ(r,i[2],r),e.scale(r,N,r),o.SetActiveBindGroups(0),l.Render(!1)}{const r=T.Transform;e.copy(b.Projection,r),s.copy(A,t),t[1]=p(A[1],S,h),e.translate(r,t,r),i[0]=p(v[0],c[0],a),i[1]=p(v[1],c[1],a),i[2]=p(v[2],c[2],a),e.rotateX(r,i[0],r),e.rotateY(r,i[1],r),e.rotateZ(r,i[2],r),e.scale(r,W,r),o.SetActiveBindGroups(1),T.Render()}}D=new ResizeObserver(n=>{for(const a of n){let{inlineSize:h,blockSize:r}=a.contentBoxSize[0];h=h<=960&&h||h-240,o.SetCanvasSize(h,r),o.MultisampleTexture=m.CreateMultisampleTexture(),C.AspectRatio=o.AspectRatio,C.UpdateViewProjection(!1),b.Bottom=r,b.Right=h,b.Near=-100;const d=(h-360)/1272,tt=d*245+110,I=d*.5+.5,F=d*80+30,et=d*-3-1,Z=d*-1-1,rt=d*-.05;s.set(I,I,I,N),s.set(et,Z,0,G),s.set(.35,0,rt,y);const k=1-(d*.13+.61),_=k*r;R=Z*-1,S=r-_-k*h,s.set(F,F,F,W),s.set(.35,.35,0,v),s.set(h-tt,r-_,0,Y),s.copy(Y,A),s.copy(G,j),s.copy(y,B)}Q(),z(),U=requestAnimationFrame(X)}),D.observe(document.body)}function pt(){V.OnDeviceLost=()=>{},cancelAnimationFrame(U),D.disconnect(),o.Destroy(),V.Destroy(void 0,M)}export{pt as destroy,ft as run};
