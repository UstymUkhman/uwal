import{b as s,c as h,a as B,d as g,T as M,E as C,M as P}from"./index-BvoO-MNg.js";class S{Children=[];Label;#e=null;TransformationOrder="TRS";ProjectionMatrix=s.identity();#t=s.identity();#i=s.identity();#s=h.create();#a=h.set(1,1);#r=0;constructor(t,e=null){this.Label=t,this.Parent=e}Add(t){t=B(t),t.forEach(e=>e.Parent=this)}Remove(t){t=B(t),t.forEach(e=>e.Parent=null)}Find(t){if(this.Label===t)return this;for(const e=0,i=this.Children.length;e<i;e++){const r=this.Children[e].Find(t);if(r)return r}return null}ResetLocalMatrix(){this.#t=s.identity()}UpdateWorldMatrix(){this.UpdateLocalMatrix(),this.#e?s.multiply(this.#e.WorldMatrix,this.#t,this.#i):s.copy(this.#t,this.#i),this.Children.forEach(t=>t.UpdateWorldMatrix())}UpdateLocalMatrix(){const t=this.TransformationOrder.split("");for(let e=0,i=t.length;e<i;e++)switch(t[e]){case"T":s.translation(this.#s,this.#t);break;case"R":s.rotate(this.#t,this.#r,this.#t);break;case"S":s.scale(this.#t,this.#a,this.#t);break}}UpdateProjectionMatrix(t){const e=this.#e&&this.#i||this.#t;return s.multiply(t,e,this.ProjectionMatrix)}ResetProjectionMatrix(){this.ProjectionMatrix=s.identity()}Rotate(t){s.rotate(this.#t,t,this.#t)}Scale(t){s.scale(this.#t,t,this.#t)}set Transform(t){const[e,i,r]=t,a=this.TransformationOrder.split("");for(let n=0,f=a.length;n<f;n++)switch(a[n]){case"T":e&&(this.Position=e);break;case"R":i!==void 0&&(this.Rotation=i);break;case"S":r&&(this.Scaling=r);break}}set Position(t){h.copy(t,this.#s),s.translate(this.#t,t,this.#t)}get Position(){return this.#s}set Rotation(t){this.#r=t,s.rotate(this.#t,t,this.#t)}get Rotation(){return this.#r}set Scaling(t){h.copy(t,this.#a),s.scale(this.#t,t,this.#t)}get Scaling(){return this.#a}get LocalMatrix(){return this.#t}get WorldMatrix(){return this.#i}set Parent(t){if(this.#e){const e=this.#e.Children.indexOf(this);0<=e&&this.#e.Children.splice(e,1)}t&&t.Children.push(this),this.#e=t}get Parent(){return this.#e}}let R=class extends S{#e;Visible=!0;#t;#i;#s=h.set(0,0);#a=h.set(0,0);#r;#n=g({min:h.create(),max:h.create()});#o=[];constructor(t,e,i="Shape",r=null){super(i,r),this.#e=t,this.#r=e}#h(t){const{projection:e,buffer:i}=this.#t.CreateUniformBuffer("projection",{label:`${this.Label} Projection Buffer`,...t});this.ProjectionMatrix=s.identity(e),this.#i=i,this.#o=this.#t.SetBindGroupFromResources([i,this.#r?.ColorBuffer].filter(Boolean),0,0,`${this.Label} Bind Group`)}SetRenderPipeline(t){this.#t=t,this.#e.CreateBuffers(t),this.#r?.CreateColorBuffer(t),this.#h()}SetPipelineData(){!this.#t&&M(C.PIPELINE_NOT_FOUND,"RenderPipeline.\n            Use `Shape.SetRenderPipeline` method before setting its data.");const{VertexBuffers:t,IndexBuffer:e,Vertices:i}=this.#e;this.#t.BindGroups=this.#o,this.#t.VertexBuffers=t,this.#t.IndexBuffer=e,this.#t.SetDrawParams(i)}UpdateLocalMatrix(){super.UpdateLocalMatrix();const t=this.LocalMatrix,{Radius:e}=this.#e;this.#n.min[0]=t[8]-e,this.#n.min[1]=t[9]-e,this.#n.max[0]=t[8]+e,this.#n.max[1]=t[9]+e,s.translate(t,this.#s,t),this.#a[0]=this.#s[0]+this.#n.max[0],this.#a[1]=this.#s[1]+this.#n.max[1]}UpdateProjectionMatrix(t){const e=super.UpdateProjectionMatrix(t);this.#t.WriteBuffer(this.#i,e)}get ProjectionBuffer(){return this.#i}set Origin(t){this.#s[0]=-t[0],this.#s[1]=-t[1];const e=this.LocalMatrix;s.translate(e,t,e)}get Origin(){return this.#s}get Center(){return this.#a}get BoundingBox(){return this.#n}get Geometry(){return this.#e}get Material(){return this.#r}Destroy(){this.#e.Destroy(),this.#r?.Destroy(),this.#t=void 0,this.#o.splice(0),this.#i?.destroy(),this.#i=void 0}};var D="@group(0)@binding(0)var<uniform>projection: mat3x3f;fn GetVertexClipSpace(position: vec2f)->vec4f{let coords=projection*vec3f(position,1);return vec4f(coords.xy,0,1);}@vertex fn vertex(@location(0)position: vec2f)->@builtin(position)vec4f {return GetVertexClipSpace(position);}";const b=g({TRIANGLE:3,SQUARE:4,PENTAGON:5,HEXAGON:6,HEPTAGON:7,OCTAGON:8,NONAGON:9,DECAGON:10,DODECAGON:12});class U{#e;#t;#i;IndexFormat;#s;#a;#r;VertexBuffers;IndexBuffer;constructor(t={segments:"SQUARE",radius:0}){const e=t.segments,i=typeof e=="number"&&e;this.#e=t.radius??0,this.#i=i||b[e||"SQUARE"],this.#s={label:"Shape",...t},this.IndexFormat=t.indexFormat??"uint16"}GetPositionBufferLayout(t,e="position",i="vertex",r="vertex"){return t.CreateVertexBufferLayout(e,i,r)}#n(t,e=this.#s.label){let i=this.#r;if(!i){i=new Float32Array((this.#i+1)*2*3);const{endAngle:a=P.TAU,startAngle:n=0,innerRadius:f=0}=this.#s,o=a-n;for(let c=0,l=0,d=this.#i;l<=d;++l){const x=n+l*o/d,p=Math.cos(x),m=Math.sin(x);i[c++]=p*this.#e,i[c++]=m*this.#e,i[c++]=p*f,i[c++]=m*f}}const r=t.CreateVertexBuffer(i,{label:`${e} Vertex Buffer`});this.VertexBuffers=t.SetVertexBuffers(r),t.WriteBuffer(r,i)}#o(t,e=this.#s.label){let i=this.#a;if(!i){i=new Uint16Array(this.#i*6);for(let a=0,n=0,f=this.#i;n<f;++n){const o=n*2;i[a++]=o+1,i[a++]=o+3,i[a++]=o+2,i[a++]=o+2,i[a++]=o+0,i[a++]=o+1}}const r=t.CreateIndexBuffer(i,{label:`${e} Index Buffer`});this.IndexBuffer=t.SetIndexBuffer(r,this.IndexFormat),t.SetDrawParams(this.#t=i.length),t.WriteBuffer(r,i)}CreateBuffers(t,e=this.#s.label){this.#n(t,e),this.#o(t,e)}set VertexData(t){this.#r=t}set IndexData(t){this.#a=t}get Vertices(){return this.#t}get Radius(){return this.#e}Destroy(){this.#a=void 0,this.#r=void 0,this.IndexBuffer?.buffer.destroy(),this.VertexBuffers?.[0].buffer.destroy()}}class O extends S{#e="Camera2D";#t=innerWidth;#i=innerHeight;constructor(t=innerWidth,e=innerHeight){super("Camera2D"),this.Size=typeof t!="number"&&this.rendererWidth.CanvasSize||[t,e]}UpdateProjectionMatrix(){return s.set(2/this.#t,0,0,0,-2/this.#i,0,-1,1,1,this.ProjectionMatrix)}set Size([t,e]){this.#t=t,this.#i=e,this.UpdateProjectionMatrix()}set Width(t){this.#t=t,this.UpdateProjectionMatrix()}get Width(){return this.#t}set Height(t){this.#i=t,this.UpdateProjectionMatrix()}get Height(){return this.#i}}export{O as C,D as S,U as a,R as b};
