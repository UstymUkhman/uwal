import{_ as e,g as t,p as n}from"./lib-Dec1TxwB.js";var r=``+new URL(`matrix-Bz2rpV2j.mp4`,import.meta.url).href,i=`const ONE_THIRD=1.0/3.0;const RED_BRIGHTNESS=1.2;const BRIGHTNESS=-0.025;const CONTRAST=2.0;struct VertexOutput{@location(0)coord: vec2f,@builtin(position)position: vec4f};@group(0)@binding(1)var Sampler: sampler;@group(0)@binding(2)var<uniform>size: vec2f;@group(0)@binding(3)var Texture: texture_external;@vertex fn vertex(@builtin(vertex_index)index: u32)->VertexOutput {let max=ONE_THIRD*2;var output: VertexOutput;var coord=GetQuadCoord(index);let scale=vec2f(min(resolution.x/size.x,max))*size/resolution.xy;let position=coord*scale*resolution.z-vec2f(0,scale.y);output.position=vec4f(position,0,1);coord=(coord+1.0)*0.5;coord.y=1.0-coord.y;output.coord=coord;return output;}@fragment fn fragment(@location(0)coord: vec2f)->@location(0)vec4f {var color=textureSampleBaseClampToEdge(Texture,Sampler,coord).rgb;color=pow(color,vec3f(0.45));var average=dot(color,vec3f(ONE_THIRD));let weight=smoothstep(0.1,0.25,color.r-average);average=(average-0.5+BRIGHTNESS)*CONTRAST+0.5;color=mix(vec3f(average),vec3f(RED_BRIGHTNESS,0.5,0.5)*color,weight);return vec4f(pow(color,vec3f(2.2)),1);}`,a,o,s,c,l=document.createElement(`video`);async function u(u){try{o=new(await(n.Renderer(u,`Video Color Grading`)))}catch(e){alert(e)}let d=await o.CreatePipeline([e,t,i]),f=new(await(n.Texture())),p=f.CreateSampler();l.playsinline=l.loop=!0,l.controls=l.muted=!0,l.style.position=`absolute`;let m,h;l.preload=`auto`,l.src=r,l.addEventListener(`loadedmetadata`,()=>{h=l.videoHeight,m=l.videoWidth,g()},!1),document.body.appendChild(l),d.SetDrawParams(6);function g(){let e=u.width/m,{offsetWidth:t,offsetHeight:n}=document.body,r=Math.min(e,1/3*2)*(1/e);if(t<=960){let e=t*r,i=h*e/m;l.style.left=`${(t-e)/2}px`,l.style.top=`${n/2-i}px`,l.style.height=`${i}px`,l.style.width=`${e}px`,l.style.bottom=`unset`,l.style.right=`unset`,l.height=i,l.width=e}else{let e=Math.min(u.clientWidth/m,.67),t=m*e,n=h*e;l.style.right=`${(u.clientWidth-t)/2}px`,l.style.bottom=`${u.clientHeight/2}px`,l.style.height=`${n}px`,l.style.width=`${t}px`,l.style.left=`unset`,l.style.top=`unset`,l.height=n,l.width=t}}async function _(){await v(),y(),a=requestAnimationFrame(b)}function v(){return new Promise((e,t)=>{if(l.addEventListener(`error`,t),`requestVideoFrameCallback`in l)l.requestVideoFrameCallback(e);else{let t=()=>l.currentTime?e():requestAnimationFrame(t);t()}l.play().catch(t)})}function y(){let{size:e,buffer:t}=d.CreateUniformBuffer(`size`);e.set([m,h]),s=t,d.WriteBuffer(t,e)}function b(){a=requestAnimationFrame(b);let e=f.ImportExternalTexture(l);d.SetBindGroupFromResources([o.ResolutionBuffer,p,s,e]),o.Render()}c=new ResizeObserver(e=>{for(let t of e){o.DevicePixelRatio=document.body.offsetWidth>960&&devicePixelRatio||1;let{inlineSize:e,blockSize:n}=t.contentBoxSize[0];e=e<=960&&e||e-240,o.SetCanvasSize(e,n)}(m&&h||a)&&~g()&&~cancelAnimationFrame(a)&&_()}),c.observe(document.body)}function d(){n.OnLost=()=>void 0,cancelAnimationFrame(a),c.disconnect(),o.Destroy(),l.remove(),n.Destroy(s)}export{d as destroy,u as run};