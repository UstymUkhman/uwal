import{D as p,C as F}from"./index-ELOcnE7E.js";import{a as I,S as L,b as M}from"./Shape-PJwMpm2R.js";import{M as S}from"./Math-Cr7J2GA5.js";var O="struct VertexOutput{@location(0)textureCoord: vec2f,@builtin(position)position: vec4f,@location(1)@interpolate(flat)instance: u32};@group(1)@binding(0)var Sampler: sampler;@group(1)@binding(1)var Texture: texture_2d<f32>;@group(1)@binding(2)var<storage,read>visible: array<u32>;@vertex fn textureVertex(@location(0)position: vec2f,@location(1)translation: vec2f,@builtin(instance_index)instance: u32)->VertexOutput{var output: VertexOutput;let dpr=resolution.z*2.75;let aspect=resolution.xy/resolution.y;let clipSpace=GetVertexClipSpace(position).xy;output.position=vec4f(clipSpace+translation,0,1);output.textureCoord=clipSpace*aspect*dpr+0.5;output.instance=instance;return output;}@fragment fn fragment(@location(0)textureCoord: vec2f,@location(1)@interpolate(flat)instance: u32)->@location(0)vec4f{if(visible[instance]==0){discard;}return textureSample(Texture,Sampler,textureCoord);}";const _=""+new URL("logo-DEvozEyj.jpg",import.meta.url).href;/**
 * @example Textures / Instancing
 * @author Ustym Ukhman <ustym.ukhman@gmail.com>
 * @description This example is developed by using a version listed below.
 * Please note that this code may be simplified in future
 * thanks to more recent library APIs.
 * @version 0.2.0
 * @license MIT
 */let l,a,w,y,f,q;async function j(d){try{a=new(await p.Renderer(d,"Textures / Instancing"))}catch(e){alert(e)}const m=128,i=256,t=new a.Pipeline,x=new I({radius:m});let s,h,u,g,n=512,v=performance.now()-n;const C=t.CreateShaderModule([L,O]);a.CreatePassDescriptor(a.CreateColorAttachment(new F(1651532)));const{buffer:b,layout:T}=t.CreateVertexBuffer("translation",i,"instance","textureVertex");t.WriteBuffer(b,z()),await a.AddPipeline(t,{fragment:t.CreateFragmentState(C),vertex:t.CreateVertexState(C,[x.GetPositionBufferLayout(t),T],void 0,"textureVertex")});function R(){cancelAnimationFrame(l),clearTimeout(h),v=performance.now()-n}async function V(){A(),P(),await D(),requestAnimationFrame(B),h=setTimeout(()=>n=~(u=-1),n*3)}function A(){const e=new M(x),[o,r]=a.CanvasSize;e.SetRenderPipeline(t,a.ResolutionBuffer),t.SetDrawParams(x.Vertices,i),t.AddVertexBuffers(b),e.Position=[o/2,r/2],e.Rotation=Math.PI/4,e.Update()}function P(){const e=t.CreateStorageBuffer("visible",i);t.WriteBuffer(e.buffer,e.visible),g=(s=e.visible).length-1,f=e.buffer}function z(){const e=new Float32Array(i*2),o=1-Math.sqrt(2)*m/d.offsetWidth,r=1-Math.sqrt(2)*m/d.offsetHeight;for(let c=i;c--;)e.set([S.Random(-o,o),S.Random(-r,r)],c*2);return e}async function D(){const e=new(await p.Texture());y=await e.CopyImageToTexture(await e.CreateImageBitmap(_),{flipY:!0,create:{mipmaps:!1}}),t.AddBindGroupFromResources([e.CreateSampler(),y.createView(),f],0,1)}function B(e){l=requestAnimationFrame(B),!(e-v<n)&&(n?s.fill(0)&&(u=S.RandomInt(0,g)):++u===g&&cancelAnimationFrame(l),v=e,s[u]=1,t.WriteBuffer(f,s),a.Render())}w=new ResizeObserver(e=>{for(const o of e){let{inlineSize:r,blockSize:c}=o.contentBoxSize[0];r=r<=960&&r||r-240,a.SetCanvasSize(r,c)}R(),V()}),w.observe(document.body)}function E(){p.OnLost=()=>{},cancelAnimationFrame(l),w.disconnect(),a.Destroy(),p.Destroy([f,q],y)}export{E as destroy,j as run};
