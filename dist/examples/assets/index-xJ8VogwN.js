var Rs=Object.defineProperty;var Cn=h=>{throw TypeError(h)};var Ps=(h,t,e)=>t in h?Rs(h,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):h[t]=e;var be=(h,t,e)=>Ps(h,typeof t!="symbol"?t+"":t,e),Tn=(h,t,e)=>t.has(h)||Cn("Cannot "+e);var T=(h,t,e)=>(Tn(h,t,"read from private field"),e?e.call(h):t.get(h)),C=(h,t,e)=>t.has(h)?Cn("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(h):t.set(h,e),F=(h,t,e,s)=>(Tn(h,t,"write to private field"),s?s.call(h,e):t.set(h,e),e),X=(h,t,e)=>(Tn(h,t,"access private method"),e);const Zr=it({RAD:Math.PI/180,DEG:180/Math.PI,HPI:Math.PI/2,TAU:Math.PI*2}),Is={CANVAS_NOT_FOUND:"CANVAS_NOT_FOUND",CONTEXT_NOT_FOUND:"CONTEXT_NOT_FOUND",SHADER_CODE_NOT_FOUND:"SHADER_CODE_NOT_FOUND",SHADER_MODULE_NOT_FOUND:"SHADER_MODULE_NOT_FOUND",VERTEX_ENTRY_NOT_FOUND:"VERTEX_ENTRY_NOT_FOUND",VERTEX_ATTRIBUTE_NOT_FOUND:"VERTEX_ATTRIBUTE_NOT_FOUND",RENDER_PASS_NOT_FOUND:"RENDER_PASS_NOT_FOUND",STORAGE_NOT_FOUND:"STORAGE_NOT_FOUND",UNIFORM_NOT_FOUND:"UNIFORM_NOT_FOUND",INVALID_UNIFORM_NAME:"INVALID_UNIFORM_NAME",BINDING_NOT_FOUND:"BINDING_NOT_FOUND",PIPELINE_NOT_FOUND:"PIPELINE_NOT_FOUND",COMMAND_ENCODER_NOT_FOUND:"COMMAND_ENCODER_NOT_FOUND"},Fs={CANVAS_NOT_FOUND:"Failed to get a WebGPU canvas.",CONTEXT_NOT_FOUND:"Failed to get a WebGPU context.",SHADER_CODE_NOT_FOUND:`Failed to get a WGSL shader when creating shader module.
        An empty shader will be used instead.`,SHADER_MODULE_NOT_FOUND:"Failed to get shader module in ",VERTEX_ENTRY_NOT_FOUND:"Failed to find function ",VERTEX_ATTRIBUTE_NOT_FOUND:"Failed to find vertex attribute ",RENDER_PASS_NOT_FOUND:"Failed to use pipeline in render pass because it has not started.",STORAGE_NOT_FOUND:"Failed to find storage ",UNIFORM_NOT_FOUND:"Failed to find uniform ",INVALID_UNIFORM_NAME:"Requested uniform is already in use and managed internally: ",BINDING_NOT_FOUND:"Failed to find binding ",PIPELINE_NOT_FOUND:"Failed to get a GPU",COMMAND_ENCODER_NOT_FOUND:"Failed to get a GPUCommandEncoder."},Bs={CANVAS_NOT_FOUND:5,CONTEXT_NOT_FOUND:6,PIPELINE_NOT_FOUND:7,COMMAND_ENCODER_NOT_FOUND:8},Ls={RENDER_PIPELNE_NOT_FOUND:"RENDER_PIPELNE_NOT_FOUND",TEXTURE_SIZE_NOT_FOUND:"TEXTURE_SIZE_NOT_FOUND",TEXTURE_NOT_FOUND:"TEXTURE_NOT_FOUND",INVALID_BYTES_PER_ROW:"INVALID_BYTES_PER_ROW"},Gs={RENDER_PIPELNE_NOT_FOUND:'"UWAL.RenderPipeline" instance is required in `Texture` for this operation.\n        Pass it to the `Texture` constructor or use `Texture.Renderer` setter before ',TEXTURE_SIZE_NOT_FOUND:"`size` array or a `width` value is required in `options` parameter of ",TEXTURE_NOT_FOUND:"`options` is required to have a `texture` value or its `create` entry\n        to be either `true` or a `TextureDescriptor` object when calling ",INVALID_BYTES_PER_ROW:"`bytesPerRow` parameter is not multiple of 256 in "},qs={FONT_TEXTURE_NOT_FOUND:"FONT_TEXTURE_NOT_FOUND"},zs={FONT_TEXTURE_NOT_FOUND:"Failed to find a font texture in "},Cs={TIMESTAMP_QUERY_NOT_FOUND:"TIMESTAMP_QUERY_NOT_FOUND"},Vs={TIMESTAMP_QUERY_NOT_FOUND:'"timestamp-query" feature is required to be set with\n        `UWAL.SetRequiredFeatures` when creating a new `GPUTiming` instance.'};it({DEVICE_LOST:"Device::Lost"});const $=it({FORMAT_NOT_SUPPORTED:"FORMAT_NOT_SUPPORTED",WEBGPU_NOT_SUPPORTED:"WEBGPU_NOT_SUPPORTED",ADAPTER_NOT_FOUND:"ADAPTER_NOT_FOUND",FEATURE_NOT_FOUND:"FEATURE_NOT_FOUND",DEVICE_NOT_FOUND:"DEVICE_NOT_FOUND",DEVICE_NOT_REQUESTED:"DEVICE_NOT_REQUESTED",DEVICE_LOST:"DEVICE_LOST",...Is,...Ls,...qs,...Cs}),ws=it({FORMAT_NOT_SUPPORTED:"Format is not yet supported: ",WEBGPU_NOT_SUPPORTED:"WebGPU is not supported in this browser.",ADAPTER_NOT_FOUND:"Failed to get a GPUAdapter.",DEVICE_NOT_FOUND:"Failed to get a GPUDevice.",FEATURE_NOT_FOUND:"Failed to get a GPUFeature ",DEVICE_NOT_REQUESTED:"GPUDevice was not requested.",DEVICE_LOST:"WebGPU device was lost. ",...Fs,...Gs,...zs,...Vs}),$s=it({WEBGPU_NOT_SUPPORTED:0,ADAPTER_NOT_FOUND:1,DEVICE_NOT_FOUND:2,DEVICE_NOT_REQUESTED:3,DEVICE_LOST:4,...Bs});function Ne(h,t){console.warn(`${ws[h]}${t??""}`.replace(/\s\s+/g," "))}function K(h,t){throw new Error(`${ws[h]}${t??""}`.replace(/\s\s+/g," "),{cause:$s[h]})}function it(h){for(let t in h)h[t]={value:h[t]};return Object.freeze(Object.create(null,h))}function Xs(h){switch(h){case 2:return"unorm8x2";case 4:return"float32";case 8:return"float32x2";case 12:return"float32x3";case 16:return"float32x4"}}function Ws(h){switch(h){case"uint8x2":case"sint8x2":case"unorm8x2":case"snorm8x2":return 2;case"uint32":case"sint32":case"float32":case"uint8x4":case"sint8x4":case"unorm8x4":case"snorm8x4":case"uint16x2":case"sint16x2":case"unorm16x2":case"snorm16x2":case"float16x2":return 4;case"uint16x4":case"sint16x4":case"uint32x2":case"sint32x2":case"unorm16x4":case"snorm16x4":case"float16x4":case"float32x2":return 8;case"uint32x3":case"sint32x3":case"float32x3":return 12;case"uint32x4":case"sint32x4":case"float32x4":return 16}return 0}function Ys(h){return h==="f16"||h.includes("h")?"f16":h.includes("f")?"f32":h.includes("u")?"u32":"i32"}function Hs(h){return+h.slice(1)/8}function Qs(h){return h==="f16"&&K($.FORMAT_NOT_SUPPORTED,`${h}.`),h==="f32"?Float32Array:h==="u32"?Uint32Array:Int32Array}const Vn={operation:"add",srcFactor:"one",dstFactor:"zero"},$n={operation:"add",srcFactor:"one",dstFactor:"one"},Xn={operation:"add",srcFactor:"one",dstFactor:"one-minus-src-alpha"},Wn={operation:"add",srcFactor:"one-minus-dst-alpha",dstFactor:"one"},Yn={operation:"add",srcFactor:"dst-alpha",dstFactor:"zero"},Hn={operation:"add",srcFactor:"zero",dstFactor:"src-alpha"},Qn={operation:"add",srcFactor:"one-minus-dst-alpha",dstFactor:"zero"},Zn={operation:"add",srcFactor:"zero",dstFactor:"one-minus-src-alpha"},jn={operation:"add",srcFactor:"dst-alpha",dstFactor:"one-minus-src-alpha"},Jn={operation:"add",srcFactor:"one-minus-dst-alpha",dstFactor:"src-alpha"};it({COPY:it({color:Vn,alpha:Vn}),ADDITIVE:it({color:$n,alpha:$n}),SOURCE_OVER:it({color:Xn,alpha:Xn}),DESTINATION_OVER:it({color:Wn,alpha:Wn}),SOURCE_IN:it({color:Yn,alpha:Yn}),DESTINATION_IN:it({color:Hn,alpha:Hn}),SOURCE_OUT:it({color:Qn,alpha:Qn}),DESTINATION_OUT:it({color:Zn,alpha:Zn}),SOURCE_ATOP:it({color:jn,alpha:jn}),DESTINATION_ATOP:it({color:Jn,alpha:Jn})});const Me=it({INDEX:GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST,VERTEX:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,STORAGE:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST,UNIFORM:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,READABLE:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST,WRITABLE:GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC});class Zs{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class me{constructor(){}get isAstNode(){return!0}get astNodeType(){return""}evaluate(t){throw new Error("Cannot evaluate node")}evaluateString(t){return this.evaluate(t).toString()}search(t){}searchBlock(t,e){if(t){e(yn.instance);for(const s of t)s instanceof Array?this.searchBlock(s,e):s.search(e);e(xn.instance)}}}class yn extends me{}yn.instance=new yn;class xn extends me{}xn.instance=new xn;class st extends me{constructor(){super()}}class vn extends st{constructor(t,e,s,o,f,x){super(),this.calls=new Set,this.name=t,this.args=e,this.returnType=s,this.body=o,this.startLine=f,this.endLine=x}get astNodeType(){return"function"}search(t){this.searchBlock(this.body,t)}}class js extends st{constructor(t){super(),this.expression=t}get astNodeType(){return"staticAssert"}search(t){this.expression.search(t)}}class Js extends st{constructor(t,e){super(),this.condition=t,this.body=e}get astNodeType(){return"while"}search(t){this.condition.search(t),this.searchBlock(this.body,t)}}class Ks extends st{constructor(t){super(),this.body=t}get astNodeType(){return"continuing"}search(t){this.searchBlock(this.body,t)}}class tr extends st{constructor(t,e,s,o){super(),this.init=t,this.condition=e,this.increment=s,this.body=o}get astNodeType(){return"for"}search(t){var e,s,o;(e=this.init)===null||e===void 0||e.search(t),(s=this.condition)===null||s===void 0||s.search(t),(o=this.increment)===null||o===void 0||o.search(t),this.searchBlock(this.body,t)}}class Ue extends st{constructor(t,e,s,o,f){super(),this.name=t,this.type=e,this.storage=s,this.access=o,this.value=f}get astNodeType(){return"var"}search(t){var e;t(this),(e=this.value)===null||e===void 0||e.search(t)}}class gs extends st{constructor(t,e,s){super(),this.name=t,this.type=e,this.value=s}get astNodeType(){return"override"}search(t){var e;(e=this.value)===null||e===void 0||e.search(t)}}class Dn extends st{constructor(t,e,s,o,f){super(),this.name=t,this.type=e,this.storage=s,this.access=o,this.value=f}get astNodeType(){return"let"}search(t){var e;t(this),(e=this.value)===null||e===void 0||e.search(t)}}class Kn extends st{constructor(t,e,s,o,f){super(),this.name=t,this.type=e,this.storage=s,this.access=o,this.value=f}get astNodeType(){return"const"}evaluate(t){return this.value.evaluate(t)}search(t){var e;t(this),(e=this.value)===null||e===void 0||e.search(t)}}var Ke;(function(h){h.increment="++",h.decrement="--"})(Ke||(Ke={}));(function(h){function t(e){const s=e;if(s=="parse")throw new Error("Invalid value for IncrementOperator");return h[s]}h.parse=t})(Ke||(Ke={}));class er extends st{constructor(t,e){super(),this.operator=t,this.variable=e}get astNodeType(){return"increment"}search(t){this.variable.search(t)}}var nn;(function(h){h.assign="=",h.addAssign="+=",h.subtractAssin="-=",h.multiplyAssign="*=",h.divideAssign="/=",h.moduloAssign="%=",h.andAssign="&=",h.orAssign="|=",h.xorAssign="^=",h.shiftLeftAssign="<<=",h.shiftRightAssign=">>="})(nn||(nn={}));(function(h){function t(e){const s=e;if(s=="parse")throw new Error("Invalid value for AssignOperator");return s}h.parse=t})(nn||(nn={}));class nr extends st{constructor(t,e,s){super(),this.operator=t,this.variable=e,this.value=s}get astNodeType(){return"assign"}search(t){this.variable.search(t),this.value.search(t)}}class ms extends st{constructor(t,e){super(),this.name=t,this.args=e}get astNodeType(){return"call"}search(t){for(const e of this.args)e.search(t);t(this)}}class sr extends st{constructor(t,e){super(),this.body=t,this.continuing=e}get astNodeType(){return"loop"}}class rr extends st{constructor(t,e){super(),this.condition=t,this.body=e}get astNodeType(){return"body"}}class ir extends st{constructor(t,e,s,o){super(),this.condition=t,this.body=e,this.elseif=s,this.else=o}get astNodeType(){return"if"}search(t){this.condition.search(t),this.searchBlock(this.body,t),this.searchBlock(this.elseif,t),this.searchBlock(this.else,t)}}class or extends st{constructor(t){super(),this.value=t}get astNodeType(){return"return"}search(t){var e;(e=this.value)===null||e===void 0||e.search(t)}}class ar extends st{constructor(t){super(),this.name=t}get astNodeType(){return"enable"}}class cr extends st{constructor(t){super(),this.extensions=t}get astNodeType(){return"requires"}}class ur extends st{constructor(t,e){super(),this.severity=t,this.rule=e}get astNodeType(){return"diagnostic"}}class ys extends st{constructor(t,e){super(),this.name=t,this.type=e}get astNodeType(){return"alias"}}class hr extends st{constructor(){super()}get astNodeType(){return"discard"}}class lr extends st{constructor(){super()}get astNodeType(){return"break"}}class _r extends st{constructor(){super()}get astNodeType(){return"continue"}}class qe extends st{constructor(t){super(),this.name=t}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}}class Oe extends qe{constructor(t,e,s,o){super(t),this.members=e,this.startLine=s,this.endLine=o}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(t){for(let e=0;e<this.members.length;e++)if(this.members[e].name==t)return e;return-1}}class xs extends qe{constructor(t,e,s){super(t),this.format=e,this.access=s}get astNodeType(){return"template"}}class fr extends qe{constructor(t,e,s,o){super(t),this.storage=e,this.type=s,this.access=o}get astNodeType(){return"pointer"}}class ks extends qe{constructor(t,e,s,o){super(t),this.attributes=e,this.format=s,this.count=o}get astNodeType(){return"array"}get isArray(){return!0}}class tn extends qe{constructor(t,e,s){super(t),this.format=e,this.access=s}get astNodeType(){return"sampler"}}class fe extends me{constructor(){super()}}class dr extends fe{constructor(t){super(),this.value=t}get astNodeType(){return"stringExpr"}toString(){return this.value}evaluateString(){return this.value}}class Ve extends fe{constructor(t,e){super(),this.type=t,this.args=e}get astNodeType(){return"createExpr"}search(t){if(t(this),this.args)for(const e of this.args)e.search(t)}evaluate(t){return this.args[0].evaluate(t)}}class Ts extends fe{constructor(t,e){super(),this.name=t,this.args=e}get astNodeType(){return"callExpr"}evaluate(t){switch(this.name){case"abs":return Math.abs(this.args[0].evaluate(t));case"acos":return Math.acos(this.args[0].evaluate(t));case"acosh":return Math.acosh(this.args[0].evaluate(t));case"asin":return Math.asin(this.args[0].evaluate(t));case"asinh":return Math.asinh(this.args[0].evaluate(t));case"atan":return Math.atan(this.args[0].evaluate(t));case"atan2":return Math.atan2(this.args[0].evaluate(t),this.args[1].evaluate(t));case"atanh":return Math.atanh(this.args[0].evaluate(t));case"ceil":return Math.ceil(this.args[0].evaluate(t));case"clamp":return Math.min(Math.max(this.args[0].evaluate(t),this.args[1].evaluate(t)),this.args[2].evaluate(t));case"cos":return Math.cos(this.args[0].evaluate(t));case"degrees":return this.args[0].evaluate(t)*180/Math.PI;case"distance":return Math.sqrt(Math.pow(this.args[0].evaluate(t)-this.args[1].evaluate(t),2));case"dot":case"exp":return Math.exp(this.args[0].evaluate(t));case"exp2":return Math.pow(2,this.args[0].evaluate(t));case"floor":return Math.floor(this.args[0].evaluate(t));case"fma":return this.args[0].evaluate(t)*this.args[1].evaluate(t)+this.args[2].evaluate(t);case"fract":return this.args[0].evaluate(t)-Math.floor(this.args[0].evaluate(t));case"inverseSqrt":return 1/Math.sqrt(this.args[0].evaluate(t));case"log":return Math.log(this.args[0].evaluate(t));case"log2":return Math.log2(this.args[0].evaluate(t));case"max":return Math.max(this.args[0].evaluate(t),this.args[1].evaluate(t));case"min":return Math.min(this.args[0].evaluate(t),this.args[1].evaluate(t));case"mix":return this.args[0].evaluate(t)*(1-this.args[2].evaluate(t))+this.args[1].evaluate(t)*this.args[2].evaluate(t);case"modf":return this.args[0].evaluate(t)-Math.floor(this.args[0].evaluate(t));case"pow":return Math.pow(this.args[0].evaluate(t),this.args[1].evaluate(t));case"radians":return this.args[0].evaluate(t)*Math.PI/180;case"round":return Math.round(this.args[0].evaluate(t));case"sign":return Math.sign(this.args[0].evaluate(t));case"sin":return Math.sin(this.args[0].evaluate(t));case"sinh":return Math.sinh(this.args[0].evaluate(t));case"saturate":return Math.min(Math.max(this.args[0].evaluate(t),0),1);case"smoothstep":return this.args[0].evaluate(t)*this.args[0].evaluate(t)*(3-2*this.args[0].evaluate(t));case"sqrt":return Math.sqrt(this.args[0].evaluate(t));case"step":return this.args[0].evaluate(t)<this.args[1].evaluate(t)?0:1;case"tan":return Math.tan(this.args[0].evaluate(t));case"tanh":return Math.tanh(this.args[0].evaluate(t));case"trunc":return Math.trunc(this.args[0].evaluate(t));default:throw new Error("Non const function: "+this.name)}}search(t){for(const e of this.args)e.search(t);t(this)}}class An extends fe{constructor(t){super(),this.name=t}get astNodeType(){return"varExpr"}search(t){t(this),this.postfix&&this.postfix.search(t)}evaluate(t){const e=t.constants.get(this.name);if(!e)throw new Error("Cannot evaluate node");return e.evaluate(t)}}class ts extends fe{constructor(t,e){super(),this.name=t,this.initializer=e}get astNodeType(){return"constExpr"}evaluate(t){var e,s;if(this.initializer instanceof Ve){const o=(e=this.postfix)===null||e===void 0?void 0:e.evaluateString(t),f=(s=this.initializer.type)===null||s===void 0?void 0:s.name,x=t.structs.get(f),N=x==null?void 0:x.getMemberIndex(o);return N!==void 0&&N!=-1?this.initializer.args[N].evaluate(t):this.initializer.evaluate(t)}return this.initializer.evaluate(t)}search(t){this.initializer.search(t)}}class es extends fe{constructor(t){super(),this.value=t}get astNodeType(){return"literalExpr"}evaluate(){return this.value}}class pr extends fe{constructor(t,e){super(),this.type=t,this.value=e}get astNodeType(){return"bitcastExpr"}search(t){this.value.search(t)}}class ns extends fe{constructor(t){super(),this.contents=t}get astNodeType(){return"groupExpr"}evaluate(t){return this.contents[0].evaluate(t)}search(t){this.searchBlock(this.contents,t)}}class wr extends fe{constructor(t){super(),this.index=t}search(t){this.index.search(t)}}class Es extends fe{constructor(){super()}}class gr extends Es{constructor(t,e){super(),this.operator=t,this.right=e}get astNodeType(){return"unaryOp"}evaluate(t){switch(this.operator){case"+":return this.right.evaluate(t);case"-":return-this.right.evaluate(t);case"!":return this.right.evaluate(t)?0:1;case"~":return~this.right.evaluate(t);default:throw new Error("Unknown unary operator: "+this.operator)}}search(t){this.right.search(t)}}class ae extends Es{constructor(t,e,s){super(),this.operator=t,this.left=e,this.right=s}get astNodeType(){return"binaryOp"}evaluate(t){switch(this.operator){case"+":return this.left.evaluate(t)+this.right.evaluate(t);case"-":return this.left.evaluate(t)-this.right.evaluate(t);case"*":return this.left.evaluate(t)*this.right.evaluate(t);case"/":return this.left.evaluate(t)/this.right.evaluate(t);case"%":return this.left.evaluate(t)%this.right.evaluate(t);case"==":return this.left.evaluate(t)==this.right.evaluate(t)?1:0;case"!=":return this.left.evaluate(t)!=this.right.evaluate(t)?1:0;case"<":return this.left.evaluate(t)<this.right.evaluate(t)?1:0;case">":return this.left.evaluate(t)>this.right.evaluate(t)?1:0;case"<=":return this.left.evaluate(t)<=this.right.evaluate(t)?1:0;case">=":return this.left.evaluate(t)>=this.right.evaluate(t)?1:0;case"&&":return this.left.evaluate(t)&&this.right.evaluate(t)?1:0;case"||":return this.left.evaluate(t)||this.right.evaluate(t)?1:0;default:throw new Error(`Unknown operator ${this.operator}`)}}search(t){this.left.search(t),this.right.search(t)}}class vs extends me{constructor(){super()}}class mr extends vs{constructor(t,e){super(),this.selector=t,this.body=e}get astNodeType(){return"case"}search(t){this.searchBlock(this.body,t)}}class yr extends vs{constructor(t){super(),this.body=t}get astNodeType(){return"default"}search(t){this.searchBlock(this.body,t)}}class xr extends me{constructor(t,e,s){super(),this.name=t,this.type=e,this.attributes=s}get astNodeType(){return"argument"}}class kr extends me{constructor(t,e){super(),this.condition=t,this.body=e}get astNodeType(){return"elseif"}search(t){this.condition.search(t),this.searchBlock(this.body,t)}}class Tr extends me{constructor(t,e,s){super(),this.name=t,this.type=e,this.attributes=s}get astNodeType(){return"member"}}class Er extends me{constructor(t,e){super(),this.name=t,this.value=e}get astNodeType(){return"attribute"}}var S,D;(function(h){h[h.token=0]="token",h[h.keyword=1]="keyword",h[h.reserved=2]="reserved"})(D||(D={}));class A{constructor(t,e,s){this.name=t,this.type=e,this.rule=s}toString(){return this.name}}class d{}S=d;d.none=new A("",D.reserved,"");d.eof=new A("EOF",D.token,"");d.reserved={asm:new A("asm",D.reserved,"asm"),bf16:new A("bf16",D.reserved,"bf16"),do:new A("do",D.reserved,"do"),enum:new A("enum",D.reserved,"enum"),f16:new A("f16",D.reserved,"f16"),f64:new A("f64",D.reserved,"f64"),handle:new A("handle",D.reserved,"handle"),i8:new A("i8",D.reserved,"i8"),i16:new A("i16",D.reserved,"i16"),i64:new A("i64",D.reserved,"i64"),mat:new A("mat",D.reserved,"mat"),premerge:new A("premerge",D.reserved,"premerge"),regardless:new A("regardless",D.reserved,"regardless"),typedef:new A("typedef",D.reserved,"typedef"),u8:new A("u8",D.reserved,"u8"),u16:new A("u16",D.reserved,"u16"),u64:new A("u64",D.reserved,"u64"),unless:new A("unless",D.reserved,"unless"),using:new A("using",D.reserved,"using"),vec:new A("vec",D.reserved,"vec"),void:new A("void",D.reserved,"void")};d.keywords={array:new A("array",D.keyword,"array"),atomic:new A("atomic",D.keyword,"atomic"),bool:new A("bool",D.keyword,"bool"),f32:new A("f32",D.keyword,"f32"),i32:new A("i32",D.keyword,"i32"),mat2x2:new A("mat2x2",D.keyword,"mat2x2"),mat2x3:new A("mat2x3",D.keyword,"mat2x3"),mat2x4:new A("mat2x4",D.keyword,"mat2x4"),mat3x2:new A("mat3x2",D.keyword,"mat3x2"),mat3x3:new A("mat3x3",D.keyword,"mat3x3"),mat3x4:new A("mat3x4",D.keyword,"mat3x4"),mat4x2:new A("mat4x2",D.keyword,"mat4x2"),mat4x3:new A("mat4x3",D.keyword,"mat4x3"),mat4x4:new A("mat4x4",D.keyword,"mat4x4"),ptr:new A("ptr",D.keyword,"ptr"),sampler:new A("sampler",D.keyword,"sampler"),sampler_comparison:new A("sampler_comparison",D.keyword,"sampler_comparison"),struct:new A("struct",D.keyword,"struct"),texture_1d:new A("texture_1d",D.keyword,"texture_1d"),texture_2d:new A("texture_2d",D.keyword,"texture_2d"),texture_2d_array:new A("texture_2d_array",D.keyword,"texture_2d_array"),texture_3d:new A("texture_3d",D.keyword,"texture_3d"),texture_cube:new A("texture_cube",D.keyword,"texture_cube"),texture_cube_array:new A("texture_cube_array",D.keyword,"texture_cube_array"),texture_multisampled_2d:new A("texture_multisampled_2d",D.keyword,"texture_multisampled_2d"),texture_storage_1d:new A("texture_storage_1d",D.keyword,"texture_storage_1d"),texture_storage_2d:new A("texture_storage_2d",D.keyword,"texture_storage_2d"),texture_storage_2d_array:new A("texture_storage_2d_array",D.keyword,"texture_storage_2d_array"),texture_storage_3d:new A("texture_storage_3d",D.keyword,"texture_storage_3d"),texture_depth_2d:new A("texture_depth_2d",D.keyword,"texture_depth_2d"),texture_depth_2d_array:new A("texture_depth_2d_array",D.keyword,"texture_depth_2d_array"),texture_depth_cube:new A("texture_depth_cube",D.keyword,"texture_depth_cube"),texture_depth_cube_array:new A("texture_depth_cube_array",D.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new A("texture_depth_multisampled_2d",D.keyword,"texture_depth_multisampled_2d"),texture_external:new A("texture_external",D.keyword,"texture_external"),u32:new A("u32",D.keyword,"u32"),vec2:new A("vec2",D.keyword,"vec2"),vec3:new A("vec3",D.keyword,"vec3"),vec4:new A("vec4",D.keyword,"vec4"),bitcast:new A("bitcast",D.keyword,"bitcast"),block:new A("block",D.keyword,"block"),break:new A("break",D.keyword,"break"),case:new A("case",D.keyword,"case"),continue:new A("continue",D.keyword,"continue"),continuing:new A("continuing",D.keyword,"continuing"),default:new A("default",D.keyword,"default"),diagnostic:new A("diagnostic",D.keyword,"diagnostic"),discard:new A("discard",D.keyword,"discard"),else:new A("else",D.keyword,"else"),enable:new A("enable",D.keyword,"enable"),fallthrough:new A("fallthrough",D.keyword,"fallthrough"),false:new A("false",D.keyword,"false"),fn:new A("fn",D.keyword,"fn"),for:new A("for",D.keyword,"for"),function:new A("function",D.keyword,"function"),if:new A("if",D.keyword,"if"),let:new A("let",D.keyword,"let"),const:new A("const",D.keyword,"const"),loop:new A("loop",D.keyword,"loop"),while:new A("while",D.keyword,"while"),private:new A("private",D.keyword,"private"),read:new A("read",D.keyword,"read"),read_write:new A("read_write",D.keyword,"read_write"),return:new A("return",D.keyword,"return"),requires:new A("requires",D.keyword,"requires"),storage:new A("storage",D.keyword,"storage"),switch:new A("switch",D.keyword,"switch"),true:new A("true",D.keyword,"true"),alias:new A("alias",D.keyword,"alias"),type:new A("type",D.keyword,"type"),uniform:new A("uniform",D.keyword,"uniform"),var:new A("var",D.keyword,"var"),override:new A("override",D.keyword,"override"),workgroup:new A("workgroup",D.keyword,"workgroup"),write:new A("write",D.keyword,"write"),r8unorm:new A("r8unorm",D.keyword,"r8unorm"),r8snorm:new A("r8snorm",D.keyword,"r8snorm"),r8uint:new A("r8uint",D.keyword,"r8uint"),r8sint:new A("r8sint",D.keyword,"r8sint"),r16uint:new A("r16uint",D.keyword,"r16uint"),r16sint:new A("r16sint",D.keyword,"r16sint"),r16float:new A("r16float",D.keyword,"r16float"),rg8unorm:new A("rg8unorm",D.keyword,"rg8unorm"),rg8snorm:new A("rg8snorm",D.keyword,"rg8snorm"),rg8uint:new A("rg8uint",D.keyword,"rg8uint"),rg8sint:new A("rg8sint",D.keyword,"rg8sint"),r32uint:new A("r32uint",D.keyword,"r32uint"),r32sint:new A("r32sint",D.keyword,"r32sint"),r32float:new A("r32float",D.keyword,"r32float"),rg16uint:new A("rg16uint",D.keyword,"rg16uint"),rg16sint:new A("rg16sint",D.keyword,"rg16sint"),rg16float:new A("rg16float",D.keyword,"rg16float"),rgba8unorm:new A("rgba8unorm",D.keyword,"rgba8unorm"),rgba8unorm_srgb:new A("rgba8unorm_srgb",D.keyword,"rgba8unorm_srgb"),rgba8snorm:new A("rgba8snorm",D.keyword,"rgba8snorm"),rgba8uint:new A("rgba8uint",D.keyword,"rgba8uint"),rgba8sint:new A("rgba8sint",D.keyword,"rgba8sint"),bgra8unorm:new A("bgra8unorm",D.keyword,"bgra8unorm"),bgra8unorm_srgb:new A("bgra8unorm_srgb",D.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new A("rgb10a2unorm",D.keyword,"rgb10a2unorm"),rg11b10float:new A("rg11b10float",D.keyword,"rg11b10float"),rg32uint:new A("rg32uint",D.keyword,"rg32uint"),rg32sint:new A("rg32sint",D.keyword,"rg32sint"),rg32float:new A("rg32float",D.keyword,"rg32float"),rgba16uint:new A("rgba16uint",D.keyword,"rgba16uint"),rgba16sint:new A("rgba16sint",D.keyword,"rgba16sint"),rgba16float:new A("rgba16float",D.keyword,"rgba16float"),rgba32uint:new A("rgba32uint",D.keyword,"rgba32uint"),rgba32sint:new A("rgba32sint",D.keyword,"rgba32sint"),rgba32float:new A("rgba32float",D.keyword,"rgba32float"),static_assert:new A("static_assert",D.keyword,"static_assert")};d.tokens={decimal_float_literal:new A("decimal_float_literal",D.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?f?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+f?)|(-?[0-9]+f)/),hex_float_literal:new A("hex_float_literal",D.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+f?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+f?))/),int_literal:new A("int_literal",D.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new A("uint_literal",D.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),ident:new A("ident",D.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new A("and",D.token,"&"),and_and:new A("and_and",D.token,"&&"),arrow:new A("arrow ",D.token,"->"),attr:new A("attr",D.token,"@"),forward_slash:new A("forward_slash",D.token,"/"),bang:new A("bang",D.token,"!"),bracket_left:new A("bracket_left",D.token,"["),bracket_right:new A("bracket_right",D.token,"]"),brace_left:new A("brace_left",D.token,"{"),brace_right:new A("brace_right",D.token,"}"),colon:new A("colon",D.token,":"),comma:new A("comma",D.token,","),equal:new A("equal",D.token,"="),equal_equal:new A("equal_equal",D.token,"=="),not_equal:new A("not_equal",D.token,"!="),greater_than:new A("greater_than",D.token,">"),greater_than_equal:new A("greater_than_equal",D.token,">="),shift_right:new A("shift_right",D.token,">>"),less_than:new A("less_than",D.token,"<"),less_than_equal:new A("less_than_equal",D.token,"<="),shift_left:new A("shift_left",D.token,"<<"),modulo:new A("modulo",D.token,"%"),minus:new A("minus",D.token,"-"),minus_minus:new A("minus_minus",D.token,"--"),period:new A("period",D.token,"."),plus:new A("plus",D.token,"+"),plus_plus:new A("plus_plus",D.token,"++"),or:new A("or",D.token,"|"),or_or:new A("or_or",D.token,"||"),paren_left:new A("paren_left",D.token,"("),paren_right:new A("paren_right",D.token,")"),semicolon:new A("semicolon",D.token,";"),star:new A("star",D.token,"*"),tilde:new A("tilde",D.token,"~"),underscore:new A("underscore",D.token,"_"),xor:new A("xor",D.token,"^"),plus_equal:new A("plus_equal",D.token,"+="),minus_equal:new A("minus_equal",D.token,"-="),times_equal:new A("times_equal",D.token,"*="),division_equal:new A("division_equal",D.token,"/="),modulo_equal:new A("modulo_equal",D.token,"%="),and_equal:new A("and_equal",D.token,"&="),or_equal:new A("or_equal",D.token,"|="),xor_equal:new A("xor_equal",D.token,"^="),shift_right_equal:new A("shift_right_equal",D.token,">>="),shift_left_equal:new A("shift_left_equal",D.token,"<<=")};d.simpleTokens={"@":S.tokens.attr,"{":S.tokens.brace_left,"}":S.tokens.brace_right,":":S.tokens.colon,",":S.tokens.comma,"(":S.tokens.paren_left,")":S.tokens.paren_right,";":S.tokens.semicolon};d.literalTokens={"&":S.tokens.and,"&&":S.tokens.and_and,"->":S.tokens.arrow,"/":S.tokens.forward_slash,"!":S.tokens.bang,"[":S.tokens.bracket_left,"]":S.tokens.bracket_right,"=":S.tokens.equal,"==":S.tokens.equal_equal,"!=":S.tokens.not_equal,">":S.tokens.greater_than,">=":S.tokens.greater_than_equal,">>":S.tokens.shift_right,"<":S.tokens.less_than,"<=":S.tokens.less_than_equal,"<<":S.tokens.shift_left,"%":S.tokens.modulo,"-":S.tokens.minus,"--":S.tokens.minus_minus,".":S.tokens.period,"+":S.tokens.plus,"++":S.tokens.plus_plus,"|":S.tokens.or,"||":S.tokens.or_or,"*":S.tokens.star,"~":S.tokens.tilde,_:S.tokens.underscore,"^":S.tokens.xor,"+=":S.tokens.plus_equal,"-=":S.tokens.minus_equal,"*=":S.tokens.times_equal,"/=":S.tokens.division_equal,"%=":S.tokens.modulo_equal,"&=":S.tokens.and_equal,"|=":S.tokens.or_equal,"^=":S.tokens.xor_equal,">>=":S.tokens.shift_right_equal,"<<=":S.tokens.shift_left_equal};d.regexTokens={decimal_float_literal:S.tokens.decimal_float_literal,hex_float_literal:S.tokens.hex_float_literal,int_literal:S.tokens.int_literal,uint_literal:S.tokens.uint_literal,ident:S.tokens.ident};d.storage_class=[S.keywords.function,S.keywords.private,S.keywords.workgroup,S.keywords.uniform,S.keywords.storage];d.access_mode=[S.keywords.read,S.keywords.write,S.keywords.read_write];d.sampler_type=[S.keywords.sampler,S.keywords.sampler_comparison];d.sampled_texture_type=[S.keywords.texture_1d,S.keywords.texture_2d,S.keywords.texture_2d_array,S.keywords.texture_3d,S.keywords.texture_cube,S.keywords.texture_cube_array];d.multisampled_texture_type=[S.keywords.texture_multisampled_2d];d.storage_texture_type=[S.keywords.texture_storage_1d,S.keywords.texture_storage_2d,S.keywords.texture_storage_2d_array,S.keywords.texture_storage_3d];d.depth_texture_type=[S.keywords.texture_depth_2d,S.keywords.texture_depth_2d_array,S.keywords.texture_depth_cube,S.keywords.texture_depth_cube_array,S.keywords.texture_depth_multisampled_2d];d.texture_external_type=[S.keywords.texture_external];d.any_texture_type=[...S.sampled_texture_type,...S.multisampled_texture_type,...S.storage_texture_type,...S.depth_texture_type,...S.texture_external_type];d.texel_format=[S.keywords.r8unorm,S.keywords.r8snorm,S.keywords.r8uint,S.keywords.r8sint,S.keywords.r16uint,S.keywords.r16sint,S.keywords.r16float,S.keywords.rg8unorm,S.keywords.rg8snorm,S.keywords.rg8uint,S.keywords.rg8sint,S.keywords.r32uint,S.keywords.r32sint,S.keywords.r32float,S.keywords.rg16uint,S.keywords.rg16sint,S.keywords.rg16float,S.keywords.rgba8unorm,S.keywords.rgba8unorm_srgb,S.keywords.rgba8snorm,S.keywords.rgba8uint,S.keywords.rgba8sint,S.keywords.bgra8unorm,S.keywords.bgra8unorm_srgb,S.keywords.rgb10a2unorm,S.keywords.rg11b10float,S.keywords.rg32uint,S.keywords.rg32sint,S.keywords.rg32float,S.keywords.rgba16uint,S.keywords.rgba16sint,S.keywords.rgba16float,S.keywords.rgba32uint,S.keywords.rgba32sint,S.keywords.rgba32float];d.const_literal=[S.tokens.int_literal,S.tokens.uint_literal,S.tokens.decimal_float_literal,S.tokens.hex_float_literal,S.keywords.true,S.keywords.false];d.literal_or_ident=[S.tokens.ident,S.tokens.int_literal,S.tokens.uint_literal,S.tokens.decimal_float_literal,S.tokens.hex_float_literal];d.element_count_expression=[S.tokens.int_literal,S.tokens.uint_literal,S.tokens.ident];d.template_types=[S.keywords.vec2,S.keywords.vec3,S.keywords.vec4,S.keywords.mat2x2,S.keywords.mat2x3,S.keywords.mat2x4,S.keywords.mat3x2,S.keywords.mat3x3,S.keywords.mat3x4,S.keywords.mat4x2,S.keywords.mat4x3,S.keywords.mat4x4,S.keywords.atomic,S.keywords.bitcast,...S.any_texture_type];d.attribute_name=[S.tokens.ident,S.keywords.block,S.keywords.diagnostic];d.assignment_operators=[S.tokens.equal,S.tokens.plus_equal,S.tokens.minus_equal,S.tokens.times_equal,S.tokens.division_equal,S.tokens.modulo_equal,S.tokens.and_equal,S.tokens.or_equal,S.tokens.xor_equal,S.tokens.shift_right_equal,S.tokens.shift_left_equal];d.increment_operators=[S.tokens.plus_plus,S.tokens.minus_minus];class ss{constructor(t,e,s){this.type=t,this.lexeme=e,this.line=s}toString(){return this.lexeme}isTemplateType(){return d.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==d.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class vr{constructor(t){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=t??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new ss(d.eof,"",this._line)),this._tokens}scanToken(){let t=this._advance();if(t==`
`)return this._line++,!0;if(this._isWhitespace(t))return!0;if(t=="/"){if(this._peekAhead()=="/"){for(;t!=`
`;){if(this._isAtEnd())return!0;t=this._advance()}return this._line++,!0}else if(this._peekAhead()=="*"){this._advance();let x=1;for(;x>0;){if(this._isAtEnd())return!0;if(t=this._advance(),t==`
`)this._line++;else if(t=="*"){if(this._peekAhead()=="/"&&(this._advance(),x--,x==0))return!0}else t=="/"&&this._peekAhead()=="*"&&(this._advance(),x++)}return!0}}const e=d.simpleTokens[t];if(e)return this._addToken(e),!0;let s=d.none;const o=this._isAlpha(t),f=t==="_";if(this._isAlphaNumeric(t)){let x=this._peekAhead();for(;this._isAlphaNumeric(x);)t+=this._advance(),x=this._peekAhead()}if(o){const x=d.keywords[t];if(x)return this._addToken(x),!0}if(o||f)return this._addToken(d.tokens.ident),!0;for(;;){let x=this._findType(t);const N=this._peekAhead();if(t=="-"&&this._tokens.length>0){if(N=="=")return this._current++,t+=N,this._addToken(d.tokens.minus_equal),!0;if(N=="-")return this._current++,t+=N,this._addToken(d.tokens.minus_minus),!0;const R=this._tokens.length-1;if((d.literal_or_ident.indexOf(this._tokens[R].type)!=-1||this._tokens[R].type==d.tokens.paren_right)&&N!=">")return this._addToken(x),!0}if(t==">"&&(N==">"||N=="=")){let R=!1,I=this._tokens.length-1;for(let B=0;B<5&&I>=0&&d.assignment_operators.indexOf(this._tokens[I].type)===-1;++B,--I)if(this._tokens[I].type===d.tokens.less_than){I>0&&this._tokens[I-1].isArrayOrTemplateType()&&(R=!0);break}if(R)return this._addToken(x),!0}if(x===d.none){let R=t,I=0;const B=2;for(let z=0;z<B;++z)if(R+=this._peekAhead(z),x=this._findType(R),x!==d.none){I=z;break}if(x===d.none)return s===d.none?!1:(this._current--,this._addToken(s),!0);t=R,this._current+=I+1}if(s=x,this._isAtEnd())break;t+=this._advance()}return s===d.none?!1:(this._addToken(s),!0)}_findType(t){for(const s in d.regexTokens){const o=d.regexTokens[s];if(this._match(t,o.rule))return o}const e=d.literalTokens[t];return e||d.none}_match(t,e){const s=e.exec(t);return s&&s.index==0&&s[0]==t}_isAtEnd(){return this._current>=this._source.length}_isAlpha(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"}_isAlphaNumeric(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"||t=="_"||t>="0"&&t<="9"}_isWhitespace(t){return t==" "||t=="	"||t=="\r"}_advance(t=0){let e=this._source[this._current];return t=t||0,t++,this._current+=t,e}_peekAhead(t=0){return t=t||0,this._current+t>=this._source.length?"\0":this._source[this._current+t]}_addToken(t){const e=this._source.substring(this._start,this._current);this._tokens.push(new ss(t,e,this._line))}}class Dr{constructor(){this._tokens=[],this._current=0,this._currentLine=0,this._context=new Zs,this._deferArrayCountEval=[]}parse(t){this._initialize(t),this._deferArrayCountEval.length=0;const e=[];for(;!this._isAtEnd();){const s=this._global_decl_or_directive();if(!s)break;e.push(s)}if(this._deferArrayCountEval.length>0){for(const s of this._deferArrayCountEval){const o=s.arrayType,f=s.countNode;if(f instanceof An){const N=f.name,R=this._context.constants.get(N);if(R)try{const I=R.evaluate(this._context);o.count=I}catch{}}}this._deferArrayCountEval.length=0}return e}_initialize(t){if(t)if(typeof t=="string"){const e=new vr(t);this._tokens=e.scanTokens()}else this._tokens=t;else this._tokens=[];this._current=0}_error(t,e){return{token:t,message:e,toString:function(){return`${e}`}}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==d.eof}_match(t){if(t instanceof A)return this._check(t)?(this._advance(),!0):!1;for(let e=0,s=t.length;e<s;++e){const o=t[e];if(this._check(o))return this._advance(),!0}return!1}_consume(t,e){if(this._check(t))return this._advance();throw this._error(this._peek(),e)}_check(t){if(this._isAtEnd())return!1;const e=this._peek();if(t instanceof Array){const s=e.type;return t.indexOf(s)!=-1}return e.type==t}_advance(){var t,e;return this._currentLine=(e=(t=this._peek())===null||t===void 0?void 0:t.line)!==null&&e!==void 0?e:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(d.tokens.semicolon)&&!this._isAtEnd(););if(this._match(d.keywords.alias)){const e=this._type_alias();return this._consume(d.tokens.semicolon,"Expected ';'"),e}if(this._match(d.keywords.diagnostic)){const e=this._diagnostic();return this._consume(d.tokens.semicolon,"Expected ';'"),e}if(this._match(d.keywords.requires)){const e=this._requires_directive();return this._consume(d.tokens.semicolon,"Expected ';'"),e}if(this._match(d.keywords.enable)){const e=this._enable_directive();return this._consume(d.tokens.semicolon,"Expected ';'"),e}const t=this._attribute();if(this._check(d.keywords.var)){const e=this._global_variable_decl();return e!=null&&(e.attributes=t),this._consume(d.tokens.semicolon,"Expected ';'."),e}if(this._check(d.keywords.override)){const e=this._override_variable_decl();return e!=null&&(e.attributes=t),this._consume(d.tokens.semicolon,"Expected ';'."),e}if(this._check(d.keywords.let)){const e=this._global_let_decl();return e!=null&&(e.attributes=t),this._consume(d.tokens.semicolon,"Expected ';'."),e}if(this._check(d.keywords.const)){const e=this._global_const_decl();return e!=null&&(e.attributes=t),this._consume(d.tokens.semicolon,"Expected ';'."),e}if(this._check(d.keywords.struct)){const e=this._struct_decl();return e!=null&&(e.attributes=t),e}if(this._check(d.keywords.fn)){const e=this._function_decl();return e!=null&&(e.attributes=t),e}return null}_function_decl(){if(!this._match(d.keywords.fn))return null;const t=this._currentLine,e=this._consume(d.tokens.ident,"Expected function name.").toString();this._consume(d.tokens.paren_left,"Expected '(' for function arguments.");const s=[];if(!this._check(d.tokens.paren_right))do{if(this._check(d.tokens.paren_right))break;const N=this._attribute(),R=this._consume(d.tokens.ident,"Expected argument name.").toString();this._consume(d.tokens.colon,"Expected ':' for argument type.");const I=this._attribute(),B=this._type_decl();B!=null&&(B.attributes=I,s.push(new xr(R,B,N)))}while(this._match(d.tokens.comma));this._consume(d.tokens.paren_right,"Expected ')' after function arguments.");let o=null;if(this._match(d.tokens.arrow)){const N=this._attribute();o=this._type_decl(),o!=null&&(o.attributes=N)}const f=this._compound_statement(),x=this._currentLine;return new vn(e,s,o,f,t,x)}_compound_statement(){const t=[];for(this._consume(d.tokens.brace_left,"Expected '{' for block.");!this._check(d.tokens.brace_right);){const e=this._statement();e!==null&&t.push(e)}return this._consume(d.tokens.brace_right,"Expected '}' for block."),t}_statement(){for(;this._match(d.tokens.semicolon)&&!this._isAtEnd(););if(this._check(d.tokens.attr)&&this._attribute(),this._check(d.keywords.if))return this._if_statement();if(this._check(d.keywords.switch))return this._switch_statement();if(this._check(d.keywords.loop))return this._loop_statement();if(this._check(d.keywords.for))return this._for_statement();if(this._check(d.keywords.while))return this._while_statement();if(this._check(d.keywords.continuing))return this._continuing_statement();if(this._check(d.keywords.static_assert))return this._static_assert_statement();if(this._check(d.tokens.brace_left))return this._compound_statement();let t=null;return this._check(d.keywords.return)?t=this._return_statement():this._check([d.keywords.var,d.keywords.let,d.keywords.const])?t=this._variable_statement():this._match(d.keywords.discard)?t=new hr:this._match(d.keywords.break)?t=new lr:this._match(d.keywords.continue)?t=new _r:t=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement(),t!=null&&this._consume(d.tokens.semicolon,"Expected ';' after statement."),t}_static_assert_statement(){if(!this._match(d.keywords.static_assert))return null;const t=this._optional_paren_expression();return new js(t)}_while_statement(){if(!this._match(d.keywords.while))return null;const t=this._optional_paren_expression();this._check(d.tokens.attr)&&this._attribute();const e=this._compound_statement();return new Js(t,e)}_continuing_statement(){if(!this._match(d.keywords.continuing))return null;const t=this._compound_statement();return new Ks(t)}_for_statement(){if(!this._match(d.keywords.for))return null;this._consume(d.tokens.paren_left,"Expected '('.");const t=this._check(d.tokens.semicolon)?null:this._for_init();this._consume(d.tokens.semicolon,"Expected ';'.");const e=this._check(d.tokens.semicolon)?null:this._short_circuit_or_expression();this._consume(d.tokens.semicolon,"Expected ';'.");const s=this._check(d.tokens.paren_right)?null:this._for_increment();this._consume(d.tokens.paren_right,"Expected ')'."),this._check(d.tokens.attr)&&this._attribute();const o=this._compound_statement();return new tr(t,e,s,o)}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(d.keywords.var)){const t=this._variable_decl();if(t===null)throw this._error(this._peek(),"Variable declaration expected.");let e=null;return this._match(d.tokens.equal)&&(e=this._short_circuit_or_expression()),new Ue(t.name,t.type,t.storage,t.access,e)}if(this._match(d.keywords.let)){const t=this._consume(d.tokens.ident,"Expected name for let.").toString();let e=null;if(this._match(d.tokens.colon)){const o=this._attribute();e=this._type_decl(),e!=null&&(e.attributes=o)}this._consume(d.tokens.equal,"Expected '=' for let.");const s=this._short_circuit_or_expression();return new Dn(t,e,null,null,s)}if(this._match(d.keywords.const)){const t=this._consume(d.tokens.ident,"Expected name for const.").toString();let e=null;if(this._match(d.tokens.colon)){const o=this._attribute();e=this._type_decl(),e!=null&&(e.attributes=o)}this._consume(d.tokens.equal,"Expected '=' for const.");const s=this._short_circuit_or_expression();return new Kn(t,e,null,null,s)}return null}_increment_decrement_statement(){const t=this._current,e=this._unary_expression();if(e==null)return null;if(!this._check(d.increment_operators))return this._current=t,null;const s=this._consume(d.increment_operators,"Expected increment operator");return new er(s.type===d.tokens.plus_plus?Ke.increment:Ke.decrement,e)}_assignment_statement(){let t=null;if(this._check(d.tokens.brace_right))return null;let e=this._match(d.tokens.underscore);if(e||(t=this._unary_expression()),!e&&t==null)return null;const s=this._consume(d.assignment_operators,"Expected assignment operator."),o=this._short_circuit_or_expression();return new nr(nn.parse(s.lexeme),t,o)}_func_call_statement(){if(!this._check(d.tokens.ident))return null;const t=this._current,e=this._consume(d.tokens.ident,"Expected function name."),s=this._argument_expression_list();return s===null?(this._current=t,null):new ms(e.lexeme,s)}_loop_statement(){if(!this._match(d.keywords.loop))return null;this._check(d.tokens.attr)&&this._attribute(),this._consume(d.tokens.brace_left,"Expected '{' for loop.");const t=[];let e=this._statement();for(;e!==null;){if(Array.isArray(e))for(let o of e)t.push(o);else t.push(e);e=this._statement()}let s=null;return this._match(d.keywords.continuing)&&(s=this._compound_statement()),this._consume(d.tokens.brace_right,"Expected '}' for loop."),new sr(t,s)}_switch_statement(){if(!this._match(d.keywords.switch))return null;const t=this._optional_paren_expression();this._check(d.tokens.attr)&&this._attribute(),this._consume(d.tokens.brace_left,"Expected '{' for switch.");const e=this._switch_body();if(e==null||e.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(d.tokens.brace_right,"Expected '}' for switch."),new rr(t,e)}_switch_body(){const t=[];if(this._match(d.keywords.case)){const e=this._case_selectors();this._match(d.tokens.colon),this._check(d.tokens.attr)&&this._attribute(),this._consume(d.tokens.brace_left,"Exected '{' for switch case.");const s=this._case_body();this._consume(d.tokens.brace_right,"Exected '}' for switch case."),t.push(new mr(e,s))}if(this._match(d.keywords.default)){this._match(d.tokens.colon),this._check(d.tokens.attr)&&this._attribute(),this._consume(d.tokens.brace_left,"Exected '{' for switch default.");const e=this._case_body();this._consume(d.tokens.brace_right,"Exected '}' for switch default."),t.push(new yr(e))}if(this._check([d.keywords.default,d.keywords.case])){const e=this._switch_body();t.push(e[0])}return t}_case_selectors(){const t=[this._shift_expression()];for(;this._match(d.tokens.comma);)t.push(this._shift_expression());return t}_case_body(){if(this._match(d.keywords.fallthrough))return this._consume(d.tokens.semicolon,"Expected ';'"),[];let t=this._statement();if(t==null)return[];t instanceof Array||(t=[t]);const e=this._case_body();return e.length==0?t:[...t,e[0]]}_if_statement(){if(!this._match(d.keywords.if))return null;const t=this._optional_paren_expression();this._check(d.tokens.attr)&&this._attribute();const e=this._compound_statement();let s=[];this._match_elseif()&&(this._check(d.tokens.attr)&&this._attribute(),s=this._elseif_statement(s));let o=null;return this._match(d.keywords.else)&&(this._check(d.tokens.attr)&&this._attribute(),o=this._compound_statement()),new ir(t,e,s,o)}_match_elseif(){return this._tokens[this._current].type===d.keywords.else&&this._tokens[this._current+1].type===d.keywords.if?(this._advance(),this._advance(),!0):!1}_elseif_statement(t=[]){const e=this._optional_paren_expression(),s=this._compound_statement();return t.push(new kr(e,s)),this._match_elseif()&&(this._check(d.tokens.attr)&&this._attribute(),this._elseif_statement(t)),t}_return_statement(){if(!this._match(d.keywords.return))return null;const t=this._short_circuit_or_expression();return new or(t)}_short_circuit_or_expression(){let t=this._short_circuit_and_expr();for(;this._match(d.tokens.or_or);)t=new ae(this._previous().toString(),t,this._short_circuit_and_expr());return t}_short_circuit_and_expr(){let t=this._inclusive_or_expression();for(;this._match(d.tokens.and_and);)t=new ae(this._previous().toString(),t,this._inclusive_or_expression());return t}_inclusive_or_expression(){let t=this._exclusive_or_expression();for(;this._match(d.tokens.or);)t=new ae(this._previous().toString(),t,this._exclusive_or_expression());return t}_exclusive_or_expression(){let t=this._and_expression();for(;this._match(d.tokens.xor);)t=new ae(this._previous().toString(),t,this._and_expression());return t}_and_expression(){let t=this._equality_expression();for(;this._match(d.tokens.and);)t=new ae(this._previous().toString(),t,this._equality_expression());return t}_equality_expression(){const t=this._relational_expression();return this._match([d.tokens.equal_equal,d.tokens.not_equal])?new ae(this._previous().toString(),t,this._relational_expression()):t}_relational_expression(){let t=this._shift_expression();for(;this._match([d.tokens.less_than,d.tokens.greater_than,d.tokens.less_than_equal,d.tokens.greater_than_equal]);)t=new ae(this._previous().toString(),t,this._shift_expression());return t}_shift_expression(){let t=this._additive_expression();for(;this._match([d.tokens.shift_left,d.tokens.shift_right]);)t=new ae(this._previous().toString(),t,this._additive_expression());return t}_additive_expression(){let t=this._multiplicative_expression();for(;this._match([d.tokens.plus,d.tokens.minus]);)t=new ae(this._previous().toString(),t,this._multiplicative_expression());return t}_multiplicative_expression(){let t=this._unary_expression();for(;this._match([d.tokens.star,d.tokens.forward_slash,d.tokens.modulo]);)t=new ae(this._previous().toString(),t,this._unary_expression());return t}_unary_expression(){return this._match([d.tokens.minus,d.tokens.bang,d.tokens.tilde,d.tokens.star,d.tokens.and])?new gr(this._previous().toString(),this._unary_expression()):this._singular_expression()}_singular_expression(){const t=this._primary_expression(),e=this._postfix_expression();return e&&(t.postfix=e),t}_postfix_expression(){if(this._match(d.tokens.bracket_left)){const t=this._short_circuit_or_expression();this._consume(d.tokens.bracket_right,"Expected ']'.");const e=new wr(t),s=this._postfix_expression();return s&&(e.postfix=s),e}if(this._match(d.tokens.period)){const t=this._consume(d.tokens.ident,"Expected member name."),e=this._postfix_expression(),s=new dr(t.lexeme);return e&&(s.postfix=e),s}return null}_getStruct(t){return this._context.aliases.has(t)?this._context.aliases.get(t).type:this._context.structs.has(t)?this._context.structs.get(t):null}_primary_expression(){if(this._match(d.tokens.ident)){const s=this._previous().toString();if(this._check(d.tokens.paren_left)){const o=this._argument_expression_list(),f=this._getStruct(s);return f!=null?new Ve(f,o):new Ts(s,o)}if(this._context.constants.has(s)){const o=this._context.constants.get(s);return new ts(s,o.value)}return new An(s)}if(this._match(d.const_literal))return new es(parseFloat(this._previous().toString()));if(this._check(d.tokens.paren_left))return this._paren_expression();if(this._match(d.keywords.bitcast)){this._consume(d.tokens.less_than,"Expected '<'.");const s=this._type_decl();this._consume(d.tokens.greater_than,"Expected '>'.");const o=this._paren_expression();return new pr(s,o)}const t=this._type_decl(),e=this._argument_expression_list();return new Ve(t,e)}_argument_expression_list(){if(!this._match(d.tokens.paren_left))return null;const t=[];do{if(this._check(d.tokens.paren_right))break;const e=this._short_circuit_or_expression();t.push(e)}while(this._match(d.tokens.comma));return this._consume(d.tokens.paren_right,"Expected ')' for agument list"),t}_optional_paren_expression(){this._match(d.tokens.paren_left);const t=this._short_circuit_or_expression();return this._match(d.tokens.paren_right),new ns([t])}_paren_expression(){this._consume(d.tokens.paren_left,"Expected '('.");const t=this._short_circuit_or_expression();return this._consume(d.tokens.paren_right,"Expected ')'."),new ns([t])}_struct_decl(){if(!this._match(d.keywords.struct))return null;const t=this._currentLine,e=this._consume(d.tokens.ident,"Expected name for struct.").toString();this._consume(d.tokens.brace_left,"Expected '{' for struct body.");const s=[];for(;!this._check(d.tokens.brace_right);){const x=this._attribute(),N=this._consume(d.tokens.ident,"Expected variable name.").toString();this._consume(d.tokens.colon,"Expected ':' for struct member type.");const R=this._attribute(),I=this._type_decl();I!=null&&(I.attributes=R),this._check(d.tokens.brace_right)?this._match(d.tokens.comma):this._consume(d.tokens.comma,"Expected ',' for struct member."),s.push(new Tr(N,I,x))}this._consume(d.tokens.brace_right,"Expected '}' after struct body.");const o=this._currentLine,f=new Oe(e,s,t,o);return this._context.structs.set(e,f),f}_global_variable_decl(){const t=this._variable_decl();return t&&this._match(d.tokens.equal)&&(t.value=this._const_expression()),t}_override_variable_decl(){const t=this._override_decl();return t&&this._match(d.tokens.equal)&&(t.value=this._const_expression()),t}_global_const_decl(){if(!this._match(d.keywords.const))return null;const t=this._consume(d.tokens.ident,"Expected variable name");let e=null;if(this._match(d.tokens.colon)){const f=this._attribute();e=this._type_decl(),e!=null&&(e.attributes=f)}let s=null;if(this._match(d.tokens.equal)){const f=this._short_circuit_or_expression();if(f instanceof Ve)s=f;else if(f instanceof ts&&f.initializer instanceof Ve)s=f.initializer;else try{const x=f.evaluate(this._context);s=new es(x)}catch{s=f}}const o=new Kn(t.toString(),e,"","",s);return this._context.constants.set(o.name,o),o}_global_let_decl(){if(!this._match(d.keywords.let))return null;const t=this._consume(d.tokens.ident,"Expected variable name");let e=null;if(this._match(d.tokens.colon)){const o=this._attribute();e=this._type_decl(),e!=null&&(e.attributes=o)}let s=null;return this._match(d.tokens.equal)&&(s=this._const_expression()),new Dn(t.toString(),e,"","",s)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(d.keywords.var))return null;let t="",e="";this._match(d.tokens.less_than)&&(t=this._consume(d.storage_class,"Expected storage_class.").toString(),this._match(d.tokens.comma)&&(e=this._consume(d.access_mode,"Expected access_mode.").toString()),this._consume(d.tokens.greater_than,"Expected '>'."));const s=this._consume(d.tokens.ident,"Expected variable name");let o=null;if(this._match(d.tokens.colon)){const f=this._attribute();o=this._type_decl(),o!=null&&(o.attributes=f)}return new Ue(s.toString(),o,t,e,null)}_override_decl(){if(!this._match(d.keywords.override))return null;const t=this._consume(d.tokens.ident,"Expected variable name");let e=null;if(this._match(d.tokens.colon)){const s=this._attribute();e=this._type_decl(),e!=null&&(e.attributes=s)}return new gs(t.toString(),e,null)}_diagnostic(){this._consume(d.tokens.paren_left,"Expected '('");const t=this._consume(d.tokens.ident,"Expected severity control name.");this._consume(d.tokens.comma,"Expected ','");const e=this._consume(d.tokens.ident,"Expected diagnostic rule name.");return this._consume(d.tokens.paren_right,"Expected ')'"),new ur(t.toString(),e.toString())}_enable_directive(){const t=this._consume(d.tokens.ident,"identity expected.");return new ar(t.toString())}_requires_directive(){const t=[this._consume(d.tokens.ident,"identity expected.").toString()];for(;this._match(d.tokens.comma);){const e=this._consume(d.tokens.ident,"identity expected.");t.push(e.toString())}return new cr(t)}_type_alias(){const t=this._consume(d.tokens.ident,"identity expected.");this._consume(d.tokens.equal,"Expected '=' for type alias.");let e=this._type_decl();if(e===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(e.name)&&(e=this._context.aliases.get(e.name).type);const s=new ys(t.toString(),e);return this._context.aliases.set(s.name,s),s}_type_decl(){if(this._check([d.tokens.ident,...d.texel_format,d.keywords.bool,d.keywords.f32,d.keywords.i32,d.keywords.u32])){const s=this._advance(),o=s.toString();return this._context.structs.has(o)?this._context.structs.get(o):this._context.aliases.has(o)?this._context.aliases.get(o).type:new qe(s.toString())}let t=this._texture_sampler_types();if(t)return t;if(this._check(d.template_types)){let s=this._advance().toString(),o=null,f=null;return this._match(d.tokens.less_than)&&(o=this._type_decl(),f=null,this._match(d.tokens.comma)&&(f=this._consume(d.access_mode,"Expected access_mode for pointer").toString()),this._consume(d.tokens.greater_than,"Expected '>' for type.")),new xs(s,o,f)}if(this._match(d.keywords.ptr)){let s=this._previous().toString();this._consume(d.tokens.less_than,"Expected '<' for pointer.");const o=this._consume(d.storage_class,"Expected storage_class for pointer");this._consume(d.tokens.comma,"Expected ',' for pointer.");const f=this._type_decl();let x=null;return this._match(d.tokens.comma)&&(x=this._consume(d.access_mode,"Expected access_mode for pointer").toString()),this._consume(d.tokens.greater_than,"Expected '>' for pointer."),new fr(s,o.toString(),f,x)}const e=this._attribute();if(this._match(d.keywords.array)){let s=null,o=-1;const f=this._previous();let x=null;if(this._match(d.tokens.less_than)){s=this._type_decl(),this._context.aliases.has(s.name)&&(s=this._context.aliases.get(s.name).type);let R="";if(this._match(d.tokens.comma)){x=this._shift_expression();try{R=x.evaluate(this._context).toString(),x=null}catch{R="1"}}this._consume(d.tokens.greater_than,"Expected '>' for array."),o=R?parseInt(R):0}const N=new ks(f.toString(),e,s,o);return x&&this._deferArrayCountEval.push({arrayType:N,countNode:x}),N}return null}_texture_sampler_types(){if(this._match(d.sampler_type))return new tn(this._previous().toString(),null,null);if(this._match(d.depth_texture_type))return new tn(this._previous().toString(),null,null);if(this._match(d.sampled_texture_type)||this._match(d.multisampled_texture_type)){const t=this._previous();this._consume(d.tokens.less_than,"Expected '<' for sampler type.");const e=this._type_decl();return this._consume(d.tokens.greater_than,"Expected '>' for sampler type."),new tn(t.toString(),e,null)}if(this._match(d.storage_texture_type)){const t=this._previous();this._consume(d.tokens.less_than,"Expected '<' for sampler type.");const e=this._consume(d.texel_format,"Invalid texel format.").toString();this._consume(d.tokens.comma,"Expected ',' after texel format.");const s=this._consume(d.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(d.tokens.greater_than,"Expected '>' for sampler type."),new tn(t.toString(),e,s)}return null}_attribute(){let t=[];for(;this._match(d.tokens.attr);){const e=this._consume(d.attribute_name,"Expected attribute name"),s=new Er(e.toString(),null);if(this._match(d.tokens.paren_left)){if(s.value=this._consume(d.literal_or_ident,"Expected attribute value").toString(),this._check(d.tokens.comma)){this._advance();do{const o=this._consume(d.literal_or_ident,"Expected attribute value").toString();s.value instanceof Array||(s.value=[s.value]),s.value.push(o)}while(this._match(d.tokens.comma))}this._consume(d.tokens.paren_right,"Expected ')'")}t.push(s)}return t.length==0?null:t}}class $e{constructor(t,e){this.name=t,this.attributes=e,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}}class rs{constructor(t,e,s){this.name=t,this.type=e,this.attributes=s,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class wn extends $e{constructor(t,e){super(t,e),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class En extends $e{constructor(t,e){super(t,e),this.count=0,this.stride=0}get isArray(){return!0}}class is extends $e{constructor(t,e,s,o){super(t,s),this.format=e,this.access=o}get isTemplate(){return!0}}var xe;(function(h){h[h.Uniform=0]="Uniform",h[h.Storage=1]="Storage",h[h.Texture=2]="Texture",h[h.Sampler=3]="Sampler",h[h.StorageTexture=4]="StorageTexture"})(xe||(xe={}));class gn{constructor(t,e,s,o,f,x,N){this.name=t,this.type=e,this.group=s,this.binding=o,this.attributes=f,this.resourceType=x,this.access=N}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Ar{constructor(t,e){this.name=t,this.type=e}}class mn{constructor(t,e){this.align=t,this.size=e}}class Sr{constructor(t,e,s,o){this.name=t,this.type=e,this.locationType=s,this.location=o,this.interpolation=null}}class os{constructor(t,e,s,o){this.name=t,this.type=e,this.locationType=s,this.location=o}}class Nr{constructor(t,e,s,o){this.name=t,this.type=e,this.attributes=s,this.id=o}}class Mr{constructor(t,e){this.name=t,this.type=e}}class br{constructor(t,e=null){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=t,this.stage=e}}class Or{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}class Ur{constructor(t){this.resources=null,this.inUse=!1,this.info=null,this.node=t}}class ge{constructor(t){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new Or,this.functions=[],this._types=new Map,this._functions=new Map,t&&this.update(t)}_isStorageTexture(t){return t.name=="texture_storage_1d"||t.name=="texture_storage_2d"||t.name=="texture_storage_2d_array"||t.name=="texture_storage_3d"}update(t){const s=new Dr().parse(t);for(const o of s)o instanceof vn&&this._functions.set(o.name,new Ur(o));for(const o of s)if(o instanceof Oe){const f=this._getTypeInfo(o,null);f instanceof wn&&this.structs.push(f)}for(const o of s){if(o instanceof ys){this.aliases.push(this._getAliasInfo(o));continue}if(o instanceof gs){const f=o,x=this._getAttributeNum(f.attributes,"id",0),N=f.type!=null?this._getTypeInfo(f.type,f.attributes):null;this.overrides.push(new Nr(f.name,N,f.attributes,x));continue}if(this._isUniformVar(o)){const f=o,x=this._getAttributeNum(f.attributes,"group",0),N=this._getAttributeNum(f.attributes,"binding",0),R=this._getTypeInfo(f.type,f.attributes),I=new gn(f.name,R,x,N,f.attributes,xe.Uniform,f.access);this.uniforms.push(I);continue}if(this._isStorageVar(o)){const f=o,x=this._getAttributeNum(f.attributes,"group",0),N=this._getAttributeNum(f.attributes,"binding",0),R=this._getTypeInfo(f.type,f.attributes),I=this._isStorageTexture(R),B=new gn(f.name,R,x,N,f.attributes,I?xe.StorageTexture:xe.Storage,f.access);this.storage.push(B);continue}if(this._isTextureVar(o)){const f=o,x=this._getAttributeNum(f.attributes,"group",0),N=this._getAttributeNum(f.attributes,"binding",0),R=this._getTypeInfo(f.type,f.attributes),I=this._isStorageTexture(R),B=new gn(f.name,R,x,N,f.attributes,I?xe.StorageTexture:xe.Texture,f.access);I?this.storage.push(B):this.textures.push(B);continue}if(this._isSamplerVar(o)){const f=o,x=this._getAttributeNum(f.attributes,"group",0),N=this._getAttributeNum(f.attributes,"binding",0),R=this._getTypeInfo(f.type,f.attributes),I=new gn(f.name,R,x,N,f.attributes,xe.Sampler,f.access);this.samplers.push(I);continue}if(o instanceof vn){const f=this._getAttribute(o,"vertex"),x=this._getAttribute(o,"fragment"),N=this._getAttribute(o,"compute"),R=f||x||N,I=new br(o.name,R==null?void 0:R.name);I.startLine=o.startLine,I.endLine=o.endLine,this.functions.push(I),this._functions.get(o.name).info=I,R&&(this._functions.get(o.name).inUse=!0,I.inUse=!0,I.resources=this._findResources(o,!!R),I.inputs=this._getInputs(o.args),I.outputs=this._getOutputs(o.returnType),this.entry[R.name].push(I)),I.arguments=o.args.map(B=>new Mr(B.name,this._getTypeInfo(B.type,B.attributes))),I.returnType=o.returnType?this._getTypeInfo(o.returnType,o.attributes):null;continue}}for(const o of this._functions.values())o.info&&(o.info.inUse=o.inUse,this._addCalls(o.node,o.info.calls));for(const o of this._functions.values())o.node.search(f=>{var x;if(f.astNodeType==="varExpr"){const N=f;for(const R of this.overrides)N.name==R.name&&((x=o.info)===null||x===void 0||x.overrides.push(R))}});for(const o of this.uniforms)this._markStructsInUse(o.type);for(const o of this.storage)this._markStructsInUse(o.type)}_markStructsInUse(t){if(t)if(t.isStruct){if(t.inUse=!0,t.members)for(const e of t.members)this._markStructsInUse(e.type)}else if(t.isArray)this._markStructsInUse(t.format);else if(t.isTemplate)t.format&&this._markStructsInUse(t.format);else{const e=this._getAlias(t.name);e&&this._markStructsInUse(e)}}_addCalls(t,e){var s;for(const o of t.calls){const f=(s=this._functions.get(o.name))===null||s===void 0?void 0:s.info;f&&e.add(f)}}findResource(t,e){for(const s of this.uniforms)if(s.group==t&&s.binding==e)return s;for(const s of this.storage)if(s.group==t&&s.binding==e)return s;for(const s of this.textures)if(s.group==t&&s.binding==e)return s;for(const s of this.samplers)if(s.group==t&&s.binding==e)return s;return null}_findResource(t){for(const e of this.uniforms)if(e.name==t)return e;for(const e of this.storage)if(e.name==t)return e;for(const e of this.textures)if(e.name==t)return e;for(const e of this.samplers)if(e.name==t)return e;return null}_markStructsFromAST(t){const e=this._getTypeInfo(t,null);this._markStructsInUse(e)}_findResources(t,e){const s=[],o=this,f=[];return t.search(x=>{if(x instanceof yn)f.push({});else if(x instanceof xn)f.pop();else if(x instanceof Ue){const N=x;e&&N.type!==null&&this._markStructsFromAST(N.type),f.length>0&&(f[f.length-1][N.name]=N)}else if(x instanceof Ve){const N=x;e&&N.type!==null&&this._markStructsFromAST(N.type)}else if(x instanceof Dn){const N=x;e&&N.type!==null&&this._markStructsFromAST(N.type),f.length>0&&(f[f.length-1][N.name]=N)}else if(x instanceof An){const N=x;if(f.length>0&&f[f.length-1][N.name])return;const R=o._findResource(N.name);R&&s.push(R)}else if(x instanceof Ts){const N=x,R=o._functions.get(N.name);R&&(e&&(R.inUse=!0),t.calls.add(R.node),R.resources===null&&(R.resources=o._findResources(R.node,e)),s.push(...R.resources))}else if(x instanceof ms){const N=x,R=o._functions.get(N.name);R&&(e&&(R.inUse=!0),t.calls.add(R.node),R.resources===null&&(R.resources=o._findResources(R.node,e)),s.push(...R.resources))}}),[...new Map(s.map(x=>[x.name,x])).values()]}getBindGroups(){const t=[];function e(s,o){s>=t.length&&(t.length=s+1),t[s]===void 0&&(t[s]=[]),o>=t[s].length&&(t[s].length=o+1)}for(const s of this.uniforms){e(s.group,s.binding);const o=t[s.group];o[s.binding]=s}for(const s of this.storage){e(s.group,s.binding);const o=t[s.group];o[s.binding]=s}for(const s of this.textures){e(s.group,s.binding);const o=t[s.group];o[s.binding]=s}for(const s of this.samplers){e(s.group,s.binding);const o=t[s.group];o[s.binding]=s}return t}_getOutputs(t,e=void 0){if(e===void 0&&(e=[]),t instanceof Oe)this._getStructOutputs(t,e);else{const s=this._getOutputInfo(t);s!==null&&e.push(s)}return e}_getStructOutputs(t,e){for(const s of t.members)if(s.type instanceof Oe)this._getStructOutputs(s.type,e);else{const o=this._getAttribute(s,"location")||this._getAttribute(s,"builtin");if(o!==null){const f=this._getTypeInfo(s.type,s.type.attributes),x=this._parseInt(o.value),N=new os(s.name,f,o.name,x);e.push(N)}}}_getOutputInfo(t){const e=this._getAttribute(t,"location")||this._getAttribute(t,"builtin");if(e!==null){const s=this._getTypeInfo(t,t.attributes),o=this._parseInt(e.value);return new os("",s,e.name,o)}return null}_getInputs(t,e=void 0){e===void 0&&(e=[]);for(const s of t)if(s.type instanceof Oe)this._getStructInputs(s.type,e);else{const o=this._getInputInfo(s);o!==null&&e.push(o)}return e}_getStructInputs(t,e){for(const s of t.members)if(s.type instanceof Oe)this._getStructInputs(s.type,e);else{const o=this._getInputInfo(s);o!==null&&e.push(o)}}_getInputInfo(t){const e=this._getAttribute(t,"location")||this._getAttribute(t,"builtin");if(e!==null){const s=this._getAttribute(t,"interpolation"),o=this._getTypeInfo(t.type,t.attributes),f=this._parseInt(e.value),x=new Sr(t.name,o,e.name,f);return s!==null&&(x.interpolation=this._parseString(s.value)),x}return null}_parseString(t){return t instanceof Array&&(t=t[0]),t}_parseInt(t){t instanceof Array&&(t=t[0]);const e=parseInt(t);return isNaN(e)?t:e}_getAlias(t){for(const e of this.aliases)if(e.name==t)return e.type;return null}_getAliasInfo(t){return new Ar(t.name,this._getTypeInfo(t.type,null))}_getTypeInfo(t,e){if(this._types.has(t))return this._types.get(t);if(t instanceof ks){const o=t,f=o.format?this._getTypeInfo(o.format,o.attributes):null,x=new En(o.name,e);return x.format=f,x.count=o.count,this._types.set(t,x),this._updateTypeInfo(x),x}if(t instanceof Oe){const o=t,f=new wn(o.name,e);f.startLine=o.startLine,f.endLine=o.endLine;for(const x of o.members){const N=this._getTypeInfo(x.type,x.attributes);f.members.push(new rs(x.name,N,x.attributes))}return this._types.set(t,f),this._updateTypeInfo(f),f}if(t instanceof tn){const o=t,f=o.format instanceof qe,x=o.format?f?this._getTypeInfo(o.format,null):new $e(o.format,null):null,N=new is(o.name,x,e,o.access);return this._types.set(t,N),this._updateTypeInfo(N),N}if(t instanceof xs){const o=t,f=o.format?this._getTypeInfo(o.format,null):null,x=new is(o.name,f,e,o.access);return this._types.set(t,x),this._updateTypeInfo(x),x}const s=new $e(t.name,e);return this._types.set(t,s),this._updateTypeInfo(s),s}_updateTypeInfo(t){var e,s;const o=this._getTypeSize(t);if(t.size=(e=o==null?void 0:o.size)!==null&&e!==void 0?e:0,t instanceof En&&t.format){const f=this._getTypeSize(t.format);t.stride=(s=f==null?void 0:f.size)!==null&&s!==void 0?s:0,this._updateTypeInfo(t.format)}t instanceof wn&&this._updateStructInfo(t)}_updateStructInfo(t){var e;let s=0,o=0,f=0,x=0;for(let N=0,R=t.members.length;N<R;++N){const I=t.members[N],B=this._getTypeSize(I);if(!B)continue;(e=this._getAlias(I.type.name))!==null&&e!==void 0||I.type;const z=B.align,J=B.size;s=this._roundUp(z,s+o),o=J,f=s,x=Math.max(x,z),I.offset=s,I.size=J,this._updateTypeInfo(I.type)}t.size=this._roundUp(x,f+o),t.align=x}_getTypeSize(t){var e,s;if(t==null)return null;const o=this._getAttributeNum(t.attributes,"size",0),f=this._getAttributeNum(t.attributes,"align",0);if(t instanceof rs&&(t=t.type),t instanceof $e){const x=this._getAlias(t.name);x!==null&&(t=x)}{const x=ge._typeInfo[t.name];if(x!==void 0){const N=((e=t.format)===null||e===void 0?void 0:e.name)==="f16"?2:1;return new mn(Math.max(f,x.align/N),Math.max(o,x.size/N))}}{const x=ge._typeInfo[t.name.substring(0,t.name.length-1)];if(x){const N=t.name[t.name.length-1]==="h"?2:1;return new mn(Math.max(f,x.align/N),Math.max(o,x.size/N))}}if(t instanceof En){let x=t,N=8,R=8;const I=this._getTypeSize(x.format);I!==null&&(R=I.size,N=I.align);const B=x.count,z=this._getAttributeNum((s=t==null?void 0:t.attributes)!==null&&s!==void 0?s:null,"stride",this._roundUp(N,R));return R=B*z,o&&(R=o),new mn(Math.max(f,N),Math.max(o,R))}if(t instanceof wn){let x=0,N=0,R=0,I=0,B=0;for(const z of t.members){const J=this._getTypeSize(z.type);J!==null&&(x=Math.max(J.align,x),R=this._roundUp(J.align,R+I),I=J.size,B=R)}return N=this._roundUp(x,B+I),new mn(Math.max(f,x),Math.max(o,N))}return null}_isUniformVar(t){return t instanceof Ue&&t.storage=="uniform"}_isStorageVar(t){return t instanceof Ue&&t.storage=="storage"}_isTextureVar(t){return t instanceof Ue&&t.type!==null&&ge._textureTypes.indexOf(t.type.name)!=-1}_isSamplerVar(t){return t instanceof Ue&&t.type!==null&&ge._samplerTypes.indexOf(t.type.name)!=-1}_getAttribute(t,e){const s=t;if(!s||!s.attributes)return null;const o=s.attributes;for(let f of o)if(f.name==e)return f;return null}_getAttributeNum(t,e,s){if(t===null)return s;for(let o of t)if(o.name==e){let f=o!==null&&o.value!==null?o.value:s;return f instanceof Array&&(f=f[0]),typeof f=="number"?f:typeof f=="string"?parseInt(f):s}return s}_roundUp(t,e){return Math.ceil(e/t)*t}}ge._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}};ge._textureTypes=d.any_texture_type.map(h=>h.name);ge._samplerTypes=d.sampler_type.map(h=>h.name);var Rr="@vertex fn vertex()->@builtin(position)vec4f {return vec4f(0);}@fragment fn fragment()->@location(0)vec4f {return vec4f(0);}@compute @workgroup_size(1)fn compute(){}",Re,Pe,ke,Te,sn,rn,Xe,Ee,Mt,en,ze,As;class Ds{constructor(t,e,s){C(this,Mt);C(this,Re);C(this,Pe);C(this,ke);be(this,"Device");be(this,"BindGroups",[]);be(this,"Reflect");C(this,Te);be(this,"Pipeline");be(this,"Descriptor");C(this,sn);C(this,rn);C(this,Xe);C(this,Ee,[]);!t&&K($.DEVICE_NOT_REQUESTED),F(this,Re,s),this.Device=t,F(this,Pe,e),F(this,ke,this.CreatePipelineLabel("Command Encoder"))}CreatePipelineLabel(t){return T(this,Pe)&&t&&`${T(this,Pe)} ${t}`||""}CreatePipelineLayout(t,e){e??(e=this.CreatePipelineLabel(`${T(this,Re)} Pipeline Layout`));const s=Array.isArray(t)&&t||[t];return this.Device.createPipelineLayout({label:e,bindGroupLayouts:s})}CreateTimestampWrites(t,e,s){return{querySet:t,beginningOfPassWriteIndex:e,endOfPassWriteIndex:s}}ResolveQuerySet(t,e,s=0,o=t.count,f=0){this.GetCommandEncoder(!0).resolveQuerySet(t,s,o,e,f)}CreateShaderModule(t,e,s,o){t||(t=Rr,Ne($.SHADER_CODE_NOT_FOUND)),e??(e=this.CreatePipelineLabel("Shader Module"));const f=Array.isArray(t)&&t.join(`

`)||t;return this.Reflect=new ge(f),this.Device.createShaderModule({label:e,code:f,sourceMap:s,compilationHints:o})}GetShaderModule(t){return t instanceof GPUShaderModule&&t||t.module}CreateBuffer(t){const e=t.label??this.CreatePipelineLabel("Buffer");return this.Device.createBuffer({label:e,...t})}CreateReadableBuffer(t){let e=typeof t=="number"&&t;e||(e=t.size);const s=(t==null?void 0:t.label)??"Readable Buffer";return this.CreateBuffer({label:s,size:e,usage:Me.READABLE,...t})}CreateWritableBuffer(t){let e=typeof t=="number"&&t;e||(e=t.size);const s=(t==null?void 0:t.label)??"Writable Buffer";return this.CreateBuffer({label:s,size:e,usage:Me.WRITABLE,...t})}CreateStorageBuffer(t,e=1){!this.Reflect&&K($.SHADER_MODULE_NOT_FOUND,"`CreateStorageBuffer`.\n            Use `CreateShaderModule` before creating a storage buffer.");const s=this.Reflect.storage.find(({name:B})=>t===B);!s&&K($.STORAGE_NOT_FOUND,`\`${t}\` in shader bindings.`);const o=typeof e=="number"&&e||e.length,f=e.label??`${t} Storage Buffer`,x=s.format.size*o,N=new ArrayBuffer(x),R=B=>(Object.keys(B).forEach(z=>{if(!(B[z].buffer instanceof ArrayBuffer))R(B[z]);else{const J=B[z].constructor,tt=x/J.BYTES_PER_ELEMENT;B[z]=new J(N,0,tt)}}),B),I=X(this,Mt,en).call(this,s,N);return{buffer:this.CreateBuffer({label:f,size:x,usage:Me.STORAGE,...e}),[t]:I.buffer instanceof ArrayBuffer?new I.constructor(N,0,o):R(I)}}CreateUniformBuffer(t,e){!this.Reflect&&K($.SHADER_MODULE_NOT_FOUND,"`CreateUniformBuffer`.\n            Use `CreateShaderModule` before creating a uniform buffer.");const s=this.Reflect.uniforms.find(({name:x})=>t===x);!s&&K($.UNIFORM_NOT_FOUND,`\`${t}\` in shader uniforms.`),t==="resolution"&&Ne($.INVALID_UNIFORM_NAME,`\`${t}\`.`);const o=(e==null?void 0:e.label)??`${t} Uniform Buffer`,f=new ArrayBuffer(s.size);return{buffer:this.CreateBuffer({label:o,size:f.byteLength,usage:Me.UNIFORM,...e}),[t]:X(this,Mt,en).call(this,s,f)}}CreateUniformBufferLayout(t){!this.Reflect&&K($.SHADER_MODULE_NOT_FOUND,"`CreateUniformBufferLayout`.\n            Use `CreateShaderModule` before creating a uniform buffer layout.");const e=this.Reflect.uniforms.find(({name:s})=>t===s);return!e&&K($.UNIFORM_NOT_FOUND,`\`${t}\` in shader uniforms.`),t==="resolution"&&Ne($.INVALID_UNIFORM_NAME,`\`${t}\`.`),X(this,Mt,en).call(this,e,new ArrayBuffer(e.size))}WriteBuffer(t,e,s=0,o,f){this.Device.queue.writeBuffer(t,s,e,o,f)}CopyBufferToBuffer(t,e,s=e.size,o=0,f=0){this.GetCommandEncoder(!0).copyBufferToBuffer(t,o,e,f,s)}GetBufferMinBindingSize(t){!this.Reflect&&K($.SHADER_MODULE_NOT_FOUND,"`GetBufferMinBindingSize`.\n            Use `CreateShaderModule` before requesting buffer's min binding size.");const s=this.Reflect.getBindGroups().flat().find(({name:o})=>t===o);return(s==null?void 0:s.size)??K($.BINDING_NOT_FOUND,`\`${t}\` in shader bind groups.`)}CreateBufferBindingLayout(t,e,s,o,f){return o??(o=X(this,Mt,ze).call(this)),{binding:f,visibility:o,buffer:{type:t,hasDynamicOffset:e,minBindingSize:s}}}CreateSamplerBindingLayout(t,e,s){return e??(e=X(this,Mt,ze).call(this)),{binding:s,visibility:e,sampler:{type:t}}}CreateTextureBindingLayout(t,e,s,o,f){return o??(o=X(this,Mt,ze).call(this)),{binding:f,visibility:o,texture:{sampleType:t,viewDimension:e,multisampled:s}}}CreateStorageTextureBindingLayout(t,e,s,o,f){return o??(o=X(this,Mt,ze).call(this)),{binding:f,visibility:o,storageTexture:{access:e,format:t,viewDimension:s}}}CreateExternalTextureBindingLayout(t,e){return t??(t=X(this,Mt,ze).call(this)),{binding:e,visibility:t,externalTexture:{}}}CreateBindGroupEntries(t,e=0){return Array.isArray(t)&&t.map((s,o)=>({binding:(e==null?void 0:e[o])??o,resource:s}))||[{binding:e,resource:t}]}CreateBindGroupLayout(t,e){return e??(e=this.CreatePipelineLabel("Bind Group Layout")),t=Array.isArray(t)&&t.map((s,o)=>({...s,binding:s.binding??o}))||[{...t,binding:t.binding??0}],this.Device.createBindGroupLayout({entries:t,label:e})}CreateBindGroup(t,e=0,s){return s??(s=this.CreatePipelineLabel("Bind Group")),typeof e=="number"&&(e=this.Pipeline?this.Pipeline.getBindGroupLayout(e):K($.PIPELINE_NOT_FOUND,`${T(this,Re)}Pipeline.`)),this.Device.createBindGroup({entries:t,label:s,layout:e})}SetBindGroups(t,e){const s=Array.isArray(t),o=Array.isArray(e);e=s&&o?e.map(f=>Array.isArray(f)&&f||[f]):o&&e||e&&[e],e=e&&e||[],this.BindGroups=s&&t.map((f,x)=>({bindGroup:f,dynamicOffsets:e,active:!0}))||[{bindGroup:t,dynamicOffsets:e,active:!0}]}AddBindGroups(t,e){const s=Array.isArray(t),o=Array.isArray(e);return e=s&&o?e.map(f=>Array.isArray(f)&&f||[f]):o&&e||e&&[e],e=e&&e||[],this.BindGroups.push(...s&&t.map(f=>({bindGroup:f,dynamicOffsets:e,active:!0}))||[{bindGroup:t,dynamicOffsets:e,active:!0}])}SetActiveBindGroups(t){t=Array.isArray(t)&&t||[t];for(let e=this.BindGroups.length;e--;)this.BindGroups[e].active=t.includes(e)}ClearBindGroups(){this.BindGroups.splice(0)}GetBindGroupsInfo(){!this.Reflect&&K($.SHADER_MODULE_NOT_FOUND,"`GetBindGroupsInfo`.\n            Use `CreateShaderModule` before requesting bind groups information.");const t=this.BindGroups.length,e=new Array(t),s=this.Reflect.getBindGroups();for(let o=0;o<t;++o){const{bindGroup:{label:f},dynamicOffsets:x,active:N}=this.BindGroups[o];e[o]={label:f,active:N,dynamicOffsets:x,bindings:s[o]}}return e}CreateCommandEncoder(){return F(this,Te,this.Device.createCommandEncoder({label:T(this,ke)}))}SetCommandEncoder(t){F(this,Te,t)}GetCommandEncoder(t=!1){if(!T(this,Te)){if(t){const e=`${T(this,ke)&&`Label: "${T(this,ke)}".`}`;Ne($.COMMAND_ENCODER_NOT_FOUND,` ${e} Creating a new one.`)}return this.CreateCommandEncoder()}return T(this,Te)}SubmitCommandBuffer(){this.Device.queue.submit([T(this,Te).finish()])}SetPipeline(t){return this.Pipeline=t}SavePipelineState(){F(this,Xe,this.Reflect),F(this,rn,this.Pipeline),F(this,sn,this.Descriptor),F(this,Ee,[...this.BindGroups])}ResetPipelineState(){this.ClearBindGroups()}RestorePipelineState(){this.Descriptor=T(this,sn),this.SetPipeline(T(this,rn)),this.Reflect=T(this,Xe),X(this,Mt,As).call(this)}set CommandEncoderLabel(t){F(this,ke,t)}get ProgramName(){return T(this,Pe)}Destroy(){this.ResetPipelineState(),F(this,Xe,void 0),T(this,Ee).splice(0),this.SetCommandEncoder(void 0)}}Re=new WeakMap,Pe=new WeakMap,ke=new WeakMap,Te=new WeakMap,sn=new WeakMap,rn=new WeakMap,Xe=new WeakMap,Ee=new WeakMap,Mt=new WeakSet,en=function(t,e,s=0,o=[]){const{format:f}=t.type,x=t.type.members??(f==null?void 0:f.members);let N=s+(t.offset??0);if(x)for(let R=0,I={},B=(f==null?void 0:f.isStruct)&&t.count||1;R<B;++R)x.forEach(z=>I[z.name]=X(this,Mt,en).call(this,z,e,N)),f!=null&&f.isStruct&&(N+=t.stride),o.push(I);else{const R=Ys((f??t.type).name),I=t.size/Hs(R),B=Qs(R);return new B(e,N,I)}return o.length===1&&o[0]||o},ze=function(){return T(this,Re)==="Render"&&GPUShaderStage.FRAGMENT||GPUShaderStage.COMPUTE},As=function(){const t=T(this,Ee).map(({bindGroup:f})=>f),e=T(this,Ee).map(({dynamicOffsets:f})=>f),s=e.some(f=>typeof f=="number")&&e||void 0,o=T(this,Ee).map(({active:f},x)=>f&&x).filter(f=>typeof f=="number");this.SetBindGroups(t,s),this.SetActiveBindGroups(o)};var ce,ue,he,zt;const Bn=class Bn{constructor(t=0,e,s,o=255){C(this,ce,0);C(this,ue,0);C(this,he,0);C(this,zt,1);typeof e=="number"&&typeof s=="number"?this.RGBA=[t,e,s,o]:(F(this,ce,(t>>16&255)/255),F(this,ue,(t>>8&255)/255),F(this,he,(t&255)/255),F(this,zt,o/255))}Set(t,e=255){return F(this,ce,(t>>16&255)/255),F(this,ue,(t>>8&255)/255),F(this,he,(t&255)/255),F(this,zt,e/255),this}Premultiply(t,e){e??(e=new Bn),t??(t=T(this,zt));const s=T(this,ce)*t,o=T(this,ue)*t,f=T(this,he)*t;return e.rgba=[s,o,f,t],e}set rgb(t){F(this,ce,t[0]),F(this,ue,t[1]),F(this,he,t[2]),F(this,zt,t[3]??1)}get rgb(){return[T(this,ce),T(this,ue),T(this,he)]}set a(t){F(this,zt,t)}get a(){return T(this,zt)}set rgba(t){this.rgb=t}get rgba(){return this.rgb.concat(T(this,zt))}set RGB(t){F(this,ce,t[0]/255),F(this,ue,t[1]/255),F(this,he,t[2]/255),F(this,zt,(t[3]??255)/255)}get RGB(){return[T(this,ce)*255,T(this,ue)*255,T(this,he)*255]}set A(t){F(this,zt,t/255)}get A(){return T(this,zt)*255}set RGBA(t){this.RGB=t}get RGBA(){return this.RGB.concat(this.A)}};ce=new WeakMap,ue=new WeakMap,he=new WeakMap,zt=new WeakMap;let Sn=Bn;function Pr(h,t){return class extends h{constructor(...e){super(...e),t(this)}}}const Ir=Pr(Array,h=>h.fill(0));let Y=1e-6;function Fr(h){function t(n=0,l=0){const r=new h(2);return n!==void 0&&(r[0]=n,l!==void 0&&(r[1]=l)),r}const e=t;function s(n,l,r){const a=r??new h(2);return a[0]=n,a[1]=l,a}function o(n,l){const r=l??new h(2);return r[0]=Math.ceil(n[0]),r[1]=Math.ceil(n[1]),r}function f(n,l){const r=l??new h(2);return r[0]=Math.floor(n[0]),r[1]=Math.floor(n[1]),r}function x(n,l){const r=l??new h(2);return r[0]=Math.round(n[0]),r[1]=Math.round(n[1]),r}function N(n,l=0,r=1,a){const p=a??new h(2);return p[0]=Math.min(r,Math.max(l,n[0])),p[1]=Math.min(r,Math.max(l,n[1])),p}function R(n,l,r){const a=r??new h(2);return a[0]=n[0]+l[0],a[1]=n[1]+l[1],a}function I(n,l,r,a){const p=a??new h(2);return p[0]=n[0]+l[0]*r,p[1]=n[1]+l[1]*r,p}function B(n,l){const r=n[0],a=n[1],p=l[0],E=l[1],O=Math.sqrt(r*r+a*a),_=Math.sqrt(p*p+E*E),w=O*_,k=w&&Ft(n,l)/w;return Math.acos(k)}function z(n,l,r){const a=r??new h(2);return a[0]=n[0]-l[0],a[1]=n[1]-l[1],a}const J=z;function tt(n,l){return Math.abs(n[0]-l[0])<Y&&Math.abs(n[1]-l[1])<Y}function _t(n,l){return n[0]===l[0]&&n[1]===l[1]}function lt(n,l,r,a){const p=a??new h(2);return p[0]=n[0]+r*(l[0]-n[0]),p[1]=n[1]+r*(l[1]-n[1]),p}function Ct(n,l,r,a){const p=a??new h(2);return p[0]=n[0]+r[0]*(l[0]-n[0]),p[1]=n[1]+r[1]*(l[1]-n[1]),p}function Vt(n,l,r){const a=r??new h(2);return a[0]=Math.max(n[0],l[0]),a[1]=Math.max(n[1],l[1]),a}function bt(n,l,r){const a=r??new h(2);return a[0]=Math.min(n[0],l[0]),a[1]=Math.min(n[1],l[1]),a}function Tt(n,l,r){const a=r??new h(2);return a[0]=n[0]*l,a[1]=n[1]*l,a}const Qt=Tt;function Rt(n,l,r){const a=r??new h(2);return a[0]=n[0]/l,a[1]=n[1]/l,a}function Pt(n,l){const r=l??new h(2);return r[0]=1/n[0],r[1]=1/n[1],r}const $t=Pt;function It(n,l,r){const a=r??new h(3),p=n[0]*l[1]-n[1]*l[0];return a[0]=0,a[1]=0,a[2]=p,a}function Ft(n,l){return n[0]*l[0]+n[1]*l[1]}function ft(n){const l=n[0],r=n[1];return Math.sqrt(l*l+r*r)}const Xt=ft;function Z(n){const l=n[0],r=n[1];return l*l+r*r}const et=Z;function Q(n,l){const r=n[0]-l[0],a=n[1]-l[1];return Math.sqrt(r*r+a*a)}const Zt=Q;function Et(n,l){const r=n[0]-l[0],a=n[1]-l[1];return r*r+a*a}const jt=Et;function vt(n,l){const r=l??new h(2),a=n[0],p=n[1],E=Math.sqrt(a*a+p*p);return E>1e-5?(r[0]=a/E,r[1]=p/E):(r[0]=0,r[1]=0),r}function Jt(n,l){const r=l??new h(2);return r[0]=-n[0],r[1]=-n[1],r}function nt(n,l){const r=l??new h(2);return r[0]=n[0],r[1]=n[1],r}const Kt=nt;function Ot(n,l,r){const a=r??new h(2);return a[0]=n[0]*l[0],a[1]=n[1]*l[1],a}const te=Ot;function Ut(n,l,r){const a=r??new h(2);return a[0]=n[0]/l[0],a[1]=n[1]/l[1],a}const Wt=Ut;function Bt(n=1,l){const r=l??new h(2),a=Math.random()*2*Math.PI;return r[0]=Math.cos(a)*n,r[1]=Math.sin(a)*n,r}function c(n){const l=n??new h(2);return l[0]=0,l[1]=0,l}function m(n,l,r){const a=r??new h(2),p=n[0],E=n[1];return a[0]=p*l[0]+E*l[4]+l[12],a[1]=p*l[1]+E*l[5]+l[13],a}function i(n,l,r){const a=r??new h(2),p=n[0],E=n[1];return a[0]=l[0]*p+l[4]*E+l[8],a[1]=l[1]*p+l[5]*E+l[9],a}function u(n,l,r,a){const p=a??new h(2),E=n[0]-l[0],O=n[1]-l[1],_=Math.sin(r),w=Math.cos(r);return p[0]=E*w-O*_+l[0],p[1]=E*_+O*w+l[1],p}function g(n,l,r){const a=r??new h(2);return vt(n,a),Tt(a,l,a)}function y(n,l,r){const a=r??new h(2);return ft(n)>l?g(n,l,a):nt(n,a)}function b(n,l,r){const a=r??new h(2);return lt(n,l,.5,a)}return{create:t,fromValues:e,set:s,ceil:o,floor:f,round:x,clamp:N,add:R,addScaled:I,angle:B,subtract:z,sub:J,equalsApproximately:tt,equals:_t,lerp:lt,lerpV:Ct,max:Vt,min:bt,mulScalar:Tt,scale:Qt,divScalar:Rt,inverse:Pt,invert:$t,cross:It,dot:Ft,length:ft,len:Xt,lengthSq:Z,lenSq:et,distance:Q,dist:Zt,distanceSq:Et,distSq:jt,normalize:vt,negate:Jt,copy:nt,clone:Kt,multiply:Ot,mul:te,divide:Ut,div:Wt,random:Bt,zero:c,transformMat4:m,transformMat3:i,rotate:u,setLength:g,truncate:y,midpoint:b}}const as=new Map;function Ss(h){let t=as.get(h);return t||(t=Fr(h),as.set(h,t)),t}function Br(h){function t(_,w,k){const v=new h(3);return _!==void 0&&(v[0]=_,w!==void 0&&(v[1]=w,k!==void 0&&(v[2]=k))),v}const e=t;function s(_,w,k,v){const M=v??new h(3);return M[0]=_,M[1]=w,M[2]=k,M}function o(_,w){const k=w??new h(3);return k[0]=Math.ceil(_[0]),k[1]=Math.ceil(_[1]),k[2]=Math.ceil(_[2]),k}function f(_,w){const k=w??new h(3);return k[0]=Math.floor(_[0]),k[1]=Math.floor(_[1]),k[2]=Math.floor(_[2]),k}function x(_,w){const k=w??new h(3);return k[0]=Math.round(_[0]),k[1]=Math.round(_[1]),k[2]=Math.round(_[2]),k}function N(_,w=0,k=1,v){const M=v??new h(3);return M[0]=Math.min(k,Math.max(w,_[0])),M[1]=Math.min(k,Math.max(w,_[1])),M[2]=Math.min(k,Math.max(w,_[2])),M}function R(_,w,k){const v=k??new h(3);return v[0]=_[0]+w[0],v[1]=_[1]+w[1],v[2]=_[2]+w[2],v}function I(_,w,k,v){const M=v??new h(3);return M[0]=_[0]+w[0]*k,M[1]=_[1]+w[1]*k,M[2]=_[2]+w[2]*k,M}function B(_,w){const k=_[0],v=_[1],M=_[2],U=w[0],P=w[1],G=w[2],V=Math.sqrt(k*k+v*v+M*M),L=Math.sqrt(U*U+P*P+G*G),q=V*L,H=q&&Ft(_,w)/q;return Math.acos(H)}function z(_,w,k){const v=k??new h(3);return v[0]=_[0]-w[0],v[1]=_[1]-w[1],v[2]=_[2]-w[2],v}const J=z;function tt(_,w){return Math.abs(_[0]-w[0])<Y&&Math.abs(_[1]-w[1])<Y&&Math.abs(_[2]-w[2])<Y}function _t(_,w){return _[0]===w[0]&&_[1]===w[1]&&_[2]===w[2]}function lt(_,w,k,v){const M=v??new h(3);return M[0]=_[0]+k*(w[0]-_[0]),M[1]=_[1]+k*(w[1]-_[1]),M[2]=_[2]+k*(w[2]-_[2]),M}function Ct(_,w,k,v){const M=v??new h(3);return M[0]=_[0]+k[0]*(w[0]-_[0]),M[1]=_[1]+k[1]*(w[1]-_[1]),M[2]=_[2]+k[2]*(w[2]-_[2]),M}function Vt(_,w,k){const v=k??new h(3);return v[0]=Math.max(_[0],w[0]),v[1]=Math.max(_[1],w[1]),v[2]=Math.max(_[2],w[2]),v}function bt(_,w,k){const v=k??new h(3);return v[0]=Math.min(_[0],w[0]),v[1]=Math.min(_[1],w[1]),v[2]=Math.min(_[2],w[2]),v}function Tt(_,w,k){const v=k??new h(3);return v[0]=_[0]*w,v[1]=_[1]*w,v[2]=_[2]*w,v}const Qt=Tt;function Rt(_,w,k){const v=k??new h(3);return v[0]=_[0]/w,v[1]=_[1]/w,v[2]=_[2]/w,v}function Pt(_,w){const k=w??new h(3);return k[0]=1/_[0],k[1]=1/_[1],k[2]=1/_[2],k}const $t=Pt;function It(_,w,k){const v=k??new h(3),M=_[2]*w[0]-_[0]*w[2],U=_[0]*w[1]-_[1]*w[0];return v[0]=_[1]*w[2]-_[2]*w[1],v[1]=M,v[2]=U,v}function Ft(_,w){return _[0]*w[0]+_[1]*w[1]+_[2]*w[2]}function ft(_){const w=_[0],k=_[1],v=_[2];return Math.sqrt(w*w+k*k+v*v)}const Xt=ft;function Z(_){const w=_[0],k=_[1],v=_[2];return w*w+k*k+v*v}const et=Z;function Q(_,w){const k=_[0]-w[0],v=_[1]-w[1],M=_[2]-w[2];return Math.sqrt(k*k+v*v+M*M)}const Zt=Q;function Et(_,w){const k=_[0]-w[0],v=_[1]-w[1],M=_[2]-w[2];return k*k+v*v+M*M}const jt=Et;function vt(_,w){const k=w??new h(3),v=_[0],M=_[1],U=_[2],P=Math.sqrt(v*v+M*M+U*U);return P>1e-5?(k[0]=v/P,k[1]=M/P,k[2]=U/P):(k[0]=0,k[1]=0,k[2]=0),k}function Jt(_,w){const k=w??new h(3);return k[0]=-_[0],k[1]=-_[1],k[2]=-_[2],k}function nt(_,w){const k=w??new h(3);return k[0]=_[0],k[1]=_[1],k[2]=_[2],k}const Kt=nt;function Ot(_,w,k){const v=k??new h(3);return v[0]=_[0]*w[0],v[1]=_[1]*w[1],v[2]=_[2]*w[2],v}const te=Ot;function Ut(_,w,k){const v=k??new h(3);return v[0]=_[0]/w[0],v[1]=_[1]/w[1],v[2]=_[2]/w[2],v}const Wt=Ut;function Bt(_=1,w){const k=w??new h(3),v=Math.random()*2*Math.PI,M=Math.random()*2-1,U=Math.sqrt(1-M*M)*_;return k[0]=Math.cos(v)*U,k[1]=Math.sin(v)*U,k[2]=M*_,k}function c(_){const w=_??new h(3);return w[0]=0,w[1]=0,w[2]=0,w}function m(_,w,k){const v=k??new h(3),M=_[0],U=_[1],P=_[2],G=w[3]*M+w[7]*U+w[11]*P+w[15]||1;return v[0]=(w[0]*M+w[4]*U+w[8]*P+w[12])/G,v[1]=(w[1]*M+w[5]*U+w[9]*P+w[13])/G,v[2]=(w[2]*M+w[6]*U+w[10]*P+w[14])/G,v}function i(_,w,k){const v=k??new h(3),M=_[0],U=_[1],P=_[2];return v[0]=M*w[0*4+0]+U*w[1*4+0]+P*w[2*4+0],v[1]=M*w[0*4+1]+U*w[1*4+1]+P*w[2*4+1],v[2]=M*w[0*4+2]+U*w[1*4+2]+P*w[2*4+2],v}function u(_,w,k){const v=k??new h(3),M=_[0],U=_[1],P=_[2];return v[0]=M*w[0]+U*w[4]+P*w[8],v[1]=M*w[1]+U*w[5]+P*w[9],v[2]=M*w[2]+U*w[6]+P*w[10],v}function g(_,w,k){const v=k??new h(3),M=w[0],U=w[1],P=w[2],G=w[3]*2,V=_[0],L=_[1],q=_[2],H=U*q-P*L,j=P*V-M*q,rt=M*L-U*V;return v[0]=V+H*G+(U*rt-P*j)*2,v[1]=L+j*G+(P*H-M*rt)*2,v[2]=q+rt*G+(M*j-U*H)*2,v}function y(_,w){const k=w??new h(3);return k[0]=_[12],k[1]=_[13],k[2]=_[14],k}function b(_,w,k){const v=k??new h(3),M=w*4;return v[0]=_[M+0],v[1]=_[M+1],v[2]=_[M+2],v}function n(_,w){const k=w??new h(3),v=_[0],M=_[1],U=_[2],P=_[4],G=_[5],V=_[6],L=_[8],q=_[9],H=_[10];return k[0]=Math.sqrt(v*v+M*M+U*U),k[1]=Math.sqrt(P*P+G*G+V*V),k[2]=Math.sqrt(L*L+q*q+H*H),k}function l(_,w,k,v){const M=v??new h(3),U=[],P=[];return U[0]=_[0]-w[0],U[1]=_[1]-w[1],U[2]=_[2]-w[2],P[0]=U[0],P[1]=U[1]*Math.cos(k)-U[2]*Math.sin(k),P[2]=U[1]*Math.sin(k)+U[2]*Math.cos(k),M[0]=P[0]+w[0],M[1]=P[1]+w[1],M[2]=P[2]+w[2],M}function r(_,w,k,v){const M=v??new h(3),U=[],P=[];return U[0]=_[0]-w[0],U[1]=_[1]-w[1],U[2]=_[2]-w[2],P[0]=U[2]*Math.sin(k)+U[0]*Math.cos(k),P[1]=U[1],P[2]=U[2]*Math.cos(k)-U[0]*Math.sin(k),M[0]=P[0]+w[0],M[1]=P[1]+w[1],M[2]=P[2]+w[2],M}function a(_,w,k,v){const M=v??new h(3),U=[],P=[];return U[0]=_[0]-w[0],U[1]=_[1]-w[1],U[2]=_[2]-w[2],P[0]=U[0]*Math.cos(k)-U[1]*Math.sin(k),P[1]=U[0]*Math.sin(k)+U[1]*Math.cos(k),P[2]=U[2],M[0]=P[0]+w[0],M[1]=P[1]+w[1],M[2]=P[2]+w[2],M}function p(_,w,k){const v=k??new h(3);return vt(_,v),Tt(v,w,v)}function E(_,w,k){const v=k??new h(3);return ft(_)>w?p(_,w,v):nt(_,v)}function O(_,w,k){const v=k??new h(3);return lt(_,w,.5,v)}return{create:t,fromValues:e,set:s,ceil:o,floor:f,round:x,clamp:N,add:R,addScaled:I,angle:B,subtract:z,sub:J,equalsApproximately:tt,equals:_t,lerp:lt,lerpV:Ct,max:Vt,min:bt,mulScalar:Tt,scale:Qt,divScalar:Rt,inverse:Pt,invert:$t,cross:It,dot:Ft,length:ft,len:Xt,lengthSq:Z,lenSq:et,distance:Q,dist:Zt,distanceSq:Et,distSq:jt,normalize:vt,negate:Jt,copy:nt,clone:Kt,multiply:Ot,mul:te,divide:Ut,div:Wt,random:Bt,zero:c,transformMat4:m,transformMat4Upper3x3:i,transformMat3:u,transformQuat:g,getTranslation:y,getAxis:b,getScaling:n,rotateX:l,rotateY:r,rotateZ:a,setLength:p,truncate:E,midpoint:O}}const cs=new Map;function kn(h){let t=cs.get(h);return t||(t=Br(h),cs.set(h,t)),t}function Lr(h){const t=Ss(h),e=kn(h);function s(c,m,i,u,g,y,b,n,l){const r=new h(12);return r[3]=0,r[7]=0,r[11]=0,c!==void 0&&(r[0]=c,m!==void 0&&(r[1]=m,i!==void 0&&(r[2]=i,u!==void 0&&(r[4]=u,g!==void 0&&(r[5]=g,y!==void 0&&(r[6]=y,b!==void 0&&(r[8]=b,n!==void 0&&(r[9]=n,l!==void 0&&(r[10]=l))))))))),r}function o(c,m,i,u,g,y,b,n,l,r){const a=r??new h(12);return a[0]=c,a[1]=m,a[2]=i,a[3]=0,a[4]=u,a[5]=g,a[6]=y,a[7]=0,a[8]=b,a[9]=n,a[10]=l,a[11]=0,a}function f(c,m){const i=m??new h(12);return i[0]=c[0],i[1]=c[1],i[2]=c[2],i[3]=0,i[4]=c[4],i[5]=c[5],i[6]=c[6],i[7]=0,i[8]=c[8],i[9]=c[9],i[10]=c[10],i[11]=0,i}function x(c,m){const i=m??new h(12),u=c[0],g=c[1],y=c[2],b=c[3],n=u+u,l=g+g,r=y+y,a=u*n,p=g*n,E=g*l,O=y*n,_=y*l,w=y*r,k=b*n,v=b*l,M=b*r;return i[0]=1-E-w,i[1]=p+M,i[2]=O-v,i[3]=0,i[4]=p-M,i[5]=1-a-w,i[6]=_+k,i[7]=0,i[8]=O+v,i[9]=_-k,i[10]=1-a-E,i[11]=0,i}function N(c,m){const i=m??new h(12);return i[0]=-c[0],i[1]=-c[1],i[2]=-c[2],i[4]=-c[4],i[5]=-c[5],i[6]=-c[6],i[8]=-c[8],i[9]=-c[9],i[10]=-c[10],i}function R(c,m){const i=m??new h(12);return i[0]=c[0],i[1]=c[1],i[2]=c[2],i[4]=c[4],i[5]=c[5],i[6]=c[6],i[8]=c[8],i[9]=c[9],i[10]=c[10],i}const I=R;function B(c,m){return Math.abs(c[0]-m[0])<Y&&Math.abs(c[1]-m[1])<Y&&Math.abs(c[2]-m[2])<Y&&Math.abs(c[4]-m[4])<Y&&Math.abs(c[5]-m[5])<Y&&Math.abs(c[6]-m[6])<Y&&Math.abs(c[8]-m[8])<Y&&Math.abs(c[9]-m[9])<Y&&Math.abs(c[10]-m[10])<Y}function z(c,m){return c[0]===m[0]&&c[1]===m[1]&&c[2]===m[2]&&c[4]===m[4]&&c[5]===m[5]&&c[6]===m[6]&&c[8]===m[8]&&c[9]===m[9]&&c[10]===m[10]}function J(c){const m=c??new h(12);return m[0]=1,m[1]=0,m[2]=0,m[4]=0,m[5]=1,m[6]=0,m[8]=0,m[9]=0,m[10]=1,m}function tt(c,m){const i=m??new h(12);if(i===c){let E;return E=c[1],c[1]=c[4],c[4]=E,E=c[2],c[2]=c[8],c[8]=E,E=c[6],c[6]=c[9],c[9]=E,i}const u=c[0*4+0],g=c[0*4+1],y=c[0*4+2],b=c[1*4+0],n=c[1*4+1],l=c[1*4+2],r=c[2*4+0],a=c[2*4+1],p=c[2*4+2];return i[0]=u,i[1]=b,i[2]=r,i[4]=g,i[5]=n,i[6]=a,i[8]=y,i[9]=l,i[10]=p,i}function _t(c,m){const i=m??new h(12),u=c[0*4+0],g=c[0*4+1],y=c[0*4+2],b=c[1*4+0],n=c[1*4+1],l=c[1*4+2],r=c[2*4+0],a=c[2*4+1],p=c[2*4+2],E=p*n-l*a,O=-p*b+l*r,_=a*b-n*r,w=1/(u*E+g*O+y*_);return i[0]=E*w,i[1]=(-p*g+y*a)*w,i[2]=(l*g-y*n)*w,i[4]=O*w,i[5]=(p*u-y*r)*w,i[6]=(-l*u+y*b)*w,i[8]=_*w,i[9]=(-a*u+g*r)*w,i[10]=(n*u-g*b)*w,i}function lt(c){const m=c[0],i=c[0*4+1],u=c[0*4+2],g=c[1*4+0],y=c[1*4+1],b=c[1*4+2],n=c[2*4+0],l=c[2*4+1],r=c[2*4+2];return m*(y*r-l*b)-g*(i*r-l*u)+n*(i*b-y*u)}const Ct=_t;function Vt(c,m,i){const u=i??new h(12),g=c[0],y=c[1],b=c[2],n=c[4],l=c[5],r=c[6],a=c[8],p=c[9],E=c[10],O=m[0],_=m[1],w=m[2],k=m[4],v=m[5],M=m[6],U=m[8],P=m[9],G=m[10];return u[0]=g*O+n*_+a*w,u[1]=y*O+l*_+p*w,u[2]=b*O+r*_+E*w,u[4]=g*k+n*v+a*M,u[5]=y*k+l*v+p*M,u[6]=b*k+r*v+E*M,u[8]=g*U+n*P+a*G,u[9]=y*U+l*P+p*G,u[10]=b*U+r*P+E*G,u}const bt=Vt;function Tt(c,m,i){const u=i??J();return c!==u&&(u[0]=c[0],u[1]=c[1],u[2]=c[2],u[4]=c[4],u[5]=c[5],u[6]=c[6]),u[8]=m[0],u[9]=m[1],u[10]=1,u}function Qt(c,m){const i=m??t.create();return i[0]=c[8],i[1]=c[9],i}function Rt(c,m,i){const u=i??t.create(),g=m*4;return u[0]=c[g+0],u[1]=c[g+1],u}function Pt(c,m,i,u){const g=u===c?c:R(c,u),y=i*4;return g[y+0]=m[0],g[y+1]=m[1],g}function $t(c,m){const i=m??t.create(),u=c[0],g=c[1],y=c[4],b=c[5];return i[0]=Math.sqrt(u*u+g*g),i[1]=Math.sqrt(y*y+b*b),i}function It(c,m){const i=m??e.create(),u=c[0],g=c[1],y=c[2],b=c[4],n=c[5],l=c[6],r=c[8],a=c[9],p=c[10];return i[0]=Math.sqrt(u*u+g*g+y*y),i[1]=Math.sqrt(b*b+n*n+l*l),i[2]=Math.sqrt(r*r+a*a+p*p),i}function Ft(c,m){const i=m??new h(12);return i[0]=1,i[1]=0,i[2]=0,i[4]=0,i[5]=1,i[6]=0,i[8]=c[0],i[9]=c[1],i[10]=1,i}function ft(c,m,i){const u=i??new h(12),g=m[0],y=m[1],b=c[0],n=c[1],l=c[2],r=c[1*4+0],a=c[1*4+1],p=c[1*4+2],E=c[2*4+0],O=c[2*4+1],_=c[2*4+2];return c!==u&&(u[0]=b,u[1]=n,u[2]=l,u[4]=r,u[5]=a,u[6]=p),u[8]=b*g+r*y+E,u[9]=n*g+a*y+O,u[10]=l*g+p*y+_,u}function Xt(c,m){const i=m??new h(12),u=Math.cos(c),g=Math.sin(c);return i[0]=u,i[1]=g,i[2]=0,i[4]=-g,i[5]=u,i[6]=0,i[8]=0,i[9]=0,i[10]=1,i}function Z(c,m,i){const u=i??new h(12),g=c[0*4+0],y=c[0*4+1],b=c[0*4+2],n=c[1*4+0],l=c[1*4+1],r=c[1*4+2],a=Math.cos(m),p=Math.sin(m);return u[0]=a*g+p*n,u[1]=a*y+p*l,u[2]=a*b+p*r,u[4]=a*n-p*g,u[5]=a*l-p*y,u[6]=a*r-p*b,c!==u&&(u[8]=c[8],u[9]=c[9],u[10]=c[10]),u}function et(c,m){const i=m??new h(12),u=Math.cos(c),g=Math.sin(c);return i[0]=1,i[1]=0,i[2]=0,i[4]=0,i[5]=u,i[6]=g,i[8]=0,i[9]=-g,i[10]=u,i}function Q(c,m,i){const u=i??new h(12),g=c[4],y=c[5],b=c[6],n=c[8],l=c[9],r=c[10],a=Math.cos(m),p=Math.sin(m);return u[4]=a*g+p*n,u[5]=a*y+p*l,u[6]=a*b+p*r,u[8]=a*n-p*g,u[9]=a*l-p*y,u[10]=a*r-p*b,c!==u&&(u[0]=c[0],u[1]=c[1],u[2]=c[2]),u}function Zt(c,m){const i=m??new h(12),u=Math.cos(c),g=Math.sin(c);return i[0]=u,i[1]=0,i[2]=-g,i[4]=0,i[5]=1,i[6]=0,i[8]=g,i[9]=0,i[10]=u,i}function Et(c,m,i){const u=i??new h(12),g=c[0*4+0],y=c[0*4+1],b=c[0*4+2],n=c[2*4+0],l=c[2*4+1],r=c[2*4+2],a=Math.cos(m),p=Math.sin(m);return u[0]=a*g-p*n,u[1]=a*y-p*l,u[2]=a*b-p*r,u[8]=a*n+p*g,u[9]=a*l+p*y,u[10]=a*r+p*b,c!==u&&(u[4]=c[4],u[5]=c[5],u[6]=c[6]),u}const jt=Xt,vt=Z;function Jt(c,m){const i=m??new h(12);return i[0]=c[0],i[1]=0,i[2]=0,i[4]=0,i[5]=c[1],i[6]=0,i[8]=0,i[9]=0,i[10]=1,i}function nt(c,m,i){const u=i??new h(12),g=m[0],y=m[1];return u[0]=g*c[0*4+0],u[1]=g*c[0*4+1],u[2]=g*c[0*4+2],u[4]=y*c[1*4+0],u[5]=y*c[1*4+1],u[6]=y*c[1*4+2],c!==u&&(u[8]=c[8],u[9]=c[9],u[10]=c[10]),u}function Kt(c,m){const i=m??new h(12);return i[0]=c[0],i[1]=0,i[2]=0,i[4]=0,i[5]=c[1],i[6]=0,i[8]=0,i[9]=0,i[10]=c[2],i}function Ot(c,m,i){const u=i??new h(12),g=m[0],y=m[1],b=m[2];return u[0]=g*c[0*4+0],u[1]=g*c[0*4+1],u[2]=g*c[0*4+2],u[4]=y*c[1*4+0],u[5]=y*c[1*4+1],u[6]=y*c[1*4+2],u[8]=b*c[2*4+0],u[9]=b*c[2*4+1],u[10]=b*c[2*4+2],u}function te(c,m){const i=m??new h(12);return i[0]=c,i[1]=0,i[2]=0,i[4]=0,i[5]=c,i[6]=0,i[8]=0,i[9]=0,i[10]=1,i}function Ut(c,m,i){const u=i??new h(12);return u[0]=m*c[0*4+0],u[1]=m*c[0*4+1],u[2]=m*c[0*4+2],u[4]=m*c[1*4+0],u[5]=m*c[1*4+1],u[6]=m*c[1*4+2],c!==u&&(u[8]=c[8],u[9]=c[9],u[10]=c[10]),u}function Wt(c,m){const i=m??new h(12);return i[0]=c,i[1]=0,i[2]=0,i[4]=0,i[5]=c,i[6]=0,i[8]=0,i[9]=0,i[10]=c,i}function Bt(c,m,i){const u=i??new h(12);return u[0]=m*c[0*4+0],u[1]=m*c[0*4+1],u[2]=m*c[0*4+2],u[4]=m*c[1*4+0],u[5]=m*c[1*4+1],u[6]=m*c[1*4+2],u[8]=m*c[2*4+0],u[9]=m*c[2*4+1],u[10]=m*c[2*4+2],u}return{clone:I,create:s,set:o,fromMat4:f,fromQuat:x,negate:N,copy:R,equalsApproximately:B,equals:z,identity:J,transpose:tt,inverse:_t,invert:Ct,determinant:lt,mul:bt,multiply:Vt,setTranslation:Tt,getTranslation:Qt,getAxis:Rt,setAxis:Pt,getScaling:$t,get3DScaling:It,translation:Ft,translate:ft,rotation:Xt,rotate:Z,rotationX:et,rotateX:Q,rotationY:Zt,rotateY:Et,rotationZ:jt,rotateZ:vt,scaling:Jt,scale:nt,uniformScaling:te,uniformScale:Ut,scaling3D:Kt,scale3D:Ot,uniformScaling3D:Wt,uniformScale3D:Bt}}const us=new Map;function Gr(h){let t=us.get(h);return t||(t=Lr(h),us.set(h,t)),t}function qr(h){const t=kn(h);function e(n,l,r,a,p,E,O,_,w,k,v,M,U,P,G,V){const L=new h(16);return n!==void 0&&(L[0]=n,l!==void 0&&(L[1]=l,r!==void 0&&(L[2]=r,a!==void 0&&(L[3]=a,p!==void 0&&(L[4]=p,E!==void 0&&(L[5]=E,O!==void 0&&(L[6]=O,_!==void 0&&(L[7]=_,w!==void 0&&(L[8]=w,k!==void 0&&(L[9]=k,v!==void 0&&(L[10]=v,M!==void 0&&(L[11]=M,U!==void 0&&(L[12]=U,P!==void 0&&(L[13]=P,G!==void 0&&(L[14]=G,V!==void 0&&(L[15]=V)))))))))))))))),L}function s(n,l,r,a,p,E,O,_,w,k,v,M,U,P,G,V,L){const q=L??new h(16);return q[0]=n,q[1]=l,q[2]=r,q[3]=a,q[4]=p,q[5]=E,q[6]=O,q[7]=_,q[8]=w,q[9]=k,q[10]=v,q[11]=M,q[12]=U,q[13]=P,q[14]=G,q[15]=V,q}function o(n,l){const r=l??new h(16);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=0,r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=0,r[8]=n[8],r[9]=n[9],r[10]=n[10],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function f(n,l){const r=l??new h(16),a=n[0],p=n[1],E=n[2],O=n[3],_=a+a,w=p+p,k=E+E,v=a*_,M=p*_,U=p*w,P=E*_,G=E*w,V=E*k,L=O*_,q=O*w,H=O*k;return r[0]=1-U-V,r[1]=M+H,r[2]=P-q,r[3]=0,r[4]=M-H,r[5]=1-v-V,r[6]=G+L,r[7]=0,r[8]=P+q,r[9]=G-L,r[10]=1-v-U,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function x(n,l){const r=l??new h(16);return r[0]=-n[0],r[1]=-n[1],r[2]=-n[2],r[3]=-n[3],r[4]=-n[4],r[5]=-n[5],r[6]=-n[6],r[7]=-n[7],r[8]=-n[8],r[9]=-n[9],r[10]=-n[10],r[11]=-n[11],r[12]=-n[12],r[13]=-n[13],r[14]=-n[14],r[15]=-n[15],r}function N(n,l){const r=l??new h(16);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=n[3],r[4]=n[4],r[5]=n[5],r[6]=n[6],r[7]=n[7],r[8]=n[8],r[9]=n[9],r[10]=n[10],r[11]=n[11],r[12]=n[12],r[13]=n[13],r[14]=n[14],r[15]=n[15],r}const R=N;function I(n,l){return Math.abs(n[0]-l[0])<Y&&Math.abs(n[1]-l[1])<Y&&Math.abs(n[2]-l[2])<Y&&Math.abs(n[3]-l[3])<Y&&Math.abs(n[4]-l[4])<Y&&Math.abs(n[5]-l[5])<Y&&Math.abs(n[6]-l[6])<Y&&Math.abs(n[7]-l[7])<Y&&Math.abs(n[8]-l[8])<Y&&Math.abs(n[9]-l[9])<Y&&Math.abs(n[10]-l[10])<Y&&Math.abs(n[11]-l[11])<Y&&Math.abs(n[12]-l[12])<Y&&Math.abs(n[13]-l[13])<Y&&Math.abs(n[14]-l[14])<Y&&Math.abs(n[15]-l[15])<Y}function B(n,l){return n[0]===l[0]&&n[1]===l[1]&&n[2]===l[2]&&n[3]===l[3]&&n[4]===l[4]&&n[5]===l[5]&&n[6]===l[6]&&n[7]===l[7]&&n[8]===l[8]&&n[9]===l[9]&&n[10]===l[10]&&n[11]===l[11]&&n[12]===l[12]&&n[13]===l[13]&&n[14]===l[14]&&n[15]===l[15]}function z(n){const l=n??new h(16);return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function J(n,l){const r=l??new h(16);if(r===n){let j;return j=n[1],n[1]=n[4],n[4]=j,j=n[2],n[2]=n[8],n[8]=j,j=n[3],n[3]=n[12],n[12]=j,j=n[6],n[6]=n[9],n[9]=j,j=n[7],n[7]=n[13],n[13]=j,j=n[11],n[11]=n[14],n[14]=j,r}const a=n[0*4+0],p=n[0*4+1],E=n[0*4+2],O=n[0*4+3],_=n[1*4+0],w=n[1*4+1],k=n[1*4+2],v=n[1*4+3],M=n[2*4+0],U=n[2*4+1],P=n[2*4+2],G=n[2*4+3],V=n[3*4+0],L=n[3*4+1],q=n[3*4+2],H=n[3*4+3];return r[0]=a,r[1]=_,r[2]=M,r[3]=V,r[4]=p,r[5]=w,r[6]=U,r[7]=L,r[8]=E,r[9]=k,r[10]=P,r[11]=q,r[12]=O,r[13]=v,r[14]=G,r[15]=H,r}function tt(n,l){const r=l??new h(16),a=n[0*4+0],p=n[0*4+1],E=n[0*4+2],O=n[0*4+3],_=n[1*4+0],w=n[1*4+1],k=n[1*4+2],v=n[1*4+3],M=n[2*4+0],U=n[2*4+1],P=n[2*4+2],G=n[2*4+3],V=n[3*4+0],L=n[3*4+1],q=n[3*4+2],H=n[3*4+3],j=P*H,rt=q*G,ut=k*H,ht=q*v,dt=k*G,pt=P*v,wt=E*H,gt=q*O,mt=E*G,yt=P*O,Dt=E*v,At=k*O,St=M*L,Nt=V*U,Lt=_*L,Gt=V*w,qt=_*U,un=M*w,hn=a*L,ln=V*p,_n=a*U,fn=M*p,dn=a*w,pn=_*p,Ln=j*w+ht*U+dt*L-(rt*w+ut*U+pt*L),Gn=rt*p+wt*U+yt*L-(j*p+gt*U+mt*L),qn=ut*p+gt*w+Dt*L-(ht*p+wt*w+At*L),zn=pt*p+mt*w+At*U-(dt*p+yt*w+Dt*U),xt=1/(a*Ln+_*Gn+M*qn+V*zn);return r[0]=xt*Ln,r[1]=xt*Gn,r[2]=xt*qn,r[3]=xt*zn,r[4]=xt*(rt*_+ut*M+pt*V-(j*_+ht*M+dt*V)),r[5]=xt*(j*a+gt*M+mt*V-(rt*a+wt*M+yt*V)),r[6]=xt*(ht*a+wt*_+At*V-(ut*a+gt*_+Dt*V)),r[7]=xt*(dt*a+yt*_+Dt*M-(pt*a+mt*_+At*M)),r[8]=xt*(St*v+Gt*G+qt*H-(Nt*v+Lt*G+un*H)),r[9]=xt*(Nt*O+hn*G+fn*H-(St*O+ln*G+_n*H)),r[10]=xt*(Lt*O+ln*v+dn*H-(Gt*O+hn*v+pn*H)),r[11]=xt*(un*O+_n*v+pn*G-(qt*O+fn*v+dn*G)),r[12]=xt*(Lt*P+un*q+Nt*k-(qt*q+St*k+Gt*P)),r[13]=xt*(_n*q+St*E+ln*P-(hn*P+fn*q+Nt*E)),r[14]=xt*(hn*k+pn*q+Gt*E-(dn*q+Lt*E+ln*k)),r[15]=xt*(dn*P+qt*E+fn*k-(_n*k+pn*P+un*E)),r}function _t(n){const l=n[0],r=n[0*4+1],a=n[0*4+2],p=n[0*4+3],E=n[1*4+0],O=n[1*4+1],_=n[1*4+2],w=n[1*4+3],k=n[2*4+0],v=n[2*4+1],M=n[2*4+2],U=n[2*4+3],P=n[3*4+0],G=n[3*4+1],V=n[3*4+2],L=n[3*4+3],q=M*L,H=V*U,j=_*L,rt=V*w,ut=_*U,ht=M*w,dt=a*L,pt=V*p,wt=a*U,gt=M*p,mt=a*w,yt=_*p,Dt=q*O+rt*v+ut*G-(H*O+j*v+ht*G),At=H*r+dt*v+gt*G-(q*r+pt*v+wt*G),St=j*r+pt*O+mt*G-(rt*r+dt*O+yt*G),Nt=ht*r+wt*O+yt*v-(ut*r+gt*O+mt*v);return l*Dt+E*At+k*St+P*Nt}const lt=tt;function Ct(n,l,r){const a=r??new h(16),p=n[0],E=n[1],O=n[2],_=n[3],w=n[4],k=n[5],v=n[6],M=n[7],U=n[8],P=n[9],G=n[10],V=n[11],L=n[12],q=n[13],H=n[14],j=n[15],rt=l[0],ut=l[1],ht=l[2],dt=l[3],pt=l[4],wt=l[5],gt=l[6],mt=l[7],yt=l[8],Dt=l[9],At=l[10],St=l[11],Nt=l[12],Lt=l[13],Gt=l[14],qt=l[15];return a[0]=p*rt+w*ut+U*ht+L*dt,a[1]=E*rt+k*ut+P*ht+q*dt,a[2]=O*rt+v*ut+G*ht+H*dt,a[3]=_*rt+M*ut+V*ht+j*dt,a[4]=p*pt+w*wt+U*gt+L*mt,a[5]=E*pt+k*wt+P*gt+q*mt,a[6]=O*pt+v*wt+G*gt+H*mt,a[7]=_*pt+M*wt+V*gt+j*mt,a[8]=p*yt+w*Dt+U*At+L*St,a[9]=E*yt+k*Dt+P*At+q*St,a[10]=O*yt+v*Dt+G*At+H*St,a[11]=_*yt+M*Dt+V*At+j*St,a[12]=p*Nt+w*Lt+U*Gt+L*qt,a[13]=E*Nt+k*Lt+P*Gt+q*qt,a[14]=O*Nt+v*Lt+G*Gt+H*qt,a[15]=_*Nt+M*Lt+V*Gt+j*qt,a}const Vt=Ct;function bt(n,l,r){const a=r??z();return n!==a&&(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],a[4]=n[4],a[5]=n[5],a[6]=n[6],a[7]=n[7],a[8]=n[8],a[9]=n[9],a[10]=n[10],a[11]=n[11]),a[12]=l[0],a[13]=l[1],a[14]=l[2],a[15]=1,a}function Tt(n,l){const r=l??t.create();return r[0]=n[12],r[1]=n[13],r[2]=n[14],r}function Qt(n,l,r){const a=r??t.create(),p=l*4;return a[0]=n[p+0],a[1]=n[p+1],a[2]=n[p+2],a}function Rt(n,l,r,a){const p=a===n?a:N(n,a),E=r*4;return p[E+0]=l[0],p[E+1]=l[1],p[E+2]=l[2],p}function Pt(n,l){const r=l??t.create(),a=n[0],p=n[1],E=n[2],O=n[4],_=n[5],w=n[6],k=n[8],v=n[9],M=n[10];return r[0]=Math.sqrt(a*a+p*p+E*E),r[1]=Math.sqrt(O*O+_*_+w*w),r[2]=Math.sqrt(k*k+v*v+M*M),r}function $t(n,l,r,a,p){const E=p??new h(16),O=Math.tan(Math.PI*.5-.5*n);if(E[0]=O/l,E[1]=0,E[2]=0,E[3]=0,E[4]=0,E[5]=O,E[6]=0,E[7]=0,E[8]=0,E[9]=0,E[11]=-1,E[12]=0,E[13]=0,E[15]=0,Number.isFinite(a)){const _=1/(r-a);E[10]=a*_,E[14]=a*r*_}else E[10]=-1,E[14]=-r;return E}function It(n,l,r,a=1/0,p){const E=p??new h(16),O=1/Math.tan(n*.5);if(E[0]=O/l,E[1]=0,E[2]=0,E[3]=0,E[4]=0,E[5]=O,E[6]=0,E[7]=0,E[8]=0,E[9]=0,E[11]=-1,E[12]=0,E[13]=0,E[15]=0,a===1/0)E[10]=0,E[14]=r;else{const _=1/(a-r);E[10]=r*_,E[14]=a*r*_}return E}function Ft(n,l,r,a,p,E,O){const _=O??new h(16);return _[0]=2/(l-n),_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=2/(a-r),_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=1/(p-E),_[11]=0,_[12]=(l+n)/(n-l),_[13]=(a+r)/(r-a),_[14]=p/(p-E),_[15]=1,_}function ft(n,l,r,a,p,E,O){const _=O??new h(16),w=l-n,k=a-r,v=p-E;return _[0]=2*p/w,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=2*p/k,_[6]=0,_[7]=0,_[8]=(n+l)/w,_[9]=(a+r)/k,_[10]=E/v,_[11]=-1,_[12]=0,_[13]=0,_[14]=p*E/v,_[15]=0,_}function Xt(n,l,r,a,p,E=1/0,O){const _=O??new h(16),w=l-n,k=a-r;if(_[0]=2*p/w,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=2*p/k,_[6]=0,_[7]=0,_[8]=(n+l)/w,_[9]=(a+r)/k,_[11]=-1,_[12]=0,_[13]=0,_[15]=0,E===1/0)_[10]=0,_[14]=p;else{const v=1/(E-p);_[10]=p*v,_[14]=E*p*v}return _}const Z=t.create(),et=t.create(),Q=t.create();function Zt(n,l,r,a){const p=a??new h(16);return t.normalize(t.subtract(l,n,Q),Q),t.normalize(t.cross(r,Q,Z),Z),t.normalize(t.cross(Q,Z,et),et),p[0]=Z[0],p[1]=Z[1],p[2]=Z[2],p[3]=0,p[4]=et[0],p[5]=et[1],p[6]=et[2],p[7]=0,p[8]=Q[0],p[9]=Q[1],p[10]=Q[2],p[11]=0,p[12]=n[0],p[13]=n[1],p[14]=n[2],p[15]=1,p}function Et(n,l,r,a){const p=a??new h(16);return t.normalize(t.subtract(n,l,Q),Q),t.normalize(t.cross(r,Q,Z),Z),t.normalize(t.cross(Q,Z,et),et),p[0]=Z[0],p[1]=Z[1],p[2]=Z[2],p[3]=0,p[4]=et[0],p[5]=et[1],p[6]=et[2],p[7]=0,p[8]=Q[0],p[9]=Q[1],p[10]=Q[2],p[11]=0,p[12]=n[0],p[13]=n[1],p[14]=n[2],p[15]=1,p}function jt(n,l,r,a){const p=a??new h(16);return t.normalize(t.subtract(n,l,Q),Q),t.normalize(t.cross(r,Q,Z),Z),t.normalize(t.cross(Q,Z,et),et),p[0]=Z[0],p[1]=et[0],p[2]=Q[0],p[3]=0,p[4]=Z[1],p[5]=et[1],p[6]=Q[1],p[7]=0,p[8]=Z[2],p[9]=et[2],p[10]=Q[2],p[11]=0,p[12]=-(Z[0]*n[0]+Z[1]*n[1]+Z[2]*n[2]),p[13]=-(et[0]*n[0]+et[1]*n[1]+et[2]*n[2]),p[14]=-(Q[0]*n[0]+Q[1]*n[1]+Q[2]*n[2]),p[15]=1,p}function vt(n,l){const r=l??new h(16);return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=n[0],r[13]=n[1],r[14]=n[2],r[15]=1,r}function Jt(n,l,r){const a=r??new h(16),p=l[0],E=l[1],O=l[2],_=n[0],w=n[1],k=n[2],v=n[3],M=n[1*4+0],U=n[1*4+1],P=n[1*4+2],G=n[1*4+3],V=n[2*4+0],L=n[2*4+1],q=n[2*4+2],H=n[2*4+3],j=n[3*4+0],rt=n[3*4+1],ut=n[3*4+2],ht=n[3*4+3];return n!==a&&(a[0]=_,a[1]=w,a[2]=k,a[3]=v,a[4]=M,a[5]=U,a[6]=P,a[7]=G,a[8]=V,a[9]=L,a[10]=q,a[11]=H),a[12]=_*p+M*E+V*O+j,a[13]=w*p+U*E+L*O+rt,a[14]=k*p+P*E+q*O+ut,a[15]=v*p+G*E+H*O+ht,a}function nt(n,l){const r=l??new h(16),a=Math.cos(n),p=Math.sin(n);return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=a,r[6]=p,r[7]=0,r[8]=0,r[9]=-p,r[10]=a,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Kt(n,l,r){const a=r??new h(16),p=n[4],E=n[5],O=n[6],_=n[7],w=n[8],k=n[9],v=n[10],M=n[11],U=Math.cos(l),P=Math.sin(l);return a[4]=U*p+P*w,a[5]=U*E+P*k,a[6]=U*O+P*v,a[7]=U*_+P*M,a[8]=U*w-P*p,a[9]=U*k-P*E,a[10]=U*v-P*O,a[11]=U*M-P*_,n!==a&&(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],a[12]=n[12],a[13]=n[13],a[14]=n[14],a[15]=n[15]),a}function Ot(n,l){const r=l??new h(16),a=Math.cos(n),p=Math.sin(n);return r[0]=a,r[1]=0,r[2]=-p,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=p,r[9]=0,r[10]=a,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function te(n,l,r){const a=r??new h(16),p=n[0*4+0],E=n[0*4+1],O=n[0*4+2],_=n[0*4+3],w=n[2*4+0],k=n[2*4+1],v=n[2*4+2],M=n[2*4+3],U=Math.cos(l),P=Math.sin(l);return a[0]=U*p-P*w,a[1]=U*E-P*k,a[2]=U*O-P*v,a[3]=U*_-P*M,a[8]=U*w+P*p,a[9]=U*k+P*E,a[10]=U*v+P*O,a[11]=U*M+P*_,n!==a&&(a[4]=n[4],a[5]=n[5],a[6]=n[6],a[7]=n[7],a[12]=n[12],a[13]=n[13],a[14]=n[14],a[15]=n[15]),a}function Ut(n,l){const r=l??new h(16),a=Math.cos(n),p=Math.sin(n);return r[0]=a,r[1]=p,r[2]=0,r[3]=0,r[4]=-p,r[5]=a,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Wt(n,l,r){const a=r??new h(16),p=n[0*4+0],E=n[0*4+1],O=n[0*4+2],_=n[0*4+3],w=n[1*4+0],k=n[1*4+1],v=n[1*4+2],M=n[1*4+3],U=Math.cos(l),P=Math.sin(l);return a[0]=U*p+P*w,a[1]=U*E+P*k,a[2]=U*O+P*v,a[3]=U*_+P*M,a[4]=U*w-P*p,a[5]=U*k-P*E,a[6]=U*v-P*O,a[7]=U*M-P*_,n!==a&&(a[8]=n[8],a[9]=n[9],a[10]=n[10],a[11]=n[11],a[12]=n[12],a[13]=n[13],a[14]=n[14],a[15]=n[15]),a}function Bt(n,l,r){const a=r??new h(16);let p=n[0],E=n[1],O=n[2];const _=Math.sqrt(p*p+E*E+O*O);p/=_,E/=_,O/=_;const w=p*p,k=E*E,v=O*O,M=Math.cos(l),U=Math.sin(l),P=1-M;return a[0]=w+(1-w)*M,a[1]=p*E*P+O*U,a[2]=p*O*P-E*U,a[3]=0,a[4]=p*E*P-O*U,a[5]=k+(1-k)*M,a[6]=E*O*P+p*U,a[7]=0,a[8]=p*O*P+E*U,a[9]=E*O*P-p*U,a[10]=v+(1-v)*M,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}const c=Bt;function m(n,l,r,a){const p=a??new h(16);let E=l[0],O=l[1],_=l[2];const w=Math.sqrt(E*E+O*O+_*_);E/=w,O/=w,_/=w;const k=E*E,v=O*O,M=_*_,U=Math.cos(r),P=Math.sin(r),G=1-U,V=k+(1-k)*U,L=E*O*G+_*P,q=E*_*G-O*P,H=E*O*G-_*P,j=v+(1-v)*U,rt=O*_*G+E*P,ut=E*_*G+O*P,ht=O*_*G-E*P,dt=M+(1-M)*U,pt=n[0],wt=n[1],gt=n[2],mt=n[3],yt=n[4],Dt=n[5],At=n[6],St=n[7],Nt=n[8],Lt=n[9],Gt=n[10],qt=n[11];return p[0]=V*pt+L*yt+q*Nt,p[1]=V*wt+L*Dt+q*Lt,p[2]=V*gt+L*At+q*Gt,p[3]=V*mt+L*St+q*qt,p[4]=H*pt+j*yt+rt*Nt,p[5]=H*wt+j*Dt+rt*Lt,p[6]=H*gt+j*At+rt*Gt,p[7]=H*mt+j*St+rt*qt,p[8]=ut*pt+ht*yt+dt*Nt,p[9]=ut*wt+ht*Dt+dt*Lt,p[10]=ut*gt+ht*At+dt*Gt,p[11]=ut*mt+ht*St+dt*qt,n!==p&&(p[12]=n[12],p[13]=n[13],p[14]=n[14],p[15]=n[15]),p}const i=m;function u(n,l){const r=l??new h(16);return r[0]=n[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=n[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=n[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function g(n,l,r){const a=r??new h(16),p=l[0],E=l[1],O=l[2];return a[0]=p*n[0*4+0],a[1]=p*n[0*4+1],a[2]=p*n[0*4+2],a[3]=p*n[0*4+3],a[4]=E*n[1*4+0],a[5]=E*n[1*4+1],a[6]=E*n[1*4+2],a[7]=E*n[1*4+3],a[8]=O*n[2*4+0],a[9]=O*n[2*4+1],a[10]=O*n[2*4+2],a[11]=O*n[2*4+3],n!==a&&(a[12]=n[12],a[13]=n[13],a[14]=n[14],a[15]=n[15]),a}function y(n,l){const r=l??new h(16);return r[0]=n,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=n,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=n,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function b(n,l,r){const a=r??new h(16);return a[0]=l*n[0*4+0],a[1]=l*n[0*4+1],a[2]=l*n[0*4+2],a[3]=l*n[0*4+3],a[4]=l*n[1*4+0],a[5]=l*n[1*4+1],a[6]=l*n[1*4+2],a[7]=l*n[1*4+3],a[8]=l*n[2*4+0],a[9]=l*n[2*4+1],a[10]=l*n[2*4+2],a[11]=l*n[2*4+3],n!==a&&(a[12]=n[12],a[13]=n[13],a[14]=n[14],a[15]=n[15]),a}return{create:e,set:s,fromMat3:o,fromQuat:f,negate:x,copy:N,clone:R,equalsApproximately:I,equals:B,identity:z,transpose:J,inverse:tt,determinant:_t,invert:lt,multiply:Ct,mul:Vt,setTranslation:bt,getTranslation:Tt,getAxis:Qt,setAxis:Rt,getScaling:Pt,perspective:$t,perspectiveReverseZ:It,ortho:Ft,frustum:ft,frustumReverseZ:Xt,aim:Zt,cameraAim:Et,lookAt:jt,translation:vt,translate:Jt,rotationX:nt,rotateX:Kt,rotationY:Ot,rotateY:te,rotationZ:Ut,rotateZ:Wt,axisRotation:Bt,rotation:c,axisRotate:m,rotate:i,scaling:u,scale:g,uniformScaling:y,uniformScale:b}}const hs=new Map;function zr(h){let t=hs.get(h);return t||(t=qr(h),hs.set(h,t)),t}function Cr(h){const t=kn(h);function e(c,m,i,u){const g=new h(4);return c!==void 0&&(g[0]=c,m!==void 0&&(g[1]=m,i!==void 0&&(g[2]=i,u!==void 0&&(g[3]=u)))),g}const s=e;function o(c,m,i,u,g){const y=g??new h(4);return y[0]=c,y[1]=m,y[2]=i,y[3]=u,y}function f(c,m,i){const u=i??new h(4),g=m*.5,y=Math.sin(g);return u[0]=y*c[0],u[1]=y*c[1],u[2]=y*c[2],u[3]=Math.cos(g),u}function x(c,m){const i=m??t.create(3),u=Math.acos(c[3])*2,g=Math.sin(u*.5);return g>Y?(i[0]=c[0]/g,i[1]=c[1]/g,i[2]=c[2]/g):(i[0]=1,i[1]=0,i[2]=0),{angle:u,axis:i}}function N(c,m){const i=ft(c,m);return Math.acos(2*i*i-1)}function R(c,m,i){const u=i??new h(4),g=c[0],y=c[1],b=c[2],n=c[3],l=m[0],r=m[1],a=m[2],p=m[3];return u[0]=g*p+n*l+y*a-b*r,u[1]=y*p+n*r+b*l-g*a,u[2]=b*p+n*a+g*r-y*l,u[3]=n*p-g*l-y*r-b*a,u}const I=R;function B(c,m,i){const u=i??new h(4),g=m*.5,y=c[0],b=c[1],n=c[2],l=c[3],r=Math.sin(g),a=Math.cos(g);return u[0]=y*a+l*r,u[1]=b*a+n*r,u[2]=n*a-b*r,u[3]=l*a-y*r,u}function z(c,m,i){const u=i??new h(4),g=m*.5,y=c[0],b=c[1],n=c[2],l=c[3],r=Math.sin(g),a=Math.cos(g);return u[0]=y*a-n*r,u[1]=b*a+l*r,u[2]=n*a+y*r,u[3]=l*a-b*r,u}function J(c,m,i){const u=i??new h(4),g=m*.5,y=c[0],b=c[1],n=c[2],l=c[3],r=Math.sin(g),a=Math.cos(g);return u[0]=y*a+b*r,u[1]=b*a-y*r,u[2]=n*a+l*r,u[3]=l*a-n*r,u}function tt(c,m,i,u){const g=u??new h(4),y=c[0],b=c[1],n=c[2],l=c[3];let r=m[0],a=m[1],p=m[2],E=m[3],O=y*r+b*a+n*p+l*E;O<0&&(O=-O,r=-r,a=-a,p=-p,E=-E);let _,w;if(1-O>Y){const k=Math.acos(O),v=Math.sin(k);_=Math.sin((1-i)*k)/v,w=Math.sin(i*k)/v}else _=1-i,w=i;return g[0]=_*y+w*r,g[1]=_*b+w*a,g[2]=_*n+w*p,g[3]=_*l+w*E,g}function _t(c,m){const i=m??new h(4),u=c[0],g=c[1],y=c[2],b=c[3],n=u*u+g*g+y*y+b*b,l=n?1/n:0;return i[0]=-u*l,i[1]=-g*l,i[2]=-y*l,i[3]=b*l,i}function lt(c,m){const i=m??new h(4);return i[0]=-c[0],i[1]=-c[1],i[2]=-c[2],i[3]=c[3],i}function Ct(c,m){const i=m??new h(4),u=c[0]+c[5]+c[10];if(u>0){const g=Math.sqrt(u+1);i[3]=.5*g;const y=.5/g;i[0]=(c[6]-c[9])*y,i[1]=(c[8]-c[2])*y,i[2]=(c[1]-c[4])*y}else{let g=0;c[5]>c[0]&&(g=1),c[10]>c[g*4+g]&&(g=2);const y=(g+1)%3,b=(g+2)%3,n=Math.sqrt(c[g*4+g]-c[y*4+y]-c[b*4+b]+1);i[g]=.5*n;const l=.5/n;i[3]=(c[y*4+b]-c[b*4+y])*l,i[y]=(c[y*4+g]+c[g*4+y])*l,i[b]=(c[b*4+g]+c[g*4+b])*l}return i}function Vt(c,m,i,u,g){const y=g??new h(4),b=c*.5,n=m*.5,l=i*.5,r=Math.sin(b),a=Math.cos(b),p=Math.sin(n),E=Math.cos(n),O=Math.sin(l),_=Math.cos(l);switch(u){case"xyz":y[0]=r*E*_+a*p*O,y[1]=a*p*_-r*E*O,y[2]=a*E*O+r*p*_,y[3]=a*E*_-r*p*O;break;case"xzy":y[0]=r*E*_-a*p*O,y[1]=a*p*_-r*E*O,y[2]=a*E*O+r*p*_,y[3]=a*E*_+r*p*O;break;case"yxz":y[0]=r*E*_+a*p*O,y[1]=a*p*_-r*E*O,y[2]=a*E*O-r*p*_,y[3]=a*E*_+r*p*O;break;case"yzx":y[0]=r*E*_+a*p*O,y[1]=a*p*_+r*E*O,y[2]=a*E*O-r*p*_,y[3]=a*E*_-r*p*O;break;case"zxy":y[0]=r*E*_-a*p*O,y[1]=a*p*_+r*E*O,y[2]=a*E*O+r*p*_,y[3]=a*E*_-r*p*O;break;case"zyx":y[0]=r*E*_-a*p*O,y[1]=a*p*_+r*E*O,y[2]=a*E*O-r*p*_,y[3]=a*E*_+r*p*O;break;default:throw new Error(`Unknown rotation order: ${u}`)}return y}function bt(c,m){const i=m??new h(4);return i[0]=c[0],i[1]=c[1],i[2]=c[2],i[3]=c[3],i}const Tt=bt;function Qt(c,m,i){const u=i??new h(4);return u[0]=c[0]+m[0],u[1]=c[1]+m[1],u[2]=c[2]+m[2],u[3]=c[3]+m[3],u}function Rt(c,m,i){const u=i??new h(4);return u[0]=c[0]-m[0],u[1]=c[1]-m[1],u[2]=c[2]-m[2],u[3]=c[3]-m[3],u}const Pt=Rt;function $t(c,m,i){const u=i??new h(4);return u[0]=c[0]*m,u[1]=c[1]*m,u[2]=c[2]*m,u[3]=c[3]*m,u}const It=$t;function Ft(c,m,i){const u=i??new h(4);return u[0]=c[0]/m,u[1]=c[1]/m,u[2]=c[2]/m,u[3]=c[3]/m,u}function ft(c,m){return c[0]*m[0]+c[1]*m[1]+c[2]*m[2]+c[3]*m[3]}function Xt(c,m,i,u){const g=u??new h(4);return g[0]=c[0]+i*(m[0]-c[0]),g[1]=c[1]+i*(m[1]-c[1]),g[2]=c[2]+i*(m[2]-c[2]),g[3]=c[3]+i*(m[3]-c[3]),g}function Z(c){const m=c[0],i=c[1],u=c[2],g=c[3];return Math.sqrt(m*m+i*i+u*u+g*g)}const et=Z;function Q(c){const m=c[0],i=c[1],u=c[2],g=c[3];return m*m+i*i+u*u+g*g}const Zt=Q;function Et(c,m){const i=m??new h(4),u=c[0],g=c[1],y=c[2],b=c[3],n=Math.sqrt(u*u+g*g+y*y+b*b);return n>1e-5?(i[0]=u/n,i[1]=g/n,i[2]=y/n,i[3]=b/n):(i[0]=0,i[1]=0,i[2]=0,i[3]=1),i}function jt(c,m){return Math.abs(c[0]-m[0])<Y&&Math.abs(c[1]-m[1])<Y&&Math.abs(c[2]-m[2])<Y&&Math.abs(c[3]-m[3])<Y}function vt(c,m){return c[0]===m[0]&&c[1]===m[1]&&c[2]===m[2]&&c[3]===m[3]}function Jt(c){const m=c??new h(4);return m[0]=0,m[1]=0,m[2]=0,m[3]=1,m}const nt=t.create(),Kt=t.create(),Ot=t.create();function te(c,m,i){const u=i??new h(4),g=t.dot(c,m);return g<-.999999?(t.cross(Kt,c,nt),t.len(nt)<1e-6&&t.cross(Ot,c,nt),t.normalize(nt,nt),f(nt,Math.PI,u),u):g>.999999?(u[0]=0,u[1]=0,u[2]=0,u[3]=1,u):(t.cross(c,m,nt),u[0]=nt[0],u[1]=nt[1],u[2]=nt[2],u[3]=1+g,Et(u,u))}const Ut=new h(4),Wt=new h(4);function Bt(c,m,i,u,g,y){const b=y??new h(4);return tt(c,u,g,Ut),tt(m,i,g,Wt),tt(Ut,Wt,2*g*(1-g),b),b}return{create:e,fromValues:s,set:o,fromAxisAngle:f,toAxisAngle:x,angle:N,multiply:R,mul:I,rotateX:B,rotateY:z,rotateZ:J,slerp:tt,inverse:_t,conjugate:lt,fromMat:Ct,fromEuler:Vt,copy:bt,clone:Tt,add:Qt,subtract:Rt,sub:Pt,mulScalar:$t,scale:It,divScalar:Ft,dot:ft,lerp:Xt,length:Z,len:et,lengthSq:Q,lenSq:Zt,normalize:Et,equalsApproximately:jt,equals:vt,identity:Jt,rotationTo:te,sqlerp:Bt}}const ls=new Map;function Vr(h){let t=ls.get(h);return t||(t=Cr(h),ls.set(h,t)),t}function $r(h){function t(i,u,g,y){const b=new h(4);return i!==void 0&&(b[0]=i,u!==void 0&&(b[1]=u,g!==void 0&&(b[2]=g,y!==void 0&&(b[3]=y)))),b}const e=t;function s(i,u,g,y,b){const n=b??new h(4);return n[0]=i,n[1]=u,n[2]=g,n[3]=y,n}function o(i,u){const g=u??new h(4);return g[0]=Math.ceil(i[0]),g[1]=Math.ceil(i[1]),g[2]=Math.ceil(i[2]),g[3]=Math.ceil(i[3]),g}function f(i,u){const g=u??new h(4);return g[0]=Math.floor(i[0]),g[1]=Math.floor(i[1]),g[2]=Math.floor(i[2]),g[3]=Math.floor(i[3]),g}function x(i,u){const g=u??new h(4);return g[0]=Math.round(i[0]),g[1]=Math.round(i[1]),g[2]=Math.round(i[2]),g[3]=Math.round(i[3]),g}function N(i,u=0,g=1,y){const b=y??new h(4);return b[0]=Math.min(g,Math.max(u,i[0])),b[1]=Math.min(g,Math.max(u,i[1])),b[2]=Math.min(g,Math.max(u,i[2])),b[3]=Math.min(g,Math.max(u,i[3])),b}function R(i,u,g){const y=g??new h(4);return y[0]=i[0]+u[0],y[1]=i[1]+u[1],y[2]=i[2]+u[2],y[3]=i[3]+u[3],y}function I(i,u,g,y){const b=y??new h(4);return b[0]=i[0]+u[0]*g,b[1]=i[1]+u[1]*g,b[2]=i[2]+u[2]*g,b[3]=i[3]+u[3]*g,b}function B(i,u,g){const y=g??new h(4);return y[0]=i[0]-u[0],y[1]=i[1]-u[1],y[2]=i[2]-u[2],y[3]=i[3]-u[3],y}const z=B;function J(i,u){return Math.abs(i[0]-u[0])<Y&&Math.abs(i[1]-u[1])<Y&&Math.abs(i[2]-u[2])<Y&&Math.abs(i[3]-u[3])<Y}function tt(i,u){return i[0]===u[0]&&i[1]===u[1]&&i[2]===u[2]&&i[3]===u[3]}function _t(i,u,g,y){const b=y??new h(4);return b[0]=i[0]+g*(u[0]-i[0]),b[1]=i[1]+g*(u[1]-i[1]),b[2]=i[2]+g*(u[2]-i[2]),b[3]=i[3]+g*(u[3]-i[3]),b}function lt(i,u,g,y){const b=y??new h(4);return b[0]=i[0]+g[0]*(u[0]-i[0]),b[1]=i[1]+g[1]*(u[1]-i[1]),b[2]=i[2]+g[2]*(u[2]-i[2]),b[3]=i[3]+g[3]*(u[3]-i[3]),b}function Ct(i,u,g){const y=g??new h(4);return y[0]=Math.max(i[0],u[0]),y[1]=Math.max(i[1],u[1]),y[2]=Math.max(i[2],u[2]),y[3]=Math.max(i[3],u[3]),y}function Vt(i,u,g){const y=g??new h(4);return y[0]=Math.min(i[0],u[0]),y[1]=Math.min(i[1],u[1]),y[2]=Math.min(i[2],u[2]),y[3]=Math.min(i[3],u[3]),y}function bt(i,u,g){const y=g??new h(4);return y[0]=i[0]*u,y[1]=i[1]*u,y[2]=i[2]*u,y[3]=i[3]*u,y}const Tt=bt;function Qt(i,u,g){const y=g??new h(4);return y[0]=i[0]/u,y[1]=i[1]/u,y[2]=i[2]/u,y[3]=i[3]/u,y}function Rt(i,u){const g=u??new h(4);return g[0]=1/i[0],g[1]=1/i[1],g[2]=1/i[2],g[3]=1/i[3],g}const Pt=Rt;function $t(i,u){return i[0]*u[0]+i[1]*u[1]+i[2]*u[2]+i[3]*u[3]}function It(i){const u=i[0],g=i[1],y=i[2],b=i[3];return Math.sqrt(u*u+g*g+y*y+b*b)}const Ft=It;function ft(i){const u=i[0],g=i[1],y=i[2],b=i[3];return u*u+g*g+y*y+b*b}const Xt=ft;function Z(i,u){const g=i[0]-u[0],y=i[1]-u[1],b=i[2]-u[2],n=i[3]-u[3];return Math.sqrt(g*g+y*y+b*b+n*n)}const et=Z;function Q(i,u){const g=i[0]-u[0],y=i[1]-u[1],b=i[2]-u[2],n=i[3]-u[3];return g*g+y*y+b*b+n*n}const Zt=Q;function Et(i,u){const g=u??new h(4),y=i[0],b=i[1],n=i[2],l=i[3],r=Math.sqrt(y*y+b*b+n*n+l*l);return r>1e-5?(g[0]=y/r,g[1]=b/r,g[2]=n/r,g[3]=l/r):(g[0]=0,g[1]=0,g[2]=0,g[3]=0),g}function jt(i,u){const g=u??new h(4);return g[0]=-i[0],g[1]=-i[1],g[2]=-i[2],g[3]=-i[3],g}function vt(i,u){const g=u??new h(4);return g[0]=i[0],g[1]=i[1],g[2]=i[2],g[3]=i[3],g}const Jt=vt;function nt(i,u,g){const y=g??new h(4);return y[0]=i[0]*u[0],y[1]=i[1]*u[1],y[2]=i[2]*u[2],y[3]=i[3]*u[3],y}const Kt=nt;function Ot(i,u,g){const y=g??new h(4);return y[0]=i[0]/u[0],y[1]=i[1]/u[1],y[2]=i[2]/u[2],y[3]=i[3]/u[3],y}const te=Ot;function Ut(i){const u=i??new h(4);return u[0]=0,u[1]=0,u[2]=0,u[3]=0,u}function Wt(i,u,g){const y=g??new h(4),b=i[0],n=i[1],l=i[2],r=i[3];return y[0]=u[0]*b+u[4]*n+u[8]*l+u[12]*r,y[1]=u[1]*b+u[5]*n+u[9]*l+u[13]*r,y[2]=u[2]*b+u[6]*n+u[10]*l+u[14]*r,y[3]=u[3]*b+u[7]*n+u[11]*l+u[15]*r,y}function Bt(i,u,g){const y=g??new h(4);return Et(i,y),bt(y,u,y)}function c(i,u,g){const y=g??new h(4);return It(i)>u?Bt(i,u,y):vt(i,y)}function m(i,u,g){const y=g??new h(4);return _t(i,u,.5,y)}return{create:t,fromValues:e,set:s,ceil:o,floor:f,round:x,clamp:N,add:R,addScaled:I,subtract:B,sub:z,equalsApproximately:J,equals:tt,lerp:_t,lerpV:lt,max:Ct,min:Vt,mulScalar:bt,scale:Tt,divScalar:Qt,inverse:Rt,invert:Pt,dot:$t,length:It,len:Ft,lengthSq:ft,lenSq:Xt,distance:Z,dist:et,distanceSq:Q,distSq:Zt,normalize:Et,negate:jt,copy:vt,clone:Jt,multiply:nt,mul:Kt,divide:Ot,div:te,zero:Ut,transformMat4:Wt,setLength:Bt,truncate:c,midpoint:m}}const _s=new Map;function Xr(h){let t=_s.get(h);return t||(t=$r(h),_s.set(h,t)),t}function Fn(h,t,e,s,o,f){return{mat3:Gr(h),mat4:zr(t),quat:Vr(e),vec2:Ss(s),vec3:kn(o),vec4:Xr(f)}}const{mat3:fs,vec2:jr}=Fn(Float32Array,Float32Array,Float32Array,Float32Array,Float32Array,Float32Array);Fn(Float64Array,Float64Array,Float64Array,Float64Array,Float64Array,Float64Array);Fn(Ir,Array,Array,Array,Array,Array);const ds=it({RENDER:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST,STORAGE:GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.TEXTURE_BINDING});it({ALL:"all",STENCIL:"stencil-only",DEPTH:"depth-only"});it({CLAMP:"clamp-to-edge",REPEAT:"repeat",MIRROR:"mirror-repeat"});const ps=it({NEAREST:"nearest",LINEAR:"linear"});it({NEVER:"never",LESS:"less",EQUAL:"equal",LESS_EQUAL:"less-equal",GREATER:"greater",NOT_EQUAL:"not-equal",GREATER_EQUAL:"greater-equal",ALWAYS:"always"});var Wr="const QUAD=array(vec2f(-1.0,-1.0),vec2f(1.0,-1.0),vec2f(1.0,1.0),vec2f(1.0,1.0),vec2f(-1.0,1.0),vec2f(-1.0,-1.0));fn GetQuadCoord(index: u32)->vec2f{return QUAD[index];}struct VertexOutput{@builtin(position)position: vec4f,@location(0)textureCoord: vec2f};@group(0)@binding(0)var Sampler: sampler;@group(0)@binding(1)var Texture: texture_2d<f32>;@vertex fn vertex(@builtin(vertex_index)index: u32)->VertexOutput {let position=GetQuadCoord(index);let coord=(position+1)*0.5;var output: VertexOutput;output.position=vec4f(position,0.0,1.0);output.textureCoord=vec2f(coord.x,1-coord.y);return output;}@fragment fn fragment(@location(0)textureCoord: vec2f)->@location(0)vec4f {return textureSample(Texture,Sampler,textureCoord);}",ne,se,W,ve,De,at,ye,Ce,Nn,Mn;class Ns{constructor(t,e){C(this,at);C(this,ne);C(this,se);C(this,W);C(this,ve);C(this,De);!t&&K($.DEVICE_NOT_REQUESTED),F(this,W,e),F(this,ne,t)}CreateSampler(t){if(!t)return T(this,ne).createSampler();const{addressModeUV:e,addressMode:s,minMagFilter:o,filter:f}=t;return e&&(t.addressModeU=t.addressModeV=e),s&&(t.addressModeU=t.addressModeV=t.addressModeW=s),o&&(t.minFilter=t.magFilter=o),f&&(t.minFilter=t.magFilter=t.mipmapFilter=f),T(this,ne).createSampler(t)}CreateTexture(t){const e=t.label??"Texture",{format:s="rgba8unorm",usage:o=ds.RENDER}=t;return T(this,ne).createTexture({label:e,format:s,usage:o,...t})}WriteTexture(t,e){const{texture:s,mipLevel:o,origin:f,aspect:x,offset:N,rowsPerImage:R}=e,[I,B]=X(this,at,ye).call(this,s);let{bytesPerRow:z}=e;z??(z=(e.width??I)*Float32Array.BYTES_PER_ELEMENT),T(this,ne).queue.writeTexture({texture:s,mipLevel:o,origin:f,aspect:x},t,{offset:N,bytesPerRow:z,rowsPerImage:R},X(this,at,Ce).call(this,{width:I,height:B,...e},"WriteTexture"))}CreateStorageTexture(t){let{size:e}=t;const s=ds.STORAGE|t.usage,o=t.label??"Storage Texture",{format:f=this.PreferredStorageFormat}=t;return e=T(this,W)&&!e?T(this,W).CanvasSize:e,this.CreateTexture({label:o,size:e,format:f,...t,usage:s})}CreateBitmapImage(t,e){return createImageBitmap(t,e)}CreateTextureFromSource(t,e={}){e=typeof e=="boolean"&&{}||e;const s=e.size,o=e.size,f=e.mipLevelCount??((e.mipmaps??!0)&&this.GetMipmapLevels(t)||void 0),x=Array.isArray(e.size)||!e.size?s??X(this,at,ye).call(this,t):[o.width,o.height];return this.CreateTexture({size:x,mipLevelCount:f,...e})}ImportExternalTexture(t,e,s){return T(this,ne).importExternalTexture({source:t,label:e,colorSpace:s})}CreateMultisampleTexture(t=!1,e=4,s){var N;!T(this,W)&&K($.RENDER_PIPELNE_NOT_FOUND,"creating a multisample texture.");const{width:o,height:f,format:x}=T(this,W).CurrentTexture;return(t||!T(this,se)||T(this,se).width!==o||T(this,se).height!==f)&&((N=T(this,se))==null||N.destroy(),F(this,se,this.CreateTexture({usage:GPUTextureUsage.RENDER_ATTACHMENT,label:s??"Multisample Texture",size:[o,f],sampleCount:e,format:x}))),T(this,se)}CopyImageToTexture(t,e={create:!0}){var tt;let{create:s,texture:o}=e;const[f,x]=X(this,at,ye).call(this,t),{flipY:N,mipLevel:R,aspect:I,colorSpace:B,premultipliedAlpha:z,mipmaps:J}=e;return J===!1&&((tt=s=typeof s=="object"&&s||{}).mipmaps??(tt.mipmaps=!1)),!o&&!s&&K($.TEXTURE_NOT_FOUND,"`CopyImageToTexture`."),o??(o=this.CreateTextureFromSource(t,s)),T(this,ne).queue.copyExternalImageToTexture({source:t,origin:e.sourceOrigin,flipY:N},{texture:o,mipLevel:R,origin:e.destinationOrigin,aspect:I,colorSpace:B,premultipliedAlpha:z},X(this,at,Ce).call(this,{width:f,height:x,...e},"CopyImageToTexture")),(J??!0)&&1<o.mipLevelCount&&(o.depthOrArrayLayers===1?this.GenerateMipmaps(o):this.GenerateCubeMipmaps(o)),o}CopyTextureToTexture(t){const{source:e,create:s}=t;let{srcTexture:o,dstTexture:f}=t;!T(this,W)&&K($.RENDER_PIPELNE_NOT_FOUND,"copying a texture to a texture."),!o&&!e&&!s&&K($.TEXTURE_NOT_FOUND,"`CopyTextureToTexture`."),o??(o=this.CreateTextureFromSource(e,s)),f??(f=this.CreateTextureFromSource(o,s));const{srcMipLevel:x,srcOrigin:N,srcAspect:R}=t,{dstMipLevel:I,dstOrigin:B,dstAspect:z}=t,[J,tt]=X(this,at,ye).call(this,o);T(this,W).GetCommandEncoder(!0).copyTextureToTexture({texture:o,mipLevel:x,origin:N,aspect:R},{texture:f,mipLevel:I,origin:B,aspect:z},X(this,at,Ce).call(this,{width:J,height:tt,...t},"CopyTextureToTexture"))}CopyTextureToBuffer(t){const{source:e,create:s}=t;let{texture:o,bytesPerRow:f}=t;!T(this,W)&&K($.RENDER_PIPELNE_NOT_FOUND,"copying a texture to a buffer."),!o&&!e&&!s&&K($.TEXTURE_NOT_FOUND,"`CopyTextureToBuffer`."),o??(o=this.CreateTextureFromSource(e,s));const[x,N]=X(this,at,ye).call(this,o),{buffer:R,offset:I,rowsPerImage:B,mipLevel:z,origin:J,aspect:tt}=t;f??(f=(t.width??x)*Float32Array.BYTES_PER_ELEMENT),X(this,at,Nn).call(this,f,"CopyTextureToBuffer"),T(this,W).GetCommandEncoder(!0).copyTextureToBuffer({texture:o,mipLevel:z,origin:J,aspect:tt},{buffer:R,offset:I,bytesPerRow:f,rowsPerImage:B},X(this,at,Ce).call(this,{width:x,height:N,...t},"CopyTextureToBuffer"))}CopyBufferToTexture(t){const{source:e,create:s}=t;let{texture:o,bytesPerRow:f}=t;!T(this,W)&&K($.RENDER_PIPELNE_NOT_FOUND,"copying a buffer to a texture."),!o&&!e&&!s&&K($.TEXTURE_NOT_FOUND,"`CopyBufferToTexture`."),o??(o=this.CreateTextureFromSource(e,s));const[x,N]=X(this,at,ye).call(this,o),{buffer:R,offset:I,rowsPerImage:B,mipLevel:z,origin:J,aspect:tt}=t;f??(f=(t.width??x)*Float32Array.BYTES_PER_ELEMENT),X(this,at,Nn).call(this,f,"CopyBufferToTexture"),T(this,W).GetCommandEncoder(!0).copyBufferToTexture({buffer:R,offset:I,bytesPerRow:f,rowsPerImage:B},{texture:o,mipLevel:z,origin:J,aspect:tt},X(this,at,Ce).call(this,{width:x,height:N,...t},"CopyBufferToTexture"))}get PreferredStorageFormat(){const t=Pn.PreferredCanvasFormat;return T(this,ne).features.has("bgra8unorm-storage")&&t==="bgra8unorm"?t:"rgba8unorm"}GenerateCubeMipmaps(t){X(this,at,Mn).call(this,t,{minMagFilter:ps.LINEAR},e=>{for(let s=0;s<t.depthOrArrayLayers;++s)T(this,W).SetBindGroups(T(this,W).CreateBindGroup(T(this,W).CreateBindGroupEntries([T(this,ve),t.createView({baseMipLevel:e-1,arrayLayerCount:1,baseArrayLayer:s,mipLevelCount:1,dimension:"2d"})]))),T(this,W).CreatePassDescriptor(T(this,W).CreateColorAttachment(t.createView({arrayLayerCount:1,baseArrayLayer:s,mipLevelCount:1,dimension:"2d",baseMipLevel:e}))),T(this,W).Render(6,!1),T(this,W).DestroyCurrentPass()})}GenerateMipmaps(t){X(this,at,Mn).call(this,t,{minFilter:ps.LINEAR},e=>{T(this,W).SetBindGroups(T(this,W).CreateBindGroup(T(this,W).CreateBindGroupEntries([T(this,ve),t.createView({baseMipLevel:e-1,mipLevelCount:1})]))),T(this,W).CreatePassDescriptor(T(this,W).CreateColorAttachment(t.createView({baseMipLevel:e,mipLevelCount:1}))),T(this,W).Render(6,!1),T(this,W).DestroyCurrentPass()})}GetMipmapLevels(t){const[e,s]=X(this,at,ye).call(this,t);return(Math.log2(Math.max(e,s))|0)+1}set Renderer(t){F(this,W,t)}SetRenderer(t){this.Renderer=t}Destroy(){var t;F(this,se,(t=T(this,se))==null?void 0:t.destroy())}}ne=new WeakMap,se=new WeakMap,W=new WeakMap,ve=new WeakMap,De=new WeakMap,at=new WeakSet,ye=function(t){return t instanceof HTMLVideoElement?[t.videoWidth,t.videoHeight]:t instanceof VideoFrame?[t.codedWidth,t.codedHeight]:[t.width,t.height]},Ce=function(t,e){const{size:s,width:o,height:f,depthOrArrayLayers:x}=t;return!s&&!o&&K($.TEXTURE_SIZE_NOT_FOUND,`\`${e}\` method.`),s??{width:o,height:f,depthOrArrayLayers:x}},Nn=function(t,e){const s=t/256;s!==(s|0)&&Ne($.INVALID_BYTES_PER_ROW,`\`${e}\` options.`)},Mn=function(t,e,s){!T(this,W)&&K($.RENDER_PIPELNE_NOT_FOUND,"creating a texture with mipmaps."),T(this,W).SavePipelineState(),T(this,W).ResetPipelineState(),(!T(this,De)||!T(this,ve))&&(F(this,De,T(this,W).CreateShaderModule(Wr)),F(this,ve,this.CreateSampler(e))),T(this,W).CreatePipeline({vertex:T(this,W).CreateVertexState(T(this,De)),fragment:T(this,W).CreateFragmentState(T(this,De),void 0,T(this,W).CreateTargetState(t.format))});for(let o=1;o<t.mipLevelCount;++o)s(o);T(this,W).SubmitCommandBuffer(),T(this,W).SetCommandEncoder(void 0),T(this,W).RestorePipelineState(),F(this,De,F(this,ve,void 0))};var on,de,an,We,Ae,ot,pe,Ie,Fe,Yt,re,ct,Ht,Be,we,ie,Se,Ye,He,Qe,Le,le,kt,bn,On,Un,Rn,Ms;class Yr extends Ds{constructor(e,s,o,f){super(e,s,"Render");C(this,kt);C(this,on);C(this,de,!1);C(this,an,fs.identity());C(this,We,new Float32Array(3));C(this,Ae,!1);C(this,ot);C(this,pe);C(this,Ie);C(this,Fe);C(this,Yt);C(this,re);C(this,ct);C(this,Ht);C(this,Be);C(this,we,[0,0,0,0]);C(this,ie,[]);C(this,Se);C(this,Ye);C(this,He);C(this,Qe,[0,0,0,0]);C(this,Le);C(this,le);!o&&K($.CANVAS_NOT_FOUND);const x=o.getContext("webgpu");!x&&K($.CONTEXT_NOT_FOUND),x.configure({device:e,...f}),F(this,Ie,this.CreateBuffer({size:T(this,We).length*Float32Array.BYTES_PER_ELEMENT,label:"Render Pipeline Resolution Buffer",usage:Me.UNIFORM})),F(this,ot,o),F(this,pe,x),X(this,kt,bn).call(this),X(this,kt,On).call(this),F(this,Be,f.format),this.CreatePassDescriptor(this.CreateColorAttachment())}ConfigureContext(e){const s=e.format??T(this,Be);T(this,pe).configure({device:this.Device,format:s,...e})}CreateColorAttachment(e,s="clear",o="store",f,x,N){const R=f&&X(this,kt,Un).call(this,f);return{view:e,loadOp:s,storeOp:o,clearValue:R,resolveTarget:x,depthSlice:N}}CreateDepthAttachment(e,s=1,o="clear",f="store",x){return F(this,Ae,!0),F(this,Fe,new Ns(this.Device)),{view:e,depthClearValue:s,depthLoadOp:o,depthStoreOp:f,depthReadOnly:x}}CreateStencilAttachment(e,s="clear",o="store",f){return{stencilClearValue:e,stencilLoadOp:s,stencilStoreOp:o,stencilReadOnly:f}}CreatePassDescriptor(e,s,o,f,x,N){const R=Array.isArray(e)&&e||[e];return F(this,de,!R.some(({view:I})=>!!I)),s??(s=this.CreatePipelineLabel("Render Pass")),this.Descriptor={colorAttachments:R,depthStencilAttachment:o,occlusionQuerySet:f,timestampWrites:x,maxDrawCount:N,label:s}}CreateIndexBuffer(e,s){const o=(s==null?void 0:s.label)??"Index Buffer";return e=Array.isArray(e)&&new Uint32Array(e)||e,this.CreateBuffer({label:o,size:e.byteLength,usage:Me.INDEX,...s})}CreateVertexBufferAttribute(e,s=0,o=0){return X(this,kt,Rn).call(this,e,s,o)}CreateVertexBufferLayout(e,s,o="vertex"){!this.Reflect&&K($.SHADER_MODULE_NOT_FOUND,"`Renderer.CreateVertexBufferLayout`.\n            Call `Renderer.CreateShaderModule` before creating a vertex layout or vertex buffer.");const{entry:{vertex:f}}=this.Reflect,x=f.find(({name:I})=>o===I);!x&&K($.VERTEX_ENTRY_NOT_FOUND,`\`${o}\` in vertex shader entries.`),e=Array.isArray(e)&&e||[e];let N=[],R=0;for(let I=0,B=e.length;I<B;++I){const z=e[I],J=typeof z=="string",tt=J?z:z.name,_t=x.inputs.find(({name:lt})=>tt===lt);if(_t){const lt=J?Xs(_t.type.size):z.format;N.push(X(this,kt,Rn).call(this,lt,+_t.location,R)),R+=Ws(lt);continue}Ne($.VERTEX_ATTRIBUTE_NOT_FOUND,`\`${tt}\` in vertex shader inputs.`)}return{arrayStride:R,stepMode:s,attributes:N}}CreateVertexBuffer(e,s=1,o,f="vertex"){const x=s.label??"Vertex Buffer";if(e instanceof Float32Array)return this.CreateBuffer({label:x,size:e.byteLength,usage:Me.VERTEX,...s});const N=this.CreateVertexBufferLayout(e,o,f),R=(typeof s=="number"&&s||(s.count??1))*N.arrayStride;return{buffer:this.CreateBuffer({label:x,size:R,usage:Me.VERTEX,...s}),layout:N}}CreateVertexState(e,s="vertex",o,f){return o=Array.isArray(o)&&o||[o],{module:e,entryPoint:s,buffers:o,constants:f}}CreateBlendComponent(e="add",s="one",o="zero"){return{operation:e,srcFactor:s,dstFactor:o}}CreateTargetState(e=T(this,Be),s,o){return s&&(s={color:s.color??{},alpha:s.alpha??{}}),{format:e,blend:s,writeMask:o}}CreateFragmentState(e,s="fragment",o,f){return o??(o=this.CreateTargetState()),o=Array.isArray(o)&&o||[o],{module:e,entryPoint:s,targets:o,constants:f}}CreateStencilFaceState(e,s,o,f){return{compare:e,failOp:s,depthFailOp:o,passOp:f}}CreateDepthStencilState(e="depth24plus",s=!0,o="less",f,x,N,R,I,B,z){return{format:e,depthWriteEnabled:s,depthCompare:o,stencilFront:f,stencilBack:x,stencilReadMask:N,stencilWriteMask:R,depthBias:I,depthBiasSlopeScale:B,depthBiasClamp:z}}CreateMultisampleState(e=4,s,o){return{count:e,mask:s,alphaToCoverageEnabled:o}}CreateStorageTextureBindingLayout(e=T(this,Be),s,o,f,x){return{binding:x,visibility:GPUShaderStage.FRAGMENT,storageTexture:{access:s,format:e,viewDimension:o}}}CreatePipeline(e={},s){let o=this.GetShaderModule(e),{vertex:f,fragment:x}=e;!o&&!f&&(o=this.CreateShaderModule()),o&&(f??(f=this.CreateVertexState(o)),x??(x=this.CreateFragmentState(o)));const N=e.label??this.CreatePipelineLabel("Render Pipeline"),R=e.layout??"auto";return this.SetPipeline(this.Device.createRenderPipeline({label:N,layout:R,vertex:f,fragment:x,...e})),s&&(T(this,ct)?T(this,ct).setPipeline(this.Pipeline):Ne($.RENDER_PASS_NOT_FOUND)),this.Pipeline}SavePipelineState(){super.SavePipelineState(),F(this,le,T(this,Ht)),F(this,Se,T(this,ie)),F(this,Qe,T(this,we)),F(this,Le,T(this,re)),F(this,Ye,T(this,de)),F(this,He,T(this,Ae)),T(this,le)&&F(this,le,Object.values(T(this,le)))}ResetPipelineState(){var e;super.ResetPipelineState(),this.SetVertexBuffers([]),this.SetIndexBuffer(void 0),F(this,de,!1),F(this,Qe,[0,0,0,0]),F(this,Ae,!1),F(this,re,(e=T(this,re))==null?void 0:e.destroy())}RestorePipelineState(){super.RestorePipelineState(),F(this,ie,T(this,Se)),F(this,we,T(this,Qe)),F(this,re,T(this,Le)),F(this,de,T(this,Ye)),F(this,Ae,T(this,He)),this.SetIndexBuffer(...Array.isArray(T(this,le))&&T(this,le)||[void 0])}SetVertexBuffers(e,s,o){s=Array.isArray(s)&&s||[s],o=Array.isArray(o)&&o||[o],F(this,ie,Array.isArray(e)&&e.map((f,x)=>({buffer:f,offset:s[x],size:o[x]}))||[{buffer:e,offset:s[0],size:o[0]}])}AddVertexBuffers(e,s,o){s=Array.isArray(s)&&s||[s],o=Array.isArray(o)&&o||[o],T(this,ie).push(...Array.isArray(e)&&e.map((f,x)=>({buffer:f,offset:s[x],size:o[x]}))||[{buffer:e,offset:s[0],size:o[0]}])}SetIndexBuffer(e,s="uint32",o,f){F(this,Ht,e&&{buffer:e,format:s,offset:o,size:f})}SetCanvasSize(e,s,o=!0){!this.Device&&K($.DEVICE_NOT_FOUND),!T(this,ot)&&K($.CANVAS_NOT_FOUND);let f=this.DevicePixelRatio*e|0,x=this.DevicePixelRatio*s|0;const N=this.Device.limits.maxTextureDimension2D;f=Math.max(1,Math.min(f,N)),x=Math.max(1,Math.min(x,N)),(T(this,ot).width!==f||T(this,ot).height!==x)&&(o&&(T(this,ot).style.height=`${s}px`,T(this,ot).style.width=`${e}px`),T(this,ot).height=x,T(this,ot).width=f,X(this,kt,On).call(this),X(this,kt,bn).call(this))}Render(e,s=!0){T(this,Ae)&&X(this,kt,Ms).call(this),T(this,ct)||(T(this,re)?(this.Descriptor.colorAttachments[0].view=T(this,re).createView(),this.Descriptor.colorAttachments[0].resolveTarget=this.CurrentTextureView):T(this,de)&&(this.Descriptor.colorAttachments[0].view=this.CurrentTextureView),F(this,ct,this.GetCommandEncoder().beginRenderPass(this.Descriptor)),T(this,ct).setPipeline(this.Pipeline),F(this,on,T(this,Ht)?T(this,ct).drawIndexed.bind(T(this,ct)):T(this,ct).draw.bind(T(this,ct))));for(let o=0,f=T(this,ie).length;o<f;++o){const{buffer:x,offset:N,size:R}=T(this,ie)[o];T(this,ct).setVertexBuffer(o,x,N,R)}T(this,Ht)&&T(this,ct).setIndexBuffer(T(this,Ht).buffer,T(this,Ht).format,T(this,Ht).offset,T(this,Ht).size);for(let o=0,f=0,x=this.BindGroups.length;o<x;++o){const{bindGroup:N,dynamicOffsets:R,active:I}=this.BindGroups[o];I&&T(this,ct).setBindGroup(f++,N,R)}T(this,ct).setBlendConstant(T(this,we)),T(this,on).call(this,...Array.isArray(e)&&e||[e]),s&&this.Submit()}DestroyCurrentPass(){var e;(e=T(this,ct))==null||e.end(),F(this,ct,void 0)}Submit(){this.DestroyCurrentPass(),this.SubmitCommandBuffer(),this.SetCommandEncoder(void 0)}Destroy(){var e;this.DestroyCurrentPass(),(e=T(this,pe))==null||e.unconfigure()}get Canvas(){return T(this,ot)}get Context(){return T(this,pe)}get CurrentPass(){return T(this,ct)}get AspectRatio(){return!T(this,ot)&&K($.CANVAS_NOT_FOUND),T(this,ot).width/T(this,ot).height}get Projection2D(){return T(this,an)}get DepthTexture(){return T(this,Yt)}get CurrentTexture(){return T(this,pe).getCurrentTexture()}get CurrentTextureView(){return this.CurrentTexture.createView()}set MultisampleTexture(e){F(this,re,e)}get MultisampleTexture(){return T(this,re)}set BlendConstant(e){F(this,we,X(this,kt,Un).call(this,e))}get BlendConstant(){return T(this,we)}get ResolutionBuffer(){return T(this,Ie)}get DevicePixelRatio(){return devicePixelRatio??1}set TextureView(e){this.Descriptor.colorAttachments[0].view=e,F(this,de,!e)}get BaseCanvasSize(){const{width:e,height:s}=T(this,ot),o=this.DevicePixelRatio;return[e/o,s/o]}get CanvasSize(){return[T(this,ot).width,T(this,ot).height]}Destroy(){var e,s,o,f,x,N,R;super.Destroy(),F(this,ct,void 0),T(this,Ie).destroy(),F(this,we,[0,0,0,0]),F(this,Fe,(e=T(this,Fe))==null?void 0:e.Destroy()),F(this,Yt,(s=T(this,Yt))==null?void 0:s.destroy()),F(this,Le,(o=T(this,Le))==null?void 0:o.destroy()),F(this,Ye,F(this,He,!1)),(f=T(this,Se))==null||f.forEach(({buffer:I})=>I.destroy()),T(this,ie).forEach(({buffer:I})=>I.destroy()),(x=T(this,Ht))==null||x.buffer.destroy(),(N=T(this,le))==null||N.splice(0),F(this,le,void 0),(R=T(this,Se))==null||R.splice(0),F(this,Se,void 0),T(this,ie).splice(0),this.ResetPipelineState(),T(this,pe).unconfigure()}}on=new WeakMap,de=new WeakMap,an=new WeakMap,We=new WeakMap,Ae=new WeakMap,ot=new WeakMap,pe=new WeakMap,Ie=new WeakMap,Fe=new WeakMap,Yt=new WeakMap,re=new WeakMap,ct=new WeakMap,Ht=new WeakMap,Be=new WeakMap,we=new WeakMap,ie=new WeakMap,Se=new WeakMap,Ye=new WeakMap,He=new WeakMap,Qe=new WeakMap,Le=new WeakMap,le=new WeakMap,kt=new WeakSet,bn=function(){T(this,We).set([T(this,ot).width,T(this,ot).height,this.DevicePixelRatio]),this.WriteBuffer(T(this,Ie),T(this,We))},On=function(){const e=2/T(this,ot).clientWidth,s=-2/T(this,ot).clientHeight;fs.set(e,0,0,0,s,0,-1,1,1,T(this,an))},Un=function(e){return e instanceof Sn?e.rgba:e},Rn=function(e,s=0,o=0){return{format:e,shaderLocation:s,offset:o}},Ms=function(){var f;const e=this.CurrentTexture,{width:s,height:o}=e;(!T(this,Yt)||T(this,Yt).width!==s||T(this,Yt).height!==o)&&((f=T(this,Yt))==null||f.destroy(),F(this,Yt,T(this,Fe).CreateTextureFromSource(e,{usage:GPUTextureUsage.RENDER_ATTACHMENT,label:"Depth Texture",format:"depth24plus",mipmaps:!1}))),this.Descriptor.depthStencilAttachment.view=T(this,Yt).createView()};var cn;class Hr extends Ds{constructor(e,s){super(e,s,"Compute");C(this,cn,[1]);this.CreatePassDescriptor()}CreatePassDescriptor(e,s){return e??(e=this.CreatePipelineLabel("Compute Pass")),this.Descriptor={label:e,timestampWrites:s}}CreatePipeline(e){const s=e.label??this.CreatePipelineLabel("Compute Pipeline"),o=e.layout??"auto",f=this.GetShaderModule(e)??this.CreateShaderModule();return this.SetPipeline(this.Device.createComputePipeline({label:s,layout:o,compute:{module:f,...e}}))}Compute(e=!1){const s=this.GetCommandEncoder().beginComputePass(this.Descriptor);s.setPipeline(this.Pipeline);for(let o=0,f=0,x=this.BindGroups.length;o<x;++o){const{bindGroup:N,dynamicOffsets:R,active:I}=this.BindGroups[o];I&&s.setBindGroup(f++,N,R)}s.dispatchWorkgroups(...T(this,cn)),s.end(),e&&this.Submit()}Submit(){this.SubmitCommandBuffer(),this.SetCommandEncoder(void 0)}set Workgroups(e){F(this,cn,Array.isArray(e)&&e||[e])}Destroy(){super.Destroy(),this.Workgroups=1}}cn=new WeakMap;var Ze,Ge,je,Je,_e,oe,In,bs,Os,Us;const ee=class ee{static async CreateQuerySet(t,e){const o=(await this.GPUDevice).createQuerySet({type:t,count:e});return T(this,Ze).push(o),o}static RenderPipeline(t,e="",s={}){return s.format??(s.format=this.PreferredCanvasFormat),X(this,oe,In).call(this,e),(async()=>{const o=await this.GPUDevice;return new Proxy(Yr,{construct(f){return new f(o,e,t,s)}})})()}static ComputePipeline(t=""){return X(this,oe,In).call(this,t),(async()=>{const e=await this.GPUDevice;return new Proxy(Hr,{construct(s){return new s(e,t)}})})()}static Texture(t){return(async()=>{const e=await this.GPUDevice;return new Proxy(Ns,{construct(s){return new s(e,t)}})})()}static Destroy(t,e){var s;T(this,Ze).forEach(o=>o.destroy()),t=Array.isArray(t)&&t||[t],t.forEach(o=>o==null?void 0:o.destroy()),e=Array.isArray(e)&&e||[e],e.forEach(o=>o==null?void 0:o.destroy()),(s=T(this,Ge))==null||s.destroy(),T(this,Ze).splice(0),T(this,_e).requiredFeatures.clear(),F(this,je,F(this,Ge,null)),this.DescriptorLabel=this.RequiredLimits=void 0,this.PowerPreference=this.ForceFallbackAdapter=void 0}static set PowerPreference(t){T(this,Je).powerPreference=t}static set ForceFallbackAdapter(t){T(this,Je).forceFallbackAdapter=t}static set DescriptorLabel(t){T(this,_e).label=t}static async SetRequiredFeatures(t){const e=(await this.Adapter).features;return t=Array.isArray(t)&&t||[t],t.forEach(s=>e.has(s)?T(this,_e).requiredFeatures.add(s):Ne($.FEATURE_NOT_FOUND,`"${s}".
It will be skipped when requesting a GPUDevice.`)),T(this,_e).requiredFeatures}static set RequiredLimits(t){T(this,_e).requiredLimits=t}static get PreferredCanvasFormat(){return!navigator.gpu&&K($.WEBGPU_NOT_SUPPORTED),navigator.gpu.getPreferredCanvasFormat()}static get Adapter(){return(async()=>T(this,je)??await X(this,oe,Os).call(this)())()}static get GPUDevice(){return(async()=>T(this,Ge)??await X(this,oe,Us).call(this)())()}static set OnDeviceLost(t){this.OnLost=t}static get OnDeviceLost(){return this.OnLost}static get Device(){return this.GPUDevice}static get VERSION(){return"0.0.10"}};Ze=new WeakMap,Ge=new WeakMap,je=new WeakMap,Je=new WeakMap,_e=new WeakMap,oe=new WeakSet,In=function(t){var e;(e=T(this,_e)).label??(e.label=t&&`${t} Device`||"")},bs=function(t){if(ee.OnLost)return ee.OnLost(t);const e=(t.message&&` | Message: ${t.message}`)??".";K($.DEVICE_LOST,`Reason: ${t.reason}`+e)},Os=function(){return!navigator.gpu&&K($.WEBGPU_NOT_SUPPORTED),async()=>{const t=await navigator.gpu.requestAdapter(T(this,Je));return!t&&K($.ADAPTER_NOT_FOUND),F(this,je,t)}},Us=function(){return async()=>{const{requiredFeatures:t,requiredLimits:e,label:s}=T(this,_e),o=await(await this.Adapter).requestDevice({requiredFeatures:t,requiredLimits:e,defaultQueue:{label:s}});return!o&&K($.DEVICE_NOT_FOUND),o.lost.then(X(this,oe,bs)),F(this,Ge,o)}},C(ee,oe),C(ee,Ze,[]),C(ee,Ge,null),C(ee,je,null),C(ee,Je,{powerPreference:void 0,forceFallbackAdapter:!1}),be(ee,"OnLost"),C(ee,_e,{label:void 0,requiredFeatures:new Set,requiredLimits:void 0});let Pn=ee;it({TRIANGLE:3,SQUARE:4,PENTAGON:5,HEXAGON:6,HEPTAGON:7,OCTAGON:8,NONAGON:9,DECAGON:10,DODECAGON:12});/**
 * @module UWAL
 * @author Ustym Ukhman <ustym.ukhman@gmail.com>
 * @description Unopinionated WebGPU Abstraction Library
 * @version 0.0.10
 * @license MIT
 */console.info("%cUWAL v0.0.10","background:#005a9c;padding:3px;color:#fff;");export{Sn as C,Pn as D,ps as F,Zr as N,it as a,fs as m,jr as v};
