import{a as e,c as t,d as n,f as r,h as i,p as a,t as o}from"./lib-BBUTVt48.js";var s=`struct VertexOutput{@location(0)textureCoord: vec2f,@builtin(position)position: vec4f,@location(1)@interpolate(flat)instance: u32};@group(1)@binding(0)var Sampler: sampler;@group(1)@binding(1)var Texture: texture_2d<f32>;@group(1)@binding(2)var<uniform>resolution: vec3f;@group(1)@binding(3)var<storage,read>visible: array<u32>;@vertex fn textureVertex(@location(0)position: vec2f,@location(1)translation: vec2f,@builtin(instance_index)instance: u32)->VertexOutput{var output: VertexOutput;let dpr=resolution.z*2.75;let aspect=resolution.xy/resolution.y;let clipSpace=GetVertexClipSpace(position).xy;output.position=vec4f(clipSpace+translation,0,1);output.textureCoord=clipSpace*aspect*dpr+0.5;output.instance=instance;return output;}@fragment fn fragment(@location(0)textureCoord: vec2f,@location(1)@interpolate(flat)instance: u32)->@location(0)vec4f{if(visible[instance]==0){discard;}return textureSample(Texture,Sampler,textureCoord);}`,c=``+new URL(`logo-DEvozEyj.jpg`,import.meta.url).href,l,u,d,f,p,m;async function h(m){try{u=new(await(a.Renderer(m,`Textures / Instancing`)))}catch(e){alert(e)}let h=new o,g=new u.Pipeline,_=new e({radius:128}),v,y,b,x,S=512,C=performance.now()-S,w=g.CreateShaderModule([i,s]);u.CreatePassDescriptor(u.CreateColorAttachment(new n(1651532)));let{buffer:T,layout:E}=g.CreateVertexBuffer(`translation`,256,`instance`,`textureVertex`);await u.AddPipeline(g,{fragment:g.CreateFragmentState(w),vertex:g.CreateVertexState(w,[_.GetPositionBufferLayout(g),E],void 0,`textureVertex`)}),A();function D(){cancelAnimationFrame(l),clearTimeout(y),C=performance.now()-S}async function O(){k(),j(),await M(),requestAnimationFrame(N),y=setTimeout(()=>S=~(b=-1),S*3)}function k(){let e=new t(_,null);e.SetRenderPipeline(g);let[n,r]=u.CanvasSize;g.AddVertexBuffers(T),g.SetDrawParams(_.Vertices,256),e.Transform=[[n/2,r/2],Math.PI/4],e.UpdateProjectionMatrix(h.ProjectionMatrix)}function A(){let e=new Float32Array(256*2),t=1-Math.sqrt(2)*128/m.offsetWidth,n=1-Math.sqrt(2)*128/m.offsetHeight;for(let i=256;i--;){let a=r.Random(-t,t),o=r.Random(-n,n);e.set([a,o],i*2)}g.WriteBuffer(T,e)}function j(){let e=g.CreateStorageBuffer(`visible`,256);g.WriteBuffer(e.buffer,e.visible),x=(v=e.visible).length-1,p=e.buffer}async function M(){let{ResolutionBuffer:e}=u,t=new(await(a.Texture()));f=await t.CopyImageToTexture(await t.CreateImageBitmap(c),{flipY:!0,create:{mipmaps:!1}}),g.AddBindGroupFromResources([t.CreateSampler(),f.createView(),e,p],0,1)}function N(e){l=requestAnimationFrame(N),!(e-C<S)&&(S?v.fill(0)&&(b=r.RandomInt(0,x)):++b===x&&cancelAnimationFrame(l),C=e,v[b]=1,g.WriteBuffer(p,v),u.Render())}d=new ResizeObserver(e=>{for(let t of e){let{inlineSize:e,blockSize:n}=t.contentBoxSize[0];e=e<=960&&e||e-240,u.SetCanvasSize(e,n),h.Size=u.CanvasSize}D(),O()}),d.observe(document.body)}function g(){a.OnLost=()=>void 0,cancelAnimationFrame(l),d.disconnect(),u.Destroy(),a.Destroy([p,m],f)}export{g as destroy,h as run};