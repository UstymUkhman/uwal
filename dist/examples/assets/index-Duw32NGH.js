import{U as s}from"./index-CTxjjS5z.js";var L="struct VertexOutput{@location(0)cell: vec2f,@builtin(position)position: vec4f};@group(0)@binding(0)var<uniform>grid: vec2f;@group(0)@binding(1)var<storage>state: array<u32>;@vertex fn vertex(@location(0)position: vec2f,@builtin(instance_index)instance: u32)->VertexOutput{let fInstance=f32(instance);let state=f32(state[instance]);let cell=vec2f(fInstance % grid.x,floor(fInstance/grid.x));var output: VertexOutput;output.position=vec4f((position*state+1)/grid-1+cell/grid*2,0,1);output.cell=cell;return output;}@fragment fn fragment(@location(0)cell: vec2f)->@location(0)vec4f {let rg=cell/grid;return vec4f(rg,1-rg.g,1);}",M="@group(0)@binding(0)var<uniform>grid: vec2f;@group(0)@binding(1)var<storage>cellStateIn: array<u32>;@group(0)@binding(2)var<storage,read_write>cellStateOut: array<u32>;fn cellIndex(cell: vec2u)->u32{return(cell.x % u32(grid.x))+(cell.y % u32(grid.y))*u32(grid.x);}fn cellActive(x: u32,y: u32)->u32{return cellStateIn[cellIndex(vec2(x,y))];}@compute @workgroup_size(8,8)fn compute(@builtin(global_invocation_id)cell: vec3u){let activeNeighbors=cellActive(cell.x+1,cell.y+1)+cellActive(cell.x+1,cell.y)+cellActive(cell.x+1,cell.y-1)+cellActive(cell.x,cell.y-1)+cellActive(cell.x-1,cell.y-1)+cellActive(cell.x-1,cell.y)+cellActive(cell.x-1,cell.y+1)+cellActive(cell.x,cell.y+1);let i=cellIndex(cell.xy);switch activeNeighbors{case 2:{cellStateOut[i]=cellStateIn[i];}case 3:{cellStateOut[i]=1;}default:{cellStateOut[i]=0;}}}";/**
 * @example Game Of Life
 * @author Ustym Ukhman <ustym.ukhman@gmail.com>
 * @description This example is inspired by Google Codelabs "Your first WebGPU app"
 * {@link https://codelabs.developers.google.com/your-first-webgpu-app}&nbsp;
 * and developed by using a version listed below. Please note that this code
 * may be simplified in future thanks to more recent library APIs.
 * @version 0.0.4
 * @license MIT
 */let f,b;async function F(h){let e,t;try{e=new(await s.RenderPipeline(h,"Game Of Life Render")),t=new(await s.ComputePipeline("Game Of Life Compute"))}catch(r){alert(r)}let i,l,c;const u=[],U=8,d=250;let g,p=0,v=performance.now()-d;const O=e.CreatePassDescriptor(e.CreateColorAttachment(void 0,"clear","store",[0,0,.4,1])),y=t.CreateBindGroupLayout([{buffer:{type:"uniform"},visibility:GPUShaderStage.COMPUTE|GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT},{buffer:{type:"read-only-storage"},visibility:GPUShaderStage.COMPUTE|GPUShaderStage.VERTEX},{buffer:{type:"storage"},visibility:GPUShaderStage.COMPUTE}]),A=e.CreateShaderModule(L),E=e.CreateFragmentState(A),R=e.CreateVertexState(A,"vertex",{attributes:[e.CreateVertexBufferAttribute("float32x2")],arrayStride:8}),B=t.CreatePipelineLayout(y),w=t.CreateShaderModule(M);e.CreatePipeline({layout:B,vertex:R,fragment:E}),t.CreatePipeline({layout:B,module:w});const S=new Float32Array([-.8,-.8,.8,-.8,.8,.8,.8,.8,-.8,.8,-.8,-.8]),T=S.length/2,G=e.CreateBuffer({size:S.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST});e.WriteBuffer(G,S),e.SetVertexBuffers(G);function I(){cancelAnimationFrame(f),u.splice(p=0),v=performance.now()-d,[i,l,c].forEach(r=>r==null?void 0:r.destroy())}function _(r=48){const n=e.AspectRatio,{width:C,height:m}=e.Canvas,a=C<m?new Float32Array([r,Math.round(r/n)]):new Float32Array([Math.round(r*n),r]);i=e.CreateBuffer({size:a.byteLength,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),e.WriteBuffer(i,a),g=a[0]*a[1];const o=new Uint32Array(g);l=t.CreateBuffer({size:o.byteLength,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST}),c=t.CreateBuffer({size:o.byteLength,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST});for(let x=0;x<o.length;x++)o[x]=+(Math.random()>.6);t.WriteBuffer(l,o),t.Workgroups=[Math.ceil(a[0]/U),Math.ceil(a[1]/U)],u.push(t.CreateBindGroup(t.CreateBindGroupEntries([{buffer:i},{buffer:l},{buffer:c}]),y),t.CreateBindGroup(t.CreateBindGroupEntries([{buffer:i},{buffer:c},{buffer:l}]),y)),f=requestAnimationFrame(P)}function P(r){if(f=requestAnimationFrame(P),r-v<d)return;const n=t.CreateCommandEncoder();t.SetBindGroups(u[p%2]),t.Compute(),e.SetCommandEncoder(n),e.SetBindGroups(u[++p%2]),O.colorAttachments[0].view=e.CurrentTextureView,e.Render([T,g]),v=r}b=new ResizeObserver(r=>{for(const n of r){const{inlineSize:C,blockSize:m}=n.contentBoxSize[0];e.SetCanvasSize(C,m)}I(),_()}),b.observe(h)}function D(){s.OnDeviceLost=()=>{},cancelAnimationFrame(f),b.disconnect(),s.Destroy()}export{D as destroy,F as run};
