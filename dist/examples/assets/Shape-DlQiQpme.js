import{a as B,T as c,E as l}from"./index-CE6-3cgY.js";import{M as g,a as s,b as n}from"./Math-Cr7J2GA5.js";var O="@group(0)@binding(0)var<uniform>resolution: vec3f;fn GetClipSpace(position: vec2f)->vec2f{let clipSpace=position/resolution.xy*2-1;return clipSpace*vec2f(1,-1);}@group(0)@binding(1)var<uniform>matrix: mat3x3f;fn GetVertexClipSpace(position: vec2f)->vec4f{let matrixPosition=matrix*vec3f(position,1);let clipSpace=GetClipSpace(matrixPosition.xy);return vec4f(clipSpace,0,1);}@vertex fn vertex(@location(0)position: vec2f)->@builtin(position)vec4f {return GetVertexClipSpace(position);}";const R=B({TRIANGLE:3,SQUARE:4,PENTAGON:5,HEXAGON:6,HEPTAGON:7,OCTAGON:8,NONAGON:9,DECAGON:10,DODECAGON:12});let P=class{#n;#u;#h;#c;#s;#r;#i;#e;constructor(t={segments:"SQUARE",radius:0}){const i=t.segments,e=typeof i=="number"&&i;this.#h=e||R[i||"SQUARE"],this.#n=t.radius??0,this.#c=t}#o(t,i="Shape"){let e=this.#e;if(!e){e=new Float32Array((this.#h+1)*2*3);const{endAngle:r=g.TAU,startAngle:h=0,innerRadius:o=0}=this.#c,a=r-h;for(let f=0,u=0,d=this.#h;u<=d;++u){const p=h+u*a/d,x=Math.cos(p),S=Math.sin(p);e[f++]=x*this.#n,e[f++]=S*this.#n,e[f++]=x*o,e[f++]=S*o}this.#r=t.CreateVertexBuffer(e,{label:`${i} Vertex Buffer`}),t.WriteBuffer(this.#r,e),t.SetVertexBuffers(this.#r)}}#t(t,i="Shape"){let e=this.#i;if(!e){e=new Uint16Array(this.#h*6);for(let r=0,h=0,o=this.#h;h<o;++h){const a=h*2;e[r++]=a+1,e[r++]=a+3,e[r++]=a+2,e[r++]=a+2,e[r++]=a+0,e[r++]=a+1}}this.#s=t.CreateIndexBuffer(e,{label:`${i} Index Buffer`}),t.SetDrawParams(this.#u=e.length),t.WriteBuffer(this.#s,e),t.SetIndexBuffer(...this.IndexBuffer)}CreateBuffers(t,i="Shape"){this.#o(t,i),this.#t(t,i)}set VertexData(t){this.#e=t}get VertexBuffer(){return this.#r}set IndexData(t){this.#i=t}get IndexBuffer(){return[this.#s,"uint16"]}get Vertices(){return this.#u}get Radius(){return this.#n}Destroy(){this.#i=void 0,this.#s?.destroy(),this.#e=void 0,this.#r?.destroy()}};class N{#n=s.create();#u=s.create();#h=s.create();#c=s.create();#s;#r;#i;#e;#o;#t;#f=!1;#l;#p;#x=n.set(1,1);#a=n.set(0,0);#B=n.set(0,0);#S=n.set(0,0);#d=B({min:n.create(),max:n.create()});constructor(t,i,e="Shape"){this.#i=t,this.#l=i,this.#s=e,this.Scale=this.#x,this.Origin=this.#a,this.Position=this.#S,this.Rotation=this.#r??0}SetRenderPipeline(t,i){this.#t=t,this.#i.CreateBuffers(t,this.#s),this.#l?.CreateColorBuffer(t,this.#s),this.#m(i)}AddVertexBuffers(t,i,e){!this.#t&&c(l.PIPELINE_NOT_FOUND,"RenderPipeline.\n            Use `Shape.SetRenderPipeline` method before adding vertex buffers."),this.#t.AddVertexBuffers(t,i,e)}#m(t){const{matrix:i,buffer:e}=this.#t.CreateUniformBuffer("matrix",{label:`${this.#s} Matrix Buffer`});this.#e=i,this.#o=e,this.#p=[t,e,this.#l?.ColorBuffer].filter(Boolean),this.#t.SetBindGroupFromResources(this.#p,0,0,`${this.#s} Bind Group`)}SetPipelineData(){!this.#t&&c(l.PIPELINE_NOT_FOUND,"RenderPipeline.\n            Use `Shape.SetRenderPipeline` method before setting its data."),this.#t.SetBindGroupFromResources(this.#p);const{VertexBuffer:t,IndexBuffer:i,Vertices:e}=this.#i;this.#t.SetVertexBuffers(t),this.#t.SetIndexBuffer(...i),this.#t.SetDrawParams(e)}Update(){if(this.#f){s.multiply(this.#c,this.#h,this.#e),s.multiply(this.#e,this.#u,this.#e),s.multiply(this.#e,this.#n,this.#e),this.#t.WriteBuffer(this.#o,this.#e);const t=this.#B[0]=this.#e[8],i=this.#B[1]=this.#e[9],{Radius:e}=this.#i;this.#d.min[0]=t-e,this.#d.min[1]=i-e,this.#d.max[0]=t+e,this.#d.max[1]=i+e,this.#f=!1}}GetPositionBufferLayout(t,i="position"){const e=t??this.#t;return!e&&c(l.PIPELINE_NOT_FOUND,"RenderPipeline.\n            Pass it as argument to `Shape.GetPositionBufferLayout` method or call\n            `Shape.SetRenderPipeline` method before getting position buffer layout."),e.CreateVertexBufferLayout(i)}set Position(t){this.#S.set(t),s.translation(this.#S,this.#c),this.#f=!0}get Position(){return this.#S}set Rotation(t){this.#r=t,s.rotation(this.#r,this.#h),this.#f=!0}get Rotation(){return this.#r}set Scale(t){this.#x.set(t),s.scaling(this.#x,this.#u),this.#f=!0}get Scale(){return this.#x}set Origin(t){const{Radius:i}=this.#i;this.#a[0]=t[0],this.#a[1]=t[1],this.#a[0]*=-i,this.#a[1]*=-i,s.translation(this.#a,this.#n),this.#a[0]=t[0]||0,this.#a[1]=t[1]||0,this.#f=!0}get Origin(){return this.#a}get Center(){return this.Update(),this.#B}get Transform(){return this.Update(),this.#e}get BoundingBox(){return this.Update(),this.#d}get Geometry(){return this.#i}get Material(){return this.#l}Destroy(){this.#i.Destroy(),this.#l?.Destroy(),this.#t=void 0,this.#o?.destroy(),this.#o=void 0,this.#p?.splice(0)}}export{O as S,N as a,P as b};
