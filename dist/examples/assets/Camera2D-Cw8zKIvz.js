import{d as i,e as h,b as c,C as P,G as C,a as M,f as g,T as y,E as b,S as D,M as U}from"./index-BRWgv0CZ.js";var v="@group(0)@binding(0)var<uniform>shapeModelViewProjection: mat3x3f;fn GetVertexClipSpace(position: vec2f)->vec4f{return vec4f((shapeModelViewProjection*vec3f(position,1)).xy,0,1);}@vertex fn vertex(@location(0)position: vec2f)->@builtin(position)vec4f {return GetVertexClipSpace(position);}";class S{Children=[];Label;#e=null;TransformationOrder="TRS";ProjectionMatrix=i.identity();#t=i.identity();#s=i.identity();#a=h.create();#i=h.set(1,1);#r=0;constructor(t,e=null){this.Label=t,this.Parent=e}Find(t){let e=null;return this.Traverse(s=>s.Label===t&&(e=s)||!1),e}Add(t){t=c(t),t.forEach(e=>e.Parent=this)}Remove(t){t=c(t),t.forEach(e=>e.Parent=null)}Traverse(t){if(!t(this))for(let e=0,s=this.Children.length;e<s;++e)this.Children[e].Traverse(t)}ResetLocalMatrix(){i.identity(this.#t)}UpdateWorldMatrix(){this.UpdateLocalMatrix(),this.#e?i.multiply(this.#e.WorldMatrix,this.#t,this.#s):i.copy(this.#t,this.#s),this.Children.forEach(t=>t.UpdateWorldMatrix())}UpdateLocalMatrix(){i.identity(this.#t);const t=this.TransformationOrder.split("");for(let e=0,s=t.length;e<s;e++)switch(t[e]){case"T":i.translate(this.#t,this.#a,this.#t);break;case"R":i.rotate(this.#t,this.#r,this.#t);break;case"S":i.scale(this.#t,this.#i,this.#t);break}}UpdateProjectionMatrix(t){const e=this.#e&&this.#s||this.#t;return i.multiply(t,e,this.ProjectionMatrix)}ResetProjectionMatrix(){i.identity(this.ProjectionMatrix)}Rotate(t){i.rotate(this.#t,t,this.#t)}Scale(t){i.scale(this.#t,t,this.#t)}set Transform(t){i.identity(this.#t);const[e,s,r]=t,a=this.TransformationOrder.split("");for(let n=0,f=a.length;n<f;n++)switch(a[n]){case"T":e&&(this.Position=e);break;case"R":s!==void 0&&(this.Rotation=s);break;case"S":r&&(this.Scaling=r);break}}set Position(t){h.copy(t,this.#a),i.translate(this.#t,t,this.#t)}get Position(){return this.#a}set Rotation(t){this.#r=t,i.rotate(this.#t,t,this.#t)}get Rotation(){return this.#r}set Scaling(t){h.copy(t,this.#i),i.scale(this.#t,t,this.#t)}get Scaling(){return this.#i}get LocalMatrix(){return this.#t}get WorldMatrix(){return this.#s}set Parent(t){if(this.#e){const e=this.#e.Children.indexOf(this);0<=e&&this.#e.Children.splice(e,1)}t&&t.Children.push(this),this.#e=t}get Parent(){return this.#e}}let R=class{#e;#t;#s;Transparent=!1;#a=crypto.randomUUID();#i;#r;#n=new P(0,0);constructor(t=16777215,e="Shape"){this.Color=t,this.#e=e}CreateColorBuffer(t,e=this.#e){const{color:s,buffer:r}=t.CreateUniformBuffer("color",{label:`${e} Color Buffer`});this.#t=s,this.#s=t,this.#r=r,this.#t.set(this.#i),t.WriteBuffer(r,s)}SetBlendConstant(t){if(!t?.BlendConstant||!this.#n.Equals(t.BlendConstant))return this.#s.BlendConstant=this.#n}set BlendConstant(t){typeof t=="number"&&this.#n.Set(t)||(this.#n.rgba=C(t))}get BlendConstant(){return this.#n}get ColorBuffer(){return this.#r}set Color(t){this.#i=typeof t=="number"&&M(t)||C(t),this.#t?.fill(1).set(this.#i),this.#s?.WriteBuffer(this.#r,this.#t)}get Color(){return this.#i}get ID(){return this.#a}Destroy(){this.#s=void 0,this.#r?.destroy(),this.#r=void 0}},T=class extends S{#e;Visible=!0;#t;#s;#a;#i=h.set(0,0);#r=h.set(0,0);#n=g({min:h.create(),max:h.create()});#o=[];constructor(t,e,s="Shape",r=null){super(s,r),this.#e=t,this.#s=e===void 0&&new R||e}SetRenderPipeline(t,e){this.#t=t,this.#e.CreateBuffers(t),this.#s?.CreateColorBuffer(t),this.#h(e)}#h(t,e){const{projection:s,buffer:r}=this.#t.CreateUniformBuffer("shapeModelViewProjection",{label:`${this.Label} Projection Buffer`,...e});this.ProjectionMatrix=i.identity(s),this.#a=r,t=c(t),this.#o=this.#t.SetBindGroupFromResources([r,this.#s?.ColorBuffer,...t].filter(Boolean),0,0,`${this.Label} Bind Group`)}UpdateProjectionMatrix(t){const e=super.UpdateProjectionMatrix(t);return this.#t.WriteBuffer(this.#a,e),e}UpdateLocalMatrix(){super.UpdateLocalMatrix();const t=this.LocalMatrix,{Radius:e}=this.#e;this.#n.min[0]=t[8]-e,this.#n.min[1]=t[9]-e,this.#n.max[0]=t[8]+e,this.#n.max[1]=t[9]+e,i.translate(t,this.#i,t),this.#r[0]=this.#i[0]+this.#n.max[0],this.#r[1]=this.#i[1]+this.#n.max[1]}SetBindGroups(){!this.#t&&y(b.PIPELINE_NOT_FOUND,"RenderPipeline.\n            Call `Shape.SetRenderPipeline` method before setting its data."),this.#t.BindGroups=this.#o}get ProjectionBuffer(){return this.#a}set Origin(t){this.#i[0]=-t[0],this.#i[1]=-t[1];const e=this.LocalMatrix;i.translate(e,t,e)}get Origin(){return this.#i}get Center(){return this.#r}get BoundingBox(){return this.#n}get Geometry(){return this.#e}get Material(){return this.#s}get Pipeline(){return this.#t}Destroy(){this.#e.Destroy(),this.#s?.Destroy(),this.#t=void 0,this.#o.splice(0),this.#a?.destroy(),this.#a=void 0}};const j=g({TRIANGLE:3,SQUARE:4,PENTAGON:5,HEXAGON:6,HEPTAGON:7,OCTAGON:8,NONAGON:9,DECAGON:10,DODECAGON:12});class L{#e;#t;DrawParams=[];IndexFormat;#s;#a=crypto.randomUUID();#i;#r;VertexBuffers;IndexBuffer;constructor(t={segments:"SQUARE",radius:0}){const e=t.segments,s=typeof e=="number"&&e;this.#e=t.radius??0,this.#t=s||j[e||"SQUARE"],this.#s={label:"Shape",...t},this.IndexFormat=t.indexFormat??"uint16"}GetPositionBufferLayout(t,e="position",s="vertex",r="vertex"){return t.CreateVertexBufferLayout(e,s,r)}SetDrawParams(t,e,s,r,a){return D(this.DrawParams,...arguments)}#n(t,e=this.#s.label){let s=this.#r;if(!s){s=new Float32Array((this.#t+1)*2*3);const{endAngle:a=U.TAU,startAngle:n=0,innerRadius:f=0}=this.#s,o=a-n;for(let l=0,d=0,x=this.#t;d<=x;++d){const p=n+d*o/x,m=Math.cos(p),B=Math.sin(p);s[l++]=m*this.#e,s[l++]=B*this.#e,s[l++]=m*f,s[l++]=B*f}}const r=t.CreateVertexBuffer(s,{label:`${e} Vertex Buffer`});this.VertexBuffers=t.SetVertexBuffers(r),t.WriteBuffer(r,s)}#o(t,e=this.#s.label){let s=this.#i;if(!s){s=new Uint16Array(this.#t*6);for(let a=0,n=0,f=this.#t;n<f;++n){const o=n*2;s[a++]=o+1,s[a++]=o+3,s[a++]=o+2,s[a++]=o+2,s[a++]=o+0,s[a++]=o+1}}const r=t.CreateIndexBuffer(s,{label:`${e} Index Buffer`});t.SetDrawParams.apply(t,this.SetDrawParams(s.length)),this.IndexBuffer=t.SetIndexBuffer(r,this.IndexFormat),t.WriteBuffer(r,s)}CreateBuffers(t,e=this.#s.label){this.#n(t,e),this.#o(t,e)}set VertexData(t){this.#r=t}set IndexData(t){this.#i=t}get Vertices(){return this.DrawParams[0]}get Radius(){return this.#e}get ID(){return this.#a}Destroy(){this.IndexBuffer?.buffer.destroy(),this.IndexBuffer=void 0,this.#r=void 0,this.#i=void 0,this.VertexBuffers&&(this.VertexBuffers[0]?.buffer.destroy(),this.VertexBuffers.splice(0),this.VertexBuffers=void 0)}}class O extends S{#e=0;#t=innerWidth;#s=innerHeight;#a=0;#i=new Float32Array(4);constructor(t=innerWidth,e=innerHeight){super("Camera2D"),this.Size=typeof t!="number"&&t.CanvasSize||[t,e]}#r(t=!1){}UpdateProjectionMatrix(){const t=this.#e,e=this.#t,s=this.#s,r=this.#a;return i.set(2/e,0,0,0,-2/s,0,r/e*2-1,t/s*-2+1,1,this.ProjectionMatrix),this.#r(),this.ProjectionMatrix}set Size([t,e]){this.#t=t,this.#s=e,this.UpdateProjectionMatrix()}set Top(t){this.#e=t,this.UpdateProjectionMatrix()}get Top(){return this.#e}set Right(t){this.#t=t,this.UpdateProjectionMatrix()}get Right(){return this.#t}set Bottom(t){this.#s=t,this.UpdateProjectionMatrix()}get Bottom(){return this.#s}set Left(t){this.#a=t,this.UpdateProjectionMatrix()}get Left(){return this.#a}get Frustum(){return this.#i}}export{O as C,v as S,L as a,T as b,R as c};
