import{A as e,B as t,C as n,D as r,E as i,H as a,I as o,J as s,L as c,M as ee,N as te,O as ne,R as l,S as re,T as ie,U as u,V as d,X as ae,_ as f,a as p,b as m,c as h,d as g,f as _,g as oe,h as se,j as ce,k as le,m as ue,n as de,o as fe,p as pe,s as v,u as y,v as me,w as he,x as ge,y as _e,z as b}from"./lib-w9vsR0Iy.js";var x=class{#e=1;Label;constructor(e=`Light`){this.Label=e}set Intensity(e){this.#e=Math.max(e,l.EPSILON)}get Intensity(){return this.#e}},ve=class extends x{#e=t.create();constructor(e,n=`DirectionalLight`){super(n),this.Direction=e||t.create(0,0,-1)}set Direction(e){t.normalize(e,this.#e)}get Direction(){return this.#e}},ye=class extends x{#e=t.create();constructor(e,t=`PointLight`){super(t),this.Position=e||this.#e}set Position(e){t.copy(e,this.#e)}get Position(){return this.#e}},be=class extends x{#e=t.create();#t=t.create();#n=t.set(0,1,0);#r=b.create();#i=c.create();constructor(e,t=`SpotLight`){super(t),this.Position=e||this.#t}LookAt(e){return c.aim(this.#t,e,this.#n,this.#i),t.copy(this.#i.slice(8,11),this.#e)}set Position(e){t.copy(e,this.#t)}get Position(){return this.#t}set Limit(e){this.#r.set(e.toSorted().map(Math.cos))}get Limit(){return this.#r}},xe=`struct Mesh{@builtin(position)position: vec4f,@location(0)cameraDirection: vec3f,@location(1)pointDirection: vec3f,@location(2)spotDirection: vec3f,@location(3)worldPosition: vec3f,@location(4)vertexNormal: vec3f,@location(5)normal: vec3f,@location(6)uv: vec2f};@group(0)@binding(2)var<uniform>mode: f32;@group(0)@binding(3)var Sampler: sampler;@group(0)@binding(4)var Texture: texture_2d<f32>;@group(1)@binding(0)var<uniform>uCamera: CameraUniforms;@group(1)@binding(1)var<uniform>uSpotLight: LightUniforms;@group(1)@binding(2)var<uniform>uPointLight: LightUniforms;@group(1)@binding(3)var<uniform>uDirectionalLight: LightUniforms;@vertex fn baseVertex(@location(0)position: vec4f,@location(1)normal: vec3f,@location(2)uv: vec2f)->Mesh{let worldPosition=GetVertexWorldPosition(position);return Mesh(GetVertexClipSpace(position),GetCameraDirection(worldPosition,uCamera.position),GetLightDirection(worldPosition,uPointLight.position),GetLightDirection(worldPosition,uSpotLight.position),worldPosition,GetVertexNormal(MeshUniforms.worldNormal,normal),normal,uv);}@fragment fn baseFragment(mesh: Mesh)->@location(0)vec4f {var rgb=color.rgb;if(mode==0){rgb=textureSample(Texture,Sampler,mesh.uv).rgb;}if(mode==1){rgb=vec3f(mesh.normal*0.5+0.5);}if(mode==2){let fdx=vec3f(dpdx(mesh.worldPosition.x),dpdx(mesh.worldPosition.y),dpdx(mesh.worldPosition.z));let fdy=vec3f(dpdy(mesh.worldPosition.x),dpdy(mesh.worldPosition.y),dpdy(mesh.worldPosition.z));rgb=normalize(cross(fdx,fdy))*0.5+0.5;}if(mode==3){rgb=vec3f(mesh.uv,0);}var light=GetDirectionalLight(uDirectionalLight,mesh.normal);let pointLight=GetPointLight(PointLight(mesh.normal,uPointLight.intensity,mesh.pointDirection,mesh.cameraDirection));let spotLight=GetSpotLight(SpotLight(mesh.normal,uSpotLight.intensity,mesh.spotDirection,mesh.cameraDirection,uSpotLight.direction,uSpotLight.limit));let specular=pointLight.specular+spotLight.specular;light+=pointLight.value+spotLight.value;return vec4f(rgb*light+specular,1);}`,Se=``+new URL(`uv-BIbGJliV.jpg`,import.meta.url).href,S,C,w,T,E=new v;async function D(t){try{C=new(await(d.Renderer(t,`Primitives / Lights`)))}catch(e){alert(e)}let c,l,v,b=0,x=new fe,{Vec2:D}=o,O=D.create(),k,A,j,M,N=[,,],Ce=o.Vec3.create(),P=new de,F=new C.Pipeline,I=new C.Pipeline,L=D.create(-.85,-1),we=D.create(.85,-1),Te=new te(16777215),R=new(await(d.Texture(C))),Ee=await R.CreateImageBitmap(Se);w=await R.CopyImageToTexture(Ee);let z=F.CreateShaderModule([ae,s,u,xe]),B=new y(`Dummy`,`uint16`),V=I.CreateShaderModule(u),{mode:H,buffer:U}=F.CreateUniformBuffer(`mode`),{uCamera:W,buffer:G}=F.CreateUniformBuffer(`uCamera`),{uSpotLight:K,buffer:q}=F.CreateUniformBuffer(`uSpotLight`),{uPointLight:J,buffer:Y}=F.CreateUniformBuffer(`uPointLight`),{uDirectionalLight:X,buffer:Z}=F.CreateUniformBuffer(`uDirectionalLight`),De=[G,q,Y,Z],Q=[U,R.CreateSampler(),w.createView()];await C.AddPipeline(I,{vertex:I.CreateVertexState(V,B.GetPositionBufferLayout(I)),primitive:I.CreatePrimitiveState(`line-list`),depthStencil:I.CreateDepthStencilState(),multisample:I.CreateMultisampleState(),fragment:I.CreateFragmentState(V,I.CreateColorTargetState(a.ALPHA_ADDITIVE))}),await C.AddPipeline(F,{fragment:F.CreateFragmentState(z,void 0,`baseFragment`),depthStencil:F.CreateDepthStencilState(),multisample:F.CreateMultisampleState(),vertex:F.CreateVertexState(z,[B.GetPositionBufferLayout(F,`baseVertex`),B.GetNormalBufferLayout(F,`baseVertex`),B.GetUVBufferLayout(F,`baseVertex`)],`baseVertex`)}),E.Add(x),P.CullTest=0,E.AddCamera(P),P.Position=[-8,4,8];function Oe(t=0){let a=5*.5,o=1.5;return[ee,()=>ce({closed:!0}),()=>e({nx:10,quads:!0}),h,null,e,le,ne,null,r,i,ie,he,n,re,null,ge,m,null,me,f,_e,null,oe,se,ue,pe,null,_,g].forEach((e,n)=>{if(!e){t%6&&(t+=6-t%6);return}let r=new y(void 0,`uint16`),i=r.Primitive=e(),s=new p(r,Te);s.SetRenderPipeline(I),N[1]=s.Material.ColorBuffer,n<3?n!==1&&s.Geometry.CreateEdgeBuffer(I,4):(s.SetRenderPipeline(F,Q.slice(-3)),r.AddNormalBuffer(F,i.normals,`baseVertex`),r.AddUVBuffer(F,i.uvs,`baseVertex`)),s.Position=[t%6*o-a*o,0,~~(t++/6)*o],x.Add(s)}),x.Position[2]=x.Children.at(-1).Position[2]/-2,a*-o}function ke(e){let t=e*.2,n=(t|0)%2*2-1;D.mulScalar(we,n,O);let r=Math.sin(t*8)*2.4,i=(e-b)*1.8;k+=i*O[0],A+=i*O[1],c.Position[0]=k-r*-Math.SQRT1_2,c.Position[2]=A+r*Math.SQRT1_2,D.mulScalar(L,n,O),j+=i*O[0]*.8,M+=i*O[1]*.8,l.Position[0]=j+r*-Math.SQRT1_2,l.Position[2]=M+r*Math.SQRT1_2,W.position.set(P.Position),K.position.set(l.Position),J.position.set(c.Position),F.WriteBuffer(G,W.position),F.WriteBuffer(q,K.position.buffer),F.WriteBuffer(Y,J.position.buffer)}function Ae(e){let t=new ve([0,-1,-1]);c=new ye([k=-e,1,A=0]),l=new be([j=e,1,M=0]);let n=o.DegreesToRadians(15),r=o.DegreesToRadians(30);t.Intensity=.2,l.Limit=[n,r],c.Intensity=2048,l.Intensity=1024,X.intensity.set([t.Intensity]),X.direction.set(t.Direction),J.intensity.set([c.Intensity]),K.direction.set(l.LookAt([-1,-.5,-1])),K.intensity.set([l.Intensity]),K.limit.set(l.Limit),F.WriteBuffer(Z,X.direction.buffer)}function je(){x.Traverse(e=>e.Destroy?.()),cancelAnimationFrame(S),x.Children.splice(0)}function Me(){v=Date.now(),Ae(Oe()),S=requestAnimationFrame($),Q.length===3&&(Q=N.concat(Q))}function $(){let e=(Date.now()-v)*5e-4,t=(Math.sin(e)+1)*.5,n=0;ke(e),H.set([(e|0)%5]),F.WriteBuffer(U,H),P.Position=[-t*12+4,t*2+2,8],x.Traverse(e=>{n++<4||(Q[0]=N[0]=e.ProjectionBuffer,H[0]||(e.Pipeline=F,e.BindGroups=F.SetBindGroups([F.CreateBindGroup(F.CreateBindGroupEntries(Q)),F.CreateBindGroup(F.CreateBindGroupEntries(De),1)]),e.Geometry.CreateIndexBuffer(F,e.Geometry.Primitive.cells)),H[0]===4&&(e.Pipeline=I,e.Geometry.CreateEdgeBuffer(I),e.BindGroups=I.SetBindGroupFromResources(N)))}),b=e,P.LookAt(Ce),C.Render(E),S=requestAnimationFrame($)}T=new ResizeObserver(e=>{for(let t of e){let{inlineSize:e,blockSize:n}=t.contentBoxSize[0];e=e<=960&&e||e-Math.max(e*.15,240),C.SetCanvasSize(e,n),C.MultisampleTexture=R.CreateMultisampleTexture(),P.AspectRatio=C.AspectRatio,P.UpdateViewProjectionMatrix()}je(),Me()}),T.observe(document.body)}function O(){d.OnLost=()=>void 0,cancelAnimationFrame(S),T.disconnect(),C.Destroy(),E.Destroy(),d.Destroy(void 0,w)}export{O as destroy,D as run};