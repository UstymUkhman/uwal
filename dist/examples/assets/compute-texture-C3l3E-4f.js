import{m as e,y as t}from"./lib-cC2LiaUE.js";var n=`struct Uniforms{time: f32,mouse: vec2f};const PI=radians(180);override DIMENSION_SIZE=8u;fn FillMask(distance: f32)->f32{return clamp(-distance,0,1);}fn Outline(distance: f32,width: f32)->f32{return clamp(distance+width,0,1)-clamp(distance,0,1);}fn CircleDistance(coord: vec2f,radius: f32)->f32{return length(coord)-radius;}fn SceneDistance(size: vec2f,coord: vec2f)->f32{let radius=min(size.x,size.y)/16;return CircleDistance(coord-size/2,radius);}fn Luminance(color: ptr<function,vec4f>,amount: f32){let luminance=amount/dot((*color).rgb,vec3f(0.2126,0.7152,0.0722));*color=*color*luminance;}fn Shadow(size: vec2f,coord: vec2f,position: vec2f,radius: f32)->f32{let lightDistance=length(coord-position);let direction=normalize(position-coord);var visibleLight=lightDistance*radius;var distance=0.01;for(var i=0;i<64;i++){let sceneDistance=SceneDistance(size,coord+direction*distance);if(sceneDistance<-radius){return 0;}visibleLight=min(visibleLight,sceneDistance/distance);distance+=max(1,abs(sceneDistance));if(distance>lightDistance){break;}}visibleLight=(visibleLight*lightDistance+radius)/(radius*2);visibleLight=clamp(visibleLight,0,1);visibleLight=smoothstep(0,1,visibleLight);return visibleLight;}fn AmbientOcclusion(size: vec2f,coord: vec2f,radius: f32,intensity: f32)->f32{let quarterRadius=radius/4;var distance=SceneDistance(size,coord);distance+=SceneDistance(size,coord+vec2f(0,quarterRadius));distance+=SceneDistance(size,coord+vec2f(0,-quarterRadius));distance+=SceneDistance(size,coord+vec2f(quarterRadius,0));distance+=SceneDistance(size,coord+vec2f(-quarterRadius,0));return 1-(pow(abs(clamp(distance/radius/5,0,1)- 1),5)+1)*intensity+(1 - intensity);}fn Light(size: vec2f,coord: vec2f,position: vec2f,color: vec4f,range: f32,radius: f32)->vec4f{let distance=coord-position;let lightDistance=length(distance);if(lightDistance>range){return vec4f(0);}let shadow=Shadow(size,coord,position,radius);let falloff=(range-lightDistance)/range;let source=FillMask(CircleDistance(distance,radius));return(shadow*falloff*falloff+source)*color;}@group(0)@binding(1)var<uniform>uniforms: Uniforms;@compute @workgroup_size(DIMENSION_SIZE,DIMENSION_SIZE)fn compute(@builtin(global_invocation_id)globalInvocation: vec3u){let size=vec2f(textureDimensions(texture));let coord=vec2f(globalInvocation.xy)+0.5;var color=vec4f(vec3f(0.5),1)*(1-length(size/2 - coord)/size.x);color*=clamp(min(coord.y % 10,coord.x % 10),0.9,1);color*=AmbientOcclusion(size,coord,40,0.4);var userLightColor=vec4f(0.75,1,0.5,1);Luminance(&userLightColor,0.4);let lightOffset=size.y/5;let firstLightPosition=vec2f(size.x*(sin(uniforms.time)+1.2)/2.4,size.y-lightOffset);var firstLightColor=vec4f(0.5,0.75,1,1);Luminance(&firstLightColor,0.6);let secondLightPosition=vec2f(size.x*(sin(uniforms.time+PI)+1.2)/2.4,lightOffset);var secondLightColor=vec4f(1,0.75,0.5,1);Luminance(&secondLightColor,0.5);color+=Light(size,coord,uniforms.mouse,userLightColor,150,8);color+=Light(size,coord,firstLightPosition,firstLightColor,300,15);color+=Light(size,coord,secondLightPosition,secondLightColor,200,12);let distance=SceneDistance(size,coord);color=mix(color,vec4f(1,0.4,0,1),FillMask(distance));color=mix(color,vec4f(vec3f(0.1),1),Outline(distance,2));textureStore(texture,globalInvocation.xy,color);}`,r=`@group(0)@binding(0)var Sampler: sampler;@group(0)@binding(1)var Texture: texture_2d<f32>;struct VertexOutput{@location(0)coord: vec2f,@builtin(position)position: vec4f};@vertex fn vertex(@builtin(vertex_index)index: u32)->VertexOutput {let coord=GetFullTriCoord(index);return VertexOutput(GetFullTexCoord(coord),vec4f(coord,0,1));}@fragment fn fragment(@location(0)coord: vec2f)->@location(0)vec4f {return textureSample(Texture,Sampler,coord);}`,i,a,o,s,c,l,u,d;async function f(f){try{s=new(await(e.Computation(`Compute Texture`))),a=new(await(e.Renderer(f,`Compute Texture`)))}catch(e){alert(e)}let p=new(await(e.Texture(a)));f.removeEventListener(`mouseenter`,g),f.removeEventListener(`touchstart`,g),f.removeEventListener(`mousemove`,g),f.removeEventListener(`touchmove`,g),f.removeEventListener(`mouseleave`,_),f.removeEventListener(`touchend`,_);async function m(){let e=p.PreferredStorageFormat;l=p.CreateStorageTexture();let t=`texture_storage_2d<${e}, write>;`;d=await s.CreatePipeline({shader:[`@group(0) @binding(0) var texture: ${t}`,n],constants:{DIMENSION_SIZE:8}}),o=d.CreateUniformBuffer(`uniforms`),d.SetBindGroupFromResources([l,o.buffer]),s.Workgroups=a.CanvasSize.map(e=>e/8),o.uniforms.mouse.fill(1/0),f.addEventListener(`mouseenter`,g),f.addEventListener(`touchstart`,g),f.addEventListener(`mousemove`,g),f.addEventListener(`touchmove`,g),f.addEventListener(`mouseleave`,_),f.addEventListener(`touchend`,_)}async function h(){u=await a.CreatePipeline([t,r]),u.SetBindGroupFromResources([p.CreateSampler(),l]),u.SetDrawParams(3)}function g(e){let{DevicePixelRatio:t}=a,n=e.touches?.[0].clientX??e.offsetX,r=e.touches?.[0].clientY??e.offsetY;o.uniforms.mouse[0]=n*t,o.uniforms.mouse[1]=(f.offsetHeight-r)*t}function _(){o.uniforms.mouse.fill(1/0)}function v(){cancelAnimationFrame(i),o?.buffer.destroy()}function y(){if(d)return l.destroy(),l=p.CreateStorageTexture(),o=d.CreateUniformBuffer(`uniforms`),d.SetBindGroupFromResources([l,o.buffer]),u.SetBindGroupFromResources([p.CreateSampler(),l]),s.Workgroups=a.CanvasSize.map(e=>e/8),~o.uniforms.mouse.fill(1/0)&&b();m().then(e=>h(e).then(b))}function b(e){i=requestAnimationFrame(b),o.uniforms.time[0]=e*.001,d.WriteBuffer(o.buffer,o.uniforms.time.buffer),s.Compute(),a.Render()}c=new ResizeObserver(e=>{for(let t of e){let{inlineSize:e,blockSize:n}=t.contentBoxSize[0];e=e<=960&&e||e-Math.max(e*.15,240),a.SetCanvasSize(e,n)}v(),y()}),c.observe(document.body)}function p(){d=d?.Destroy(),u=u?.Destroy(),e.OnLost=()=>void 0,cancelAnimationFrame(i),c.disconnect(),s.Destroy(),a.Destroy(),e.Destroy(o.buffer,l)}export{p as destroy,f as run};