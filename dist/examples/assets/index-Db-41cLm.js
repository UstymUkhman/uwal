import{B as I,T as B,E as R,D as A,a as U,G as W,C as N,M as D}from"./index-BRWgv0CZ.js";import{P as V}from"./PerspectiveCamera-Bu4jQUSw.js";import"./Node-BwerG3u1.js";var z="const VERTEX=array(vec2f(0,-1),vec2f(1,-1),vec2f(0,0),vec2f(1,0));struct char{coords: vec2f,extent: vec2f,size : vec2f,offset: vec2f};struct text{alpha: f32,scale: f32,color: vec4f,transform: mat4x4f,chars: array<vec3f>};struct camera{view: mat4x4f,projection: mat4x4f};struct MSDFTextVertexOutput{@location(0)textureCoord: vec2f,@builtin(position)position: vec4f};@group(0)@binding(0)var Sampler: sampler;@group(0)@binding(1)var Texture: texture_2d<f32>;@group(0)@binding(2)var<storage>Characters: array<char>;@group(0)@binding(3)var<uniform>Camera: camera;@group(1)@binding(0)var<storage>Text: text;@vertex fn vertex(@builtin(vertex_index)index: u32,@builtin(instance_index)instance: u32)->MSDFTextVertexOutput{var output: MSDFTextVertexOutput;let vertexPosition=VERTEX[index];let textElement=Text.chars[instance];let character=Characters[u32(textElement.z)];output.textureCoord=vertexPosition*vec2f(1,-1);let characterPosition=(vertexPosition*character.size+textElement.xy+character.offset)*Text.scale;output.position=Camera.projection*Camera.view*Text.transform*vec4f(characterPosition,0,1);output.textureCoord*=character.extent;output.textureCoord+=character.coords;return output;}fn SampleMSDFTexture(coord: vec2f)->f32{let c=textureSample(Texture,Sampler,coord);return max(min(c.r,c.g),min(max(c.r,c.g),c.b));}@fragment fn fragment(@location(0)textureCoord: vec2f)->@location(0)vec4f {let signDistance=SampleMSDFTexture(textureCoord)-0.5;let dimensions=vec2f(textureDimensions(Texture,0));let dpdx=dpdxFine(textureCoord);let dpdy=dpdyFine(textureCoord);let x=length(vec2f(dpdx.x,dpdy.x));let y=length(vec2f(dpdx.y,dpdy.y));let dx=dimensions.x*x;let dy=dimensions.y*y;let px=inverseSqrt(dx*dx+dy*dy)*4;let pxDistance=signDistance*px;let a=smoothstep(Text.alpha,-Text.alpha,pxDistance);if(a<0.001){discard;}return vec4f(Text.color.rgb,Text.color.a*a);}";class X{#i;#t;#h;#e;constructor(e,t){if(this.#h=t.get(63)??t.entries().next().value[1],this.#e=e.common.lineHeight,this.#t=t,!!e.kernings){this.#i=new Map;for(const f of e.kernings){let n=this.#i.get(f.first);n||(n=new Map,this.#i.set(f.first,n)),n.set(f.second,f.amount)}}}GetCharacter(e){return this.#t.get(e)??this.#h}GetXAdvance(e,t=-1){const f=this.GetCharacter(e);if(t>-1){const n=this.#i.get(e);if(n)return f.xadvance+(n.get(t)??0)}return f.xadvance}get LineHeight(){return this.#e}}class j{#i;#t;#h;#e;#n;#f;#r;#s;#d;#a=new Float32Array(8);constructor(e="MSDFText"){this.#i=e}CreateRenderPipeline(e){this.#t=e,this.#e=new this.#t.Pipeline;const t=this.#e.CreateShaderModule(z),f=GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT;return this.#s=this.#e.CreateBindGroupLayout([this.#t.CreateSamplerBindingLayout(),this.#t.CreateTextureBindingLayout(),this.#t.CreateBufferBindingLayout("read-only-storage",!1,0,GPUShaderStage.VERTEX),this.#t.CreateBufferBindingLayout(void 0,!1,0,GPUShaderStage.VERTEX)]),this.#d=this.#e.CreateBindGroupLayout(this.#t.CreateBufferBindingLayout("read-only-storage",!1,0,f)),this.#t.AddPipeline(this.#e,{layout:this.#e.CreatePipelineLayout([this.#s,this.#d]),primitive:this.#e.CreatePrimitiveState("triangle-strip",void 0,"uint32"),depthStencil:this.#e.CreateDepthStencilState(void 0,!1),vertex:this.#e.CreateVertexState(t),fragment:this.#e.CreateFragmentState(t,this.#e.CreateColorTargetState(I.ALPHA_ADDITIVE))})}async#c(e){return this.#r.CopyImageToTexture(await this.#r.CreateImageBitmap(e),{mipmaps:!1,create:{label:`${this.#i} Font Texture`}})}#o(e,t,f){let n=0,C=0,a=e.charCodeAt(0);const i=[0,0],r=[],{LineHeight:s}=t;for(let d=0,h=0,u=a,v=e.length,l=v-1;d<v;u=a,++d)switch(a=d<l&&e.charCodeAt(d+1)||-1,u){case 10:case 13:n=Math.max(n,i[0]),r.push(i[0]),i[1]-=s,i[0]=0,h++;break;case 32:i[0]+=t.GetXAdvance(u);break;default:f?.(i,h,t.GetCharacter(u).c),i[0]+=t.GetXAdvance(u,a),C++}r.push(i[0]),n=Math.max(n,i[0]);const p=s*r.length;return{lineWidths:r,instances:C,height:p,width:n}}async LoadFont(e,t=!1,f){!this.#e&&B(R.PIPELINE_NOT_FOUND,"RenderPipeline.\n            Call `MSDFText.CreateRenderPipeline` method before loading a font file."),this.#h=t;const n=e.lastIndexOf("/")+1;this.#r=new(await A.Texture());const C=n&&e.substring(0,n)||"",a=await(await fetch(e,f)).json(),i=a.pages.map(v=>this.#c(C+v)),{buffer:r}=this.#e.CreateStorageBuffer("Characters",{label:`${this.#i} Characters Buffer`,length:a.chars.length,mappedAtCreation:!0});this.#n=this.#e.CreateUniformBuffer("Camera",{label:`${this.#i} Camera Buffer`}).buffer;const s=new Map,p=1/a.common.scaleW,d=1/a.common.scaleH,h=new Float32Array(r.getMappedRange());for(let v=0,l=0,w=a.chars.length;v<w;l+=8,++v){const c=a.chars[v];h[l+0]=c.x*p,h[l+1]=c.y*d,h[l+2]=c.width*p,h[l+3]=c.height*d,h[l+4]=c.width,h[l+5]=c.height,h[l+6]=c.xoffset,h[l+7]=-c.yoffset,s.set(c.id,Object.assign({c:v},c))}const u=this.#r.CreateSampler({label:`${this.#i} Sampler`,maxAnisotropy:16,filter:"linear"});return r.unmap(),this.#f=await Promise.all(i),this.#e.SetBindGroupFromResources([u,this.#f[0].createView(),r,this.#n],0,this.#s),new X(a,s)}Write(e,t,f=0,n=.01,C=!1){!this.#e&&B(R.PIPELINE_NOT_FOUND,"RenderPipeline.\n            Call `MSDFText.CreateRenderPipeline` method before writing a string.");const a=this.#e.CreateStorageBuffer("Text",{label:`${this.#i} Storage Buffer`,size:e.length*16+96,mappedAtCreation:!0}).buffer,i=new Float32Array(a.getMappedRange());let r=24,s;return C?(s=this.#o(e,t),this.#o(e,t,([p,d],h,u)=>{const{lineWidths:v,width:l,height:w}=s,c=l*-.5-(l-v[h])*-.5;i[r+0]=p+c,i[r+1]=d+w*.5,i[r+2]=u,r+=4})):s=this.#o(e,t,([p,d],h,u)=>{i[r+0]=p,i[r+1]=d,i[r+2]=u,r+=4}),a.unmap(),this.#e.BindGroups.length===1?this.#e.AddBindGroupFromResources(a,0,this.#d):this.#e.BindGroups[1].bindGroup=this.#e.CreateBindGroup(this.#e.CreateBindGroupEntries(a),this.#d),this.#e.SetDrawParams(4,s.instances),this.#e.EncodeRenderBundle(this.#t.CreateRenderBundleEncoder()),this.#a.set([-this.#h+.5,n]),this.#e.WriteBuffer(a,this.#a,0,0,2),this.SetColor(f,a),a}SetTransform(e,t){!this.#e&&B(R.PIPELINE_NOT_FOUND,"RenderPipeline.\n            Call `MSDFText.CreateRenderPipeline` method before setting transform matrix."),this.#e.WriteBuffer(t,e,32,0,16)}SetColor(e,t){!this.#e&&B(R.PIPELINE_NOT_FOUND,"RenderPipeline.\n            Call `MSDFText.CreateRenderPipeline` method before setting text color."),this.#a.set(typeof e=="number"&&U(e)||W(e),4),this.#e.WriteBuffer(t,this.#a,16,4,4)}SetScale(e,t){!this.#e&&B(R.PIPELINE_NOT_FOUND,"RenderPipeline.\n            Call `MSDFText.CreateRenderPipeline` method before setting text scale."),this.#a[1]=e,this.#e.WriteBuffer(t,this.#a,4,1,1)}UpdatePerspective(e){!this.#e&&B(R.PIPELINE_NOT_FOUND,"RenderPipeline.\n            Call `MSDFText.CreateRenderPipeline` method before updating projection matrix."),this.#e.WriteBuffer(this.#n,e.LocalMatrix,0),this.#e.WriteBuffer(this.#n,e.ProjectionMatrix,64)}get Pipeline(){return this.#e}Destroy(){this.#f?.forEach(e=>e?.destroy()),this.#n?.destroy(),this.#e.Destroy(),this.#r?.Destroy()}}const k=JSON.parse('[{"id":33,"index":65,"char":"!","width":19,"height":41,"xoffset":0,"yoffset":1,"xadvance":20,"chnl":15,"x":0,"y":0,"page":0},{"id":110,"index":52,"char":"n","width":20,"height":41,"xoffset":0,"yoffset":1,"xadvance":21,"chnl":15,"x":0,"y":42,"page":0},{"id":115,"index":57,"char":"s","width":21,"height":41,"xoffset":0,"yoffset":1,"xadvance":21,"chnl":15,"x":20,"y":0,"page":0},{"id":41,"index":73,"char":")","width":23,"height":40,"xoffset":0,"yoffset":1,"xadvance":23,"chnl":15,"x":0,"y":84,"page":0},{"id":47,"index":79,"char":"/","width":23,"height":40,"xoffset":0,"yoffset":1,"xadvance":24,"chnl":15,"x":21,"y":42,"page":0},{"id":112,"index":54,"char":"p","width":23,"height":40,"xoffset":0,"yoffset":1,"xadvance":24,"chnl":15,"x":42,"y":0,"page":0},{"id":114,"index":56,"char":"r","width":23,"height":40,"xoffset":0,"yoffset":1,"xadvance":24,"chnl":15,"x":0,"y":125,"page":0},{"id":116,"index":58,"char":"t","width":23,"height":40,"xoffset":0,"yoffset":1,"xadvance":23,"chnl":15,"x":0,"y":166,"page":0},{"id":38,"index":70,"char":"&","width":23,"height":39,"xoffset":0,"yoffset":2,"xadvance":23,"chnl":15,"x":0,"y":207,"page":0},{"id":63,"index":85,"char":"?","width":24,"height":39,"xoffset":0,"yoffset":2,"xadvance":24,"chnl":15,"x":0,"y":247,"page":0},{"id":93,"index":89,"char":"]","width":17,"height":39,"xoffset":0,"yoffset":2,"xadvance":17,"chnl":15,"x":24,"y":83,"page":0},{"id":109,"index":51,"char":"m","width":20,"height":39,"xoffset":0,"yoffset":2,"xadvance":20,"chnl":15,"x":24,"y":123,"page":0},{"id":113,"index":55,"char":"q","width":20,"height":39,"xoffset":0,"yoffset":1,"xadvance":20,"chnl":15,"x":42,"y":83,"page":0},{"id":118,"index":60,"char":"v","width":23,"height":39,"xoffset":0,"yoffset":2,"xadvance":24,"chnl":15,"x":45,"y":41,"page":0},{"id":34,"index":66,"char":"\\"","width":22,"height":38,"xoffset":0,"yoffset":4,"xadvance":22,"chnl":15,"x":66,"y":0,"page":0},{"id":91,"index":88,"char":"[","width":20,"height":38,"xoffset":0,"yoffset":4,"xadvance":20,"chnl":15,"x":24,"y":163,"page":0},{"id":36,"index":68,"char":"$","width":22,"height":37,"xoffset":0,"yoffset":4,"xadvance":22,"chnl":15,"x":24,"y":202,"page":0},{"id":37,"index":69,"char":"%","width":16,"height":37,"xoffset":0,"yoffset":2,"xadvance":16,"chnl":15,"x":45,"y":123,"page":0},{"id":60,"index":82,"char":"<","width":23,"height":37,"xoffset":0,"yoffset":2,"xadvance":24,"chnl":15,"x":45,"y":161,"page":0},{"id":119,"index":61,"char":"w","width":23,"height":37,"xoffset":0,"yoffset":2,"xadvance":23,"chnl":15,"x":62,"y":123,"page":0},{"id":35,"index":67,"char":"#","width":22,"height":36,"xoffset":0,"yoffset":5,"xadvance":22,"chnl":15,"x":63,"y":81,"page":0},{"id":59,"index":81,"char":";","width":18,"height":36,"xoffset":0,"yoffset":4,"xadvance":18,"chnl":15,"x":69,"y":39,"page":0},{"id":61,"index":83,"char":"=","width":19,"height":36,"xoffset":0,"yoffset":3,"xadvance":19,"chnl":15,"x":0,"y":287,"page":0},{"id":97,"index":39,"char":"a","width":20,"height":36,"xoffset":0,"yoffset":4,"xadvance":20,"chnl":15,"x":0,"y":324,"page":0},{"id":108,"index":50,"char":"l","width":22,"height":36,"xoffset":0,"yoffset":5,"xadvance":22,"chnl":15,"x":20,"y":287,"page":0},{"id":121,"index":63,"char":"y","width":22,"height":36,"xoffset":0,"yoffset":3,"xadvance":22,"chnl":15,"x":25,"y":240,"page":0},{"id":122,"index":64,"char":"z","width":20,"height":36,"xoffset":0,"yoffset":5,"xadvance":20,"chnl":15,"x":47,"y":199,"page":0},{"id":123,"index":90,"char":"{","width":24,"height":36,"xoffset":0,"yoffset":4,"xadvance":24,"chnl":15,"x":0,"y":361,"page":0},{"id":42,"index":74,"char":"*","width":19,"height":35,"xoffset":0,"yoffset":3,"xadvance":19,"chnl":15,"x":21,"y":324,"page":0},{"id":125,"index":91,"char":"}","width":20,"height":35,"xoffset":0,"yoffset":5,"xadvance":20,"chnl":15,"x":0,"y":398,"page":0},{"id":126,"index":93,"char":"~","width":20,"height":35,"xoffset":0,"yoffset":5,"xadvance":20,"chnl":15,"x":0,"y":434,"page":0},{"id":40,"index":72,"char":"(","width":21,"height":34,"xoffset":0,"yoffset":5,"xadvance":21,"chnl":15,"x":0,"y":470,"page":0},{"id":44,"index":76,"char":",","width":18,"height":34,"xoffset":0,"yoffset":4,"xadvance":18,"chnl":15,"x":21,"y":398,"page":0},{"id":92,"index":87,"char":"\\\\","width":18,"height":34,"xoffset":0,"yoffset":5,"xadvance":18,"chnl":15,"x":21,"y":433,"page":0},{"id":100,"index":42,"char":"d","width":19,"height":34,"xoffset":0,"yoffset":8,"xadvance":19,"chnl":15,"x":25,"y":360,"page":0},{"id":102,"index":44,"char":"f","width":20,"height":34,"xoffset":0,"yoffset":8,"xadvance":20,"chnl":15,"x":41,"y":324,"page":0},{"id":107,"index":94,"char":"k","width":21,"height":34,"xoffset":0,"yoffset":5,"xadvance":22,"chnl":15,"x":22,"y":468,"page":0},{"id":120,"index":62,"char":"x","width":23,"height":34,"xoffset":0,"yoffset":5,"xadvance":23,"chnl":15,"x":43,"y":277,"page":0},{"id":45,"index":77,"char":"-","width":20,"height":33,"xoffset":0,"yoffset":6,"xadvance":21,"chnl":15,"x":48,"y":236,"page":0},{"id":99,"index":41,"char":"c","width":18,"height":33,"xoffset":0,"yoffset":9,"xadvance":18,"chnl":15,"x":68,"y":199,"page":0},{"id":103,"index":45,"char":"g","width":21,"height":33,"xoffset":0,"yoffset":8,"xadvance":21,"chnl":15,"x":69,"y":161,"page":0},{"id":58,"index":80,"char":":","width":22,"height":32,"xoffset":0,"yoffset":7,"xadvance":22,"chnl":15,"x":40,"y":395,"page":0},{"id":62,"index":84,"char":">","width":22,"height":32,"xoffset":0,"yoffset":6,"xadvance":22,"chnl":15,"x":45,"y":359,"page":0},{"id":48,"index":95,"char":"0","width":22,"height":31,"xoffset":0,"yoffset":7,"xadvance":22,"chnl":15,"x":40,"y":428,"page":0},{"id":50,"index":5,"char":"2","width":20,"height":31,"xoffset":0,"yoffset":7,"xadvance":20,"chnl":15,"x":62,"y":312,"page":0},{"id":51,"index":6,"char":"3","width":21,"height":31,"xoffset":0,"yoffset":8,"xadvance":21,"chnl":15,"x":67,"y":270,"page":0},{"id":52,"index":7,"char":"4","width":18,"height":31,"xoffset":0,"yoffset":7,"xadvance":18,"chnl":15,"x":69,"y":233,"page":0},{"id":53,"index":8,"char":"5","width":19,"height":31,"xoffset":0,"yoffset":8,"xadvance":19,"chnl":15,"x":87,"y":195,"page":0},{"id":54,"index":9,"char":"6","width":22,"height":31,"xoffset":0,"yoffset":7,"xadvance":22,"chnl":15,"x":88,"y":227,"page":0},{"id":56,"index":11,"char":"8","width":22,"height":31,"xoffset":0,"yoffset":7,"xadvance":22,"chnl":15,"x":44,"y":460,"page":0},{"id":57,"index":12,"char":"9","width":22,"height":31,"xoffset":0,"yoffset":7,"xadvance":22,"chnl":15,"x":63,"y":392,"page":0},{"id":49,"index":4,"char":"1","width":14,"height":30,"xoffset":0,"yoffset":8,"xadvance":14,"chnl":15,"x":63,"y":424,"page":0},{"id":55,"index":10,"char":"7","width":21,"height":30,"xoffset":0,"yoffset":8,"xadvance":21,"chnl":15,"x":68,"y":344,"page":0},{"id":98,"index":40,"char":"b","width":19,"height":30,"xoffset":0,"yoffset":11,"xadvance":19,"chnl":15,"x":83,"y":302,"page":0},{"id":106,"index":48,"char":"j","width":19,"height":30,"xoffset":0,"yoffset":11,"xadvance":19,"chnl":15,"x":89,"y":259,"page":0},{"id":124,"index":92,"char":"|","width":19,"height":30,"xoffset":0,"yoffset":6,"xadvance":19,"chnl":15,"x":67,"y":455,"page":0},{"id":43,"index":75,"char":"+","width":24,"height":29,"xoffset":0,"yoffset":8,"xadvance":24,"chnl":15,"x":78,"y":424,"page":0},{"id":65,"index":13,"char":"A","width":22,"height":29,"xoffset":0,"yoffset":9,"xadvance":22,"chnl":15,"x":86,"y":375,"page":0},{"id":67,"index":15,"char":"C","width":19,"height":29,"xoffset":0,"yoffset":9,"xadvance":19,"chnl":15,"x":90,"y":333,"page":0},{"id":71,"index":19,"char":"G","width":21,"height":29,"xoffset":0,"yoffset":9,"xadvance":21,"chnl":15,"x":103,"y":290,"page":0},{"id":74,"index":22,"char":"J","width":16,"height":29,"xoffset":0,"yoffset":10,"xadvance":17,"chnl":15,"x":109,"y":259,"page":0},{"id":79,"index":27,"char":"O","width":21,"height":29,"xoffset":0,"yoffset":9,"xadvance":22,"chnl":15,"x":87,"y":454,"page":0},{"id":81,"index":29,"char":"Q","width":23,"height":29,"xoffset":0,"yoffset":9,"xadvance":23,"chnl":15,"x":103,"y":405,"page":0},{"id":83,"index":31,"char":"S","width":19,"height":29,"xoffset":0,"yoffset":9,"xadvance":20,"chnl":15,"x":109,"y":363,"page":0},{"id":85,"index":33,"char":"U","width":20,"height":29,"xoffset":0,"yoffset":10,"xadvance":21,"chnl":15,"x":110,"y":320,"page":0},{"id":117,"index":59,"char":"u","width":19,"height":29,"xoffset":0,"yoffset":9,"xadvance":19,"chnl":15,"x":125,"y":289,"page":0},{"id":66,"index":14,"char":"B","width":22,"height":28,"xoffset":0,"yoffset":10,"xadvance":22,"chnl":15,"x":87,"y":484,"page":0},{"id":68,"index":16,"char":"D","width":19,"height":28,"xoffset":0,"yoffset":10,"xadvance":19,"chnl":15,"x":109,"y":435,"page":0},{"id":69,"index":17,"char":"E","width":19,"height":28,"xoffset":0,"yoffset":10,"xadvance":19,"chnl":15,"x":127,"y":393,"page":0},{"id":70,"index":18,"char":"F","width":17,"height":28,"xoffset":0,"yoffset":10,"xadvance":17,"chnl":15,"x":129,"y":350,"page":0},{"id":72,"index":20,"char":"H","width":19,"height":28,"xoffset":0,"yoffset":10,"xadvance":20,"chnl":15,"x":131,"y":319,"page":0},{"id":73,"index":21,"char":"I","width":16,"height":28,"xoffset":0,"yoffset":10,"xadvance":17,"chnl":15,"x":110,"y":464,"page":0},{"id":75,"index":23,"char":"K","width":23,"height":28,"xoffset":0,"yoffset":10,"xadvance":23,"chnl":15,"x":127,"y":464,"page":0},{"id":76,"index":24,"char":"L","width":20,"height":28,"xoffset":0,"yoffset":10,"xadvance":20,"chnl":15,"x":129,"y":422,"page":0},{"id":77,"index":25,"char":"M","width":21,"height":28,"xoffset":0,"yoffset":10,"xadvance":22,"chnl":15,"x":147,"y":348,"page":0},{"id":78,"index":26,"char":"N","width":20,"height":28,"xoffset":0,"yoffset":10,"xadvance":20,"chnl":15,"x":147,"y":377,"page":0},{"id":80,"index":28,"char":"P","width":21,"height":28,"xoffset":0,"yoffset":10,"xadvance":21,"chnl":15,"x":150,"y":406,"page":0},{"id":82,"index":30,"char":"R","width":20,"height":28,"xoffset":0,"yoffset":10,"xadvance":21,"chnl":15,"x":168,"y":377,"page":0},{"id":84,"index":32,"char":"T","width":20,"height":28,"xoffset":0,"yoffset":10,"xadvance":21,"chnl":15,"x":150,"y":435,"page":0},{"id":86,"index":34,"char":"V","width":23,"height":28,"xoffset":0,"yoffset":10,"xadvance":23,"chnl":15,"x":151,"y":464,"page":0},{"id":87,"index":35,"char":"W","width":21,"height":28,"xoffset":0,"yoffset":10,"xadvance":22,"chnl":15,"x":171,"y":435,"page":0},{"id":88,"index":36,"char":"X","width":22,"height":28,"xoffset":0,"yoffset":10,"xadvance":22,"chnl":15,"x":172,"y":406,"page":0},{"id":89,"index":37,"char":"Y","width":22,"height":28,"xoffset":0,"yoffset":10,"xadvance":22,"chnl":15,"x":175,"y":464,"page":0},{"id":90,"index":38,"char":"Z","width":19,"height":28,"xoffset":0,"yoffset":10,"xadvance":19,"chnl":15,"x":193,"y":435,"page":0},{"id":105,"index":47,"char":"i","width":16,"height":28,"xoffset":0,"yoffset":11,"xadvance":16,"chnl":15,"x":198,"y":464,"page":0},{"id":111,"index":53,"char":"o","width":22,"height":27,"xoffset":0,"yoffset":7,"xadvance":22,"chnl":15,"x":86,"y":76,"page":0},{"id":39,"index":71,"char":"\'","width":22,"height":26,"xoffset":0,"yoffset":8,"xadvance":22,"chnl":15,"x":88,"y":39,"page":0},{"id":94,"index":86,"char":"^","width":23,"height":26,"xoffset":0,"yoffset":9,"xadvance":23,"chnl":15,"x":89,"y":0,"page":0},{"id":46,"index":78,"char":".","width":24,"height":25,"xoffset":0,"yoffset":8,"xadvance":24,"chnl":15,"x":86,"y":104,"page":0},{"id":101,"index":43,"char":"e","width":18,"height":23,"xoffset":0,"yoffset":13,"xadvance":19,"chnl":15,"x":67,"y":486,"page":0},{"id":104,"index":46,"char":"h","width":20,"height":23,"xoffset":0,"yoffset":14,"xadvance":20,"chnl":15,"x":86,"y":130,"page":0},{"id":95,"index":49,"char":"_","width":22,"height":7,"xoffset":0,"yoffset":17,"xadvance":22,"chnl":15,"x":0,"y":505,"page":0},{"id":32,"index":3,"char":" ","width":0,"height":0,"xoffset":-2,"yoffset":34,"xadvance":21,"chnl":15,"x":21,"y":83,"page":0},{"id":64,"index":0,"char":"@","width":0,"height":0,"xoffset":-2,"yoffset":34,"xadvance":21,"chnl":15,"x":42,"y":41,"page":0},{"id":96,"index":0,"char":"`","width":0,"height":0,"xoffset":-2,"yoffset":34,"xadvance":21,"chnl":15,"x":24,"y":240,"page":0}]'),H={chars:k},Y=""+new URL("Matrix-Code-NFI-BvPxQt03.json",import.meta.url).href;/**
 * @example MSDF Text
 * @author Ustym Ukhman <ustym.ukhman@gmail.com>
 * @description This example is developed by using a version listed below.
 * Please note that this code may be simplified in future
 * thanks to more recent library APIs.
 * @version 0.2.0
 * @license MIT
 */const L=new j,F=[];let G,m,M;async function J(o){try{m=new(await A.Renderer(o,"MSDF Text"))}catch(y){alert(y)}const e=new N(3028032),t=new V;m.CreatePassDescriptor(m.CreateColorAttachment(e),m.CreateDepthStencilAttachment());const f=await L.CreateRenderPipeline(m),n=await L.LoadFont(Y,!0);let C=Float32Array.BYTES_PER_ELEMENT*6+2;const a=Float32Array.BYTES_PER_ELEMENT*4;C*=Float32Array.BYTES_PER_ELEMENT,o.removeEventListener("mouseenter",w),o.removeEventListener("touchstart",w),o.removeEventListener("mousemove",w),o.removeEventListener("touchmove",w),o.removeEventListener("mouseleave",c),o.removeEventListener("touchend",c),o.addEventListener("mouseenter",w),o.addEventListener("touchstart",w),o.addEventListener("mousemove",w),o.addEventListener("touchmove",w),o.addEventListener("mouseleave",c),o.addEventListener("touchend",c);const i={x:-1,y:-1},r=new N(8962256),s=new Float32Array(5);let p=0,d=0;const h=[];function u(){F.forEach(y=>y.destroy()),f.ClearRenderBundles(),cancelAnimationFrame(M),F.splice(0),h.splice(0)}function v(){l(),s.set([1,...r.rgba]),M=requestAnimationFrame(O),L.UpdatePerspective(t)}function l(){const[y,g]=m.BaseCanvasSize,E=H.chars.map(({id:x})=>x);p=Math.ceil(g/40);const T=y/24;d=Math.ceil(T),e.Set(6193580,64);let P=T/8;if(g<=880){let x=g/40;x=23-x|0,d+=x-1,P+=x/10,p+=x}for(let x=0,b=p*d;x<b;++x){const S=x%d,_=x/d|0;h.push(D.RandomInt(1,240)),F.push(L.Write(String.fromCharCode(E[D.RandomInt(0,90)]),n,e)),L.SetTransform(D.Mat4.translation([-P+S*.25,4.65-_*.4,-8]),F[x])}}function w(y){i&&(i.x=(y.touches?.[0].clientX??y.offsetX)/o.offsetWidth,i.y=(y.touches?.[0].clientY??y.offsetY)/o.offsetHeight,i.x+=(.5-i.x)*.05,i.y-=i.y*.06)}function c(){i.x=i.y=-1}function O(){m.Render();const{AspectRatio:y}=m;M=requestAnimationFrame(O);for(let g=0,E=h.length;g<E;++g){const T=(i.x-g%d/d)*y,P=i.y-(g/d|0)/p;let x=120,b=240,S=T*T+P*P;s.set(e.rgba,1),S<.04&&(s.set(r.rgb,1),S=(.04-S)*25,h[g]-=S*h[g]-1|0,x-=S*(x*.5)|0,b-=S*(b*.5)|0,s[4]=D.SmoothStep(S)+.1),--h[g]||(s[0]=D.RandomInt(0,90),h[g]=D.RandomInt(x,b),f.WriteBuffer(F[g],s,C,0,1)),f.WriteBuffer(F[g],s,a,1,4)}}G=new ResizeObserver(y=>{for(const g of y){const{inlineSize:E,blockSize:T}=g.contentBoxSize[0],P=E<=960&&E||E-240;m.SetCanvasSize(P,T),t.AspectRatio=m.AspectRatio,t.UpdateViewProjectionMatrix()}u(),v()}),G.observe(document.body)}function Q(){A.OnLost=()=>{},cancelAnimationFrame(M),G.disconnect(),L.Destroy(),m.Destroy(),A.Destroy(F)}export{Q as destroy,J as run};
