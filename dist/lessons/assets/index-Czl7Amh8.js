var Cn=Object.defineProperty;var Hs=h=>{throw TypeError(h)};var Vn=(h,t,e)=>t in h?Cn(h,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):h[t]=e;var Ie=(h,t,e)=>Vn(h,typeof t!="symbol"?t+"":t,e),Ns=(h,t,e)=>t.has(h)||Hs("Cannot "+e);var x=(h,t,e)=>(Ns(h,t,"read from private field"),e?e.call(h):t.get(h)),z=(h,t,e)=>t.has(h)?Hs("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(h):t.set(h,e),F=(h,t,e,n)=>(Ns(h,t,"write to private field"),n?n.call(h,e):t.set(h,e),e),$=(h,t,e)=>(Ns(h,t,"access private method"),e);const vn=it({RAD:Math.PI/180,DEG:180/Math.PI,HPI:Math.PI/2,TAU:Math.PI*2}),$n={CANVAS_NOT_FOUND:"CANVAS_NOT_FOUND",CONTEXT_NOT_FOUND:"CONTEXT_NOT_FOUND",SHADER_CODE_NOT_FOUND:"SHADER_CODE_NOT_FOUND",SHADER_MODULE_NOT_FOUND:"SHADER_MODULE_NOT_FOUND",VERTEX_ENTRY_NOT_FOUND:"VERTEX_ENTRY_NOT_FOUND",VERTEX_ATTRIBUTE_NOT_FOUND:"VERTEX_ATTRIBUTE_NOT_FOUND",RENDER_PASS_NOT_FOUND:"RENDER_PASS_NOT_FOUND",STORAGE_NOT_FOUND:"STORAGE_NOT_FOUND",UNIFORM_NOT_FOUND:"UNIFORM_NOT_FOUND",INVALID_UNIFORM_NAME:"INVALID_UNIFORM_NAME",BINDING_NOT_FOUND:"BINDING_NOT_FOUND",PIPELINE_NOT_FOUND:"PIPELINE_NOT_FOUND",COMMAND_ENCODER_NOT_FOUND:"COMMAND_ENCODER_NOT_FOUND"},Xn={CANVAS_NOT_FOUND:"Failed to get a WebGPU canvas.",CONTEXT_NOT_FOUND:"Failed to get a WebGPU context.",SHADER_CODE_NOT_FOUND:`Failed to get a WGSL shader when creating shader module.
        An empty shader will be used instead.`,SHADER_MODULE_NOT_FOUND:"Failed to get shader module in ",VERTEX_ENTRY_NOT_FOUND:"Failed to find function ",VERTEX_ATTRIBUTE_NOT_FOUND:"Failed to find vertex attribute ",RENDER_PASS_NOT_FOUND:"Failed to use pipeline in render pass because it has not started.",STORAGE_NOT_FOUND:"Failed to find storage ",UNIFORM_NOT_FOUND:"Failed to find uniform ",INVALID_UNIFORM_NAME:"Requested uniform is already in use and managed internally: ",BINDING_NOT_FOUND:"Failed to find binding ",PIPELINE_NOT_FOUND:"Failed to get a GPU",COMMAND_ENCODER_NOT_FOUND:"Failed to get a GPUCommandEncoder."},Wn={CANVAS_NOT_FOUND:5,CONTEXT_NOT_FOUND:6,PIPELINE_NOT_FOUND:7,COMMAND_ENCODER_NOT_FOUND:8},Qn={RENDER_PIPELNE_NOT_FOUND:"RENDER_PIPELNE_NOT_FOUND",TEXTURE_SIZE_NOT_FOUND:"TEXTURE_SIZE_NOT_FOUND",TEXTURE_NOT_FOUND:"TEXTURE_NOT_FOUND",INVALID_BYTES_PER_ROW:"INVALID_BYTES_PER_ROW"},Yn={RENDER_PIPELNE_NOT_FOUND:'"UWAL.RenderPipeline" instance is required in `Texture` for this operation.\n        Pass it to the `Texture` constructor or use `Texture.Renderer` setter before ',TEXTURE_SIZE_NOT_FOUND:"`size` array or a `width` value is required in `options` parameter of ",TEXTURE_NOT_FOUND:"`options` is required to have a `texture` value or its `create` entry\n        to be either `true` or a `TextureDescriptor` object when calling ",INVALID_BYTES_PER_ROW:"`bytesPerRow` parameter is not multiple of 256 in "},Hn={FONT_TEXTURE_NOT_FOUND:"FONT_TEXTURE_NOT_FOUND"},Zn={FONT_TEXTURE_NOT_FOUND:"Failed to find a font texture in "},jn={TIMESTAMP_QUERY_NOT_FOUND:"TIMESTAMP_QUERY_NOT_FOUND"},Jn={TIMESTAMP_QUERY_NOT_FOUND:'"timestamp-query" feature is required to be set with\n        `UWAL.SetRequiredFeatures` when creating a new `GPUTiming` instance.'};it({DEVICE_LOST:"Device::Lost"});const X=it({FORMAT_NOT_SUPPORTED:"FORMAT_NOT_SUPPORTED",WEBGPU_NOT_SUPPORTED:"WEBGPU_NOT_SUPPORTED",ADAPTER_NOT_FOUND:"ADAPTER_NOT_FOUND",FEATURE_NOT_FOUND:"FEATURE_NOT_FOUND",DEVICE_NOT_FOUND:"DEVICE_NOT_FOUND",DEVICE_NOT_REQUESTED:"DEVICE_NOT_REQUESTED",DEVICE_LOST:"DEVICE_LOST",...$n,...Qn,...Hn,...jn}),Dn=it({FORMAT_NOT_SUPPORTED:"Format is not yet supported: ",WEBGPU_NOT_SUPPORTED:"WebGPU is not supported in this browser.",ADAPTER_NOT_FOUND:"Failed to get a GPUAdapter.",DEVICE_NOT_FOUND:"Failed to get a GPUDevice.",FEATURE_NOT_FOUND:"Failed to get a GPUFeature ",DEVICE_NOT_REQUESTED:"GPUDevice was not requested.",DEVICE_LOST:"WebGPU device was lost. ",...Xn,...Yn,...Zn,...Jn}),Kn=it({WEBGPU_NOT_SUPPORTED:0,ADAPTER_NOT_FOUND:1,DEVICE_NOT_FOUND:2,DEVICE_NOT_REQUESTED:3,DEVICE_LOST:4,...Wn});function ke(h,t){console.warn(`${Dn[h]}${t??""}`.replace(/\s\s+/g," "))}function K(h,t){throw new Error(`${Dn[h]}${t??""}`.replace(/\s\s+/g," "),{cause:Kn[h]})}var ge,Yt,zt,he,Le,Pe,bs,Os;class tr{constructor(t){z(this,Pe);z(this,ge);z(this,Yt);z(this,zt);z(this,he);z(this,Le,!1);F(this,he,t),je.GPUDevice.then(({features:e})=>{e.has("timestamp-query")&&(F(this,Le,!0),$(this,Pe,bs).call(this))})}async ResolveAndSubmit(){if(!x(this,Le))return $(this,Pe,Os).call(this),NaN;if(x(this,he).ResolveQuerySet(x(this,zt),x(this,ge)),x(this,Yt).mapState==="unmapped"&&x(this,he).CopyBufferToBuffer(x(this,ge),x(this,Yt)),$(this,Pe,Os).call(this),x(this,Yt).mapState!=="unmapped")return 0;await x(this,Yt).mapAsync(GPUMapMode.READ);const t=new BigInt64Array(x(this,Yt).getMappedRange()),e=Number(t[1]-t[0]);return x(this,Yt).unmap(),e}get QuerySet(){return x(this,zt)??(async()=>{if(!(await je.GPUDevice).features.has("timestamp-query"))ke(X.TIMESTAMP_QUERY_NOT_FOUND);else return await $(this,Pe,bs).call(this),x(this,zt)})()}get Enabled(){return x(this,Le)}Destroy(){var t,e,n;F(this,Le,!1),F(this,zt,(t=x(this,zt))==null?void 0:t.destroy()),F(this,Yt,(e=x(this,Yt))==null?void 0:e.destroy()),F(this,ge,(n=x(this,ge))==null?void 0:n.destroy())}}ge=new WeakMap,Yt=new WeakMap,zt=new WeakMap,he=new WeakMap,Le=new WeakMap,Pe=new WeakSet,bs=async function(){return x(this,zt)?x(this,zt):(F(this,zt,await je.CreateQuerySet("timestamp",2)),F(this,ge,x(this,he).CreateBuffer({usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC,label:"GPUTiming Resolve Buffer",size:x(this,zt).count*8})),F(this,Yt,x(this,he).CreateBuffer({label:"GPUTiming Result Buffer",size:x(this,ge).size,usage:Te.READABLE})),x(this,zt))},Os=function(){x(this,he).SubmitCommandBuffer(),x(this,he).SetCommandEncoder(void 0)};function it(h){for(let t in h)h[t]={value:h[t]};return Object.freeze(Object.create(null,h))}function er(h){return vn.RAD*h}function sr(h){return vn.DEG*h}function nr(h,t){return(h%t+t)%t}function rr(h){switch(h){case 2:return"unorm8x2";case 4:return"float32";case 8:return"float32x2";case 12:return"float32x3";case 16:return"float32x4"}}function ir(h){switch(h){case"uint8x2":case"sint8x2":case"unorm8x2":case"snorm8x2":return 2;case"uint32":case"sint32":case"float32":case"uint8x4":case"sint8x4":case"unorm8x4":case"snorm8x4":case"uint16x2":case"sint16x2":case"unorm16x2":case"snorm16x2":case"float16x2":return 4;case"uint16x4":case"sint16x4":case"uint32x2":case"sint32x2":case"unorm16x4":case"snorm16x4":case"float16x4":case"float32x2":return 8;case"uint32x3":case"sint32x3":case"float32x3":return 12;case"uint32x4":case"sint32x4":case"float32x4":return 16}return 0}function or(h){return h==="f16"||h.includes("h")?"f16":h.includes("f")?"f32":h.includes("u")?"u32":"i32"}function ar(h){return+h.slice(1)/8}function cr(h){return h==="f16"&&K(X.FORMAT_NOT_SUPPORTED,`${h}.`),h==="f32"?Float32Array:h==="u32"?Uint32Array:Int32Array}const Zs={operation:"add",srcFactor:"one",dstFactor:"zero"},js={operation:"add",srcFactor:"one",dstFactor:"one"},Js={operation:"add",srcFactor:"one",dstFactor:"one-minus-src-alpha"},Ks={operation:"add",srcFactor:"one-minus-dst-alpha",dstFactor:"one"},tn={operation:"add",srcFactor:"dst-alpha",dstFactor:"zero"},en={operation:"add",srcFactor:"zero",dstFactor:"src-alpha"},sn={operation:"add",srcFactor:"one-minus-dst-alpha",dstFactor:"zero"},nn={operation:"add",srcFactor:"zero",dstFactor:"one-minus-src-alpha"},rn={operation:"add",srcFactor:"dst-alpha",dstFactor:"one-minus-src-alpha"},on={operation:"add",srcFactor:"one-minus-dst-alpha",dstFactor:"src-alpha"},ui=it({COPY:it({color:Zs,alpha:Zs}),ADDITIVE:it({color:js,alpha:js}),SOURCE_OVER:it({color:Js,alpha:Js}),DESTINATION_OVER:it({color:Ks,alpha:Ks}),SOURCE_IN:it({color:tn,alpha:tn}),DESTINATION_IN:it({color:en,alpha:en}),SOURCE_OUT:it({color:sn,alpha:sn}),DESTINATION_OUT:it({color:nn,alpha:nn}),SOURCE_ATOP:it({color:rn,alpha:rn}),DESTINATION_ATOP:it({color:on,alpha:on})}),Te=it({INDEX:GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST,VERTEX:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,STORAGE:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST,UNIFORM:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,READABLE:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST,WRITABLE:GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC});class ur{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class ve{constructor(){}get isAstNode(){return!0}get astNodeType(){return""}evaluate(t){throw new Error("Cannot evaluate node")}evaluateString(t){return this.evaluate(t).toString()}search(t){}searchBlock(t,e){if(t){e(Ds.instance);for(const n of t)n instanceof Array?this.searchBlock(n,e):n.search(e);e(As.instance)}}}class Ds extends ve{}Ds.instance=new Ds;class As extends ve{}As.instance=new As;class nt extends ve{constructor(){super()}}class Us extends nt{constructor(t,e,n,o,f,k){super(),this.calls=new Set,this.name=t,this.args=e,this.returnType=n,this.body=o,this.startLine=f,this.endLine=k}get astNodeType(){return"function"}search(t){this.searchBlock(this.body,t)}}class hr extends nt{constructor(t){super(),this.expression=t}get astNodeType(){return"staticAssert"}search(t){this.expression.search(t)}}class lr extends nt{constructor(t,e){super(),this.condition=t,this.body=e}get astNodeType(){return"while"}search(t){this.condition.search(t),this.searchBlock(this.body,t)}}class _r extends nt{constructor(t){super(),this.body=t}get astNodeType(){return"continuing"}search(t){this.searchBlock(this.body,t)}}class fr extends nt{constructor(t,e,n,o){super(),this.init=t,this.condition=e,this.increment=n,this.body=o}get astNodeType(){return"for"}search(t){var e,n,o;(e=this.init)===null||e===void 0||e.search(t),(n=this.condition)===null||n===void 0||n.search(t),(o=this.increment)===null||o===void 0||o.search(t),this.searchBlock(this.body,t)}}class Be extends nt{constructor(t,e,n,o,f){super(),this.name=t,this.type=e,this.storage=n,this.access=o,this.value=f}get astNodeType(){return"var"}search(t){var e;t(this),(e=this.value)===null||e===void 0||e.search(t)}}class An extends nt{constructor(t,e,n){super(),this.name=t,this.type=e,this.value=n}get astNodeType(){return"override"}search(t){var e;(e=this.value)===null||e===void 0||e.search(t)}}class Rs extends nt{constructor(t,e,n,o,f){super(),this.name=t,this.type=e,this.storage=n,this.access=o,this.value=f}get astNodeType(){return"let"}search(t){var e;t(this),(e=this.value)===null||e===void 0||e.search(t)}}class an extends nt{constructor(t,e,n,o,f){super(),this.name=t,this.type=e,this.storage=n,this.access=o,this.value=f}get astNodeType(){return"const"}evaluate(t){return this.value.evaluate(t)}search(t){var e;t(this),(e=this.value)===null||e===void 0||e.search(t)}}var os;(function(h){h.increment="++",h.decrement="--"})(os||(os={}));(function(h){function t(e){const n=e;if(n=="parse")throw new Error("Invalid value for IncrementOperator");return h[n]}h.parse=t})(os||(os={}));class dr extends nt{constructor(t,e){super(),this.operator=t,this.variable=e}get astNodeType(){return"increment"}search(t){this.variable.search(t)}}var us;(function(h){h.assign="=",h.addAssign="+=",h.subtractAssin="-=",h.multiplyAssign="*=",h.divideAssign="/=",h.moduloAssign="%=",h.andAssign="&=",h.orAssign="|=",h.xorAssign="^=",h.shiftLeftAssign="<<=",h.shiftRightAssign=">>="})(us||(us={}));(function(h){function t(e){const n=e;if(n=="parse")throw new Error("Invalid value for AssignOperator");return n}h.parse=t})(us||(us={}));class pr extends nt{constructor(t,e,n){super(),this.operator=t,this.variable=e,this.value=n}get astNodeType(){return"assign"}search(t){this.variable.search(t),this.value.search(t)}}class Sn extends nt{constructor(t,e){super(),this.name=t,this.args=e}get astNodeType(){return"call"}search(t){for(const e of this.args)e.search(t);t(this)}}class wr extends nt{constructor(t,e){super(),this.body=t,this.continuing=e}get astNodeType(){return"loop"}}class gr extends nt{constructor(t,e){super(),this.condition=t,this.body=e}get astNodeType(){return"body"}}class mr extends nt{constructor(t,e,n,o){super(),this.condition=t,this.body=e,this.elseif=n,this.else=o}get astNodeType(){return"if"}search(t){this.condition.search(t),this.searchBlock(this.body,t),this.searchBlock(this.elseif,t),this.searchBlock(this.else,t)}}class yr extends nt{constructor(t){super(),this.value=t}get astNodeType(){return"return"}search(t){var e;(e=this.value)===null||e===void 0||e.search(t)}}class xr extends nt{constructor(t){super(),this.name=t}get astNodeType(){return"enable"}}class kr extends nt{constructor(t){super(),this.extensions=t}get astNodeType(){return"requires"}}class Tr extends nt{constructor(t,e){super(),this.severity=t,this.rule=e}get astNodeType(){return"diagnostic"}}class Nn extends nt{constructor(t,e){super(),this.name=t,this.type=e}get astNodeType(){return"alias"}}class Er extends nt{constructor(){super()}get astNodeType(){return"discard"}}class vr extends nt{constructor(){super()}get astNodeType(){return"break"}}class Dr extends nt{constructor(){super()}get astNodeType(){return"continue"}}class We extends nt{constructor(t){super(),this.name=t}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}}class Fe extends We{constructor(t,e,n,o){super(t),this.members=e,this.startLine=n,this.endLine=o}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(t){for(let e=0;e<this.members.length;e++)if(this.members[e].name==t)return e;return-1}}class Mn extends We{constructor(t,e,n){super(t),this.format=e,this.access=n}get astNodeType(){return"template"}}class Ar extends We{constructor(t,e,n,o){super(t),this.storage=e,this.type=n,this.access=o}get astNodeType(){return"pointer"}}class bn extends We{constructor(t,e,n,o){super(t),this.attributes=e,this.format=n,this.count=o}get astNodeType(){return"array"}get isArray(){return!0}}class as extends We{constructor(t,e,n){super(t),this.format=e,this.access=n}get astNodeType(){return"sampler"}}class we extends ve{constructor(){super()}}class Sr extends we{constructor(t){super(),this.value=t}get astNodeType(){return"stringExpr"}toString(){return this.value}evaluateString(){return this.value}}class He extends we{constructor(t,e){super(),this.type=t,this.args=e}get astNodeType(){return"createExpr"}search(t){if(t(this),this.args)for(const e of this.args)e.search(t)}evaluate(t){return this.args[0].evaluate(t)}}class On extends we{constructor(t,e){super(),this.name=t,this.args=e}get astNodeType(){return"callExpr"}evaluate(t){switch(this.name){case"abs":return Math.abs(this.args[0].evaluate(t));case"acos":return Math.acos(this.args[0].evaluate(t));case"acosh":return Math.acosh(this.args[0].evaluate(t));case"asin":return Math.asin(this.args[0].evaluate(t));case"asinh":return Math.asinh(this.args[0].evaluate(t));case"atan":return Math.atan(this.args[0].evaluate(t));case"atan2":return Math.atan2(this.args[0].evaluate(t),this.args[1].evaluate(t));case"atanh":return Math.atanh(this.args[0].evaluate(t));case"ceil":return Math.ceil(this.args[0].evaluate(t));case"clamp":return Math.min(Math.max(this.args[0].evaluate(t),this.args[1].evaluate(t)),this.args[2].evaluate(t));case"cos":return Math.cos(this.args[0].evaluate(t));case"degrees":return this.args[0].evaluate(t)*180/Math.PI;case"distance":return Math.sqrt(Math.pow(this.args[0].evaluate(t)-this.args[1].evaluate(t),2));case"dot":case"exp":return Math.exp(this.args[0].evaluate(t));case"exp2":return Math.pow(2,this.args[0].evaluate(t));case"floor":return Math.floor(this.args[0].evaluate(t));case"fma":return this.args[0].evaluate(t)*this.args[1].evaluate(t)+this.args[2].evaluate(t);case"fract":return this.args[0].evaluate(t)-Math.floor(this.args[0].evaluate(t));case"inverseSqrt":return 1/Math.sqrt(this.args[0].evaluate(t));case"log":return Math.log(this.args[0].evaluate(t));case"log2":return Math.log2(this.args[0].evaluate(t));case"max":return Math.max(this.args[0].evaluate(t),this.args[1].evaluate(t));case"min":return Math.min(this.args[0].evaluate(t),this.args[1].evaluate(t));case"mix":return this.args[0].evaluate(t)*(1-this.args[2].evaluate(t))+this.args[1].evaluate(t)*this.args[2].evaluate(t);case"modf":return this.args[0].evaluate(t)-Math.floor(this.args[0].evaluate(t));case"pow":return Math.pow(this.args[0].evaluate(t),this.args[1].evaluate(t));case"radians":return this.args[0].evaluate(t)*Math.PI/180;case"round":return Math.round(this.args[0].evaluate(t));case"sign":return Math.sign(this.args[0].evaluate(t));case"sin":return Math.sin(this.args[0].evaluate(t));case"sinh":return Math.sinh(this.args[0].evaluate(t));case"saturate":return Math.min(Math.max(this.args[0].evaluate(t),0),1);case"smoothstep":return this.args[0].evaluate(t)*this.args[0].evaluate(t)*(3-2*this.args[0].evaluate(t));case"sqrt":return Math.sqrt(this.args[0].evaluate(t));case"step":return this.args[0].evaluate(t)<this.args[1].evaluate(t)?0:1;case"tan":return Math.tan(this.args[0].evaluate(t));case"tanh":return Math.tanh(this.args[0].evaluate(t));case"trunc":return Math.trunc(this.args[0].evaluate(t));default:throw new Error("Non const function: "+this.name)}}search(t){for(const e of this.args)e.search(t);t(this)}}class Ps extends we{constructor(t){super(),this.name=t}get astNodeType(){return"varExpr"}search(t){t(this),this.postfix&&this.postfix.search(t)}evaluate(t){const e=t.constants.get(this.name);if(!e)throw new Error("Cannot evaluate node");return e.evaluate(t)}}class cn extends we{constructor(t,e){super(),this.name=t,this.initializer=e}get astNodeType(){return"constExpr"}evaluate(t){var e,n;if(this.initializer instanceof He){const o=(e=this.postfix)===null||e===void 0?void 0:e.evaluateString(t),f=(n=this.initializer.type)===null||n===void 0?void 0:n.name,k=t.structs.get(f),N=k==null?void 0:k.getMemberIndex(o);return N!==void 0&&N!=-1?this.initializer.args[N].evaluate(t):this.initializer.evaluate(t)}return this.initializer.evaluate(t)}search(t){this.initializer.search(t)}}class un extends we{constructor(t){super(),this.value=t}get astNodeType(){return"literalExpr"}evaluate(){return this.value}}class Nr extends we{constructor(t,e){super(),this.type=t,this.value=e}get astNodeType(){return"bitcastExpr"}search(t){this.value.search(t)}}class hn extends we{constructor(t){super(),this.contents=t}get astNodeType(){return"groupExpr"}evaluate(t){return this.contents[0].evaluate(t)}search(t){this.searchBlock(this.contents,t)}}class Mr extends we{constructor(t){super(),this.index=t}search(t){this.index.search(t)}}class Un extends we{constructor(){super()}}class br extends Un{constructor(t,e){super(),this.operator=t,this.right=e}get astNodeType(){return"unaryOp"}evaluate(t){switch(this.operator){case"+":return this.right.evaluate(t);case"-":return-this.right.evaluate(t);case"!":return this.right.evaluate(t)?0:1;case"~":return~this.right.evaluate(t);default:throw new Error("Unknown unary operator: "+this.operator)}}search(t){this.right.search(t)}}class ue extends Un{constructor(t,e,n){super(),this.operator=t,this.left=e,this.right=n}get astNodeType(){return"binaryOp"}evaluate(t){switch(this.operator){case"+":return this.left.evaluate(t)+this.right.evaluate(t);case"-":return this.left.evaluate(t)-this.right.evaluate(t);case"*":return this.left.evaluate(t)*this.right.evaluate(t);case"/":return this.left.evaluate(t)/this.right.evaluate(t);case"%":return this.left.evaluate(t)%this.right.evaluate(t);case"==":return this.left.evaluate(t)==this.right.evaluate(t)?1:0;case"!=":return this.left.evaluate(t)!=this.right.evaluate(t)?1:0;case"<":return this.left.evaluate(t)<this.right.evaluate(t)?1:0;case">":return this.left.evaluate(t)>this.right.evaluate(t)?1:0;case"<=":return this.left.evaluate(t)<=this.right.evaluate(t)?1:0;case">=":return this.left.evaluate(t)>=this.right.evaluate(t)?1:0;case"&&":return this.left.evaluate(t)&&this.right.evaluate(t)?1:0;case"||":return this.left.evaluate(t)||this.right.evaluate(t)?1:0;default:throw new Error(`Unknown operator ${this.operator}`)}}search(t){this.left.search(t),this.right.search(t)}}class Rn extends ve{constructor(){super()}}class Or extends Rn{constructor(t,e){super(),this.selector=t,this.body=e}get astNodeType(){return"case"}search(t){this.searchBlock(this.body,t)}}class Ur extends Rn{constructor(t){super(),this.body=t}get astNodeType(){return"default"}search(t){this.searchBlock(this.body,t)}}class Rr extends ve{constructor(t,e,n){super(),this.name=t,this.type=e,this.attributes=n}get astNodeType(){return"argument"}}class Pr extends ve{constructor(t,e){super(),this.condition=t,this.body=e}get astNodeType(){return"elseif"}search(t){this.condition.search(t),this.searchBlock(this.body,t)}}class Ir extends ve{constructor(t,e,n){super(),this.name=t,this.type=e,this.attributes=n}get astNodeType(){return"member"}}class Fr extends ve{constructor(t,e){super(),this.name=t,this.value=e}get astNodeType(){return"attribute"}}var S,D;(function(h){h[h.token=0]="token",h[h.keyword=1]="keyword",h[h.reserved=2]="reserved"})(D||(D={}));class A{constructor(t,e,n){this.name=t,this.type=e,this.rule=n}toString(){return this.name}}class d{}S=d;d.none=new A("",D.reserved,"");d.eof=new A("EOF",D.token,"");d.reserved={asm:new A("asm",D.reserved,"asm"),bf16:new A("bf16",D.reserved,"bf16"),do:new A("do",D.reserved,"do"),enum:new A("enum",D.reserved,"enum"),f16:new A("f16",D.reserved,"f16"),f64:new A("f64",D.reserved,"f64"),handle:new A("handle",D.reserved,"handle"),i8:new A("i8",D.reserved,"i8"),i16:new A("i16",D.reserved,"i16"),i64:new A("i64",D.reserved,"i64"),mat:new A("mat",D.reserved,"mat"),premerge:new A("premerge",D.reserved,"premerge"),regardless:new A("regardless",D.reserved,"regardless"),typedef:new A("typedef",D.reserved,"typedef"),u8:new A("u8",D.reserved,"u8"),u16:new A("u16",D.reserved,"u16"),u64:new A("u64",D.reserved,"u64"),unless:new A("unless",D.reserved,"unless"),using:new A("using",D.reserved,"using"),vec:new A("vec",D.reserved,"vec"),void:new A("void",D.reserved,"void")};d.keywords={array:new A("array",D.keyword,"array"),atomic:new A("atomic",D.keyword,"atomic"),bool:new A("bool",D.keyword,"bool"),f32:new A("f32",D.keyword,"f32"),i32:new A("i32",D.keyword,"i32"),mat2x2:new A("mat2x2",D.keyword,"mat2x2"),mat2x3:new A("mat2x3",D.keyword,"mat2x3"),mat2x4:new A("mat2x4",D.keyword,"mat2x4"),mat3x2:new A("mat3x2",D.keyword,"mat3x2"),mat3x3:new A("mat3x3",D.keyword,"mat3x3"),mat3x4:new A("mat3x4",D.keyword,"mat3x4"),mat4x2:new A("mat4x2",D.keyword,"mat4x2"),mat4x3:new A("mat4x3",D.keyword,"mat4x3"),mat4x4:new A("mat4x4",D.keyword,"mat4x4"),ptr:new A("ptr",D.keyword,"ptr"),sampler:new A("sampler",D.keyword,"sampler"),sampler_comparison:new A("sampler_comparison",D.keyword,"sampler_comparison"),struct:new A("struct",D.keyword,"struct"),texture_1d:new A("texture_1d",D.keyword,"texture_1d"),texture_2d:new A("texture_2d",D.keyword,"texture_2d"),texture_2d_array:new A("texture_2d_array",D.keyword,"texture_2d_array"),texture_3d:new A("texture_3d",D.keyword,"texture_3d"),texture_cube:new A("texture_cube",D.keyword,"texture_cube"),texture_cube_array:new A("texture_cube_array",D.keyword,"texture_cube_array"),texture_multisampled_2d:new A("texture_multisampled_2d",D.keyword,"texture_multisampled_2d"),texture_storage_1d:new A("texture_storage_1d",D.keyword,"texture_storage_1d"),texture_storage_2d:new A("texture_storage_2d",D.keyword,"texture_storage_2d"),texture_storage_2d_array:new A("texture_storage_2d_array",D.keyword,"texture_storage_2d_array"),texture_storage_3d:new A("texture_storage_3d",D.keyword,"texture_storage_3d"),texture_depth_2d:new A("texture_depth_2d",D.keyword,"texture_depth_2d"),texture_depth_2d_array:new A("texture_depth_2d_array",D.keyword,"texture_depth_2d_array"),texture_depth_cube:new A("texture_depth_cube",D.keyword,"texture_depth_cube"),texture_depth_cube_array:new A("texture_depth_cube_array",D.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new A("texture_depth_multisampled_2d",D.keyword,"texture_depth_multisampled_2d"),texture_external:new A("texture_external",D.keyword,"texture_external"),u32:new A("u32",D.keyword,"u32"),vec2:new A("vec2",D.keyword,"vec2"),vec3:new A("vec3",D.keyword,"vec3"),vec4:new A("vec4",D.keyword,"vec4"),bitcast:new A("bitcast",D.keyword,"bitcast"),block:new A("block",D.keyword,"block"),break:new A("break",D.keyword,"break"),case:new A("case",D.keyword,"case"),continue:new A("continue",D.keyword,"continue"),continuing:new A("continuing",D.keyword,"continuing"),default:new A("default",D.keyword,"default"),diagnostic:new A("diagnostic",D.keyword,"diagnostic"),discard:new A("discard",D.keyword,"discard"),else:new A("else",D.keyword,"else"),enable:new A("enable",D.keyword,"enable"),fallthrough:new A("fallthrough",D.keyword,"fallthrough"),false:new A("false",D.keyword,"false"),fn:new A("fn",D.keyword,"fn"),for:new A("for",D.keyword,"for"),function:new A("function",D.keyword,"function"),if:new A("if",D.keyword,"if"),let:new A("let",D.keyword,"let"),const:new A("const",D.keyword,"const"),loop:new A("loop",D.keyword,"loop"),while:new A("while",D.keyword,"while"),private:new A("private",D.keyword,"private"),read:new A("read",D.keyword,"read"),read_write:new A("read_write",D.keyword,"read_write"),return:new A("return",D.keyword,"return"),requires:new A("requires",D.keyword,"requires"),storage:new A("storage",D.keyword,"storage"),switch:new A("switch",D.keyword,"switch"),true:new A("true",D.keyword,"true"),alias:new A("alias",D.keyword,"alias"),type:new A("type",D.keyword,"type"),uniform:new A("uniform",D.keyword,"uniform"),var:new A("var",D.keyword,"var"),override:new A("override",D.keyword,"override"),workgroup:new A("workgroup",D.keyword,"workgroup"),write:new A("write",D.keyword,"write"),r8unorm:new A("r8unorm",D.keyword,"r8unorm"),r8snorm:new A("r8snorm",D.keyword,"r8snorm"),r8uint:new A("r8uint",D.keyword,"r8uint"),r8sint:new A("r8sint",D.keyword,"r8sint"),r16uint:new A("r16uint",D.keyword,"r16uint"),r16sint:new A("r16sint",D.keyword,"r16sint"),r16float:new A("r16float",D.keyword,"r16float"),rg8unorm:new A("rg8unorm",D.keyword,"rg8unorm"),rg8snorm:new A("rg8snorm",D.keyword,"rg8snorm"),rg8uint:new A("rg8uint",D.keyword,"rg8uint"),rg8sint:new A("rg8sint",D.keyword,"rg8sint"),r32uint:new A("r32uint",D.keyword,"r32uint"),r32sint:new A("r32sint",D.keyword,"r32sint"),r32float:new A("r32float",D.keyword,"r32float"),rg16uint:new A("rg16uint",D.keyword,"rg16uint"),rg16sint:new A("rg16sint",D.keyword,"rg16sint"),rg16float:new A("rg16float",D.keyword,"rg16float"),rgba8unorm:new A("rgba8unorm",D.keyword,"rgba8unorm"),rgba8unorm_srgb:new A("rgba8unorm_srgb",D.keyword,"rgba8unorm_srgb"),rgba8snorm:new A("rgba8snorm",D.keyword,"rgba8snorm"),rgba8uint:new A("rgba8uint",D.keyword,"rgba8uint"),rgba8sint:new A("rgba8sint",D.keyword,"rgba8sint"),bgra8unorm:new A("bgra8unorm",D.keyword,"bgra8unorm"),bgra8unorm_srgb:new A("bgra8unorm_srgb",D.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new A("rgb10a2unorm",D.keyword,"rgb10a2unorm"),rg11b10float:new A("rg11b10float",D.keyword,"rg11b10float"),rg32uint:new A("rg32uint",D.keyword,"rg32uint"),rg32sint:new A("rg32sint",D.keyword,"rg32sint"),rg32float:new A("rg32float",D.keyword,"rg32float"),rgba16uint:new A("rgba16uint",D.keyword,"rgba16uint"),rgba16sint:new A("rgba16sint",D.keyword,"rgba16sint"),rgba16float:new A("rgba16float",D.keyword,"rgba16float"),rgba32uint:new A("rgba32uint",D.keyword,"rgba32uint"),rgba32sint:new A("rgba32sint",D.keyword,"rgba32sint"),rgba32float:new A("rgba32float",D.keyword,"rgba32float"),static_assert:new A("static_assert",D.keyword,"static_assert")};d.tokens={decimal_float_literal:new A("decimal_float_literal",D.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?f?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+f?)|(-?[0-9]+f)/),hex_float_literal:new A("hex_float_literal",D.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+f?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+f?))/),int_literal:new A("int_literal",D.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new A("uint_literal",D.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),ident:new A("ident",D.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new A("and",D.token,"&"),and_and:new A("and_and",D.token,"&&"),arrow:new A("arrow ",D.token,"->"),attr:new A("attr",D.token,"@"),forward_slash:new A("forward_slash",D.token,"/"),bang:new A("bang",D.token,"!"),bracket_left:new A("bracket_left",D.token,"["),bracket_right:new A("bracket_right",D.token,"]"),brace_left:new A("brace_left",D.token,"{"),brace_right:new A("brace_right",D.token,"}"),colon:new A("colon",D.token,":"),comma:new A("comma",D.token,","),equal:new A("equal",D.token,"="),equal_equal:new A("equal_equal",D.token,"=="),not_equal:new A("not_equal",D.token,"!="),greater_than:new A("greater_than",D.token,">"),greater_than_equal:new A("greater_than_equal",D.token,">="),shift_right:new A("shift_right",D.token,">>"),less_than:new A("less_than",D.token,"<"),less_than_equal:new A("less_than_equal",D.token,"<="),shift_left:new A("shift_left",D.token,"<<"),modulo:new A("modulo",D.token,"%"),minus:new A("minus",D.token,"-"),minus_minus:new A("minus_minus",D.token,"--"),period:new A("period",D.token,"."),plus:new A("plus",D.token,"+"),plus_plus:new A("plus_plus",D.token,"++"),or:new A("or",D.token,"|"),or_or:new A("or_or",D.token,"||"),paren_left:new A("paren_left",D.token,"("),paren_right:new A("paren_right",D.token,")"),semicolon:new A("semicolon",D.token,";"),star:new A("star",D.token,"*"),tilde:new A("tilde",D.token,"~"),underscore:new A("underscore",D.token,"_"),xor:new A("xor",D.token,"^"),plus_equal:new A("plus_equal",D.token,"+="),minus_equal:new A("minus_equal",D.token,"-="),times_equal:new A("times_equal",D.token,"*="),division_equal:new A("division_equal",D.token,"/="),modulo_equal:new A("modulo_equal",D.token,"%="),and_equal:new A("and_equal",D.token,"&="),or_equal:new A("or_equal",D.token,"|="),xor_equal:new A("xor_equal",D.token,"^="),shift_right_equal:new A("shift_right_equal",D.token,">>="),shift_left_equal:new A("shift_left_equal",D.token,"<<=")};d.simpleTokens={"@":S.tokens.attr,"{":S.tokens.brace_left,"}":S.tokens.brace_right,":":S.tokens.colon,",":S.tokens.comma,"(":S.tokens.paren_left,")":S.tokens.paren_right,";":S.tokens.semicolon};d.literalTokens={"&":S.tokens.and,"&&":S.tokens.and_and,"->":S.tokens.arrow,"/":S.tokens.forward_slash,"!":S.tokens.bang,"[":S.tokens.bracket_left,"]":S.tokens.bracket_right,"=":S.tokens.equal,"==":S.tokens.equal_equal,"!=":S.tokens.not_equal,">":S.tokens.greater_than,">=":S.tokens.greater_than_equal,">>":S.tokens.shift_right,"<":S.tokens.less_than,"<=":S.tokens.less_than_equal,"<<":S.tokens.shift_left,"%":S.tokens.modulo,"-":S.tokens.minus,"--":S.tokens.minus_minus,".":S.tokens.period,"+":S.tokens.plus,"++":S.tokens.plus_plus,"|":S.tokens.or,"||":S.tokens.or_or,"*":S.tokens.star,"~":S.tokens.tilde,_:S.tokens.underscore,"^":S.tokens.xor,"+=":S.tokens.plus_equal,"-=":S.tokens.minus_equal,"*=":S.tokens.times_equal,"/=":S.tokens.division_equal,"%=":S.tokens.modulo_equal,"&=":S.tokens.and_equal,"|=":S.tokens.or_equal,"^=":S.tokens.xor_equal,">>=":S.tokens.shift_right_equal,"<<=":S.tokens.shift_left_equal};d.regexTokens={decimal_float_literal:S.tokens.decimal_float_literal,hex_float_literal:S.tokens.hex_float_literal,int_literal:S.tokens.int_literal,uint_literal:S.tokens.uint_literal,ident:S.tokens.ident};d.storage_class=[S.keywords.function,S.keywords.private,S.keywords.workgroup,S.keywords.uniform,S.keywords.storage];d.access_mode=[S.keywords.read,S.keywords.write,S.keywords.read_write];d.sampler_type=[S.keywords.sampler,S.keywords.sampler_comparison];d.sampled_texture_type=[S.keywords.texture_1d,S.keywords.texture_2d,S.keywords.texture_2d_array,S.keywords.texture_3d,S.keywords.texture_cube,S.keywords.texture_cube_array];d.multisampled_texture_type=[S.keywords.texture_multisampled_2d];d.storage_texture_type=[S.keywords.texture_storage_1d,S.keywords.texture_storage_2d,S.keywords.texture_storage_2d_array,S.keywords.texture_storage_3d];d.depth_texture_type=[S.keywords.texture_depth_2d,S.keywords.texture_depth_2d_array,S.keywords.texture_depth_cube,S.keywords.texture_depth_cube_array,S.keywords.texture_depth_multisampled_2d];d.texture_external_type=[S.keywords.texture_external];d.any_texture_type=[...S.sampled_texture_type,...S.multisampled_texture_type,...S.storage_texture_type,...S.depth_texture_type,...S.texture_external_type];d.texel_format=[S.keywords.r8unorm,S.keywords.r8snorm,S.keywords.r8uint,S.keywords.r8sint,S.keywords.r16uint,S.keywords.r16sint,S.keywords.r16float,S.keywords.rg8unorm,S.keywords.rg8snorm,S.keywords.rg8uint,S.keywords.rg8sint,S.keywords.r32uint,S.keywords.r32sint,S.keywords.r32float,S.keywords.rg16uint,S.keywords.rg16sint,S.keywords.rg16float,S.keywords.rgba8unorm,S.keywords.rgba8unorm_srgb,S.keywords.rgba8snorm,S.keywords.rgba8uint,S.keywords.rgba8sint,S.keywords.bgra8unorm,S.keywords.bgra8unorm_srgb,S.keywords.rgb10a2unorm,S.keywords.rg11b10float,S.keywords.rg32uint,S.keywords.rg32sint,S.keywords.rg32float,S.keywords.rgba16uint,S.keywords.rgba16sint,S.keywords.rgba16float,S.keywords.rgba32uint,S.keywords.rgba32sint,S.keywords.rgba32float];d.const_literal=[S.tokens.int_literal,S.tokens.uint_literal,S.tokens.decimal_float_literal,S.tokens.hex_float_literal,S.keywords.true,S.keywords.false];d.literal_or_ident=[S.tokens.ident,S.tokens.int_literal,S.tokens.uint_literal,S.tokens.decimal_float_literal,S.tokens.hex_float_literal];d.element_count_expression=[S.tokens.int_literal,S.tokens.uint_literal,S.tokens.ident];d.template_types=[S.keywords.vec2,S.keywords.vec3,S.keywords.vec4,S.keywords.mat2x2,S.keywords.mat2x3,S.keywords.mat2x4,S.keywords.mat3x2,S.keywords.mat3x3,S.keywords.mat3x4,S.keywords.mat4x2,S.keywords.mat4x3,S.keywords.mat4x4,S.keywords.atomic,S.keywords.bitcast,...S.any_texture_type];d.attribute_name=[S.tokens.ident,S.keywords.block,S.keywords.diagnostic];d.assignment_operators=[S.tokens.equal,S.tokens.plus_equal,S.tokens.minus_equal,S.tokens.times_equal,S.tokens.division_equal,S.tokens.modulo_equal,S.tokens.and_equal,S.tokens.or_equal,S.tokens.xor_equal,S.tokens.shift_right_equal,S.tokens.shift_left_equal];d.increment_operators=[S.tokens.plus_plus,S.tokens.minus_minus];class ln{constructor(t,e,n){this.type=t,this.lexeme=e,this.line=n}toString(){return this.lexeme}isTemplateType(){return d.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==d.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class Br{constructor(t){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=t??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new ln(d.eof,"",this._line)),this._tokens}scanToken(){let t=this._advance();if(t==`
`)return this._line++,!0;if(this._isWhitespace(t))return!0;if(t=="/"){if(this._peekAhead()=="/"){for(;t!=`
`;){if(this._isAtEnd())return!0;t=this._advance()}return this._line++,!0}else if(this._peekAhead()=="*"){this._advance();let k=1;for(;k>0;){if(this._isAtEnd())return!0;if(t=this._advance(),t==`
`)this._line++;else if(t=="*"){if(this._peekAhead()=="/"&&(this._advance(),k--,k==0))return!0}else t=="/"&&this._peekAhead()=="*"&&(this._advance(),k++)}return!0}}const e=d.simpleTokens[t];if(e)return this._addToken(e),!0;let n=d.none;const o=this._isAlpha(t),f=t==="_";if(this._isAlphaNumeric(t)){let k=this._peekAhead();for(;this._isAlphaNumeric(k);)t+=this._advance(),k=this._peekAhead()}if(o){const k=d.keywords[t];if(k)return this._addToken(k),!0}if(o||f)return this._addToken(d.tokens.ident),!0;for(;;){let k=this._findType(t);const N=this._peekAhead();if(t=="-"&&this._tokens.length>0){if(N=="=")return this._current++,t+=N,this._addToken(d.tokens.minus_equal),!0;if(N=="-")return this._current++,t+=N,this._addToken(d.tokens.minus_minus),!0;const R=this._tokens.length-1;if((d.literal_or_ident.indexOf(this._tokens[R].type)!=-1||this._tokens[R].type==d.tokens.paren_right)&&N!=">")return this._addToken(k),!0}if(t==">"&&(N==">"||N=="=")){let R=!1,I=this._tokens.length-1;for(let B=0;B<5&&I>=0&&d.assignment_operators.indexOf(this._tokens[I].type)===-1;++B,--I)if(this._tokens[I].type===d.tokens.less_than){I>0&&this._tokens[I-1].isArrayOrTemplateType()&&(R=!0);break}if(R)return this._addToken(k),!0}if(k===d.none){let R=t,I=0;const B=2;for(let C=0;C<B;++C)if(R+=this._peekAhead(C),k=this._findType(R),k!==d.none){I=C;break}if(k===d.none)return n===d.none?!1:(this._current--,this._addToken(n),!0);t=R,this._current+=I+1}if(n=k,this._isAtEnd())break;t+=this._advance()}return n===d.none?!1:(this._addToken(n),!0)}_findType(t){for(const n in d.regexTokens){const o=d.regexTokens[n];if(this._match(t,o.rule))return o}const e=d.literalTokens[t];return e||d.none}_match(t,e){const n=e.exec(t);return n&&n.index==0&&n[0]==t}_isAtEnd(){return this._current>=this._source.length}_isAlpha(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"}_isAlphaNumeric(t){return t>="a"&&t<="z"||t>="A"&&t<="Z"||t=="_"||t>="0"&&t<="9"}_isWhitespace(t){return t==" "||t=="	"||t=="\r"}_advance(t=0){let e=this._source[this._current];return t=t||0,t++,this._current+=t,e}_peekAhead(t=0){return t=t||0,this._current+t>=this._source.length?"\0":this._source[this._current+t]}_addToken(t){const e=this._source.substring(this._start,this._current);this._tokens.push(new ln(t,e,this._line))}}class Lr{constructor(){this._tokens=[],this._current=0,this._currentLine=0,this._context=new ur,this._deferArrayCountEval=[]}parse(t){this._initialize(t),this._deferArrayCountEval.length=0;const e=[];for(;!this._isAtEnd();){const n=this._global_decl_or_directive();if(!n)break;e.push(n)}if(this._deferArrayCountEval.length>0){for(const n of this._deferArrayCountEval){const o=n.arrayType,f=n.countNode;if(f instanceof Ps){const N=f.name,R=this._context.constants.get(N);if(R)try{const I=R.evaluate(this._context);o.count=I}catch{}}}this._deferArrayCountEval.length=0}return e}_initialize(t){if(t)if(typeof t=="string"){const e=new Br(t);this._tokens=e.scanTokens()}else this._tokens=t;else this._tokens=[];this._current=0}_error(t,e){return{token:t,message:e,toString:function(){return`${e}`}}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==d.eof}_match(t){if(t instanceof A)return this._check(t)?(this._advance(),!0):!1;for(let e=0,n=t.length;e<n;++e){const o=t[e];if(this._check(o))return this._advance(),!0}return!1}_consume(t,e){if(this._check(t))return this._advance();throw this._error(this._peek(),e)}_check(t){if(this._isAtEnd())return!1;const e=this._peek();if(t instanceof Array){const n=e.type;return t.indexOf(n)!=-1}return e.type==t}_advance(){var t,e;return this._currentLine=(e=(t=this._peek())===null||t===void 0?void 0:t.line)!==null&&e!==void 0?e:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(d.tokens.semicolon)&&!this._isAtEnd(););if(this._match(d.keywords.alias)){const e=this._type_alias();return this._consume(d.tokens.semicolon,"Expected ';'"),e}if(this._match(d.keywords.diagnostic)){const e=this._diagnostic();return this._consume(d.tokens.semicolon,"Expected ';'"),e}if(this._match(d.keywords.requires)){const e=this._requires_directive();return this._consume(d.tokens.semicolon,"Expected ';'"),e}if(this._match(d.keywords.enable)){const e=this._enable_directive();return this._consume(d.tokens.semicolon,"Expected ';'"),e}const t=this._attribute();if(this._check(d.keywords.var)){const e=this._global_variable_decl();return e!=null&&(e.attributes=t),this._consume(d.tokens.semicolon,"Expected ';'."),e}if(this._check(d.keywords.override)){const e=this._override_variable_decl();return e!=null&&(e.attributes=t),this._consume(d.tokens.semicolon,"Expected ';'."),e}if(this._check(d.keywords.let)){const e=this._global_let_decl();return e!=null&&(e.attributes=t),this._consume(d.tokens.semicolon,"Expected ';'."),e}if(this._check(d.keywords.const)){const e=this._global_const_decl();return e!=null&&(e.attributes=t),this._consume(d.tokens.semicolon,"Expected ';'."),e}if(this._check(d.keywords.struct)){const e=this._struct_decl();return e!=null&&(e.attributes=t),e}if(this._check(d.keywords.fn)){const e=this._function_decl();return e!=null&&(e.attributes=t),e}return null}_function_decl(){if(!this._match(d.keywords.fn))return null;const t=this._currentLine,e=this._consume(d.tokens.ident,"Expected function name.").toString();this._consume(d.tokens.paren_left,"Expected '(' for function arguments.");const n=[];if(!this._check(d.tokens.paren_right))do{if(this._check(d.tokens.paren_right))break;const N=this._attribute(),R=this._consume(d.tokens.ident,"Expected argument name.").toString();this._consume(d.tokens.colon,"Expected ':' for argument type.");const I=this._attribute(),B=this._type_decl();B!=null&&(B.attributes=I,n.push(new Rr(R,B,N)))}while(this._match(d.tokens.comma));this._consume(d.tokens.paren_right,"Expected ')' after function arguments.");let o=null;if(this._match(d.tokens.arrow)){const N=this._attribute();o=this._type_decl(),o!=null&&(o.attributes=N)}const f=this._compound_statement(),k=this._currentLine;return new Us(e,n,o,f,t,k)}_compound_statement(){const t=[];for(this._consume(d.tokens.brace_left,"Expected '{' for block.");!this._check(d.tokens.brace_right);){const e=this._statement();e!==null&&t.push(e)}return this._consume(d.tokens.brace_right,"Expected '}' for block."),t}_statement(){for(;this._match(d.tokens.semicolon)&&!this._isAtEnd(););if(this._check(d.tokens.attr)&&this._attribute(),this._check(d.keywords.if))return this._if_statement();if(this._check(d.keywords.switch))return this._switch_statement();if(this._check(d.keywords.loop))return this._loop_statement();if(this._check(d.keywords.for))return this._for_statement();if(this._check(d.keywords.while))return this._while_statement();if(this._check(d.keywords.continuing))return this._continuing_statement();if(this._check(d.keywords.static_assert))return this._static_assert_statement();if(this._check(d.tokens.brace_left))return this._compound_statement();let t=null;return this._check(d.keywords.return)?t=this._return_statement():this._check([d.keywords.var,d.keywords.let,d.keywords.const])?t=this._variable_statement():this._match(d.keywords.discard)?t=new Er:this._match(d.keywords.break)?t=new vr:this._match(d.keywords.continue)?t=new Dr:t=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement(),t!=null&&this._consume(d.tokens.semicolon,"Expected ';' after statement."),t}_static_assert_statement(){if(!this._match(d.keywords.static_assert))return null;const t=this._optional_paren_expression();return new hr(t)}_while_statement(){if(!this._match(d.keywords.while))return null;const t=this._optional_paren_expression();this._check(d.tokens.attr)&&this._attribute();const e=this._compound_statement();return new lr(t,e)}_continuing_statement(){if(!this._match(d.keywords.continuing))return null;const t=this._compound_statement();return new _r(t)}_for_statement(){if(!this._match(d.keywords.for))return null;this._consume(d.tokens.paren_left,"Expected '('.");const t=this._check(d.tokens.semicolon)?null:this._for_init();this._consume(d.tokens.semicolon,"Expected ';'.");const e=this._check(d.tokens.semicolon)?null:this._short_circuit_or_expression();this._consume(d.tokens.semicolon,"Expected ';'.");const n=this._check(d.tokens.paren_right)?null:this._for_increment();this._consume(d.tokens.paren_right,"Expected ')'."),this._check(d.tokens.attr)&&this._attribute();const o=this._compound_statement();return new fr(t,e,n,o)}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(d.keywords.var)){const t=this._variable_decl();if(t===null)throw this._error(this._peek(),"Variable declaration expected.");let e=null;return this._match(d.tokens.equal)&&(e=this._short_circuit_or_expression()),new Be(t.name,t.type,t.storage,t.access,e)}if(this._match(d.keywords.let)){const t=this._consume(d.tokens.ident,"Expected name for let.").toString();let e=null;if(this._match(d.tokens.colon)){const o=this._attribute();e=this._type_decl(),e!=null&&(e.attributes=o)}this._consume(d.tokens.equal,"Expected '=' for let.");const n=this._short_circuit_or_expression();return new Rs(t,e,null,null,n)}if(this._match(d.keywords.const)){const t=this._consume(d.tokens.ident,"Expected name for const.").toString();let e=null;if(this._match(d.tokens.colon)){const o=this._attribute();e=this._type_decl(),e!=null&&(e.attributes=o)}this._consume(d.tokens.equal,"Expected '=' for const.");const n=this._short_circuit_or_expression();return new an(t,e,null,null,n)}return null}_increment_decrement_statement(){const t=this._current,e=this._unary_expression();if(e==null)return null;if(!this._check(d.increment_operators))return this._current=t,null;const n=this._consume(d.increment_operators,"Expected increment operator");return new dr(n.type===d.tokens.plus_plus?os.increment:os.decrement,e)}_assignment_statement(){let t=null;if(this._check(d.tokens.brace_right))return null;let e=this._match(d.tokens.underscore);if(e||(t=this._unary_expression()),!e&&t==null)return null;const n=this._consume(d.assignment_operators,"Expected assignment operator."),o=this._short_circuit_or_expression();return new pr(us.parse(n.lexeme),t,o)}_func_call_statement(){if(!this._check(d.tokens.ident))return null;const t=this._current,e=this._consume(d.tokens.ident,"Expected function name."),n=this._argument_expression_list();return n===null?(this._current=t,null):new Sn(e.lexeme,n)}_loop_statement(){if(!this._match(d.keywords.loop))return null;this._check(d.tokens.attr)&&this._attribute(),this._consume(d.tokens.brace_left,"Expected '{' for loop.");const t=[];let e=this._statement();for(;e!==null;){if(Array.isArray(e))for(let o of e)t.push(o);else t.push(e);e=this._statement()}let n=null;return this._match(d.keywords.continuing)&&(n=this._compound_statement()),this._consume(d.tokens.brace_right,"Expected '}' for loop."),new wr(t,n)}_switch_statement(){if(!this._match(d.keywords.switch))return null;const t=this._optional_paren_expression();this._check(d.tokens.attr)&&this._attribute(),this._consume(d.tokens.brace_left,"Expected '{' for switch.");const e=this._switch_body();if(e==null||e.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(d.tokens.brace_right,"Expected '}' for switch."),new gr(t,e)}_switch_body(){const t=[];if(this._match(d.keywords.case)){const e=this._case_selectors();this._match(d.tokens.colon),this._check(d.tokens.attr)&&this._attribute(),this._consume(d.tokens.brace_left,"Exected '{' for switch case.");const n=this._case_body();this._consume(d.tokens.brace_right,"Exected '}' for switch case."),t.push(new Or(e,n))}if(this._match(d.keywords.default)){this._match(d.tokens.colon),this._check(d.tokens.attr)&&this._attribute(),this._consume(d.tokens.brace_left,"Exected '{' for switch default.");const e=this._case_body();this._consume(d.tokens.brace_right,"Exected '}' for switch default."),t.push(new Ur(e))}if(this._check([d.keywords.default,d.keywords.case])){const e=this._switch_body();t.push(e[0])}return t}_case_selectors(){const t=[this._shift_expression()];for(;this._match(d.tokens.comma);)t.push(this._shift_expression());return t}_case_body(){if(this._match(d.keywords.fallthrough))return this._consume(d.tokens.semicolon,"Expected ';'"),[];let t=this._statement();if(t==null)return[];t instanceof Array||(t=[t]);const e=this._case_body();return e.length==0?t:[...t,e[0]]}_if_statement(){if(!this._match(d.keywords.if))return null;const t=this._optional_paren_expression();this._check(d.tokens.attr)&&this._attribute();const e=this._compound_statement();let n=[];this._match_elseif()&&(this._check(d.tokens.attr)&&this._attribute(),n=this._elseif_statement(n));let o=null;return this._match(d.keywords.else)&&(this._check(d.tokens.attr)&&this._attribute(),o=this._compound_statement()),new mr(t,e,n,o)}_match_elseif(){return this._tokens[this._current].type===d.keywords.else&&this._tokens[this._current+1].type===d.keywords.if?(this._advance(),this._advance(),!0):!1}_elseif_statement(t=[]){const e=this._optional_paren_expression(),n=this._compound_statement();return t.push(new Pr(e,n)),this._match_elseif()&&(this._check(d.tokens.attr)&&this._attribute(),this._elseif_statement(t)),t}_return_statement(){if(!this._match(d.keywords.return))return null;const t=this._short_circuit_or_expression();return new yr(t)}_short_circuit_or_expression(){let t=this._short_circuit_and_expr();for(;this._match(d.tokens.or_or);)t=new ue(this._previous().toString(),t,this._short_circuit_and_expr());return t}_short_circuit_and_expr(){let t=this._inclusive_or_expression();for(;this._match(d.tokens.and_and);)t=new ue(this._previous().toString(),t,this._inclusive_or_expression());return t}_inclusive_or_expression(){let t=this._exclusive_or_expression();for(;this._match(d.tokens.or);)t=new ue(this._previous().toString(),t,this._exclusive_or_expression());return t}_exclusive_or_expression(){let t=this._and_expression();for(;this._match(d.tokens.xor);)t=new ue(this._previous().toString(),t,this._and_expression());return t}_and_expression(){let t=this._equality_expression();for(;this._match(d.tokens.and);)t=new ue(this._previous().toString(),t,this._equality_expression());return t}_equality_expression(){const t=this._relational_expression();return this._match([d.tokens.equal_equal,d.tokens.not_equal])?new ue(this._previous().toString(),t,this._relational_expression()):t}_relational_expression(){let t=this._shift_expression();for(;this._match([d.tokens.less_than,d.tokens.greater_than,d.tokens.less_than_equal,d.tokens.greater_than_equal]);)t=new ue(this._previous().toString(),t,this._shift_expression());return t}_shift_expression(){let t=this._additive_expression();for(;this._match([d.tokens.shift_left,d.tokens.shift_right]);)t=new ue(this._previous().toString(),t,this._additive_expression());return t}_additive_expression(){let t=this._multiplicative_expression();for(;this._match([d.tokens.plus,d.tokens.minus]);)t=new ue(this._previous().toString(),t,this._multiplicative_expression());return t}_multiplicative_expression(){let t=this._unary_expression();for(;this._match([d.tokens.star,d.tokens.forward_slash,d.tokens.modulo]);)t=new ue(this._previous().toString(),t,this._unary_expression());return t}_unary_expression(){return this._match([d.tokens.minus,d.tokens.bang,d.tokens.tilde,d.tokens.star,d.tokens.and])?new br(this._previous().toString(),this._unary_expression()):this._singular_expression()}_singular_expression(){const t=this._primary_expression(),e=this._postfix_expression();return e&&(t.postfix=e),t}_postfix_expression(){if(this._match(d.tokens.bracket_left)){const t=this._short_circuit_or_expression();this._consume(d.tokens.bracket_right,"Expected ']'.");const e=new Mr(t),n=this._postfix_expression();return n&&(e.postfix=n),e}if(this._match(d.tokens.period)){const t=this._consume(d.tokens.ident,"Expected member name."),e=this._postfix_expression(),n=new Sr(t.lexeme);return e&&(n.postfix=e),n}return null}_getStruct(t){return this._context.aliases.has(t)?this._context.aliases.get(t).type:this._context.structs.has(t)?this._context.structs.get(t):null}_primary_expression(){if(this._match(d.tokens.ident)){const n=this._previous().toString();if(this._check(d.tokens.paren_left)){const o=this._argument_expression_list(),f=this._getStruct(n);return f!=null?new He(f,o):new On(n,o)}if(this._context.constants.has(n)){const o=this._context.constants.get(n);return new cn(n,o.value)}return new Ps(n)}if(this._match(d.const_literal))return new un(parseFloat(this._previous().toString()));if(this._check(d.tokens.paren_left))return this._paren_expression();if(this._match(d.keywords.bitcast)){this._consume(d.tokens.less_than,"Expected '<'.");const n=this._type_decl();this._consume(d.tokens.greater_than,"Expected '>'.");const o=this._paren_expression();return new Nr(n,o)}const t=this._type_decl(),e=this._argument_expression_list();return new He(t,e)}_argument_expression_list(){if(!this._match(d.tokens.paren_left))return null;const t=[];do{if(this._check(d.tokens.paren_right))break;const e=this._short_circuit_or_expression();t.push(e)}while(this._match(d.tokens.comma));return this._consume(d.tokens.paren_right,"Expected ')' for agument list"),t}_optional_paren_expression(){this._match(d.tokens.paren_left);const t=this._short_circuit_or_expression();return this._match(d.tokens.paren_right),new hn([t])}_paren_expression(){this._consume(d.tokens.paren_left,"Expected '('.");const t=this._short_circuit_or_expression();return this._consume(d.tokens.paren_right,"Expected ')'."),new hn([t])}_struct_decl(){if(!this._match(d.keywords.struct))return null;const t=this._currentLine,e=this._consume(d.tokens.ident,"Expected name for struct.").toString();this._consume(d.tokens.brace_left,"Expected '{' for struct body.");const n=[];for(;!this._check(d.tokens.brace_right);){const k=this._attribute(),N=this._consume(d.tokens.ident,"Expected variable name.").toString();this._consume(d.tokens.colon,"Expected ':' for struct member type.");const R=this._attribute(),I=this._type_decl();I!=null&&(I.attributes=R),this._check(d.tokens.brace_right)?this._match(d.tokens.comma):this._consume(d.tokens.comma,"Expected ',' for struct member."),n.push(new Ir(N,I,k))}this._consume(d.tokens.brace_right,"Expected '}' after struct body.");const o=this._currentLine,f=new Fe(e,n,t,o);return this._context.structs.set(e,f),f}_global_variable_decl(){const t=this._variable_decl();return t&&this._match(d.tokens.equal)&&(t.value=this._const_expression()),t}_override_variable_decl(){const t=this._override_decl();return t&&this._match(d.tokens.equal)&&(t.value=this._const_expression()),t}_global_const_decl(){if(!this._match(d.keywords.const))return null;const t=this._consume(d.tokens.ident,"Expected variable name");let e=null;if(this._match(d.tokens.colon)){const f=this._attribute();e=this._type_decl(),e!=null&&(e.attributes=f)}let n=null;if(this._match(d.tokens.equal)){const f=this._short_circuit_or_expression();if(f instanceof He)n=f;else if(f instanceof cn&&f.initializer instanceof He)n=f.initializer;else try{const k=f.evaluate(this._context);n=new un(k)}catch{n=f}}const o=new an(t.toString(),e,"","",n);return this._context.constants.set(o.name,o),o}_global_let_decl(){if(!this._match(d.keywords.let))return null;const t=this._consume(d.tokens.ident,"Expected variable name");let e=null;if(this._match(d.tokens.colon)){const o=this._attribute();e=this._type_decl(),e!=null&&(e.attributes=o)}let n=null;return this._match(d.tokens.equal)&&(n=this._const_expression()),new Rs(t.toString(),e,"","",n)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(d.keywords.var))return null;let t="",e="";this._match(d.tokens.less_than)&&(t=this._consume(d.storage_class,"Expected storage_class.").toString(),this._match(d.tokens.comma)&&(e=this._consume(d.access_mode,"Expected access_mode.").toString()),this._consume(d.tokens.greater_than,"Expected '>'."));const n=this._consume(d.tokens.ident,"Expected variable name");let o=null;if(this._match(d.tokens.colon)){const f=this._attribute();o=this._type_decl(),o!=null&&(o.attributes=f)}return new Be(n.toString(),o,t,e,null)}_override_decl(){if(!this._match(d.keywords.override))return null;const t=this._consume(d.tokens.ident,"Expected variable name");let e=null;if(this._match(d.tokens.colon)){const n=this._attribute();e=this._type_decl(),e!=null&&(e.attributes=n)}return new An(t.toString(),e,null)}_diagnostic(){this._consume(d.tokens.paren_left,"Expected '('");const t=this._consume(d.tokens.ident,"Expected severity control name.");this._consume(d.tokens.comma,"Expected ','");const e=this._consume(d.tokens.ident,"Expected diagnostic rule name.");return this._consume(d.tokens.paren_right,"Expected ')'"),new Tr(t.toString(),e.toString())}_enable_directive(){const t=this._consume(d.tokens.ident,"identity expected.");return new xr(t.toString())}_requires_directive(){const t=[this._consume(d.tokens.ident,"identity expected.").toString()];for(;this._match(d.tokens.comma);){const e=this._consume(d.tokens.ident,"identity expected.");t.push(e.toString())}return new kr(t)}_type_alias(){const t=this._consume(d.tokens.ident,"identity expected.");this._consume(d.tokens.equal,"Expected '=' for type alias.");let e=this._type_decl();if(e===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(e.name)&&(e=this._context.aliases.get(e.name).type);const n=new Nn(t.toString(),e);return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([d.tokens.ident,...d.texel_format,d.keywords.bool,d.keywords.f32,d.keywords.i32,d.keywords.u32])){const n=this._advance(),o=n.toString();return this._context.structs.has(o)?this._context.structs.get(o):this._context.aliases.has(o)?this._context.aliases.get(o).type:new We(n.toString())}let t=this._texture_sampler_types();if(t)return t;if(this._check(d.template_types)){let n=this._advance().toString(),o=null,f=null;return this._match(d.tokens.less_than)&&(o=this._type_decl(),f=null,this._match(d.tokens.comma)&&(f=this._consume(d.access_mode,"Expected access_mode for pointer").toString()),this._consume(d.tokens.greater_than,"Expected '>' for type.")),new Mn(n,o,f)}if(this._match(d.keywords.ptr)){let n=this._previous().toString();this._consume(d.tokens.less_than,"Expected '<' for pointer.");const o=this._consume(d.storage_class,"Expected storage_class for pointer");this._consume(d.tokens.comma,"Expected ',' for pointer.");const f=this._type_decl();let k=null;return this._match(d.tokens.comma)&&(k=this._consume(d.access_mode,"Expected access_mode for pointer").toString()),this._consume(d.tokens.greater_than,"Expected '>' for pointer."),new Ar(n,o.toString(),f,k)}const e=this._attribute();if(this._match(d.keywords.array)){let n=null,o=-1;const f=this._previous();let k=null;if(this._match(d.tokens.less_than)){n=this._type_decl(),this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);let R="";if(this._match(d.tokens.comma)){k=this._shift_expression();try{R=k.evaluate(this._context).toString(),k=null}catch{R="1"}}this._consume(d.tokens.greater_than,"Expected '>' for array."),o=R?parseInt(R):0}const N=new bn(f.toString(),e,n,o);return k&&this._deferArrayCountEval.push({arrayType:N,countNode:k}),N}return null}_texture_sampler_types(){if(this._match(d.sampler_type))return new as(this._previous().toString(),null,null);if(this._match(d.depth_texture_type))return new as(this._previous().toString(),null,null);if(this._match(d.sampled_texture_type)||this._match(d.multisampled_texture_type)){const t=this._previous();this._consume(d.tokens.less_than,"Expected '<' for sampler type.");const e=this._type_decl();return this._consume(d.tokens.greater_than,"Expected '>' for sampler type."),new as(t.toString(),e,null)}if(this._match(d.storage_texture_type)){const t=this._previous();this._consume(d.tokens.less_than,"Expected '<' for sampler type.");const e=this._consume(d.texel_format,"Invalid texel format.").toString();this._consume(d.tokens.comma,"Expected ',' after texel format.");const n=this._consume(d.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(d.tokens.greater_than,"Expected '>' for sampler type."),new as(t.toString(),e,n)}return null}_attribute(){let t=[];for(;this._match(d.tokens.attr);){const e=this._consume(d.attribute_name,"Expected attribute name"),n=new Fr(e.toString(),null);if(this._match(d.tokens.paren_left)){if(n.value=this._consume(d.literal_or_ident,"Expected attribute value").toString(),this._check(d.tokens.comma)){this._advance();do{const o=this._consume(d.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(o)}while(this._match(d.tokens.comma))}this._consume(d.tokens.paren_right,"Expected ')'")}t.push(n)}return t.length==0?null:t}}class Ze{constructor(t,e){this.name=t,this.attributes=e,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}}class _n{constructor(t,e,n){this.name=t,this.type=e,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Ts extends Ze{constructor(t,e){super(t,e),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class Ms extends Ze{constructor(t,e){super(t,e),this.count=0,this.stride=0}get isArray(){return!0}}class fn extends Ze{constructor(t,e,n,o){super(t,n),this.format=e,this.access=o}get isTemplate(){return!0}}var Ae;(function(h){h[h.Uniform=0]="Uniform",h[h.Storage=1]="Storage",h[h.Texture=2]="Texture",h[h.Sampler=3]="Sampler",h[h.StorageTexture=4]="StorageTexture"})(Ae||(Ae={}));class Es{constructor(t,e,n,o,f,k,N){this.name=t,this.type=e,this.group=n,this.binding=o,this.attributes=f,this.resourceType=k,this.access=N}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Gr{constructor(t,e){this.name=t,this.type=e}}class vs{constructor(t,e){this.align=t,this.size=e}}class qr{constructor(t,e,n,o){this.name=t,this.type=e,this.locationType=n,this.location=o,this.interpolation=null}}class dn{constructor(t,e,n,o){this.name=t,this.type=e,this.locationType=n,this.location=o}}class zr{constructor(t,e,n,o){this.name=t,this.type=e,this.attributes=n,this.id=o}}class Cr{constructor(t,e){this.name=t,this.type=e}}class Vr{constructor(t,e=null){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=t,this.stage=e}}class $r{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}class Xr{constructor(t){this.resources=null,this.inUse=!1,this.info=null,this.node=t}}class Ee{constructor(t){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new $r,this.functions=[],this._types=new Map,this._functions=new Map,t&&this.update(t)}_isStorageTexture(t){return t.name=="texture_storage_1d"||t.name=="texture_storage_2d"||t.name=="texture_storage_2d_array"||t.name=="texture_storage_3d"}update(t){const n=new Lr().parse(t);for(const o of n)o instanceof Us&&this._functions.set(o.name,new Xr(o));for(const o of n)if(o instanceof Fe){const f=this._getTypeInfo(o,null);f instanceof Ts&&this.structs.push(f)}for(const o of n){if(o instanceof Nn){this.aliases.push(this._getAliasInfo(o));continue}if(o instanceof An){const f=o,k=this._getAttributeNum(f.attributes,"id",0),N=f.type!=null?this._getTypeInfo(f.type,f.attributes):null;this.overrides.push(new zr(f.name,N,f.attributes,k));continue}if(this._isUniformVar(o)){const f=o,k=this._getAttributeNum(f.attributes,"group",0),N=this._getAttributeNum(f.attributes,"binding",0),R=this._getTypeInfo(f.type,f.attributes),I=new Es(f.name,R,k,N,f.attributes,Ae.Uniform,f.access);this.uniforms.push(I);continue}if(this._isStorageVar(o)){const f=o,k=this._getAttributeNum(f.attributes,"group",0),N=this._getAttributeNum(f.attributes,"binding",0),R=this._getTypeInfo(f.type,f.attributes),I=this._isStorageTexture(R),B=new Es(f.name,R,k,N,f.attributes,I?Ae.StorageTexture:Ae.Storage,f.access);this.storage.push(B);continue}if(this._isTextureVar(o)){const f=o,k=this._getAttributeNum(f.attributes,"group",0),N=this._getAttributeNum(f.attributes,"binding",0),R=this._getTypeInfo(f.type,f.attributes),I=this._isStorageTexture(R),B=new Es(f.name,R,k,N,f.attributes,I?Ae.StorageTexture:Ae.Texture,f.access);I?this.storage.push(B):this.textures.push(B);continue}if(this._isSamplerVar(o)){const f=o,k=this._getAttributeNum(f.attributes,"group",0),N=this._getAttributeNum(f.attributes,"binding",0),R=this._getTypeInfo(f.type,f.attributes),I=new Es(f.name,R,k,N,f.attributes,Ae.Sampler,f.access);this.samplers.push(I);continue}if(o instanceof Us){const f=this._getAttribute(o,"vertex"),k=this._getAttribute(o,"fragment"),N=this._getAttribute(o,"compute"),R=f||k||N,I=new Vr(o.name,R==null?void 0:R.name);I.startLine=o.startLine,I.endLine=o.endLine,this.functions.push(I),this._functions.get(o.name).info=I,R&&(this._functions.get(o.name).inUse=!0,I.inUse=!0,I.resources=this._findResources(o,!!R),I.inputs=this._getInputs(o.args),I.outputs=this._getOutputs(o.returnType),this.entry[R.name].push(I)),I.arguments=o.args.map(B=>new Cr(B.name,this._getTypeInfo(B.type,B.attributes))),I.returnType=o.returnType?this._getTypeInfo(o.returnType,o.attributes):null;continue}}for(const o of this._functions.values())o.info&&(o.info.inUse=o.inUse,this._addCalls(o.node,o.info.calls));for(const o of this._functions.values())o.node.search(f=>{var k;if(f.astNodeType==="varExpr"){const N=f;for(const R of this.overrides)N.name==R.name&&((k=o.info)===null||k===void 0||k.overrides.push(R))}});for(const o of this.uniforms)this._markStructsInUse(o.type);for(const o of this.storage)this._markStructsInUse(o.type)}_markStructsInUse(t){if(t)if(t.isStruct){if(t.inUse=!0,t.members)for(const e of t.members)this._markStructsInUse(e.type)}else if(t.isArray)this._markStructsInUse(t.format);else if(t.isTemplate)t.format&&this._markStructsInUse(t.format);else{const e=this._getAlias(t.name);e&&this._markStructsInUse(e)}}_addCalls(t,e){var n;for(const o of t.calls){const f=(n=this._functions.get(o.name))===null||n===void 0?void 0:n.info;f&&e.add(f)}}findResource(t,e){for(const n of this.uniforms)if(n.group==t&&n.binding==e)return n;for(const n of this.storage)if(n.group==t&&n.binding==e)return n;for(const n of this.textures)if(n.group==t&&n.binding==e)return n;for(const n of this.samplers)if(n.group==t&&n.binding==e)return n;return null}_findResource(t){for(const e of this.uniforms)if(e.name==t)return e;for(const e of this.storage)if(e.name==t)return e;for(const e of this.textures)if(e.name==t)return e;for(const e of this.samplers)if(e.name==t)return e;return null}_markStructsFromAST(t){const e=this._getTypeInfo(t,null);this._markStructsInUse(e)}_findResources(t,e){const n=[],o=this,f=[];return t.search(k=>{if(k instanceof Ds)f.push({});else if(k instanceof As)f.pop();else if(k instanceof Be){const N=k;e&&N.type!==null&&this._markStructsFromAST(N.type),f.length>0&&(f[f.length-1][N.name]=N)}else if(k instanceof He){const N=k;e&&N.type!==null&&this._markStructsFromAST(N.type)}else if(k instanceof Rs){const N=k;e&&N.type!==null&&this._markStructsFromAST(N.type),f.length>0&&(f[f.length-1][N.name]=N)}else if(k instanceof Ps){const N=k;if(f.length>0&&f[f.length-1][N.name])return;const R=o._findResource(N.name);R&&n.push(R)}else if(k instanceof On){const N=k,R=o._functions.get(N.name);R&&(e&&(R.inUse=!0),t.calls.add(R.node),R.resources===null&&(R.resources=o._findResources(R.node,e)),n.push(...R.resources))}else if(k instanceof Sn){const N=k,R=o._functions.get(N.name);R&&(e&&(R.inUse=!0),t.calls.add(R.node),R.resources===null&&(R.resources=o._findResources(R.node,e)),n.push(...R.resources))}}),[...new Map(n.map(k=>[k.name,k])).values()]}getBindGroups(){const t=[];function e(n,o){n>=t.length&&(t.length=n+1),t[n]===void 0&&(t[n]=[]),o>=t[n].length&&(t[n].length=o+1)}for(const n of this.uniforms){e(n.group,n.binding);const o=t[n.group];o[n.binding]=n}for(const n of this.storage){e(n.group,n.binding);const o=t[n.group];o[n.binding]=n}for(const n of this.textures){e(n.group,n.binding);const o=t[n.group];o[n.binding]=n}for(const n of this.samplers){e(n.group,n.binding);const o=t[n.group];o[n.binding]=n}return t}_getOutputs(t,e=void 0){if(e===void 0&&(e=[]),t instanceof Fe)this._getStructOutputs(t,e);else{const n=this._getOutputInfo(t);n!==null&&e.push(n)}return e}_getStructOutputs(t,e){for(const n of t.members)if(n.type instanceof Fe)this._getStructOutputs(n.type,e);else{const o=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(o!==null){const f=this._getTypeInfo(n.type,n.type.attributes),k=this._parseInt(o.value),N=new dn(n.name,f,o.name,k);e.push(N)}}}_getOutputInfo(t){const e=this._getAttribute(t,"location")||this._getAttribute(t,"builtin");if(e!==null){const n=this._getTypeInfo(t,t.attributes),o=this._parseInt(e.value);return new dn("",n,e.name,o)}return null}_getInputs(t,e=void 0){e===void 0&&(e=[]);for(const n of t)if(n.type instanceof Fe)this._getStructInputs(n.type,e);else{const o=this._getInputInfo(n);o!==null&&e.push(o)}return e}_getStructInputs(t,e){for(const n of t.members)if(n.type instanceof Fe)this._getStructInputs(n.type,e);else{const o=this._getInputInfo(n);o!==null&&e.push(o)}}_getInputInfo(t){const e=this._getAttribute(t,"location")||this._getAttribute(t,"builtin");if(e!==null){const n=this._getAttribute(t,"interpolation"),o=this._getTypeInfo(t.type,t.attributes),f=this._parseInt(e.value),k=new qr(t.name,o,e.name,f);return n!==null&&(k.interpolation=this._parseString(n.value)),k}return null}_parseString(t){return t instanceof Array&&(t=t[0]),t}_parseInt(t){t instanceof Array&&(t=t[0]);const e=parseInt(t);return isNaN(e)?t:e}_getAlias(t){for(const e of this.aliases)if(e.name==t)return e.type;return null}_getAliasInfo(t){return new Gr(t.name,this._getTypeInfo(t.type,null))}_getTypeInfo(t,e){if(this._types.has(t))return this._types.get(t);if(t instanceof bn){const o=t,f=o.format?this._getTypeInfo(o.format,o.attributes):null,k=new Ms(o.name,e);return k.format=f,k.count=o.count,this._types.set(t,k),this._updateTypeInfo(k),k}if(t instanceof Fe){const o=t,f=new Ts(o.name,e);f.startLine=o.startLine,f.endLine=o.endLine;for(const k of o.members){const N=this._getTypeInfo(k.type,k.attributes);f.members.push(new _n(k.name,N,k.attributes))}return this._types.set(t,f),this._updateTypeInfo(f),f}if(t instanceof as){const o=t,f=o.format instanceof We,k=o.format?f?this._getTypeInfo(o.format,null):new Ze(o.format,null):null,N=new fn(o.name,k,e,o.access);return this._types.set(t,N),this._updateTypeInfo(N),N}if(t instanceof Mn){const o=t,f=o.format?this._getTypeInfo(o.format,null):null,k=new fn(o.name,f,e,o.access);return this._types.set(t,k),this._updateTypeInfo(k),k}const n=new Ze(t.name,e);return this._types.set(t,n),this._updateTypeInfo(n),n}_updateTypeInfo(t){var e,n;const o=this._getTypeSize(t);if(t.size=(e=o==null?void 0:o.size)!==null&&e!==void 0?e:0,t instanceof Ms&&t.format){const f=this._getTypeSize(t.format);t.stride=(n=f==null?void 0:f.size)!==null&&n!==void 0?n:0,this._updateTypeInfo(t.format)}t instanceof Ts&&this._updateStructInfo(t)}_updateStructInfo(t){var e;let n=0,o=0,f=0,k=0;for(let N=0,R=t.members.length;N<R;++N){const I=t.members[N],B=this._getTypeSize(I);if(!B)continue;(e=this._getAlias(I.type.name))!==null&&e!==void 0||I.type;const C=B.align,J=B.size;n=this._roundUp(C,n+o),o=J,f=n,k=Math.max(k,C),I.offset=n,I.size=J,this._updateTypeInfo(I.type)}t.size=this._roundUp(k,f+o),t.align=k}_getTypeSize(t){var e,n;if(t==null)return null;const o=this._getAttributeNum(t.attributes,"size",0),f=this._getAttributeNum(t.attributes,"align",0);if(t instanceof _n&&(t=t.type),t instanceof Ze){const k=this._getAlias(t.name);k!==null&&(t=k)}{const k=Ee._typeInfo[t.name];if(k!==void 0){const N=((e=t.format)===null||e===void 0?void 0:e.name)==="f16"?2:1;return new vs(Math.max(f,k.align/N),Math.max(o,k.size/N))}}{const k=Ee._typeInfo[t.name.substring(0,t.name.length-1)];if(k){const N=t.name[t.name.length-1]==="h"?2:1;return new vs(Math.max(f,k.align/N),Math.max(o,k.size/N))}}if(t instanceof Ms){let k=t,N=8,R=8;const I=this._getTypeSize(k.format);I!==null&&(R=I.size,N=I.align);const B=k.count,C=this._getAttributeNum((n=t==null?void 0:t.attributes)!==null&&n!==void 0?n:null,"stride",this._roundUp(N,R));return R=B*C,o&&(R=o),new vs(Math.max(f,N),Math.max(o,R))}if(t instanceof Ts){let k=0,N=0,R=0,I=0,B=0;for(const C of t.members){const J=this._getTypeSize(C.type);J!==null&&(k=Math.max(J.align,k),R=this._roundUp(J.align,R+I),I=J.size,B=R)}return N=this._roundUp(k,B+I),new vs(Math.max(f,k),Math.max(o,N))}return null}_isUniformVar(t){return t instanceof Be&&t.storage=="uniform"}_isStorageVar(t){return t instanceof Be&&t.storage=="storage"}_isTextureVar(t){return t instanceof Be&&t.type!==null&&Ee._textureTypes.indexOf(t.type.name)!=-1}_isSamplerVar(t){return t instanceof Be&&t.type!==null&&Ee._samplerTypes.indexOf(t.type.name)!=-1}_getAttribute(t,e){const n=t;if(!n||!n.attributes)return null;const o=n.attributes;for(let f of o)if(f.name==e)return f;return null}_getAttributeNum(t,e,n){if(t===null)return n;for(let o of t)if(o.name==e){let f=o!==null&&o.value!==null?o.value:n;return f instanceof Array&&(f=f[0]),typeof f=="number"?f:typeof f=="string"?parseInt(f):n}return n}_roundUp(t,e){return Math.ceil(e/t)*t}}Ee._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}};Ee._textureTypes=d.any_texture_type.map(h=>h.name);Ee._samplerTypes=d.sampler_type.map(h=>h.name);var Wr="@vertex fn vertex()->@builtin(position)vec4f {return vec4f(0);}@fragment fn fragment()->@location(0)vec4f {return vec4f(0);}@compute @workgroup_size(1)fn compute(){}",Ge,qe,Se,Ne,hs,ls,Je,Me,Mt,cs,Qe,In;class Pn{constructor(t,e,n){z(this,Mt);z(this,Ge);z(this,qe);z(this,Se);Ie(this,"Device");Ie(this,"BindGroups",[]);Ie(this,"Reflect");z(this,Ne);Ie(this,"Pipeline");Ie(this,"Descriptor");z(this,hs);z(this,ls);z(this,Je);z(this,Me,[]);!t&&K(X.DEVICE_NOT_REQUESTED),F(this,Ge,n),this.Device=t,F(this,qe,e),F(this,Se,this.CreatePipelineLabel("Command Encoder"))}CreatePipelineLabel(t){return x(this,qe)&&t&&`${x(this,qe)} ${t}`||""}CreatePipelineLayout(t,e){e??(e=this.CreatePipelineLabel(`${x(this,Ge)} Pipeline Layout`));const n=Array.isArray(t)&&t||[t];return this.Device.createPipelineLayout({label:e,bindGroupLayouts:n})}CreateTimestampWrites(t,e,n){return{querySet:t,beginningOfPassWriteIndex:e,endOfPassWriteIndex:n}}ResolveQuerySet(t,e,n=0,o=t.count,f=0){this.GetCommandEncoder(!0).resolveQuerySet(t,n,o,e,f)}CreateShaderModule(t,e,n,o){t||(t=Wr,ke(X.SHADER_CODE_NOT_FOUND)),e??(e=this.CreatePipelineLabel("Shader Module"));const f=Array.isArray(t)&&t.join(`

`)||t;return this.Reflect=new Ee(f),this.Device.createShaderModule({label:e,code:f,sourceMap:n,compilationHints:o})}GetShaderModule(t){return t instanceof GPUShaderModule&&t||t.module}CreateBuffer(t){const e=t.label??this.CreatePipelineLabel("Buffer");return this.Device.createBuffer({label:e,...t})}CreateReadableBuffer(t){let e=typeof t=="number"&&t;e||(e=t.size);const n=(t==null?void 0:t.label)??"Readable Buffer";return this.CreateBuffer({label:n,size:e,usage:Te.READABLE,...t})}CreateWritableBuffer(t){let e=typeof t=="number"&&t;e||(e=t.size);const n=(t==null?void 0:t.label)??"Writable Buffer";return this.CreateBuffer({label:n,size:e,usage:Te.WRITABLE,...t})}CreateStorageBuffer(t,e=1){!this.Reflect&&K(X.SHADER_MODULE_NOT_FOUND,"`CreateStorageBuffer`.\n            Use `CreateShaderModule` before creating a storage buffer.");const n=this.Reflect.storage.find(({name:B})=>t===B);!n&&K(X.STORAGE_NOT_FOUND,`\`${t}\` in shader bindings.`);const o=typeof e=="number"&&e||e.length,f=e.label??`${t} Storage Buffer`,k=n.format.size*o,N=new ArrayBuffer(k),R=B=>(Object.keys(B).forEach(C=>{if(!(B[C].buffer instanceof ArrayBuffer))R(B[C]);else{const J=B[C].constructor,tt=k/J.BYTES_PER_ELEMENT;B[C]=new J(N,0,tt)}}),B),I=$(this,Mt,cs).call(this,n,N);return{buffer:this.CreateBuffer({label:f,size:k,usage:Te.STORAGE,...e}),[t]:I.buffer instanceof ArrayBuffer?new I.constructor(N,0,o):R(I)}}CreateUniformBuffer(t,e){!this.Reflect&&K(X.SHADER_MODULE_NOT_FOUND,"`CreateUniformBuffer`.\n            Use `CreateShaderModule` before creating a uniform buffer.");const n=this.Reflect.uniforms.find(({name:k})=>t===k);!n&&K(X.UNIFORM_NOT_FOUND,`\`${t}\` in shader uniforms.`),t==="resolution"&&ke(X.INVALID_UNIFORM_NAME,`\`${t}\`.`);const o=(e==null?void 0:e.label)??`${t} Uniform Buffer`,f=new ArrayBuffer(n.size);return{buffer:this.CreateBuffer({label:o,size:f.byteLength,usage:Te.UNIFORM,...e}),[t]:$(this,Mt,cs).call(this,n,f)}}CreateUniformBufferLayout(t){!this.Reflect&&K(X.SHADER_MODULE_NOT_FOUND,"`CreateUniformBufferLayout`.\n            Use `CreateShaderModule` before creating a uniform buffer layout.");const e=this.Reflect.uniforms.find(({name:n})=>t===n);return!e&&K(X.UNIFORM_NOT_FOUND,`\`${t}\` in shader uniforms.`),t==="resolution"&&ke(X.INVALID_UNIFORM_NAME,`\`${t}\`.`),$(this,Mt,cs).call(this,e,new ArrayBuffer(e.size))}WriteBuffer(t,e,n=0,o,f){this.Device.queue.writeBuffer(t,n,e,o,f)}CopyBufferToBuffer(t,e,n=e.size,o=0,f=0){this.GetCommandEncoder(!0).copyBufferToBuffer(t,o,e,f,n)}GetBufferMinBindingSize(t){!this.Reflect&&K(X.SHADER_MODULE_NOT_FOUND,"`GetBufferMinBindingSize`.\n            Use `CreateShaderModule` before requesting buffer's min binding size.");const n=this.Reflect.getBindGroups().flat().find(({name:o})=>t===o);return(n==null?void 0:n.size)??K(X.BINDING_NOT_FOUND,`\`${t}\` in shader bind groups.`)}CreateBufferBindingLayout(t,e,n,o,f){return o??(o=$(this,Mt,Qe).call(this)),{binding:f,visibility:o,buffer:{type:t,hasDynamicOffset:e,minBindingSize:n}}}CreateSamplerBindingLayout(t,e,n){return e??(e=$(this,Mt,Qe).call(this)),{binding:n,visibility:e,sampler:{type:t}}}CreateTextureBindingLayout(t,e,n,o,f){return o??(o=$(this,Mt,Qe).call(this)),{binding:f,visibility:o,texture:{sampleType:t,viewDimension:e,multisampled:n}}}CreateStorageTextureBindingLayout(t,e,n,o,f){return o??(o=$(this,Mt,Qe).call(this)),{binding:f,visibility:o,storageTexture:{access:e,format:t,viewDimension:n}}}CreateExternalTextureBindingLayout(t,e){return t??(t=$(this,Mt,Qe).call(this)),{binding:e,visibility:t,externalTexture:{}}}CreateBindGroupEntries(t,e=0){return Array.isArray(t)&&t.map((n,o)=>({binding:(e==null?void 0:e[o])??o,resource:n}))||[{binding:e,resource:t}]}CreateBindGroupLayout(t,e){return e??(e=this.CreatePipelineLabel("Bind Group Layout")),t=Array.isArray(t)&&t.map((n,o)=>({...n,binding:n.binding??o}))||[{...t,binding:t.binding??0}],this.Device.createBindGroupLayout({entries:t,label:e})}CreateBindGroup(t,e=0,n){return n??(n=this.CreatePipelineLabel("Bind Group")),typeof e=="number"&&(e=this.Pipeline?this.Pipeline.getBindGroupLayout(e):K(X.PIPELINE_NOT_FOUND,`${x(this,Ge)}Pipeline.`)),this.Device.createBindGroup({entries:t,label:n,layout:e})}SetBindGroups(t,e){const n=Array.isArray(t),o=Array.isArray(e);e=n&&o?e.map(f=>Array.isArray(f)&&f||[f]):o&&e||e&&[e],e=e&&e||[],this.BindGroups=n&&t.map((f,k)=>({bindGroup:f,dynamicOffsets:e,active:!0}))||[{bindGroup:t,dynamicOffsets:e,active:!0}]}AddBindGroups(t,e){const n=Array.isArray(t),o=Array.isArray(e);return e=n&&o?e.map(f=>Array.isArray(f)&&f||[f]):o&&e||e&&[e],e=e&&e||[],this.BindGroups.push(...n&&t.map(f=>({bindGroup:f,dynamicOffsets:e,active:!0}))||[{bindGroup:t,dynamicOffsets:e,active:!0}])}SetActiveBindGroups(t){t=Array.isArray(t)&&t||[t];for(let e=this.BindGroups.length;e--;)this.BindGroups[e].active=t.includes(e)}ClearBindGroups(){this.BindGroups.splice(0)}GetBindGroupsInfo(){!this.Reflect&&K(X.SHADER_MODULE_NOT_FOUND,"`GetBindGroupsInfo`.\n            Use `CreateShaderModule` before requesting bind groups information.");const t=this.BindGroups.length,e=new Array(t),n=this.Reflect.getBindGroups();for(let o=0;o<t;++o){const{bindGroup:{label:f},dynamicOffsets:k,active:N}=this.BindGroups[o];e[o]={label:f,active:N,dynamicOffsets:k,bindings:n[o]}}return e}CreateCommandEncoder(){return F(this,Ne,this.Device.createCommandEncoder({label:x(this,Se)}))}SetCommandEncoder(t){F(this,Ne,t)}GetCommandEncoder(t=!1){if(!x(this,Ne)){if(t){const e=`${x(this,Se)&&`Label: "${x(this,Se)}".`}`;ke(X.COMMAND_ENCODER_NOT_FOUND,` ${e} Creating a new one.`)}return this.CreateCommandEncoder()}return x(this,Ne)}SubmitCommandBuffer(){this.Device.queue.submit([x(this,Ne).finish()])}SetPipeline(t){return this.Pipeline=t}SavePipelineState(){F(this,Je,this.Reflect),F(this,ls,this.Pipeline),F(this,hs,this.Descriptor),F(this,Me,[...this.BindGroups])}ResetPipelineState(){this.ClearBindGroups()}RestorePipelineState(){this.Descriptor=x(this,hs),this.SetPipeline(x(this,ls)),this.Reflect=x(this,Je),$(this,Mt,In).call(this)}set CommandEncoderLabel(t){F(this,Se,t)}get ProgramName(){return x(this,qe)}Destroy(){this.ResetPipelineState(),F(this,Je,void 0),x(this,Me).splice(0),this.SetCommandEncoder(void 0)}}Ge=new WeakMap,qe=new WeakMap,Se=new WeakMap,Ne=new WeakMap,hs=new WeakMap,ls=new WeakMap,Je=new WeakMap,Me=new WeakMap,Mt=new WeakSet,cs=function(t,e,n=0,o=[]){const{format:f}=t.type,k=t.type.members??(f==null?void 0:f.members);let N=n+(t.offset??0);if(k)for(let R=0,I={},B=(f==null?void 0:f.isStruct)&&t.count||1;R<B;++R)k.forEach(C=>I[C.name]=$(this,Mt,cs).call(this,C,e,N)),f!=null&&f.isStruct&&(N+=t.stride),o.push(I);else{const R=or((f??t.type).name),I=t.size/ar(R),B=cr(R);return new B(e,N,I)}return o.length===1&&o[0]||o},Qe=function(){return x(this,Ge)==="Render"&&GPUShaderStage.FRAGMENT||GPUShaderStage.COMPUTE},In=function(){const t=x(this,Me).map(({bindGroup:f})=>f),e=x(this,Me).map(({dynamicOffsets:f})=>f),n=e.some(f=>typeof f=="number")&&e||void 0,o=x(this,Me).map(({active:f},k)=>f&&k).filter(f=>typeof f=="number");this.SetBindGroups(t,n),this.SetActiveBindGroups(o)};var le,_e,fe,Ct;const $s=class $s{constructor(t=0,e,n,o=255){z(this,le,0);z(this,_e,0);z(this,fe,0);z(this,Ct,1);typeof e=="number"&&typeof n=="number"?this.RGBA=[t,e,n,o]:(F(this,le,(t>>16&255)/255),F(this,_e,(t>>8&255)/255),F(this,fe,(t&255)/255),F(this,Ct,o/255))}Set(t,e=255){return F(this,le,(t>>16&255)/255),F(this,_e,(t>>8&255)/255),F(this,fe,(t&255)/255),F(this,Ct,e/255),this}Premultiply(t,e){e??(e=new $s),t??(t=x(this,Ct));const n=x(this,le)*t,o=x(this,_e)*t,f=x(this,fe)*t;return e.rgba=[n,o,f,t],e}set rgb(t){F(this,le,t[0]),F(this,_e,t[1]),F(this,fe,t[2]),F(this,Ct,t[3]??1)}get rgb(){return[x(this,le),x(this,_e),x(this,fe)]}set a(t){F(this,Ct,t)}get a(){return x(this,Ct)}set rgba(t){this.rgb=t}get rgba(){return this.rgb.concat(x(this,Ct))}set RGB(t){F(this,le,t[0]/255),F(this,_e,t[1]/255),F(this,fe,t[2]/255),F(this,Ct,(t[3]??255)/255)}get RGB(){return[x(this,le)*255,x(this,_e)*255,x(this,fe)*255]}set A(t){F(this,Ct,t/255)}get A(){return x(this,Ct)*255}set RGBA(t){this.RGB=t}get RGBA(){return this.RGB.concat(this.A)}};le=new WeakMap,_e=new WeakMap,fe=new WeakMap,Ct=new WeakMap;let Is=$s;function Qr(h,t){return class extends h{constructor(...e){super(...e),t(this)}}}const Yr=Qr(Array,h=>h.fill(0));let Q=1e-6;function Hr(h){function t(s=0,l=0){const r=new h(2);return s!==void 0&&(r[0]=s,l!==void 0&&(r[1]=l)),r}const e=t;function n(s,l,r){const a=r??new h(2);return a[0]=s,a[1]=l,a}function o(s,l){const r=l??new h(2);return r[0]=Math.ceil(s[0]),r[1]=Math.ceil(s[1]),r}function f(s,l){const r=l??new h(2);return r[0]=Math.floor(s[0]),r[1]=Math.floor(s[1]),r}function k(s,l){const r=l??new h(2);return r[0]=Math.round(s[0]),r[1]=Math.round(s[1]),r}function N(s,l=0,r=1,a){const p=a??new h(2);return p[0]=Math.min(r,Math.max(l,s[0])),p[1]=Math.min(r,Math.max(l,s[1])),p}function R(s,l,r){const a=r??new h(2);return a[0]=s[0]+l[0],a[1]=s[1]+l[1],a}function I(s,l,r,a){const p=a??new h(2);return p[0]=s[0]+l[0]*r,p[1]=s[1]+l[1]*r,p}function B(s,l){const r=s[0],a=s[1],p=l[0],E=l[1],O=Math.sqrt(r*r+a*a),_=Math.sqrt(p*p+E*E),w=O*_,T=w&&Ft(s,l)/w;return Math.acos(T)}function C(s,l,r){const a=r??new h(2);return a[0]=s[0]-l[0],a[1]=s[1]-l[1],a}const J=C;function tt(s,l){return Math.abs(s[0]-l[0])<Q&&Math.abs(s[1]-l[1])<Q}function _t(s,l){return s[0]===l[0]&&s[1]===l[1]}function lt(s,l,r,a){const p=a??new h(2);return p[0]=s[0]+r*(l[0]-s[0]),p[1]=s[1]+r*(l[1]-s[1]),p}function Vt(s,l,r,a){const p=a??new h(2);return p[0]=s[0]+r[0]*(l[0]-s[0]),p[1]=s[1]+r[1]*(l[1]-s[1]),p}function $t(s,l,r){const a=r??new h(2);return a[0]=Math.max(s[0],l[0]),a[1]=Math.max(s[1],l[1]),a}function bt(s,l,r){const a=r??new h(2);return a[0]=Math.min(s[0],l[0]),a[1]=Math.min(s[1],l[1]),a}function Tt(s,l,r){const a=r??new h(2);return a[0]=s[0]*l,a[1]=s[1]*l,a}const jt=Tt;function Rt(s,l,r){const a=r??new h(2);return a[0]=s[0]/l,a[1]=s[1]/l,a}function Pt(s,l){const r=l??new h(2);return r[0]=1/s[0],r[1]=1/s[1],r}const Xt=Pt;function It(s,l,r){const a=r??new h(3),p=s[0]*l[1]-s[1]*l[0];return a[0]=0,a[1]=0,a[2]=p,a}function Ft(s,l){return s[0]*l[0]+s[1]*l[1]}function ft(s){const l=s[0],r=s[1];return Math.sqrt(l*l+r*r)}const Wt=ft;function Z(s){const l=s[0],r=s[1];return l*l+r*r}const et=Z;function H(s,l){const r=s[0]-l[0],a=s[1]-l[1];return Math.sqrt(r*r+a*a)}const Jt=H;function Et(s,l){const r=s[0]-l[0],a=s[1]-l[1];return r*r+a*a}const Kt=Et;function vt(s,l){const r=l??new h(2),a=s[0],p=s[1],E=Math.sqrt(a*a+p*p);return E>1e-5?(r[0]=a/E,r[1]=p/E):(r[0]=0,r[1]=0),r}function te(s,l){const r=l??new h(2);return r[0]=-s[0],r[1]=-s[1],r}function st(s,l){const r=l??new h(2);return r[0]=s[0],r[1]=s[1],r}const ee=st;function Ot(s,l,r){const a=r??new h(2);return a[0]=s[0]*l[0],a[1]=s[1]*l[1],a}const se=Ot;function Ut(s,l,r){const a=r??new h(2);return a[0]=s[0]/l[0],a[1]=s[1]/l[1],a}const Qt=Ut;function Bt(s=1,l){const r=l??new h(2),a=Math.random()*2*Math.PI;return r[0]=Math.cos(a)*s,r[1]=Math.sin(a)*s,r}function c(s){const l=s??new h(2);return l[0]=0,l[1]=0,l}function m(s,l,r){const a=r??new h(2),p=s[0],E=s[1];return a[0]=p*l[0]+E*l[4]+l[12],a[1]=p*l[1]+E*l[5]+l[13],a}function i(s,l,r){const a=r??new h(2),p=s[0],E=s[1];return a[0]=l[0]*p+l[4]*E+l[8],a[1]=l[1]*p+l[5]*E+l[9],a}function u(s,l,r,a){const p=a??new h(2),E=s[0]-l[0],O=s[1]-l[1],_=Math.sin(r),w=Math.cos(r);return p[0]=E*w-O*_+l[0],p[1]=E*_+O*w+l[1],p}function g(s,l,r){const a=r??new h(2);return vt(s,a),Tt(a,l,a)}function y(s,l,r){const a=r??new h(2);return ft(s)>l?g(s,l,a):st(s,a)}function b(s,l,r){const a=r??new h(2);return lt(s,l,.5,a)}return{create:t,fromValues:e,set:n,ceil:o,floor:f,round:k,clamp:N,add:R,addScaled:I,angle:B,subtract:C,sub:J,equalsApproximately:tt,equals:_t,lerp:lt,lerpV:Vt,max:$t,min:bt,mulScalar:Tt,scale:jt,divScalar:Rt,inverse:Pt,invert:Xt,cross:It,dot:Ft,length:ft,len:Wt,lengthSq:Z,lenSq:et,distance:H,dist:Jt,distanceSq:Et,distSq:Kt,normalize:vt,negate:te,copy:st,clone:ee,multiply:Ot,mul:se,divide:Ut,div:Qt,random:Bt,zero:c,transformMat4:m,transformMat3:i,rotate:u,setLength:g,truncate:y,midpoint:b}}const pn=new Map;function Fn(h){let t=pn.get(h);return t||(t=Hr(h),pn.set(h,t)),t}function Zr(h){function t(_,w,T){const v=new h(3);return _!==void 0&&(v[0]=_,w!==void 0&&(v[1]=w,T!==void 0&&(v[2]=T))),v}const e=t;function n(_,w,T,v){const M=v??new h(3);return M[0]=_,M[1]=w,M[2]=T,M}function o(_,w){const T=w??new h(3);return T[0]=Math.ceil(_[0]),T[1]=Math.ceil(_[1]),T[2]=Math.ceil(_[2]),T}function f(_,w){const T=w??new h(3);return T[0]=Math.floor(_[0]),T[1]=Math.floor(_[1]),T[2]=Math.floor(_[2]),T}function k(_,w){const T=w??new h(3);return T[0]=Math.round(_[0]),T[1]=Math.round(_[1]),T[2]=Math.round(_[2]),T}function N(_,w=0,T=1,v){const M=v??new h(3);return M[0]=Math.min(T,Math.max(w,_[0])),M[1]=Math.min(T,Math.max(w,_[1])),M[2]=Math.min(T,Math.max(w,_[2])),M}function R(_,w,T){const v=T??new h(3);return v[0]=_[0]+w[0],v[1]=_[1]+w[1],v[2]=_[2]+w[2],v}function I(_,w,T,v){const M=v??new h(3);return M[0]=_[0]+w[0]*T,M[1]=_[1]+w[1]*T,M[2]=_[2]+w[2]*T,M}function B(_,w){const T=_[0],v=_[1],M=_[2],U=w[0],P=w[1],G=w[2],V=Math.sqrt(T*T+v*v+M*M),L=Math.sqrt(U*U+P*P+G*G),q=V*L,Y=q&&Ft(_,w)/q;return Math.acos(Y)}function C(_,w,T){const v=T??new h(3);return v[0]=_[0]-w[0],v[1]=_[1]-w[1],v[2]=_[2]-w[2],v}const J=C;function tt(_,w){return Math.abs(_[0]-w[0])<Q&&Math.abs(_[1]-w[1])<Q&&Math.abs(_[2]-w[2])<Q}function _t(_,w){return _[0]===w[0]&&_[1]===w[1]&&_[2]===w[2]}function lt(_,w,T,v){const M=v??new h(3);return M[0]=_[0]+T*(w[0]-_[0]),M[1]=_[1]+T*(w[1]-_[1]),M[2]=_[2]+T*(w[2]-_[2]),M}function Vt(_,w,T,v){const M=v??new h(3);return M[0]=_[0]+T[0]*(w[0]-_[0]),M[1]=_[1]+T[1]*(w[1]-_[1]),M[2]=_[2]+T[2]*(w[2]-_[2]),M}function $t(_,w,T){const v=T??new h(3);return v[0]=Math.max(_[0],w[0]),v[1]=Math.max(_[1],w[1]),v[2]=Math.max(_[2],w[2]),v}function bt(_,w,T){const v=T??new h(3);return v[0]=Math.min(_[0],w[0]),v[1]=Math.min(_[1],w[1]),v[2]=Math.min(_[2],w[2]),v}function Tt(_,w,T){const v=T??new h(3);return v[0]=_[0]*w,v[1]=_[1]*w,v[2]=_[2]*w,v}const jt=Tt;function Rt(_,w,T){const v=T??new h(3);return v[0]=_[0]/w,v[1]=_[1]/w,v[2]=_[2]/w,v}function Pt(_,w){const T=w??new h(3);return T[0]=1/_[0],T[1]=1/_[1],T[2]=1/_[2],T}const Xt=Pt;function It(_,w,T){const v=T??new h(3),M=_[2]*w[0]-_[0]*w[2],U=_[0]*w[1]-_[1]*w[0];return v[0]=_[1]*w[2]-_[2]*w[1],v[1]=M,v[2]=U,v}function Ft(_,w){return _[0]*w[0]+_[1]*w[1]+_[2]*w[2]}function ft(_){const w=_[0],T=_[1],v=_[2];return Math.sqrt(w*w+T*T+v*v)}const Wt=ft;function Z(_){const w=_[0],T=_[1],v=_[2];return w*w+T*T+v*v}const et=Z;function H(_,w){const T=_[0]-w[0],v=_[1]-w[1],M=_[2]-w[2];return Math.sqrt(T*T+v*v+M*M)}const Jt=H;function Et(_,w){const T=_[0]-w[0],v=_[1]-w[1],M=_[2]-w[2];return T*T+v*v+M*M}const Kt=Et;function vt(_,w){const T=w??new h(3),v=_[0],M=_[1],U=_[2],P=Math.sqrt(v*v+M*M+U*U);return P>1e-5?(T[0]=v/P,T[1]=M/P,T[2]=U/P):(T[0]=0,T[1]=0,T[2]=0),T}function te(_,w){const T=w??new h(3);return T[0]=-_[0],T[1]=-_[1],T[2]=-_[2],T}function st(_,w){const T=w??new h(3);return T[0]=_[0],T[1]=_[1],T[2]=_[2],T}const ee=st;function Ot(_,w,T){const v=T??new h(3);return v[0]=_[0]*w[0],v[1]=_[1]*w[1],v[2]=_[2]*w[2],v}const se=Ot;function Ut(_,w,T){const v=T??new h(3);return v[0]=_[0]/w[0],v[1]=_[1]/w[1],v[2]=_[2]/w[2],v}const Qt=Ut;function Bt(_=1,w){const T=w??new h(3),v=Math.random()*2*Math.PI,M=Math.random()*2-1,U=Math.sqrt(1-M*M)*_;return T[0]=Math.cos(v)*U,T[1]=Math.sin(v)*U,T[2]=M*_,T}function c(_){const w=_??new h(3);return w[0]=0,w[1]=0,w[2]=0,w}function m(_,w,T){const v=T??new h(3),M=_[0],U=_[1],P=_[2],G=w[3]*M+w[7]*U+w[11]*P+w[15]||1;return v[0]=(w[0]*M+w[4]*U+w[8]*P+w[12])/G,v[1]=(w[1]*M+w[5]*U+w[9]*P+w[13])/G,v[2]=(w[2]*M+w[6]*U+w[10]*P+w[14])/G,v}function i(_,w,T){const v=T??new h(3),M=_[0],U=_[1],P=_[2];return v[0]=M*w[0*4+0]+U*w[1*4+0]+P*w[2*4+0],v[1]=M*w[0*4+1]+U*w[1*4+1]+P*w[2*4+1],v[2]=M*w[0*4+2]+U*w[1*4+2]+P*w[2*4+2],v}function u(_,w,T){const v=T??new h(3),M=_[0],U=_[1],P=_[2];return v[0]=M*w[0]+U*w[4]+P*w[8],v[1]=M*w[1]+U*w[5]+P*w[9],v[2]=M*w[2]+U*w[6]+P*w[10],v}function g(_,w,T){const v=T??new h(3),M=w[0],U=w[1],P=w[2],G=w[3]*2,V=_[0],L=_[1],q=_[2],Y=U*q-P*L,j=P*V-M*q,rt=M*L-U*V;return v[0]=V+Y*G+(U*rt-P*j)*2,v[1]=L+j*G+(P*Y-M*rt)*2,v[2]=q+rt*G+(M*j-U*Y)*2,v}function y(_,w){const T=w??new h(3);return T[0]=_[12],T[1]=_[13],T[2]=_[14],T}function b(_,w,T){const v=T??new h(3),M=w*4;return v[0]=_[M+0],v[1]=_[M+1],v[2]=_[M+2],v}function s(_,w){const T=w??new h(3),v=_[0],M=_[1],U=_[2],P=_[4],G=_[5],V=_[6],L=_[8],q=_[9],Y=_[10];return T[0]=Math.sqrt(v*v+M*M+U*U),T[1]=Math.sqrt(P*P+G*G+V*V),T[2]=Math.sqrt(L*L+q*q+Y*Y),T}function l(_,w,T,v){const M=v??new h(3),U=[],P=[];return U[0]=_[0]-w[0],U[1]=_[1]-w[1],U[2]=_[2]-w[2],P[0]=U[0],P[1]=U[1]*Math.cos(T)-U[2]*Math.sin(T),P[2]=U[1]*Math.sin(T)+U[2]*Math.cos(T),M[0]=P[0]+w[0],M[1]=P[1]+w[1],M[2]=P[2]+w[2],M}function r(_,w,T,v){const M=v??new h(3),U=[],P=[];return U[0]=_[0]-w[0],U[1]=_[1]-w[1],U[2]=_[2]-w[2],P[0]=U[2]*Math.sin(T)+U[0]*Math.cos(T),P[1]=U[1],P[2]=U[2]*Math.cos(T)-U[0]*Math.sin(T),M[0]=P[0]+w[0],M[1]=P[1]+w[1],M[2]=P[2]+w[2],M}function a(_,w,T,v){const M=v??new h(3),U=[],P=[];return U[0]=_[0]-w[0],U[1]=_[1]-w[1],U[2]=_[2]-w[2],P[0]=U[0]*Math.cos(T)-U[1]*Math.sin(T),P[1]=U[0]*Math.sin(T)+U[1]*Math.cos(T),P[2]=U[2],M[0]=P[0]+w[0],M[1]=P[1]+w[1],M[2]=P[2]+w[2],M}function p(_,w,T){const v=T??new h(3);return vt(_,v),Tt(v,w,v)}function E(_,w,T){const v=T??new h(3);return ft(_)>w?p(_,w,v):st(_,v)}function O(_,w,T){const v=T??new h(3);return lt(_,w,.5,v)}return{create:t,fromValues:e,set:n,ceil:o,floor:f,round:k,clamp:N,add:R,addScaled:I,angle:B,subtract:C,sub:J,equalsApproximately:tt,equals:_t,lerp:lt,lerpV:Vt,max:$t,min:bt,mulScalar:Tt,scale:jt,divScalar:Rt,inverse:Pt,invert:Xt,cross:It,dot:Ft,length:ft,len:Wt,lengthSq:Z,lenSq:et,distance:H,dist:Jt,distanceSq:Et,distSq:Kt,normalize:vt,negate:te,copy:st,clone:ee,multiply:Ot,mul:se,divide:Ut,div:Qt,random:Bt,zero:c,transformMat4:m,transformMat4Upper3x3:i,transformMat3:u,transformQuat:g,getTranslation:y,getAxis:b,getScaling:s,rotateX:l,rotateY:r,rotateZ:a,setLength:p,truncate:E,midpoint:O}}const wn=new Map;function Ss(h){let t=wn.get(h);return t||(t=Zr(h),wn.set(h,t)),t}function jr(h){const t=Fn(h),e=Ss(h);function n(c,m,i,u,g,y,b,s,l){const r=new h(12);return r[3]=0,r[7]=0,r[11]=0,c!==void 0&&(r[0]=c,m!==void 0&&(r[1]=m,i!==void 0&&(r[2]=i,u!==void 0&&(r[4]=u,g!==void 0&&(r[5]=g,y!==void 0&&(r[6]=y,b!==void 0&&(r[8]=b,s!==void 0&&(r[9]=s,l!==void 0&&(r[10]=l))))))))),r}function o(c,m,i,u,g,y,b,s,l,r){const a=r??new h(12);return a[0]=c,a[1]=m,a[2]=i,a[3]=0,a[4]=u,a[5]=g,a[6]=y,a[7]=0,a[8]=b,a[9]=s,a[10]=l,a[11]=0,a}function f(c,m){const i=m??new h(12);return i[0]=c[0],i[1]=c[1],i[2]=c[2],i[3]=0,i[4]=c[4],i[5]=c[5],i[6]=c[6],i[7]=0,i[8]=c[8],i[9]=c[9],i[10]=c[10],i[11]=0,i}function k(c,m){const i=m??new h(12),u=c[0],g=c[1],y=c[2],b=c[3],s=u+u,l=g+g,r=y+y,a=u*s,p=g*s,E=g*l,O=y*s,_=y*l,w=y*r,T=b*s,v=b*l,M=b*r;return i[0]=1-E-w,i[1]=p+M,i[2]=O-v,i[3]=0,i[4]=p-M,i[5]=1-a-w,i[6]=_+T,i[7]=0,i[8]=O+v,i[9]=_-T,i[10]=1-a-E,i[11]=0,i}function N(c,m){const i=m??new h(12);return i[0]=-c[0],i[1]=-c[1],i[2]=-c[2],i[4]=-c[4],i[5]=-c[5],i[6]=-c[6],i[8]=-c[8],i[9]=-c[9],i[10]=-c[10],i}function R(c,m){const i=m??new h(12);return i[0]=c[0],i[1]=c[1],i[2]=c[2],i[4]=c[4],i[5]=c[5],i[6]=c[6],i[8]=c[8],i[9]=c[9],i[10]=c[10],i}const I=R;function B(c,m){return Math.abs(c[0]-m[0])<Q&&Math.abs(c[1]-m[1])<Q&&Math.abs(c[2]-m[2])<Q&&Math.abs(c[4]-m[4])<Q&&Math.abs(c[5]-m[5])<Q&&Math.abs(c[6]-m[6])<Q&&Math.abs(c[8]-m[8])<Q&&Math.abs(c[9]-m[9])<Q&&Math.abs(c[10]-m[10])<Q}function C(c,m){return c[0]===m[0]&&c[1]===m[1]&&c[2]===m[2]&&c[4]===m[4]&&c[5]===m[5]&&c[6]===m[6]&&c[8]===m[8]&&c[9]===m[9]&&c[10]===m[10]}function J(c){const m=c??new h(12);return m[0]=1,m[1]=0,m[2]=0,m[4]=0,m[5]=1,m[6]=0,m[8]=0,m[9]=0,m[10]=1,m}function tt(c,m){const i=m??new h(12);if(i===c){let E;return E=c[1],c[1]=c[4],c[4]=E,E=c[2],c[2]=c[8],c[8]=E,E=c[6],c[6]=c[9],c[9]=E,i}const u=c[0*4+0],g=c[0*4+1],y=c[0*4+2],b=c[1*4+0],s=c[1*4+1],l=c[1*4+2],r=c[2*4+0],a=c[2*4+1],p=c[2*4+2];return i[0]=u,i[1]=b,i[2]=r,i[4]=g,i[5]=s,i[6]=a,i[8]=y,i[9]=l,i[10]=p,i}function _t(c,m){const i=m??new h(12),u=c[0*4+0],g=c[0*4+1],y=c[0*4+2],b=c[1*4+0],s=c[1*4+1],l=c[1*4+2],r=c[2*4+0],a=c[2*4+1],p=c[2*4+2],E=p*s-l*a,O=-p*b+l*r,_=a*b-s*r,w=1/(u*E+g*O+y*_);return i[0]=E*w,i[1]=(-p*g+y*a)*w,i[2]=(l*g-y*s)*w,i[4]=O*w,i[5]=(p*u-y*r)*w,i[6]=(-l*u+y*b)*w,i[8]=_*w,i[9]=(-a*u+g*r)*w,i[10]=(s*u-g*b)*w,i}function lt(c){const m=c[0],i=c[0*4+1],u=c[0*4+2],g=c[1*4+0],y=c[1*4+1],b=c[1*4+2],s=c[2*4+0],l=c[2*4+1],r=c[2*4+2];return m*(y*r-l*b)-g*(i*r-l*u)+s*(i*b-y*u)}const Vt=_t;function $t(c,m,i){const u=i??new h(12),g=c[0],y=c[1],b=c[2],s=c[4],l=c[5],r=c[6],a=c[8],p=c[9],E=c[10],O=m[0],_=m[1],w=m[2],T=m[4],v=m[5],M=m[6],U=m[8],P=m[9],G=m[10];return u[0]=g*O+s*_+a*w,u[1]=y*O+l*_+p*w,u[2]=b*O+r*_+E*w,u[4]=g*T+s*v+a*M,u[5]=y*T+l*v+p*M,u[6]=b*T+r*v+E*M,u[8]=g*U+s*P+a*G,u[9]=y*U+l*P+p*G,u[10]=b*U+r*P+E*G,u}const bt=$t;function Tt(c,m,i){const u=i??J();return c!==u&&(u[0]=c[0],u[1]=c[1],u[2]=c[2],u[4]=c[4],u[5]=c[5],u[6]=c[6]),u[8]=m[0],u[9]=m[1],u[10]=1,u}function jt(c,m){const i=m??t.create();return i[0]=c[8],i[1]=c[9],i}function Rt(c,m,i){const u=i??t.create(),g=m*4;return u[0]=c[g+0],u[1]=c[g+1],u}function Pt(c,m,i,u){const g=u===c?c:R(c,u),y=i*4;return g[y+0]=m[0],g[y+1]=m[1],g}function Xt(c,m){const i=m??t.create(),u=c[0],g=c[1],y=c[4],b=c[5];return i[0]=Math.sqrt(u*u+g*g),i[1]=Math.sqrt(y*y+b*b),i}function It(c,m){const i=m??e.create(),u=c[0],g=c[1],y=c[2],b=c[4],s=c[5],l=c[6],r=c[8],a=c[9],p=c[10];return i[0]=Math.sqrt(u*u+g*g+y*y),i[1]=Math.sqrt(b*b+s*s+l*l),i[2]=Math.sqrt(r*r+a*a+p*p),i}function Ft(c,m){const i=m??new h(12);return i[0]=1,i[1]=0,i[2]=0,i[4]=0,i[5]=1,i[6]=0,i[8]=c[0],i[9]=c[1],i[10]=1,i}function ft(c,m,i){const u=i??new h(12),g=m[0],y=m[1],b=c[0],s=c[1],l=c[2],r=c[1*4+0],a=c[1*4+1],p=c[1*4+2],E=c[2*4+0],O=c[2*4+1],_=c[2*4+2];return c!==u&&(u[0]=b,u[1]=s,u[2]=l,u[4]=r,u[5]=a,u[6]=p),u[8]=b*g+r*y+E,u[9]=s*g+a*y+O,u[10]=l*g+p*y+_,u}function Wt(c,m){const i=m??new h(12),u=Math.cos(c),g=Math.sin(c);return i[0]=u,i[1]=g,i[2]=0,i[4]=-g,i[5]=u,i[6]=0,i[8]=0,i[9]=0,i[10]=1,i}function Z(c,m,i){const u=i??new h(12),g=c[0*4+0],y=c[0*4+1],b=c[0*4+2],s=c[1*4+0],l=c[1*4+1],r=c[1*4+2],a=Math.cos(m),p=Math.sin(m);return u[0]=a*g+p*s,u[1]=a*y+p*l,u[2]=a*b+p*r,u[4]=a*s-p*g,u[5]=a*l-p*y,u[6]=a*r-p*b,c!==u&&(u[8]=c[8],u[9]=c[9],u[10]=c[10]),u}function et(c,m){const i=m??new h(12),u=Math.cos(c),g=Math.sin(c);return i[0]=1,i[1]=0,i[2]=0,i[4]=0,i[5]=u,i[6]=g,i[8]=0,i[9]=-g,i[10]=u,i}function H(c,m,i){const u=i??new h(12),g=c[4],y=c[5],b=c[6],s=c[8],l=c[9],r=c[10],a=Math.cos(m),p=Math.sin(m);return u[4]=a*g+p*s,u[5]=a*y+p*l,u[6]=a*b+p*r,u[8]=a*s-p*g,u[9]=a*l-p*y,u[10]=a*r-p*b,c!==u&&(u[0]=c[0],u[1]=c[1],u[2]=c[2]),u}function Jt(c,m){const i=m??new h(12),u=Math.cos(c),g=Math.sin(c);return i[0]=u,i[1]=0,i[2]=-g,i[4]=0,i[5]=1,i[6]=0,i[8]=g,i[9]=0,i[10]=u,i}function Et(c,m,i){const u=i??new h(12),g=c[0*4+0],y=c[0*4+1],b=c[0*4+2],s=c[2*4+0],l=c[2*4+1],r=c[2*4+2],a=Math.cos(m),p=Math.sin(m);return u[0]=a*g-p*s,u[1]=a*y-p*l,u[2]=a*b-p*r,u[8]=a*s+p*g,u[9]=a*l+p*y,u[10]=a*r+p*b,c!==u&&(u[4]=c[4],u[5]=c[5],u[6]=c[6]),u}const Kt=Wt,vt=Z;function te(c,m){const i=m??new h(12);return i[0]=c[0],i[1]=0,i[2]=0,i[4]=0,i[5]=c[1],i[6]=0,i[8]=0,i[9]=0,i[10]=1,i}function st(c,m,i){const u=i??new h(12),g=m[0],y=m[1];return u[0]=g*c[0*4+0],u[1]=g*c[0*4+1],u[2]=g*c[0*4+2],u[4]=y*c[1*4+0],u[5]=y*c[1*4+1],u[6]=y*c[1*4+2],c!==u&&(u[8]=c[8],u[9]=c[9],u[10]=c[10]),u}function ee(c,m){const i=m??new h(12);return i[0]=c[0],i[1]=0,i[2]=0,i[4]=0,i[5]=c[1],i[6]=0,i[8]=0,i[9]=0,i[10]=c[2],i}function Ot(c,m,i){const u=i??new h(12),g=m[0],y=m[1],b=m[2];return u[0]=g*c[0*4+0],u[1]=g*c[0*4+1],u[2]=g*c[0*4+2],u[4]=y*c[1*4+0],u[5]=y*c[1*4+1],u[6]=y*c[1*4+2],u[8]=b*c[2*4+0],u[9]=b*c[2*4+1],u[10]=b*c[2*4+2],u}function se(c,m){const i=m??new h(12);return i[0]=c,i[1]=0,i[2]=0,i[4]=0,i[5]=c,i[6]=0,i[8]=0,i[9]=0,i[10]=1,i}function Ut(c,m,i){const u=i??new h(12);return u[0]=m*c[0*4+0],u[1]=m*c[0*4+1],u[2]=m*c[0*4+2],u[4]=m*c[1*4+0],u[5]=m*c[1*4+1],u[6]=m*c[1*4+2],c!==u&&(u[8]=c[8],u[9]=c[9],u[10]=c[10]),u}function Qt(c,m){const i=m??new h(12);return i[0]=c,i[1]=0,i[2]=0,i[4]=0,i[5]=c,i[6]=0,i[8]=0,i[9]=0,i[10]=c,i}function Bt(c,m,i){const u=i??new h(12);return u[0]=m*c[0*4+0],u[1]=m*c[0*4+1],u[2]=m*c[0*4+2],u[4]=m*c[1*4+0],u[5]=m*c[1*4+1],u[6]=m*c[1*4+2],u[8]=m*c[2*4+0],u[9]=m*c[2*4+1],u[10]=m*c[2*4+2],u}return{clone:I,create:n,set:o,fromMat4:f,fromQuat:k,negate:N,copy:R,equalsApproximately:B,equals:C,identity:J,transpose:tt,inverse:_t,invert:Vt,determinant:lt,mul:bt,multiply:$t,setTranslation:Tt,getTranslation:jt,getAxis:Rt,setAxis:Pt,getScaling:Xt,get3DScaling:It,translation:Ft,translate:ft,rotation:Wt,rotate:Z,rotationX:et,rotateX:H,rotationY:Jt,rotateY:Et,rotationZ:Kt,rotateZ:vt,scaling:te,scale:st,uniformScaling:se,uniformScale:Ut,scaling3D:ee,scale3D:Ot,uniformScaling3D:Qt,uniformScale3D:Bt}}const gn=new Map;function Jr(h){let t=gn.get(h);return t||(t=jr(h),gn.set(h,t)),t}function Kr(h){const t=Ss(h);function e(s,l,r,a,p,E,O,_,w,T,v,M,U,P,G,V){const L=new h(16);return s!==void 0&&(L[0]=s,l!==void 0&&(L[1]=l,r!==void 0&&(L[2]=r,a!==void 0&&(L[3]=a,p!==void 0&&(L[4]=p,E!==void 0&&(L[5]=E,O!==void 0&&(L[6]=O,_!==void 0&&(L[7]=_,w!==void 0&&(L[8]=w,T!==void 0&&(L[9]=T,v!==void 0&&(L[10]=v,M!==void 0&&(L[11]=M,U!==void 0&&(L[12]=U,P!==void 0&&(L[13]=P,G!==void 0&&(L[14]=G,V!==void 0&&(L[15]=V)))))))))))))))),L}function n(s,l,r,a,p,E,O,_,w,T,v,M,U,P,G,V,L){const q=L??new h(16);return q[0]=s,q[1]=l,q[2]=r,q[3]=a,q[4]=p,q[5]=E,q[6]=O,q[7]=_,q[8]=w,q[9]=T,q[10]=v,q[11]=M,q[12]=U,q[13]=P,q[14]=G,q[15]=V,q}function o(s,l){const r=l??new h(16);return r[0]=s[0],r[1]=s[1],r[2]=s[2],r[3]=0,r[4]=s[4],r[5]=s[5],r[6]=s[6],r[7]=0,r[8]=s[8],r[9]=s[9],r[10]=s[10],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function f(s,l){const r=l??new h(16),a=s[0],p=s[1],E=s[2],O=s[3],_=a+a,w=p+p,T=E+E,v=a*_,M=p*_,U=p*w,P=E*_,G=E*w,V=E*T,L=O*_,q=O*w,Y=O*T;return r[0]=1-U-V,r[1]=M+Y,r[2]=P-q,r[3]=0,r[4]=M-Y,r[5]=1-v-V,r[6]=G+L,r[7]=0,r[8]=P+q,r[9]=G-L,r[10]=1-v-U,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function k(s,l){const r=l??new h(16);return r[0]=-s[0],r[1]=-s[1],r[2]=-s[2],r[3]=-s[3],r[4]=-s[4],r[5]=-s[5],r[6]=-s[6],r[7]=-s[7],r[8]=-s[8],r[9]=-s[9],r[10]=-s[10],r[11]=-s[11],r[12]=-s[12],r[13]=-s[13],r[14]=-s[14],r[15]=-s[15],r}function N(s,l){const r=l??new h(16);return r[0]=s[0],r[1]=s[1],r[2]=s[2],r[3]=s[3],r[4]=s[4],r[5]=s[5],r[6]=s[6],r[7]=s[7],r[8]=s[8],r[9]=s[9],r[10]=s[10],r[11]=s[11],r[12]=s[12],r[13]=s[13],r[14]=s[14],r[15]=s[15],r}const R=N;function I(s,l){return Math.abs(s[0]-l[0])<Q&&Math.abs(s[1]-l[1])<Q&&Math.abs(s[2]-l[2])<Q&&Math.abs(s[3]-l[3])<Q&&Math.abs(s[4]-l[4])<Q&&Math.abs(s[5]-l[5])<Q&&Math.abs(s[6]-l[6])<Q&&Math.abs(s[7]-l[7])<Q&&Math.abs(s[8]-l[8])<Q&&Math.abs(s[9]-l[9])<Q&&Math.abs(s[10]-l[10])<Q&&Math.abs(s[11]-l[11])<Q&&Math.abs(s[12]-l[12])<Q&&Math.abs(s[13]-l[13])<Q&&Math.abs(s[14]-l[14])<Q&&Math.abs(s[15]-l[15])<Q}function B(s,l){return s[0]===l[0]&&s[1]===l[1]&&s[2]===l[2]&&s[3]===l[3]&&s[4]===l[4]&&s[5]===l[5]&&s[6]===l[6]&&s[7]===l[7]&&s[8]===l[8]&&s[9]===l[9]&&s[10]===l[10]&&s[11]===l[11]&&s[12]===l[12]&&s[13]===l[13]&&s[14]===l[14]&&s[15]===l[15]}function C(s){const l=s??new h(16);return l[0]=1,l[1]=0,l[2]=0,l[3]=0,l[4]=0,l[5]=1,l[6]=0,l[7]=0,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,l}function J(s,l){const r=l??new h(16);if(r===s){let j;return j=s[1],s[1]=s[4],s[4]=j,j=s[2],s[2]=s[8],s[8]=j,j=s[3],s[3]=s[12],s[12]=j,j=s[6],s[6]=s[9],s[9]=j,j=s[7],s[7]=s[13],s[13]=j,j=s[11],s[11]=s[14],s[14]=j,r}const a=s[0*4+0],p=s[0*4+1],E=s[0*4+2],O=s[0*4+3],_=s[1*4+0],w=s[1*4+1],T=s[1*4+2],v=s[1*4+3],M=s[2*4+0],U=s[2*4+1],P=s[2*4+2],G=s[2*4+3],V=s[3*4+0],L=s[3*4+1],q=s[3*4+2],Y=s[3*4+3];return r[0]=a,r[1]=_,r[2]=M,r[3]=V,r[4]=p,r[5]=w,r[6]=U,r[7]=L,r[8]=E,r[9]=T,r[10]=P,r[11]=q,r[12]=O,r[13]=v,r[14]=G,r[15]=Y,r}function tt(s,l){const r=l??new h(16),a=s[0*4+0],p=s[0*4+1],E=s[0*4+2],O=s[0*4+3],_=s[1*4+0],w=s[1*4+1],T=s[1*4+2],v=s[1*4+3],M=s[2*4+0],U=s[2*4+1],P=s[2*4+2],G=s[2*4+3],V=s[3*4+0],L=s[3*4+1],q=s[3*4+2],Y=s[3*4+3],j=P*Y,rt=q*G,ut=T*Y,ht=q*v,dt=T*G,pt=P*v,wt=E*Y,gt=q*O,mt=E*G,yt=P*O,Dt=E*v,At=T*O,St=M*L,Nt=V*U,Lt=_*L,Gt=V*w,qt=_*U,ps=M*w,ws=a*L,gs=V*p,ms=a*U,ys=M*p,xs=a*w,ks=_*p,Xs=j*w+ht*U+dt*L-(rt*w+ut*U+pt*L),Ws=rt*p+wt*U+yt*L-(j*p+gt*U+mt*L),Qs=ut*p+gt*w+Dt*L-(ht*p+wt*w+At*L),Ys=pt*p+mt*w+At*U-(dt*p+yt*w+Dt*U),xt=1/(a*Xs+_*Ws+M*Qs+V*Ys);return r[0]=xt*Xs,r[1]=xt*Ws,r[2]=xt*Qs,r[3]=xt*Ys,r[4]=xt*(rt*_+ut*M+pt*V-(j*_+ht*M+dt*V)),r[5]=xt*(j*a+gt*M+mt*V-(rt*a+wt*M+yt*V)),r[6]=xt*(ht*a+wt*_+At*V-(ut*a+gt*_+Dt*V)),r[7]=xt*(dt*a+yt*_+Dt*M-(pt*a+mt*_+At*M)),r[8]=xt*(St*v+Gt*G+qt*Y-(Nt*v+Lt*G+ps*Y)),r[9]=xt*(Nt*O+ws*G+ys*Y-(St*O+gs*G+ms*Y)),r[10]=xt*(Lt*O+gs*v+xs*Y-(Gt*O+ws*v+ks*Y)),r[11]=xt*(ps*O+ms*v+ks*G-(qt*O+ys*v+xs*G)),r[12]=xt*(Lt*P+ps*q+Nt*T-(qt*q+St*T+Gt*P)),r[13]=xt*(ms*q+St*E+gs*P-(ws*P+ys*q+Nt*E)),r[14]=xt*(ws*T+ks*q+Gt*E-(xs*q+Lt*E+gs*T)),r[15]=xt*(xs*P+qt*E+ys*T-(ms*T+ks*P+ps*E)),r}function _t(s){const l=s[0],r=s[0*4+1],a=s[0*4+2],p=s[0*4+3],E=s[1*4+0],O=s[1*4+1],_=s[1*4+2],w=s[1*4+3],T=s[2*4+0],v=s[2*4+1],M=s[2*4+2],U=s[2*4+3],P=s[3*4+0],G=s[3*4+1],V=s[3*4+2],L=s[3*4+3],q=M*L,Y=V*U,j=_*L,rt=V*w,ut=_*U,ht=M*w,dt=a*L,pt=V*p,wt=a*U,gt=M*p,mt=a*w,yt=_*p,Dt=q*O+rt*v+ut*G-(Y*O+j*v+ht*G),At=Y*r+dt*v+gt*G-(q*r+pt*v+wt*G),St=j*r+pt*O+mt*G-(rt*r+dt*O+yt*G),Nt=ht*r+wt*O+yt*v-(ut*r+gt*O+mt*v);return l*Dt+E*At+T*St+P*Nt}const lt=tt;function Vt(s,l,r){const a=r??new h(16),p=s[0],E=s[1],O=s[2],_=s[3],w=s[4],T=s[5],v=s[6],M=s[7],U=s[8],P=s[9],G=s[10],V=s[11],L=s[12],q=s[13],Y=s[14],j=s[15],rt=l[0],ut=l[1],ht=l[2],dt=l[3],pt=l[4],wt=l[5],gt=l[6],mt=l[7],yt=l[8],Dt=l[9],At=l[10],St=l[11],Nt=l[12],Lt=l[13],Gt=l[14],qt=l[15];return a[0]=p*rt+w*ut+U*ht+L*dt,a[1]=E*rt+T*ut+P*ht+q*dt,a[2]=O*rt+v*ut+G*ht+Y*dt,a[3]=_*rt+M*ut+V*ht+j*dt,a[4]=p*pt+w*wt+U*gt+L*mt,a[5]=E*pt+T*wt+P*gt+q*mt,a[6]=O*pt+v*wt+G*gt+Y*mt,a[7]=_*pt+M*wt+V*gt+j*mt,a[8]=p*yt+w*Dt+U*At+L*St,a[9]=E*yt+T*Dt+P*At+q*St,a[10]=O*yt+v*Dt+G*At+Y*St,a[11]=_*yt+M*Dt+V*At+j*St,a[12]=p*Nt+w*Lt+U*Gt+L*qt,a[13]=E*Nt+T*Lt+P*Gt+q*qt,a[14]=O*Nt+v*Lt+G*Gt+Y*qt,a[15]=_*Nt+M*Lt+V*Gt+j*qt,a}const $t=Vt;function bt(s,l,r){const a=r??C();return s!==a&&(a[0]=s[0],a[1]=s[1],a[2]=s[2],a[3]=s[3],a[4]=s[4],a[5]=s[5],a[6]=s[6],a[7]=s[7],a[8]=s[8],a[9]=s[9],a[10]=s[10],a[11]=s[11]),a[12]=l[0],a[13]=l[1],a[14]=l[2],a[15]=1,a}function Tt(s,l){const r=l??t.create();return r[0]=s[12],r[1]=s[13],r[2]=s[14],r}function jt(s,l,r){const a=r??t.create(),p=l*4;return a[0]=s[p+0],a[1]=s[p+1],a[2]=s[p+2],a}function Rt(s,l,r,a){const p=a===s?a:N(s,a),E=r*4;return p[E+0]=l[0],p[E+1]=l[1],p[E+2]=l[2],p}function Pt(s,l){const r=l??t.create(),a=s[0],p=s[1],E=s[2],O=s[4],_=s[5],w=s[6],T=s[8],v=s[9],M=s[10];return r[0]=Math.sqrt(a*a+p*p+E*E),r[1]=Math.sqrt(O*O+_*_+w*w),r[2]=Math.sqrt(T*T+v*v+M*M),r}function Xt(s,l,r,a,p){const E=p??new h(16),O=Math.tan(Math.PI*.5-.5*s);if(E[0]=O/l,E[1]=0,E[2]=0,E[3]=0,E[4]=0,E[5]=O,E[6]=0,E[7]=0,E[8]=0,E[9]=0,E[11]=-1,E[12]=0,E[13]=0,E[15]=0,Number.isFinite(a)){const _=1/(r-a);E[10]=a*_,E[14]=a*r*_}else E[10]=-1,E[14]=-r;return E}function It(s,l,r,a=1/0,p){const E=p??new h(16),O=1/Math.tan(s*.5);if(E[0]=O/l,E[1]=0,E[2]=0,E[3]=0,E[4]=0,E[5]=O,E[6]=0,E[7]=0,E[8]=0,E[9]=0,E[11]=-1,E[12]=0,E[13]=0,E[15]=0,a===1/0)E[10]=0,E[14]=r;else{const _=1/(a-r);E[10]=r*_,E[14]=a*r*_}return E}function Ft(s,l,r,a,p,E,O){const _=O??new h(16);return _[0]=2/(l-s),_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=2/(a-r),_[6]=0,_[7]=0,_[8]=0,_[9]=0,_[10]=1/(p-E),_[11]=0,_[12]=(l+s)/(s-l),_[13]=(a+r)/(r-a),_[14]=p/(p-E),_[15]=1,_}function ft(s,l,r,a,p,E,O){const _=O??new h(16),w=l-s,T=a-r,v=p-E;return _[0]=2*p/w,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=2*p/T,_[6]=0,_[7]=0,_[8]=(s+l)/w,_[9]=(a+r)/T,_[10]=E/v,_[11]=-1,_[12]=0,_[13]=0,_[14]=p*E/v,_[15]=0,_}function Wt(s,l,r,a,p,E=1/0,O){const _=O??new h(16),w=l-s,T=a-r;if(_[0]=2*p/w,_[1]=0,_[2]=0,_[3]=0,_[4]=0,_[5]=2*p/T,_[6]=0,_[7]=0,_[8]=(s+l)/w,_[9]=(a+r)/T,_[11]=-1,_[12]=0,_[13]=0,_[15]=0,E===1/0)_[10]=0,_[14]=p;else{const v=1/(E-p);_[10]=p*v,_[14]=E*p*v}return _}const Z=t.create(),et=t.create(),H=t.create();function Jt(s,l,r,a){const p=a??new h(16);return t.normalize(t.subtract(l,s,H),H),t.normalize(t.cross(r,H,Z),Z),t.normalize(t.cross(H,Z,et),et),p[0]=Z[0],p[1]=Z[1],p[2]=Z[2],p[3]=0,p[4]=et[0],p[5]=et[1],p[6]=et[2],p[7]=0,p[8]=H[0],p[9]=H[1],p[10]=H[2],p[11]=0,p[12]=s[0],p[13]=s[1],p[14]=s[2],p[15]=1,p}function Et(s,l,r,a){const p=a??new h(16);return t.normalize(t.subtract(s,l,H),H),t.normalize(t.cross(r,H,Z),Z),t.normalize(t.cross(H,Z,et),et),p[0]=Z[0],p[1]=Z[1],p[2]=Z[2],p[3]=0,p[4]=et[0],p[5]=et[1],p[6]=et[2],p[7]=0,p[8]=H[0],p[9]=H[1],p[10]=H[2],p[11]=0,p[12]=s[0],p[13]=s[1],p[14]=s[2],p[15]=1,p}function Kt(s,l,r,a){const p=a??new h(16);return t.normalize(t.subtract(s,l,H),H),t.normalize(t.cross(r,H,Z),Z),t.normalize(t.cross(H,Z,et),et),p[0]=Z[0],p[1]=et[0],p[2]=H[0],p[3]=0,p[4]=Z[1],p[5]=et[1],p[6]=H[1],p[7]=0,p[8]=Z[2],p[9]=et[2],p[10]=H[2],p[11]=0,p[12]=-(Z[0]*s[0]+Z[1]*s[1]+Z[2]*s[2]),p[13]=-(et[0]*s[0]+et[1]*s[1]+et[2]*s[2]),p[14]=-(H[0]*s[0]+H[1]*s[1]+H[2]*s[2]),p[15]=1,p}function vt(s,l){const r=l??new h(16);return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=s[0],r[13]=s[1],r[14]=s[2],r[15]=1,r}function te(s,l,r){const a=r??new h(16),p=l[0],E=l[1],O=l[2],_=s[0],w=s[1],T=s[2],v=s[3],M=s[1*4+0],U=s[1*4+1],P=s[1*4+2],G=s[1*4+3],V=s[2*4+0],L=s[2*4+1],q=s[2*4+2],Y=s[2*4+3],j=s[3*4+0],rt=s[3*4+1],ut=s[3*4+2],ht=s[3*4+3];return s!==a&&(a[0]=_,a[1]=w,a[2]=T,a[3]=v,a[4]=M,a[5]=U,a[6]=P,a[7]=G,a[8]=V,a[9]=L,a[10]=q,a[11]=Y),a[12]=_*p+M*E+V*O+j,a[13]=w*p+U*E+L*O+rt,a[14]=T*p+P*E+q*O+ut,a[15]=v*p+G*E+Y*O+ht,a}function st(s,l){const r=l??new h(16),a=Math.cos(s),p=Math.sin(s);return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=a,r[6]=p,r[7]=0,r[8]=0,r[9]=-p,r[10]=a,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function ee(s,l,r){const a=r??new h(16),p=s[4],E=s[5],O=s[6],_=s[7],w=s[8],T=s[9],v=s[10],M=s[11],U=Math.cos(l),P=Math.sin(l);return a[4]=U*p+P*w,a[5]=U*E+P*T,a[6]=U*O+P*v,a[7]=U*_+P*M,a[8]=U*w-P*p,a[9]=U*T-P*E,a[10]=U*v-P*O,a[11]=U*M-P*_,s!==a&&(a[0]=s[0],a[1]=s[1],a[2]=s[2],a[3]=s[3],a[12]=s[12],a[13]=s[13],a[14]=s[14],a[15]=s[15]),a}function Ot(s,l){const r=l??new h(16),a=Math.cos(s),p=Math.sin(s);return r[0]=a,r[1]=0,r[2]=-p,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=p,r[9]=0,r[10]=a,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function se(s,l,r){const a=r??new h(16),p=s[0*4+0],E=s[0*4+1],O=s[0*4+2],_=s[0*4+3],w=s[2*4+0],T=s[2*4+1],v=s[2*4+2],M=s[2*4+3],U=Math.cos(l),P=Math.sin(l);return a[0]=U*p-P*w,a[1]=U*E-P*T,a[2]=U*O-P*v,a[3]=U*_-P*M,a[8]=U*w+P*p,a[9]=U*T+P*E,a[10]=U*v+P*O,a[11]=U*M+P*_,s!==a&&(a[4]=s[4],a[5]=s[5],a[6]=s[6],a[7]=s[7],a[12]=s[12],a[13]=s[13],a[14]=s[14],a[15]=s[15]),a}function Ut(s,l){const r=l??new h(16),a=Math.cos(s),p=Math.sin(s);return r[0]=a,r[1]=p,r[2]=0,r[3]=0,r[4]=-p,r[5]=a,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Qt(s,l,r){const a=r??new h(16),p=s[0*4+0],E=s[0*4+1],O=s[0*4+2],_=s[0*4+3],w=s[1*4+0],T=s[1*4+1],v=s[1*4+2],M=s[1*4+3],U=Math.cos(l),P=Math.sin(l);return a[0]=U*p+P*w,a[1]=U*E+P*T,a[2]=U*O+P*v,a[3]=U*_+P*M,a[4]=U*w-P*p,a[5]=U*T-P*E,a[6]=U*v-P*O,a[7]=U*M-P*_,s!==a&&(a[8]=s[8],a[9]=s[9],a[10]=s[10],a[11]=s[11],a[12]=s[12],a[13]=s[13],a[14]=s[14],a[15]=s[15]),a}function Bt(s,l,r){const a=r??new h(16);let p=s[0],E=s[1],O=s[2];const _=Math.sqrt(p*p+E*E+O*O);p/=_,E/=_,O/=_;const w=p*p,T=E*E,v=O*O,M=Math.cos(l),U=Math.sin(l),P=1-M;return a[0]=w+(1-w)*M,a[1]=p*E*P+O*U,a[2]=p*O*P-E*U,a[3]=0,a[4]=p*E*P-O*U,a[5]=T+(1-T)*M,a[6]=E*O*P+p*U,a[7]=0,a[8]=p*O*P+E*U,a[9]=E*O*P-p*U,a[10]=v+(1-v)*M,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}const c=Bt;function m(s,l,r,a){const p=a??new h(16);let E=l[0],O=l[1],_=l[2];const w=Math.sqrt(E*E+O*O+_*_);E/=w,O/=w,_/=w;const T=E*E,v=O*O,M=_*_,U=Math.cos(r),P=Math.sin(r),G=1-U,V=T+(1-T)*U,L=E*O*G+_*P,q=E*_*G-O*P,Y=E*O*G-_*P,j=v+(1-v)*U,rt=O*_*G+E*P,ut=E*_*G+O*P,ht=O*_*G-E*P,dt=M+(1-M)*U,pt=s[0],wt=s[1],gt=s[2],mt=s[3],yt=s[4],Dt=s[5],At=s[6],St=s[7],Nt=s[8],Lt=s[9],Gt=s[10],qt=s[11];return p[0]=V*pt+L*yt+q*Nt,p[1]=V*wt+L*Dt+q*Lt,p[2]=V*gt+L*At+q*Gt,p[3]=V*mt+L*St+q*qt,p[4]=Y*pt+j*yt+rt*Nt,p[5]=Y*wt+j*Dt+rt*Lt,p[6]=Y*gt+j*At+rt*Gt,p[7]=Y*mt+j*St+rt*qt,p[8]=ut*pt+ht*yt+dt*Nt,p[9]=ut*wt+ht*Dt+dt*Lt,p[10]=ut*gt+ht*At+dt*Gt,p[11]=ut*mt+ht*St+dt*qt,s!==p&&(p[12]=s[12],p[13]=s[13],p[14]=s[14],p[15]=s[15]),p}const i=m;function u(s,l){const r=l??new h(16);return r[0]=s[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=s[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=s[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function g(s,l,r){const a=r??new h(16),p=l[0],E=l[1],O=l[2];return a[0]=p*s[0*4+0],a[1]=p*s[0*4+1],a[2]=p*s[0*4+2],a[3]=p*s[0*4+3],a[4]=E*s[1*4+0],a[5]=E*s[1*4+1],a[6]=E*s[1*4+2],a[7]=E*s[1*4+3],a[8]=O*s[2*4+0],a[9]=O*s[2*4+1],a[10]=O*s[2*4+2],a[11]=O*s[2*4+3],s!==a&&(a[12]=s[12],a[13]=s[13],a[14]=s[14],a[15]=s[15]),a}function y(s,l){const r=l??new h(16);return r[0]=s,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=s,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=s,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function b(s,l,r){const a=r??new h(16);return a[0]=l*s[0*4+0],a[1]=l*s[0*4+1],a[2]=l*s[0*4+2],a[3]=l*s[0*4+3],a[4]=l*s[1*4+0],a[5]=l*s[1*4+1],a[6]=l*s[1*4+2],a[7]=l*s[1*4+3],a[8]=l*s[2*4+0],a[9]=l*s[2*4+1],a[10]=l*s[2*4+2],a[11]=l*s[2*4+3],s!==a&&(a[12]=s[12],a[13]=s[13],a[14]=s[14],a[15]=s[15]),a}return{create:e,set:n,fromMat3:o,fromQuat:f,negate:k,copy:N,clone:R,equalsApproximately:I,equals:B,identity:C,transpose:J,inverse:tt,determinant:_t,invert:lt,multiply:Vt,mul:$t,setTranslation:bt,getTranslation:Tt,getAxis:jt,setAxis:Rt,getScaling:Pt,perspective:Xt,perspectiveReverseZ:It,ortho:Ft,frustum:ft,frustumReverseZ:Wt,aim:Jt,cameraAim:Et,lookAt:Kt,translation:vt,translate:te,rotationX:st,rotateX:ee,rotationY:Ot,rotateY:se,rotationZ:Ut,rotateZ:Qt,axisRotation:Bt,rotation:c,axisRotate:m,rotate:i,scaling:u,scale:g,uniformScaling:y,uniformScale:b}}const mn=new Map;function ti(h){let t=mn.get(h);return t||(t=Kr(h),mn.set(h,t)),t}function ei(h){const t=Ss(h);function e(c,m,i,u){const g=new h(4);return c!==void 0&&(g[0]=c,m!==void 0&&(g[1]=m,i!==void 0&&(g[2]=i,u!==void 0&&(g[3]=u)))),g}const n=e;function o(c,m,i,u,g){const y=g??new h(4);return y[0]=c,y[1]=m,y[2]=i,y[3]=u,y}function f(c,m,i){const u=i??new h(4),g=m*.5,y=Math.sin(g);return u[0]=y*c[0],u[1]=y*c[1],u[2]=y*c[2],u[3]=Math.cos(g),u}function k(c,m){const i=m??t.create(3),u=Math.acos(c[3])*2,g=Math.sin(u*.5);return g>Q?(i[0]=c[0]/g,i[1]=c[1]/g,i[2]=c[2]/g):(i[0]=1,i[1]=0,i[2]=0),{angle:u,axis:i}}function N(c,m){const i=ft(c,m);return Math.acos(2*i*i-1)}function R(c,m,i){const u=i??new h(4),g=c[0],y=c[1],b=c[2],s=c[3],l=m[0],r=m[1],a=m[2],p=m[3];return u[0]=g*p+s*l+y*a-b*r,u[1]=y*p+s*r+b*l-g*a,u[2]=b*p+s*a+g*r-y*l,u[3]=s*p-g*l-y*r-b*a,u}const I=R;function B(c,m,i){const u=i??new h(4),g=m*.5,y=c[0],b=c[1],s=c[2],l=c[3],r=Math.sin(g),a=Math.cos(g);return u[0]=y*a+l*r,u[1]=b*a+s*r,u[2]=s*a-b*r,u[3]=l*a-y*r,u}function C(c,m,i){const u=i??new h(4),g=m*.5,y=c[0],b=c[1],s=c[2],l=c[3],r=Math.sin(g),a=Math.cos(g);return u[0]=y*a-s*r,u[1]=b*a+l*r,u[2]=s*a+y*r,u[3]=l*a-b*r,u}function J(c,m,i){const u=i??new h(4),g=m*.5,y=c[0],b=c[1],s=c[2],l=c[3],r=Math.sin(g),a=Math.cos(g);return u[0]=y*a+b*r,u[1]=b*a-y*r,u[2]=s*a+l*r,u[3]=l*a-s*r,u}function tt(c,m,i,u){const g=u??new h(4),y=c[0],b=c[1],s=c[2],l=c[3];let r=m[0],a=m[1],p=m[2],E=m[3],O=y*r+b*a+s*p+l*E;O<0&&(O=-O,r=-r,a=-a,p=-p,E=-E);let _,w;if(1-O>Q){const T=Math.acos(O),v=Math.sin(T);_=Math.sin((1-i)*T)/v,w=Math.sin(i*T)/v}else _=1-i,w=i;return g[0]=_*y+w*r,g[1]=_*b+w*a,g[2]=_*s+w*p,g[3]=_*l+w*E,g}function _t(c,m){const i=m??new h(4),u=c[0],g=c[1],y=c[2],b=c[3],s=u*u+g*g+y*y+b*b,l=s?1/s:0;return i[0]=-u*l,i[1]=-g*l,i[2]=-y*l,i[3]=b*l,i}function lt(c,m){const i=m??new h(4);return i[0]=-c[0],i[1]=-c[1],i[2]=-c[2],i[3]=c[3],i}function Vt(c,m){const i=m??new h(4),u=c[0]+c[5]+c[10];if(u>0){const g=Math.sqrt(u+1);i[3]=.5*g;const y=.5/g;i[0]=(c[6]-c[9])*y,i[1]=(c[8]-c[2])*y,i[2]=(c[1]-c[4])*y}else{let g=0;c[5]>c[0]&&(g=1),c[10]>c[g*4+g]&&(g=2);const y=(g+1)%3,b=(g+2)%3,s=Math.sqrt(c[g*4+g]-c[y*4+y]-c[b*4+b]+1);i[g]=.5*s;const l=.5/s;i[3]=(c[y*4+b]-c[b*4+y])*l,i[y]=(c[y*4+g]+c[g*4+y])*l,i[b]=(c[b*4+g]+c[g*4+b])*l}return i}function $t(c,m,i,u,g){const y=g??new h(4),b=c*.5,s=m*.5,l=i*.5,r=Math.sin(b),a=Math.cos(b),p=Math.sin(s),E=Math.cos(s),O=Math.sin(l),_=Math.cos(l);switch(u){case"xyz":y[0]=r*E*_+a*p*O,y[1]=a*p*_-r*E*O,y[2]=a*E*O+r*p*_,y[3]=a*E*_-r*p*O;break;case"xzy":y[0]=r*E*_-a*p*O,y[1]=a*p*_-r*E*O,y[2]=a*E*O+r*p*_,y[3]=a*E*_+r*p*O;break;case"yxz":y[0]=r*E*_+a*p*O,y[1]=a*p*_-r*E*O,y[2]=a*E*O-r*p*_,y[3]=a*E*_+r*p*O;break;case"yzx":y[0]=r*E*_+a*p*O,y[1]=a*p*_+r*E*O,y[2]=a*E*O-r*p*_,y[3]=a*E*_-r*p*O;break;case"zxy":y[0]=r*E*_-a*p*O,y[1]=a*p*_+r*E*O,y[2]=a*E*O+r*p*_,y[3]=a*E*_-r*p*O;break;case"zyx":y[0]=r*E*_-a*p*O,y[1]=a*p*_+r*E*O,y[2]=a*E*O-r*p*_,y[3]=a*E*_+r*p*O;break;default:throw new Error(`Unknown rotation order: ${u}`)}return y}function bt(c,m){const i=m??new h(4);return i[0]=c[0],i[1]=c[1],i[2]=c[2],i[3]=c[3],i}const Tt=bt;function jt(c,m,i){const u=i??new h(4);return u[0]=c[0]+m[0],u[1]=c[1]+m[1],u[2]=c[2]+m[2],u[3]=c[3]+m[3],u}function Rt(c,m,i){const u=i??new h(4);return u[0]=c[0]-m[0],u[1]=c[1]-m[1],u[2]=c[2]-m[2],u[3]=c[3]-m[3],u}const Pt=Rt;function Xt(c,m,i){const u=i??new h(4);return u[0]=c[0]*m,u[1]=c[1]*m,u[2]=c[2]*m,u[3]=c[3]*m,u}const It=Xt;function Ft(c,m,i){const u=i??new h(4);return u[0]=c[0]/m,u[1]=c[1]/m,u[2]=c[2]/m,u[3]=c[3]/m,u}function ft(c,m){return c[0]*m[0]+c[1]*m[1]+c[2]*m[2]+c[3]*m[3]}function Wt(c,m,i,u){const g=u??new h(4);return g[0]=c[0]+i*(m[0]-c[0]),g[1]=c[1]+i*(m[1]-c[1]),g[2]=c[2]+i*(m[2]-c[2]),g[3]=c[3]+i*(m[3]-c[3]),g}function Z(c){const m=c[0],i=c[1],u=c[2],g=c[3];return Math.sqrt(m*m+i*i+u*u+g*g)}const et=Z;function H(c){const m=c[0],i=c[1],u=c[2],g=c[3];return m*m+i*i+u*u+g*g}const Jt=H;function Et(c,m){const i=m??new h(4),u=c[0],g=c[1],y=c[2],b=c[3],s=Math.sqrt(u*u+g*g+y*y+b*b);return s>1e-5?(i[0]=u/s,i[1]=g/s,i[2]=y/s,i[3]=b/s):(i[0]=0,i[1]=0,i[2]=0,i[3]=1),i}function Kt(c,m){return Math.abs(c[0]-m[0])<Q&&Math.abs(c[1]-m[1])<Q&&Math.abs(c[2]-m[2])<Q&&Math.abs(c[3]-m[3])<Q}function vt(c,m){return c[0]===m[0]&&c[1]===m[1]&&c[2]===m[2]&&c[3]===m[3]}function te(c){const m=c??new h(4);return m[0]=0,m[1]=0,m[2]=0,m[3]=1,m}const st=t.create(),ee=t.create(),Ot=t.create();function se(c,m,i){const u=i??new h(4),g=t.dot(c,m);return g<-.999999?(t.cross(ee,c,st),t.len(st)<1e-6&&t.cross(Ot,c,st),t.normalize(st,st),f(st,Math.PI,u),u):g>.999999?(u[0]=0,u[1]=0,u[2]=0,u[3]=1,u):(t.cross(c,m,st),u[0]=st[0],u[1]=st[1],u[2]=st[2],u[3]=1+g,Et(u,u))}const Ut=new h(4),Qt=new h(4);function Bt(c,m,i,u,g,y){const b=y??new h(4);return tt(c,u,g,Ut),tt(m,i,g,Qt),tt(Ut,Qt,2*g*(1-g),b),b}return{create:e,fromValues:n,set:o,fromAxisAngle:f,toAxisAngle:k,angle:N,multiply:R,mul:I,rotateX:B,rotateY:C,rotateZ:J,slerp:tt,inverse:_t,conjugate:lt,fromMat:Vt,fromEuler:$t,copy:bt,clone:Tt,add:jt,subtract:Rt,sub:Pt,mulScalar:Xt,scale:It,divScalar:Ft,dot:ft,lerp:Wt,length:Z,len:et,lengthSq:H,lenSq:Jt,normalize:Et,equalsApproximately:Kt,equals:vt,identity:te,rotationTo:se,sqlerp:Bt}}const yn=new Map;function si(h){let t=yn.get(h);return t||(t=ei(h),yn.set(h,t)),t}function ni(h){function t(i,u,g,y){const b=new h(4);return i!==void 0&&(b[0]=i,u!==void 0&&(b[1]=u,g!==void 0&&(b[2]=g,y!==void 0&&(b[3]=y)))),b}const e=t;function n(i,u,g,y,b){const s=b??new h(4);return s[0]=i,s[1]=u,s[2]=g,s[3]=y,s}function o(i,u){const g=u??new h(4);return g[0]=Math.ceil(i[0]),g[1]=Math.ceil(i[1]),g[2]=Math.ceil(i[2]),g[3]=Math.ceil(i[3]),g}function f(i,u){const g=u??new h(4);return g[0]=Math.floor(i[0]),g[1]=Math.floor(i[1]),g[2]=Math.floor(i[2]),g[3]=Math.floor(i[3]),g}function k(i,u){const g=u??new h(4);return g[0]=Math.round(i[0]),g[1]=Math.round(i[1]),g[2]=Math.round(i[2]),g[3]=Math.round(i[3]),g}function N(i,u=0,g=1,y){const b=y??new h(4);return b[0]=Math.min(g,Math.max(u,i[0])),b[1]=Math.min(g,Math.max(u,i[1])),b[2]=Math.min(g,Math.max(u,i[2])),b[3]=Math.min(g,Math.max(u,i[3])),b}function R(i,u,g){const y=g??new h(4);return y[0]=i[0]+u[0],y[1]=i[1]+u[1],y[2]=i[2]+u[2],y[3]=i[3]+u[3],y}function I(i,u,g,y){const b=y??new h(4);return b[0]=i[0]+u[0]*g,b[1]=i[1]+u[1]*g,b[2]=i[2]+u[2]*g,b[3]=i[3]+u[3]*g,b}function B(i,u,g){const y=g??new h(4);return y[0]=i[0]-u[0],y[1]=i[1]-u[1],y[2]=i[2]-u[2],y[3]=i[3]-u[3],y}const C=B;function J(i,u){return Math.abs(i[0]-u[0])<Q&&Math.abs(i[1]-u[1])<Q&&Math.abs(i[2]-u[2])<Q&&Math.abs(i[3]-u[3])<Q}function tt(i,u){return i[0]===u[0]&&i[1]===u[1]&&i[2]===u[2]&&i[3]===u[3]}function _t(i,u,g,y){const b=y??new h(4);return b[0]=i[0]+g*(u[0]-i[0]),b[1]=i[1]+g*(u[1]-i[1]),b[2]=i[2]+g*(u[2]-i[2]),b[3]=i[3]+g*(u[3]-i[3]),b}function lt(i,u,g,y){const b=y??new h(4);return b[0]=i[0]+g[0]*(u[0]-i[0]),b[1]=i[1]+g[1]*(u[1]-i[1]),b[2]=i[2]+g[2]*(u[2]-i[2]),b[3]=i[3]+g[3]*(u[3]-i[3]),b}function Vt(i,u,g){const y=g??new h(4);return y[0]=Math.max(i[0],u[0]),y[1]=Math.max(i[1],u[1]),y[2]=Math.max(i[2],u[2]),y[3]=Math.max(i[3],u[3]),y}function $t(i,u,g){const y=g??new h(4);return y[0]=Math.min(i[0],u[0]),y[1]=Math.min(i[1],u[1]),y[2]=Math.min(i[2],u[2]),y[3]=Math.min(i[3],u[3]),y}function bt(i,u,g){const y=g??new h(4);return y[0]=i[0]*u,y[1]=i[1]*u,y[2]=i[2]*u,y[3]=i[3]*u,y}const Tt=bt;function jt(i,u,g){const y=g??new h(4);return y[0]=i[0]/u,y[1]=i[1]/u,y[2]=i[2]/u,y[3]=i[3]/u,y}function Rt(i,u){const g=u??new h(4);return g[0]=1/i[0],g[1]=1/i[1],g[2]=1/i[2],g[3]=1/i[3],g}const Pt=Rt;function Xt(i,u){return i[0]*u[0]+i[1]*u[1]+i[2]*u[2]+i[3]*u[3]}function It(i){const u=i[0],g=i[1],y=i[2],b=i[3];return Math.sqrt(u*u+g*g+y*y+b*b)}const Ft=It;function ft(i){const u=i[0],g=i[1],y=i[2],b=i[3];return u*u+g*g+y*y+b*b}const Wt=ft;function Z(i,u){const g=i[0]-u[0],y=i[1]-u[1],b=i[2]-u[2],s=i[3]-u[3];return Math.sqrt(g*g+y*y+b*b+s*s)}const et=Z;function H(i,u){const g=i[0]-u[0],y=i[1]-u[1],b=i[2]-u[2],s=i[3]-u[3];return g*g+y*y+b*b+s*s}const Jt=H;function Et(i,u){const g=u??new h(4),y=i[0],b=i[1],s=i[2],l=i[3],r=Math.sqrt(y*y+b*b+s*s+l*l);return r>1e-5?(g[0]=y/r,g[1]=b/r,g[2]=s/r,g[3]=l/r):(g[0]=0,g[1]=0,g[2]=0,g[3]=0),g}function Kt(i,u){const g=u??new h(4);return g[0]=-i[0],g[1]=-i[1],g[2]=-i[2],g[3]=-i[3],g}function vt(i,u){const g=u??new h(4);return g[0]=i[0],g[1]=i[1],g[2]=i[2],g[3]=i[3],g}const te=vt;function st(i,u,g){const y=g??new h(4);return y[0]=i[0]*u[0],y[1]=i[1]*u[1],y[2]=i[2]*u[2],y[3]=i[3]*u[3],y}const ee=st;function Ot(i,u,g){const y=g??new h(4);return y[0]=i[0]/u[0],y[1]=i[1]/u[1],y[2]=i[2]/u[2],y[3]=i[3]/u[3],y}const se=Ot;function Ut(i){const u=i??new h(4);return u[0]=0,u[1]=0,u[2]=0,u[3]=0,u}function Qt(i,u,g){const y=g??new h(4),b=i[0],s=i[1],l=i[2],r=i[3];return y[0]=u[0]*b+u[4]*s+u[8]*l+u[12]*r,y[1]=u[1]*b+u[5]*s+u[9]*l+u[13]*r,y[2]=u[2]*b+u[6]*s+u[10]*l+u[14]*r,y[3]=u[3]*b+u[7]*s+u[11]*l+u[15]*r,y}function Bt(i,u,g){const y=g??new h(4);return Et(i,y),bt(y,u,y)}function c(i,u,g){const y=g??new h(4);return It(i)>u?Bt(i,u,y):vt(i,y)}function m(i,u,g){const y=g??new h(4);return _t(i,u,.5,y)}return{create:t,fromValues:e,set:n,ceil:o,floor:f,round:k,clamp:N,add:R,addScaled:I,subtract:B,sub:C,equalsApproximately:J,equals:tt,lerp:_t,lerpV:lt,max:Vt,min:$t,mulScalar:bt,scale:Tt,divScalar:jt,inverse:Rt,invert:Pt,dot:Xt,length:It,len:Ft,lengthSq:ft,lenSq:Wt,distance:Z,dist:et,distanceSq:H,distSq:Jt,normalize:Et,negate:Kt,copy:vt,clone:te,multiply:st,mul:ee,divide:Ot,div:se,zero:Ut,transformMat4:Qt,setLength:Bt,truncate:c,midpoint:m}}const xn=new Map;function ri(h){let t=xn.get(h);return t||(t=ni(h),xn.set(h,t)),t}function Vs(h,t,e,n,o,f){return{mat3:Jr(h),mat4:ti(t),quat:si(e),vec2:Fn(n),vec3:Ss(o),vec4:ri(f)}}const{mat3:kn,mat4:hi,vec2:li}=Vs(Float32Array,Float32Array,Float32Array,Float32Array,Float32Array,Float32Array);Vs(Float64Array,Float64Array,Float64Array,Float64Array,Float64Array,Float64Array);Vs(Yr,Array,Array,Array,Array,Array);const Tn=it({RENDER:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST,STORAGE:GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.TEXTURE_BINDING});it({ALL:"all",STENCIL:"stencil-only",DEPTH:"depth-only"});const _i=it({CLAMP:"clamp-to-edge",REPEAT:"repeat",MIRROR:"mirror-repeat"}),En=it({NEAREST:"nearest",LINEAR:"linear"});it({NEVER:"never",LESS:"less",EQUAL:"equal",LESS_EQUAL:"less-equal",GREATER:"greater",NOT_EQUAL:"not-equal",GREATER_EQUAL:"greater-equal",ALWAYS:"always"});var ii="const QUAD=array(vec2f(-1.0,-1.0),vec2f(1.0,-1.0),vec2f(1.0,1.0),vec2f(1.0,1.0),vec2f(-1.0,1.0),vec2f(-1.0,-1.0));fn GetQuadCoord(index: u32)->vec2f{return QUAD[index];}struct VertexOutput{@builtin(position)position: vec4f,@location(0)textureCoord: vec2f};@group(0)@binding(0)var Sampler: sampler;@group(0)@binding(1)var Texture: texture_2d<f32>;@vertex fn vertex(@builtin(vertex_index)index: u32)->VertexOutput {let position=GetQuadCoord(index);let coord=(position+1)*0.5;var output: VertexOutput;output.position=vec4f(position,0.0,1.0);output.textureCoord=vec2f(coord.x,1-coord.y);return output;}@fragment fn fragment(@location(0)textureCoord: vec2f)->@location(0)vec4f {return textureSample(Texture,Sampler,textureCoord);}",re,ie,W,be,Oe,at,De,Ye,Fs,Bs;class Bn{constructor(t,e){z(this,at);z(this,re);z(this,ie);z(this,W);z(this,be);z(this,Oe);!t&&K(X.DEVICE_NOT_REQUESTED),F(this,W,e),F(this,re,t)}CreateSampler(t){if(!t)return x(this,re).createSampler();const{addressModeUV:e,addressMode:n,minMagFilter:o,filter:f}=t;return e&&(t.addressModeU=t.addressModeV=e),n&&(t.addressModeU=t.addressModeV=t.addressModeW=n),o&&(t.minFilter=t.magFilter=o),f&&(t.minFilter=t.magFilter=t.mipmapFilter=f),x(this,re).createSampler(t)}CreateTexture(t){const e=t.label??"Texture",{format:n="rgba8unorm",usage:o=Tn.RENDER}=t;return x(this,re).createTexture({label:e,format:n,usage:o,...t})}WriteTexture(t,e){const{texture:n,mipLevel:o,origin:f,aspect:k,offset:N,rowsPerImage:R}=e,[I,B]=$(this,at,De).call(this,n);let{bytesPerRow:C}=e;C??(C=(e.width??I)*Float32Array.BYTES_PER_ELEMENT),x(this,re).queue.writeTexture({texture:n,mipLevel:o,origin:f,aspect:k},t,{offset:N,bytesPerRow:C,rowsPerImage:R},$(this,at,Ye).call(this,{width:I,height:B,...e},"WriteTexture"))}CreateStorageTexture(t){let{size:e}=t;const n=Tn.STORAGE|t.usage,o=t.label??"Storage Texture",{format:f=this.PreferredStorageFormat}=t;return e=x(this,W)&&!e?x(this,W).CanvasSize:e,this.CreateTexture({label:o,size:e,format:f,...t,usage:n})}CreateBitmapImage(t,e){return createImageBitmap(t,e)}CreateTextureFromSource(t,e={}){e=typeof e=="boolean"&&{}||e;const n=e.size,o=e.size,f=e.mipLevelCount??((e.mipmaps??!0)&&this.GetMipmapLevels(t)||void 0),k=Array.isArray(e.size)||!e.size?n??$(this,at,De).call(this,t):[o.width,o.height];return this.CreateTexture({size:k,mipLevelCount:f,...e})}ImportExternalTexture(t,e,n){return x(this,re).importExternalTexture({source:t,label:e,colorSpace:n})}CreateMultisampleTexture(t=!1,e=4,n){var N;!x(this,W)&&K(X.RENDER_PIPELNE_NOT_FOUND,"creating a multisample texture.");const{width:o,height:f,format:k}=x(this,W).CurrentTexture;return(t||!x(this,ie)||x(this,ie).width!==o||x(this,ie).height!==f)&&((N=x(this,ie))==null||N.destroy(),F(this,ie,this.CreateTexture({usage:GPUTextureUsage.RENDER_ATTACHMENT,label:n??"Multisample Texture",size:[o,f],sampleCount:e,format:k}))),x(this,ie)}CopyImageToTexture(t,e={create:!0}){var tt;let{create:n,texture:o}=e;const[f,k]=$(this,at,De).call(this,t),{flipY:N,mipLevel:R,aspect:I,colorSpace:B,premultipliedAlpha:C,mipmaps:J}=e;return J===!1&&((tt=n=typeof n=="object"&&n||{}).mipmaps??(tt.mipmaps=!1)),!o&&!n&&K(X.TEXTURE_NOT_FOUND,"`CopyImageToTexture`."),o??(o=this.CreateTextureFromSource(t,n)),x(this,re).queue.copyExternalImageToTexture({source:t,origin:e.sourceOrigin,flipY:N},{texture:o,mipLevel:R,origin:e.destinationOrigin,aspect:I,colorSpace:B,premultipliedAlpha:C},$(this,at,Ye).call(this,{width:f,height:k,...e},"CopyImageToTexture")),(J??!0)&&1<o.mipLevelCount&&(o.depthOrArrayLayers===1?this.GenerateMipmaps(o):this.GenerateCubeMipmaps(o)),o}CopyTextureToTexture(t){const{source:e,create:n}=t;let{srcTexture:o,dstTexture:f}=t;!x(this,W)&&K(X.RENDER_PIPELNE_NOT_FOUND,"copying a texture to a texture."),!o&&!e&&!n&&K(X.TEXTURE_NOT_FOUND,"`CopyTextureToTexture`."),o??(o=this.CreateTextureFromSource(e,n)),f??(f=this.CreateTextureFromSource(o,n));const{srcMipLevel:k,srcOrigin:N,srcAspect:R}=t,{dstMipLevel:I,dstOrigin:B,dstAspect:C}=t,[J,tt]=$(this,at,De).call(this,o);x(this,W).GetCommandEncoder(!0).copyTextureToTexture({texture:o,mipLevel:k,origin:N,aspect:R},{texture:f,mipLevel:I,origin:B,aspect:C},$(this,at,Ye).call(this,{width:J,height:tt,...t},"CopyTextureToTexture"))}CopyTextureToBuffer(t){const{source:e,create:n}=t;let{texture:o,bytesPerRow:f}=t;!x(this,W)&&K(X.RENDER_PIPELNE_NOT_FOUND,"copying a texture to a buffer."),!o&&!e&&!n&&K(X.TEXTURE_NOT_FOUND,"`CopyTextureToBuffer`."),o??(o=this.CreateTextureFromSource(e,n));const[k,N]=$(this,at,De).call(this,o),{buffer:R,offset:I,rowsPerImage:B,mipLevel:C,origin:J,aspect:tt}=t;f??(f=(t.width??k)*Float32Array.BYTES_PER_ELEMENT),$(this,at,Fs).call(this,f,"CopyTextureToBuffer"),x(this,W).GetCommandEncoder(!0).copyTextureToBuffer({texture:o,mipLevel:C,origin:J,aspect:tt},{buffer:R,offset:I,bytesPerRow:f,rowsPerImage:B},$(this,at,Ye).call(this,{width:k,height:N,...t},"CopyTextureToBuffer"))}CopyBufferToTexture(t){const{source:e,create:n}=t;let{texture:o,bytesPerRow:f}=t;!x(this,W)&&K(X.RENDER_PIPELNE_NOT_FOUND,"copying a buffer to a texture."),!o&&!e&&!n&&K(X.TEXTURE_NOT_FOUND,"`CopyBufferToTexture`."),o??(o=this.CreateTextureFromSource(e,n));const[k,N]=$(this,at,De).call(this,o),{buffer:R,offset:I,rowsPerImage:B,mipLevel:C,origin:J,aspect:tt}=t;f??(f=(t.width??k)*Float32Array.BYTES_PER_ELEMENT),$(this,at,Fs).call(this,f,"CopyBufferToTexture"),x(this,W).GetCommandEncoder(!0).copyBufferToTexture({buffer:R,offset:I,bytesPerRow:f,rowsPerImage:B},{texture:o,mipLevel:C,origin:J,aspect:tt},$(this,at,Ye).call(this,{width:k,height:N,...t},"CopyBufferToTexture"))}get PreferredStorageFormat(){const t=je.PreferredCanvasFormat;return x(this,re).features.has("bgra8unorm-storage")&&t==="bgra8unorm"?t:"rgba8unorm"}GenerateCubeMipmaps(t){$(this,at,Bs).call(this,t,{minMagFilter:En.LINEAR},e=>{for(let n=0;n<t.depthOrArrayLayers;++n)x(this,W).SetBindGroups(x(this,W).CreateBindGroup(x(this,W).CreateBindGroupEntries([x(this,be),t.createView({baseMipLevel:e-1,arrayLayerCount:1,baseArrayLayer:n,mipLevelCount:1,dimension:"2d"})]))),x(this,W).CreatePassDescriptor(x(this,W).CreateColorAttachment(t.createView({arrayLayerCount:1,baseArrayLayer:n,mipLevelCount:1,dimension:"2d",baseMipLevel:e}))),x(this,W).Render(6,!1),x(this,W).DestroyCurrentPass()})}GenerateMipmaps(t){$(this,at,Bs).call(this,t,{minFilter:En.LINEAR},e=>{x(this,W).SetBindGroups(x(this,W).CreateBindGroup(x(this,W).CreateBindGroupEntries([x(this,be),t.createView({baseMipLevel:e-1,mipLevelCount:1})]))),x(this,W).CreatePassDescriptor(x(this,W).CreateColorAttachment(t.createView({baseMipLevel:e,mipLevelCount:1}))),x(this,W).Render(6,!1),x(this,W).DestroyCurrentPass()})}GetMipmapLevels(t){const[e,n]=$(this,at,De).call(this,t);return(Math.log2(Math.max(e,n))|0)+1}set Renderer(t){F(this,W,t)}SetRenderer(t){this.Renderer=t}Destroy(){var t;F(this,ie,(t=x(this,ie))==null?void 0:t.destroy())}}re=new WeakMap,ie=new WeakMap,W=new WeakMap,be=new WeakMap,Oe=new WeakMap,at=new WeakSet,De=function(t){return t instanceof HTMLVideoElement?[t.videoWidth,t.videoHeight]:t instanceof VideoFrame?[t.codedWidth,t.codedHeight]:[t.width,t.height]},Ye=function(t,e){const{size:n,width:o,height:f,depthOrArrayLayers:k}=t;return!n&&!o&&K(X.TEXTURE_SIZE_NOT_FOUND,`\`${e}\` method.`),n??{width:o,height:f,depthOrArrayLayers:k}},Fs=function(t,e){const n=t/256;n!==(n|0)&&ke(X.INVALID_BYTES_PER_ROW,`\`${e}\` options.`)},Bs=function(t,e,n){!x(this,W)&&K(X.RENDER_PIPELNE_NOT_FOUND,"creating a texture with mipmaps."),x(this,W).SavePipelineState(),x(this,W).ResetPipelineState(),(!x(this,Oe)||!x(this,be))&&(F(this,Oe,x(this,W).CreateShaderModule(ii)),F(this,be,this.CreateSampler(e))),x(this,W).CreatePipeline({vertex:x(this,W).CreateVertexState(x(this,Oe)),fragment:x(this,W).CreateFragmentState(x(this,Oe),void 0,x(this,W).CreateTargetState(t.format))});for(let o=1;o<t.mipLevelCount;++o)n(o);x(this,W).SubmitCommandBuffer(),x(this,W).SetCommandEncoder(void 0),x(this,W).RestorePipelineState(),F(this,Oe,F(this,be,void 0))};var _s,me,fs,Ke,Ue,ot,ye,ze,Ce,Ht,oe,ct,Zt,Ve,xe,ae,Re,ts,es,ss,$e,de,kt,Ls,Gs,qs,zs,Ln;class oi extends Pn{constructor(e,n,o,f){super(e,n,"Render");z(this,kt);z(this,_s);z(this,me,!1);z(this,fs,kn.identity());z(this,Ke,new Float32Array(3));z(this,Ue,!1);z(this,ot);z(this,ye);z(this,ze);z(this,Ce);z(this,Ht);z(this,oe);z(this,ct);z(this,Zt);z(this,Ve);z(this,xe,[0,0,0,0]);z(this,ae,[]);z(this,Re);z(this,ts);z(this,es);z(this,ss,[0,0,0,0]);z(this,$e);z(this,de);!o&&K(X.CANVAS_NOT_FOUND);const k=o.getContext("webgpu");!k&&K(X.CONTEXT_NOT_FOUND),k.configure({device:e,...f}),F(this,ze,this.CreateBuffer({size:x(this,Ke).length*Float32Array.BYTES_PER_ELEMENT,label:"Render Pipeline Resolution Buffer",usage:Te.UNIFORM})),F(this,ot,o),F(this,ye,k),$(this,kt,Ls).call(this),$(this,kt,Gs).call(this),F(this,Ve,f.format),this.CreatePassDescriptor(this.CreateColorAttachment())}ConfigureContext(e){const n=e.format??x(this,Ve);x(this,ye).configure({device:this.Device,format:n,...e})}CreateColorAttachment(e,n="clear",o="store",f,k,N){const R=f&&$(this,kt,qs).call(this,f);return{view:e,loadOp:n,storeOp:o,clearValue:R,resolveTarget:k,depthSlice:N}}CreateDepthAttachment(e,n=1,o="clear",f="store",k){return F(this,Ue,!0),F(this,Ce,new Bn(this.Device)),{view:e,depthClearValue:n,depthLoadOp:o,depthStoreOp:f,depthReadOnly:k}}CreateStencilAttachment(e,n="clear",o="store",f){return{stencilClearValue:e,stencilLoadOp:n,stencilStoreOp:o,stencilReadOnly:f}}CreatePassDescriptor(e,n,o,f,k,N){const R=Array.isArray(e)&&e||[e];return F(this,me,!R.some(({view:I})=>!!I)),n??(n=this.CreatePipelineLabel("Render Pass")),this.Descriptor={colorAttachments:R,depthStencilAttachment:o,occlusionQuerySet:f,timestampWrites:k,maxDrawCount:N,label:n}}CreateIndexBuffer(e,n){const o=(n==null?void 0:n.label)??"Index Buffer";return e=Array.isArray(e)&&new Uint32Array(e)||e,this.CreateBuffer({label:o,size:e.byteLength,usage:Te.INDEX,...n})}CreateVertexBufferAttribute(e,n=0,o=0){return $(this,kt,zs).call(this,e,n,o)}CreateVertexBufferLayout(e,n,o="vertex"){!this.Reflect&&K(X.SHADER_MODULE_NOT_FOUND,"`Renderer.CreateVertexBufferLayout`.\n            Call `Renderer.CreateShaderModule` before creating a vertex layout or vertex buffer.");const{entry:{vertex:f}}=this.Reflect,k=f.find(({name:I})=>o===I);!k&&K(X.VERTEX_ENTRY_NOT_FOUND,`\`${o}\` in vertex shader entries.`),e=Array.isArray(e)&&e||[e];let N=[],R=0;for(let I=0,B=e.length;I<B;++I){const C=e[I],J=typeof C=="string",tt=J?C:C.name,_t=k.inputs.find(({name:lt})=>tt===lt);if(_t){const lt=J?rr(_t.type.size):C.format;N.push($(this,kt,zs).call(this,lt,+_t.location,R)),R+=ir(lt);continue}ke(X.VERTEX_ATTRIBUTE_NOT_FOUND,`\`${tt}\` in vertex shader inputs.`)}return{arrayStride:R,stepMode:n,attributes:N}}CreateVertexBuffer(e,n=1,o,f="vertex"){const k=n.label??"Vertex Buffer";if(e instanceof Float32Array)return this.CreateBuffer({label:k,size:e.byteLength,usage:Te.VERTEX,...n});const N=this.CreateVertexBufferLayout(e,o,f),R=(typeof n=="number"&&n||(n.count??1))*N.arrayStride;return{buffer:this.CreateBuffer({label:k,size:R,usage:Te.VERTEX,...n}),layout:N}}CreateVertexState(e,n="vertex",o,f){return o=Array.isArray(o)&&o||[o],{module:e,entryPoint:n,buffers:o,constants:f}}CreateBlendComponent(e="add",n="one",o="zero"){return{operation:e,srcFactor:n,dstFactor:o}}CreateTargetState(e=x(this,Ve),n,o){return n&&(n={color:n.color??{},alpha:n.alpha??{}}),{format:e,blend:n,writeMask:o}}CreateFragmentState(e,n="fragment",o,f){return o??(o=this.CreateTargetState()),o=Array.isArray(o)&&o||[o],{module:e,entryPoint:n,targets:o,constants:f}}CreateStencilFaceState(e,n,o,f){return{compare:e,failOp:n,depthFailOp:o,passOp:f}}CreateDepthStencilState(e="depth24plus",n=!0,o="less",f,k,N,R,I,B,C){return{format:e,depthWriteEnabled:n,depthCompare:o,stencilFront:f,stencilBack:k,stencilReadMask:N,stencilWriteMask:R,depthBias:I,depthBiasSlopeScale:B,depthBiasClamp:C}}CreateMultisampleState(e=4,n,o){return{count:e,mask:n,alphaToCoverageEnabled:o}}CreateStorageTextureBindingLayout(e=x(this,Ve),n,o,f,k){return{binding:k,visibility:GPUShaderStage.FRAGMENT,storageTexture:{access:n,format:e,viewDimension:o}}}CreatePipeline(e={},n){let o=this.GetShaderModule(e),{vertex:f,fragment:k}=e;!o&&!f&&(o=this.CreateShaderModule()),o&&(f??(f=this.CreateVertexState(o)),k??(k=this.CreateFragmentState(o)));const N=e.label??this.CreatePipelineLabel("Render Pipeline"),R=e.layout??"auto";return this.SetPipeline(this.Device.createRenderPipeline({label:N,layout:R,vertex:f,fragment:k,...e})),n&&(x(this,ct)?x(this,ct).setPipeline(this.Pipeline):ke(X.RENDER_PASS_NOT_FOUND)),this.Pipeline}SavePipelineState(){super.SavePipelineState(),F(this,de,x(this,Zt)),F(this,Re,x(this,ae)),F(this,ss,x(this,xe)),F(this,$e,x(this,oe)),F(this,ts,x(this,me)),F(this,es,x(this,Ue)),x(this,de)&&F(this,de,Object.values(x(this,de)))}ResetPipelineState(){var e;super.ResetPipelineState(),this.SetVertexBuffers([]),this.SetIndexBuffer(void 0),F(this,me,!1),F(this,ss,[0,0,0,0]),F(this,Ue,!1),F(this,oe,(e=x(this,oe))==null?void 0:e.destroy())}RestorePipelineState(){super.RestorePipelineState(),F(this,ae,x(this,Re)),F(this,xe,x(this,ss)),F(this,oe,x(this,$e)),F(this,me,x(this,ts)),F(this,Ue,x(this,es)),this.SetIndexBuffer(...Array.isArray(x(this,de))&&x(this,de)||[void 0])}SetVertexBuffers(e,n,o){n=Array.isArray(n)&&n||[n],o=Array.isArray(o)&&o||[o],F(this,ae,Array.isArray(e)&&e.map((f,k)=>({buffer:f,offset:n[k],size:o[k]}))||[{buffer:e,offset:n[0],size:o[0]}])}AddVertexBuffers(e,n,o){n=Array.isArray(n)&&n||[n],o=Array.isArray(o)&&o||[o],x(this,ae).push(...Array.isArray(e)&&e.map((f,k)=>({buffer:f,offset:n[k],size:o[k]}))||[{buffer:e,offset:n[0],size:o[0]}])}SetIndexBuffer(e,n="uint32",o,f){F(this,Zt,e&&{buffer:e,format:n,offset:o,size:f})}SetCanvasSize(e,n,o=!0){!this.Device&&K(X.DEVICE_NOT_FOUND),!x(this,ot)&&K(X.CANVAS_NOT_FOUND);let f=this.DevicePixelRatio*e|0,k=this.DevicePixelRatio*n|0;const N=this.Device.limits.maxTextureDimension2D;f=Math.max(1,Math.min(f,N)),k=Math.max(1,Math.min(k,N)),(x(this,ot).width!==f||x(this,ot).height!==k)&&(o&&(x(this,ot).style.height=`${n}px`,x(this,ot).style.width=`${e}px`),x(this,ot).height=k,x(this,ot).width=f,$(this,kt,Gs).call(this),$(this,kt,Ls).call(this))}Render(e,n=!0){x(this,Ue)&&$(this,kt,Ln).call(this),x(this,ct)||(x(this,oe)?(this.Descriptor.colorAttachments[0].view=x(this,oe).createView(),this.Descriptor.colorAttachments[0].resolveTarget=this.CurrentTextureView):x(this,me)&&(this.Descriptor.colorAttachments[0].view=this.CurrentTextureView),F(this,ct,this.GetCommandEncoder().beginRenderPass(this.Descriptor)),x(this,ct).setPipeline(this.Pipeline),F(this,_s,x(this,Zt)?x(this,ct).drawIndexed.bind(x(this,ct)):x(this,ct).draw.bind(x(this,ct))));for(let o=0,f=x(this,ae).length;o<f;++o){const{buffer:k,offset:N,size:R}=x(this,ae)[o];x(this,ct).setVertexBuffer(o,k,N,R)}x(this,Zt)&&x(this,ct).setIndexBuffer(x(this,Zt).buffer,x(this,Zt).format,x(this,Zt).offset,x(this,Zt).size);for(let o=0,f=0,k=this.BindGroups.length;o<k;++o){const{bindGroup:N,dynamicOffsets:R,active:I}=this.BindGroups[o];I&&x(this,ct).setBindGroup(f++,N,R)}x(this,ct).setBlendConstant(x(this,xe)),x(this,_s).call(this,...Array.isArray(e)&&e||[e]),n&&this.Submit()}DestroyCurrentPass(){var e;(e=x(this,ct))==null||e.end(),F(this,ct,void 0)}Submit(){this.DestroyCurrentPass(),this.SubmitCommandBuffer(),this.SetCommandEncoder(void 0)}Destroy(){var e;this.DestroyCurrentPass(),(e=x(this,ye))==null||e.unconfigure()}get Canvas(){return x(this,ot)}get Context(){return x(this,ye)}get CurrentPass(){return x(this,ct)}get AspectRatio(){return!x(this,ot)&&K(X.CANVAS_NOT_FOUND),x(this,ot).width/x(this,ot).height}get Projection2D(){return x(this,fs)}get DepthTexture(){return x(this,Ht)}get CurrentTexture(){return x(this,ye).getCurrentTexture()}get CurrentTextureView(){return this.CurrentTexture.createView()}set MultisampleTexture(e){F(this,oe,e)}get MultisampleTexture(){return x(this,oe)}set BlendConstant(e){F(this,xe,$(this,kt,qs).call(this,e))}get BlendConstant(){return x(this,xe)}get ResolutionBuffer(){return x(this,ze)}get DevicePixelRatio(){return devicePixelRatio??1}set TextureView(e){this.Descriptor.colorAttachments[0].view=e,F(this,me,!e)}get BaseCanvasSize(){const{width:e,height:n}=x(this,ot),o=this.DevicePixelRatio;return[e/o,n/o]}get CanvasSize(){return[x(this,ot).width,x(this,ot).height]}Destroy(){var e,n,o,f,k,N,R;super.Destroy(),F(this,ct,void 0),x(this,ze).destroy(),F(this,xe,[0,0,0,0]),F(this,Ce,(e=x(this,Ce))==null?void 0:e.Destroy()),F(this,Ht,(n=x(this,Ht))==null?void 0:n.destroy()),F(this,$e,(o=x(this,$e))==null?void 0:o.destroy()),F(this,ts,F(this,es,!1)),(f=x(this,Re))==null||f.forEach(({buffer:I})=>I.destroy()),x(this,ae).forEach(({buffer:I})=>I.destroy()),(k=x(this,Zt))==null||k.buffer.destroy(),(N=x(this,de))==null||N.splice(0),F(this,de,void 0),(R=x(this,Re))==null||R.splice(0),F(this,Re,void 0),x(this,ae).splice(0),this.ResetPipelineState(),x(this,ye).unconfigure()}}_s=new WeakMap,me=new WeakMap,fs=new WeakMap,Ke=new WeakMap,Ue=new WeakMap,ot=new WeakMap,ye=new WeakMap,ze=new WeakMap,Ce=new WeakMap,Ht=new WeakMap,oe=new WeakMap,ct=new WeakMap,Zt=new WeakMap,Ve=new WeakMap,xe=new WeakMap,ae=new WeakMap,Re=new WeakMap,ts=new WeakMap,es=new WeakMap,ss=new WeakMap,$e=new WeakMap,de=new WeakMap,kt=new WeakSet,Ls=function(){x(this,Ke).set([x(this,ot).width,x(this,ot).height,this.DevicePixelRatio]),this.WriteBuffer(x(this,ze),x(this,Ke))},Gs=function(){const e=2/x(this,ot).clientWidth,n=-2/x(this,ot).clientHeight;kn.set(e,0,0,0,n,0,-1,1,1,x(this,fs))},qs=function(e){return e instanceof Is?e.rgba:e},zs=function(e,n=0,o=0){return{format:e,shaderLocation:n,offset:o}},Ln=function(){var f;const e=this.CurrentTexture,{width:n,height:o}=e;(!x(this,Ht)||x(this,Ht).width!==n||x(this,Ht).height!==o)&&((f=x(this,Ht))==null||f.destroy(),F(this,Ht,x(this,Ce).CreateTextureFromSource(e,{usage:GPUTextureUsage.RENDER_ATTACHMENT,label:"Depth Texture",format:"depth24plus",mipmaps:!1}))),this.Descriptor.depthStencilAttachment.view=x(this,Ht).createView()};var ds;class ai extends Pn{constructor(e,n){super(e,n,"Compute");z(this,ds,[1]);this.CreatePassDescriptor()}CreatePassDescriptor(e,n){return e??(e=this.CreatePipelineLabel("Compute Pass")),this.Descriptor={label:e,timestampWrites:n}}CreatePipeline(e){const n=e.label??this.CreatePipelineLabel("Compute Pipeline"),o=e.layout??"auto",f=this.GetShaderModule(e)??this.CreateShaderModule();return this.SetPipeline(this.Device.createComputePipeline({label:n,layout:o,compute:{module:f,...e}}))}Compute(e=!1){const n=this.GetCommandEncoder().beginComputePass(this.Descriptor);n.setPipeline(this.Pipeline);for(let o=0,f=0,k=this.BindGroups.length;o<k;++o){const{bindGroup:N,dynamicOffsets:R,active:I}=this.BindGroups[o];I&&n.setBindGroup(f++,N,R)}n.dispatchWorkgroups(...x(this,ds)),n.end(),e&&this.Submit()}Submit(){this.SubmitCommandBuffer(),this.SetCommandEncoder(void 0)}set Workgroups(e){F(this,ds,Array.isArray(e)&&e||[e])}Destroy(){super.Destroy(),this.Workgroups=1}}ds=new WeakMap;var ns,Xe,rs,is,pe,ce,Cs,Gn,qn,zn;const ne=class ne{static async CreateQuerySet(t,e){const o=(await this.GPUDevice).createQuerySet({type:t,count:e});return x(this,ns).push(o),o}static RenderPipeline(t,e="",n={}){return n.format??(n.format=this.PreferredCanvasFormat),$(this,ce,Cs).call(this,e),(async()=>{const o=await this.GPUDevice;return new Proxy(oi,{construct(f){return new f(o,e,t,n)}})})()}static ComputePipeline(t=""){return $(this,ce,Cs).call(this,t),(async()=>{const e=await this.GPUDevice;return new Proxy(ai,{construct(n){return new n(e,t)}})})()}static Texture(t){return(async()=>{const e=await this.GPUDevice;return new Proxy(Bn,{construct(n){return new n(e,t)}})})()}static Destroy(t,e){var n;x(this,ns).forEach(o=>o.destroy()),t=Array.isArray(t)&&t||[t],t.forEach(o=>o==null?void 0:o.destroy()),e=Array.isArray(e)&&e||[e],e.forEach(o=>o==null?void 0:o.destroy()),(n=x(this,Xe))==null||n.destroy(),x(this,ns).splice(0),x(this,pe).requiredFeatures.clear(),F(this,rs,F(this,Xe,null)),this.DescriptorLabel=this.RequiredLimits=void 0,this.PowerPreference=this.ForceFallbackAdapter=void 0}static set PowerPreference(t){x(this,is).powerPreference=t}static set ForceFallbackAdapter(t){x(this,is).forceFallbackAdapter=t}static set DescriptorLabel(t){x(this,pe).label=t}static async SetRequiredFeatures(t){const e=(await this.Adapter).features;return t=Array.isArray(t)&&t||[t],t.forEach(n=>e.has(n)?x(this,pe).requiredFeatures.add(n):ke(X.FEATURE_NOT_FOUND,`"${n}".
It will be skipped when requesting a GPUDevice.`)),x(this,pe).requiredFeatures}static set RequiredLimits(t){x(this,pe).requiredLimits=t}static get PreferredCanvasFormat(){return!navigator.gpu&&K(X.WEBGPU_NOT_SUPPORTED),navigator.gpu.getPreferredCanvasFormat()}static get Adapter(){return(async()=>x(this,rs)??await $(this,ce,qn).call(this)())()}static get GPUDevice(){return(async()=>x(this,Xe)??await $(this,ce,zn).call(this)())()}static set OnDeviceLost(t){this.OnLost=t}static get OnDeviceLost(){return this.OnLost}static get Device(){return this.GPUDevice}static get VERSION(){return"0.0.10"}};ns=new WeakMap,Xe=new WeakMap,rs=new WeakMap,is=new WeakMap,pe=new WeakMap,ce=new WeakSet,Cs=function(t){var e;(e=x(this,pe)).label??(e.label=t&&`${t} Device`||"")},Gn=function(t){if(ne.OnLost)return ne.OnLost(t);const e=(t.message&&` | Message: ${t.message}`)??".";K(X.DEVICE_LOST,`Reason: ${t.reason}`+e)},qn=function(){return!navigator.gpu&&K(X.WEBGPU_NOT_SUPPORTED),async()=>{const t=await navigator.gpu.requestAdapter(x(this,is));return!t&&K(X.ADAPTER_NOT_FOUND),F(this,rs,t)}},zn=function(){return async()=>{const{requiredFeatures:t,requiredLimits:e,label:n}=x(this,pe),o=await(await this.Adapter).requestDevice({requiredFeatures:t,requiredLimits:e,defaultQueue:{label:n}});return!o&&K(X.DEVICE_NOT_FOUND),o.lost.then($(this,ce,Gn)),F(this,Xe,o)}},z(ne,ce),z(ne,ns,[]),z(ne,Xe,null),z(ne,rs,null),z(ne,is,{powerPreference:void 0,forceFallbackAdapter:!1}),Ie(ne,"OnLost"),z(ne,pe,{label:void 0,requiredFeatures:new Set,requiredLimits:void 0});let je=ne;it({TRIANGLE:3,SQUARE:4,PENTAGON:5,HEXAGON:6,HEPTAGON:7,OCTAGON:8,NONAGON:9,DECAGON:10,DODECAGON:12});/**
 * @module UWAL
 * @author Ustym Ukhman <ustym.ukhman@gmail.com>
 * @description Unopinionated WebGPU Abstraction Library
 * @version 0.0.10
 * @license MIT
 */const fi={DegreesToRadians:er,RadiansToDegrees:sr,EuclideanModulo:nr,GPUTiming:tr};console.info("%cUWAL v0.0.10","background:#005a9c;padding:3px;color:#fff;");export{_i as A,ui as B,Is as C,je as D,En as F,vn as N,fi as U,hi as a,it as b,kn as m,li as v};
