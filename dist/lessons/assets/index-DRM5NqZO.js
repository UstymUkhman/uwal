var X=Object.defineProperty;var j=(s,e,t)=>e in s?X(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var _=(s,e,t)=>(j(s,typeof e!="symbol"?e+"":e,t),t),G=(s,e,t)=>{if(!e.has(s))throw TypeError("Cannot "+t)};var n=(s,e,t)=>(G(s,e,"read from private field"),t?t.call(s):e.get(s)),u=(s,e,t)=>{if(e.has(s))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(s):e.set(s,t)},E=(s,e,t,a)=>(G(s,e,"write to private field"),a?a.call(s,t):e.set(s,t),t);var p=(s,e,t)=>(G(s,e,"access private method"),t);function S(s){const e={};for(let t in s)e[t]={value:s[t]};return Object.freeze(Object.create(null,e))}const k=S({DEVICE_LOST:"Device::Lost"}),O=S({WEBGPU_NOT_SUPPORTED:"WEBGPU_NOT_SUPPORTED",ADAPTER_NOT_FOUND:"ADAPTER_NOT_FOUND",DEVICE_NOT_FOUND:"DEVICE_NOT_FOUND",DEVICE_NOT_REQUESTED:"DEVICE_NOT_REQUESTED",DEVICE_LOST:"DEVICE_LOST",CANVAS_NOT_FOUND:"CANVAS_NOT_FOUND",CONTEXT_NOT_FOUND:"CONTEXT_NOT_FOUND",COMMAND_ENCODER_NOT_FOUND:"COMMAND_ENCODER_NOT_FOUND"}),M=S({WEBGPU_NOT_SUPPORTED:"WebGPU is not supported in this browser.",ADAPTER_NOT_FOUND:"Failed to get a GPUAdapter.",DEVICE_NOT_FOUND:"Failed to get a GPUDevice.",DEVICE_NOT_REQUESTED:"GPUDevice was not requested.",DEVICE_LOST:"WebGPU device was lost.",CANVAS_NOT_FOUND:"Failed to get a WebGPU canvas.",CONTEXT_NOT_FOUND:"Failed to get a WebGPU context.",COMMAND_ENCODER_NOT_FOUND:"Failed to get a GPUCommandEncoder."}),q=S({WEBGPU_NOT_SUPPORTED:0,ADAPTER_NOT_FOUND:1,DEVICE_NOT_FOUND:2,DEVICE_NOT_REQUESTED:3,DEVICE_LOST:4,CANVAS_NOT_FOUND:5,CONTEXT_NOT_FOUND:6,COMMAND_ENCODER_NOT_FOUND:7});function W(s,e){console.warn(M[s]+(e??""))}function l(s,e){throw new Error(M[s]+(e??""),{cause:q[s]})}var h,N,g;class L{constructor(e,t){u(this,h,void 0);u(this,N,void 0);_(this,"Device");_(this,"BindGroups",[]);u(this,g,void 0);!e&&l(O.DEVICE_NOT_REQUESTED),this.Device=e,E(this,h,t),E(this,N,this.CreateProgramLabel("Command Encoder"))}CreateProgramLabel(e){return n(this,h)&&e&&`${n(this,h)} ${e}`||""}CreateBuffer(e){const t=e.label??this.CreateProgramLabel("Buffer");return this.Device.createBuffer({...e,label:t})}WriteBuffer(e,t,a=0,i,o){this.Device.queue.writeBuffer(e,a,t,i,o)}CopyBufferToBuffer(e,t,a,i=0,o=0){this.CommandEncoder.copyBufferToBuffer(e,i,t,o,a)}CreateShaderModule(e,t,a,i){t??(t=this.CreateProgramLabel("Shader Module"));const o=Array.isArray(e)&&e.join(`

`)||e;return this.Device.createShaderModule({label:t,code:o,sourceMap:a,compilationHints:i})}CreateBindGroupEntries(e){return Array.isArray(e)&&e.map((t,a)=>({binding:a,resource:t}))||[{binding:0,resource:e}]}CreateBindGroup(e){const t=e.label??this.CreateProgramLabel("Bind Group");return this.Device.createBindGroup({...e,label:t})}AddBindGroups(e){this.BindGroups=Array.isArray(e)&&e||[e]}CreateCommandEncoder(){return E(this,g,this.Device.createCommandEncoder({label:n(this,N)}))}SubmitCommandBuffer(){this.Device.queue.submit([this.CommandEncoder.finish()])}set CommandEncoderLabel(e){E(this,N,e)}get CommandEncoder(){if(!n(this,g)){const e=` ${n(this,N)&&`Label: "${n(this,N)}". `}`;return W(O.COMMAND_ENCODER_NOT_FOUND,e+"Creating a new one."),this.CreateCommandEncoder()}return n(this,g)}get ProgramName(){return n(this,h)}}h=new WeakMap,N=new WeakMap,g=new WeakMap;var f,D;class z extends L{constructor(t,a,i){super(t,a);u(this,f,void 0);u(this,D,void 0);E(this,f,i)}CreateColorAttachment(t,a="load",i="store",o,c,m){return{view:t,loadOp:a,storeOp:i,clearValue:o,resolveTarget:c,depthSlice:m}}CreateRenderPassDescriptor(t,a,i,o,c,m){const V=Array.isArray(t)&&t||[t];return a??(a=this.CreateProgramLabel("Render Pass")),{colorAttachments:V,depthStencilAttachment:i,occlusionQuerySet:o,timestampWrites:c,maxDrawCount:m,label:a}}CreateVertexState(t,a="vertex",i,o){return{module:t,entryPoint:a,constants:i,buffers:o}}CreateFragmentState(t,a="fragment",i,o){return i??(i=[{format:n(this,f)}]),{module:t,entryPoint:a,targets:i,constants:o}}CreateRenderPipeline(t){const a=t.layout??"auto",i=t.label??this.CreateProgramLabel("Render Pipeline");return this.Device.createRenderPipeline({...t,label:i,layout:a})}Render(t,a,i,o=!0){if(!n(this,D)){const c=this.CreateCommandEncoder();E(this,D,c.beginRenderPass(t)),n(this,D).setPipeline(a)}for(let c=0,m=this.BindGroups.length;c<m;++c)n(this,D).setBindGroup(c,this.BindGroups[c]);n(this,D).draw(...Array.isArray(i)&&i||[i]),o&&(n(this,D).end(),E(this,D,void 0),this.SubmitCommandBuffer())}get CurrentPass(){return n(this,D)}}f=new WeakMap,D=new WeakMap;var v;class H extends L{constructor(t,a){super(t,a);u(this,v,[1])}CreateComputePassDescriptor(t,a,i,o){return t??(t=this.CreateProgramLabel("Compute Pass")),{label:t,timestampWrites:a?{querySet:a,beginningOfPassWriteIndex:i,endOfPassWriteIndex:o}:void 0}}CreateComputePipeline(t){const a=t.layout??"auto",i=t.label??this.CreateProgramLabel("Compute Pipeline");return this.Device.createComputePipeline({label:i,layout:a,compute:t})}Compute(t,a){const i=this.CommandEncoder.beginComputePass(a);i.setPipeline(t);for(let o=0,c=this.BindGroups.length;o<c;++o)i.setBindGroup(o,this.BindGroups[o]);i.dispatchWorkgroups(...n(this,v)),i.end()}set Workgroups(t){E(this,v,Array.isArray(t)&&t||[t])}}v=new WeakMap;/**
 * @module UWAL
 * @author Ustym Ukhman <ustym.ukhman@gmail.com>
 * @description Unopinionated WebGPU Abstraction Library
 * @version 0.0.2
 * @license MIT
 */var R,T,C,P,F,A,d,U,w,b,x,y,$,B,Q;const r=class r{static SetAdapterOptions(e,t=!1){n(r,A).powerPreference=e,n(r,A).forceFallbackAdapter=t}static SetDeviceDescriptor(e,t=[],a={}){n(r,d).label=e,n(r,d).requiredFeatures=t,n(r,d).requiredLimits=a}static SetCanvasSize(e=innerWidth,t=innerHeight){!n(r,C)&&l(O.CANVAS_NOT_FOUND),!n(r,T)&&l(O.DEVICE_NOT_FOUND);const{maxTextureDimension2D:a}=n(r,T).limits;e=Math.max(1,Math.min(e,a)),t=Math.max(1,Math.min(t,a)),(n(r,C).width!==e||n(r,C).height!==t)&&(n(r,C).height=t,n(r,C).width=e)}static RenderPipeline(e,t="",a={}){return n(r,d).label=p(this,U,w).call(this,t),(async()=>{const i=await r.Device,o=e.getContext("webgpu");!o&&l(O.CONTEXT_NOT_FOUND);const c=a.format??n(r,F),m={...a,format:c};return o.configure({device:i,...m}),E(r,C,e),E(r,P,o),new Proxy(z,{construct(V){return new V(i,t,c)}})})()}static ComputePipeline(e=""){return n(r,d).label=p(this,U,w).call(this,e),(async()=>{const t=await r.Device;return new Proxy(H,{construct(a){return new a(t,e)}})})()}static Destroy(e,t,a){var i,o;e=Array.isArray(e)&&e||[e],e.forEach(c=>c==null?void 0:c.destroy()),t=Array.isArray(t)&&t||[t],t.forEach(c=>c==null?void 0:c.destroy()),a=Array.isArray(a)&&a||[a],a.forEach(c=>c==null?void 0:c.destroy()),(i=n(r,P))==null||i.unconfigure(),(o=n(r,T))==null||o.destroy()}static get Adapter(){return(async()=>{var e;return n(r,R)??await p(e=r,b,x).call(e)()})()}static get Device(){return(async()=>{var e;return n(r,T)??await p(e=r,y,$).call(e)()})()}static get Canvas(){return n(r,C)}static get Context(){return n(r,P)}static get AspectRatio(){return!n(r,C)&&l(O.CANVAS_NOT_FOUND),n(r,C).width/n(r,C).height}static get CurrentTexture(){return n(r,P).getCurrentTexture()}static get CurrentTextureView(){return r.CurrentTexture.createView()}static get VERSION(){return"0.0.2"}};R=new WeakMap,T=new WeakMap,C=new WeakMap,P=new WeakMap,F=new WeakMap,A=new WeakMap,d=new WeakMap,U=new WeakSet,w=function(e){return n(r,d).label??(e&&`${e} Device`||"")},b=new WeakSet,x=function(){return!navigator.gpu&&l(O.WEBGPU_NOT_SUPPORTED),E(r,F,navigator.gpu.getPreferredCanvasFormat()),async()=>{const e=await navigator.gpu.requestAdapter(n(r,A));return!e&&l(O.ADAPTER_NOT_FOUND),E(r,R,e)}},y=new WeakSet,$=function(){return async()=>{const{requiredFeatures:e,requiredLimits:t,label:a}=n(r,d),i=await(await r.Adapter).requestDevice({requiredFeatures:e,requiredLimits:t,defaultQueue:{label:a}});return!i&&l(O.DEVICE_NOT_FOUND),i.lost.then(p(r,B,Q)),E(r,T,i)}},B=new WeakSet,Q=function(e){if(r.OnDeviceLost)return r.OnDeviceLost(e);n(r,C).dispatchEvent(new CustomEvent(k.DEVICE_LOST,{detail:e}));const t=(e.message&&` | Message: ${e.message}`)??".";l(O.DEVICE_LOST,` Reason: ${e.reason}`+t)},u(r,U),u(r,b),u(r,y),u(r,B),u(r,R,null),u(r,T,null),u(r,C,void 0),u(r,P,void 0),u(r,F,void 0),u(r,A,{powerPreference:void 0,forceFallbackAdapter:!1}),u(r,d,{label:void 0,requiredFeatures:[],requiredLimits:{}}),_(r,"OnDeviceLost");let I=r;console.info("%cUWAL v0.0.2","background:#005a9c;padding:3px;color:#fff;");export{I as U};
