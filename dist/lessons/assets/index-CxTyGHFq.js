var Ee=i=>{throw TypeError(i)};var se=(i,t,r)=>t.has(i)||Ee("Cannot "+r);var e=(i,t,r)=>(se(i,t,"read from private field"),r?r.call(i):t.get(i)),s=(i,t,r)=>t.has(i)?Ee("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,r),o=(i,t,r,c)=>(se(i,t,"write to private field"),c?c.call(i,r):t.set(i,r),r),M=(i,t,r)=>(se(i,t,"access private method"),r);import{b as be,T as ze,E as _e,N as Le,U as ie,C as oe,a as Ae}from"./index-DpAAqsmP.js";import{a as g,v as Re}from"./wgpu-matrix.module-0Oa3LLlt.js";var Ie="struct Shape{color: vec4f,matrix: mat3x3f};@group(0)@binding(0)var<uniform>resolution: vec2f;fn GetClipSpace(position: vec2f)->vec2f{let clipSpace=position/resolution*2-1;return clipSpace*vec2f(1,-1);}@group(0)@binding(1)var<uniform>shape: Shape;fn GetVertexClipSpace(position: vec2f)->vec4f{let matrixPosition=shape.matrix*vec3f(position,1);let clipSpace=GetClipSpace(matrixPosition.xy);return vec4f(clipSpace,0.0,1.0);}@vertex fn vertex(@location(0)position: vec2f)->@builtin(position)vec4f {return GetVertexClipSpace(position);}",a,m,F,B,$,q,Y,Q,b,C,O,U,p,z,_,V,k,P,d,L,w,I,A,v,Ue,Ve,Pe,ae;class je{constructor(t){s(this,v);s(this,a);s(this,m);s(this,F,0);s(this,B,!1);s(this,$,g.create());s(this,q,g.create());s(this,Y,g.create());s(this,Q,g.create());s(this,b);s(this,C);s(this,O);s(this,U);s(this,p);s(this,z);s(this,_);s(this,V);s(this,k);s(this,P,new Float32Array([1,1]));s(this,d,new Float32Array([0,0]));s(this,L,new Float32Array([0,0]));s(this,w,new Float32Array([0,0]));s(this,I);s(this,A,be({min:Re.create(),max:Re.create()}));!t.segments&&ze(_e.REQUIRED_SEGMENTS),o(this,b,t.label??"Shape"),o(this,m,t.radius??0),o(this,a,t.renderer),o(this,C,t.segments);const{startAngle:r,endAngle:c,innerRadius:u}=t;M(this,v,Ue).call(this,r,c,u),M(this,v,Ve).call(this),M(this,v,Pe).call(this),this.Scale=e(this,P),this.Origin=e(this,d),this.Rotation=e(this,F),this.Position=e(this,w)}Update(){return e(this,a).SetVertexBuffers(e(this,_)),e(this,a).SetIndexBuffer(e(this,z)),e(this,a).SetBindGroups(e(this,k)),M(this,v,ae).call(this)}Render(t=!0){e(this,a).SavePipelineState(),e(this,a).Render(e(this.Update(),O),t),e(this,a).RestorePipelineState()}set Color(t){e(this,U).set(Array.isArray(t)||ArrayBuffer.isView(t)?t:t.rgba),e(this,a).WriteBuffer(e(this,V),e(this,U),e(this,I).color)}get Color(){return e(this,U)}set Position(t){e(this,w).set(t),g.translation(e(this,w),e(this,Q)),o(this,B,!0)}get Position(){return e(this,w)}set Rotation(t){g.rotation(o(this,F,t),e(this,Y)),o(this,B,!0)}get Rotation(){return e(this,F)}set Scale(t){e(this,P).set(t),g.scaling(e(this,P),e(this,q)),o(this,B,!0)}get Scale(){return e(this,P)}set Origin(t){e(this,d)[0]=t[0],e(this,d)[1]=t[1],e(this,d)[0]*=-e(this,m),e(this,d)[1]*=-e(this,m),g.translation(e(this,d),e(this,$)),e(this,d)[0]=t[0]||0,e(this,d)[1]=t[1]||0,o(this,B,!0)}get Origin(){return e(this,d)}get Center(){return e(M(this,v,ae).call(this),L)}get Vertices(){return e(this,O)}get Transform(){return e(this,p)}get BoundingBox(){return e(this,A)}}a=new WeakMap,m=new WeakMap,F=new WeakMap,B=new WeakMap,$=new WeakMap,q=new WeakMap,Y=new WeakMap,Q=new WeakMap,b=new WeakMap,C=new WeakMap,O=new WeakMap,U=new WeakMap,p=new WeakMap,z=new WeakMap,_=new WeakMap,V=new WeakMap,k=new WeakMap,P=new WeakMap,d=new WeakMap,L=new WeakMap,w=new WeakMap,I=new WeakMap,A=new WeakMap,v=new WeakSet,Ue=function(t=0,r=Le.TAU,c=0){const u=r-t,l=new Float32Array((e(this,C)+1)*2*3);for(let y=0,D=0;D<=e(this,C);++D){const K=t+D*u/e(this,C),X=Math.cos(K),W=Math.sin(K);l[y++]=X*e(this,m),l[y++]=W*e(this,m),l[y++]=X*c,l[y++]=W*c}o(this,_,e(this,a).CreateVertexBuffer(l,{label:`${e(this,b)} Vertex Buffer`})),e(this,a).WriteBuffer(e(this,_),l)},Ve=function(){const t=new Uint32Array(o(this,O,e(this,C)*6));for(let r=0,c=0;c<e(this,C);++c){const u=c*2;t[r++]=u+1,t[r++]=u+3,t[r++]=u+2,t[r++]=u+2,t[r++]=u+0,t[r++]=u+1}o(this,z,e(this,a).CreateIndexBuffer(t,{label:`${e(this,b)} Index Buffer`})),e(this,a).WriteBuffer(e(this,z),t)},Pe=function(){const{buffer:t,shape:{color:r,matrix:c}}=e(this,a).CreateUniformBuffer("shape",{label:`${e(this,b)} Uniform Buffer`});o(this,V,t),o(this,p,c),o(this,U,r),o(this,k,e(this,a).CreateBindGroup(e(this,a).CreateBindGroupEntries([{buffer:e(this,a).ResolutionBuffer},{buffer:e(this,V)}]),0,`${e(this,b)} Bind Group`)),o(this,I,be({matrix:r.length*Float32Array.BYTES_PER_ELEMENT,color:0*Float32Array.BYTES_PER_ELEMENT}))},ae=function(){if(e(this,B)){g.multiply(e(this,Q),e(this,Y),e(this,p)),g.multiply(e(this,p),e(this,q),e(this,p)),g.multiply(e(this,p),e(this,$),e(this,p)),e(this,a).WriteBuffer(e(this,V),e(this,p),e(this,I).matrix);const t=e(this,L)[0]=e(this,p)[8],r=e(this,L)[1]=e(this,p)[9];e(this,A).min[0]=t-e(this,m),e(this,A).min[1]=r-e(this,m),e(this,A).max[0]=t+e(this,m),e(this,A).max[1]=r+e(this,m),o(this,B,!1)}return this};var De="struct VertexOutput{@builtin(position)position: vec4f,@location(0)color: vec4f};@vertex fn mainVertex(@location(0)position: vec2f,@location(1)color: vec4f,@location(2)offset: vec2f,@location(3)scale: vec2f,@location(4)vertexColor: vec4f)->VertexOutput{var output: VertexOutput;let clipSpace=GetVertexClipSpace(position*scale).xy;output.position=vec4f(clipSpace+(offset+0.9)/1.8*vec2f(2,-2),0.0,1.0);output.color=color*vertexColor;return output;}@fragment fn fragment(@location(0)color: vec4f)->@location(0)vec4f {return color;}",J,H,T,j;class ne{constructor(t=30){s(this,J,0);s(this,H,0);s(this,T,0);s(this,j,[]);o(this,J,t)}addSample(t){const r=e(this,j)[e(this,T)]||0;o(this,H,e(this,H)+(t-r)),e(this,j)[e(this,T)]=t,o(this,T,(e(this,T)+1)%e(this,J))}get(){return e(this,H)/e(this,j).length}}J=new WeakMap,H=new WeakMap,T=new WeakMap,j=new WeakMap;/**
 * @module Timing Performance
 * @author Ustym Ukhman <ustym.ukhman@gmail.com>
 * @description This lesson is reproduced from WebGPU Timing Performance
 * {@link https://webgpufundamentals.org/webgpu/lessons/webgpu-timing.html}&nbsp;
 * and developed by using a version listed below. Please note that this code
 * may be simplified in future thanks to more recent library APIs.
 * @version 0.0.9
 * @license MIT
 */(async function(i){let t,r;try{r=!!(await ie.SetRequiredFeatures("timestamp-query")).length,t=new(await ie.RenderPipeline(i,"Timing Performance"))}catch(n){alert(n)}const{querySet:c,resolveBuffer:u,resultBuffer:l}=await async function(){if(!r)return{};const n=await ie.CreateQuerySet("timestamp",2),f=t.CreateBuffer({usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC,size:n.count*8}),h=t.CreateBuffer({usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST,size:f.size});return{querySet:n,resolveBuffer:f,resultBuffer:h}}(),y=24,D=0,K=0,X=2;let W=0,fe=0;const R=1e4,ce=[],we=new GUI,te={objects:100};we.add(te,"objects",0,R,1);const S=document.createElement("pre"),ue=document.createElement("span"),le=document.createElement("span"),he=document.createElement("span");S.style.backgroundColor="rgb(0 0 0 / 0.8)",S.style.position="absolute",S.style.padding="0.5em",S.style.display="grid",S.style.color="white",S.style.margin="0px",S.style.left="0px",S.style.top="0px",S.append(ue,le,he),document.body.appendChild(S);const pe=new ne,me=new ne,de=new ne,xe=t.CreateShaderModule([Ie,De]),ge=t.CreateColorAttachment();ge.clearValue=new oe(5000268).rgba,t.CreatePassDescriptor(ge,void 0,void 0,void 0,t.CreateTimestampWrites(c,0,1));const Te=t.CreateVertexBufferLayout("position",void 0,"mainVertex"),{buffer:Z,layout:Ge}=t.CreateVertexBuffer([{name:"color",format:"unorm8x4"}],R,"instance","mainVertex"),{buffer:ee,layout:Me}=t.CreateVertexBuffer(["offset","scale"],R,"instance","mainVertex"),{buffer:ve,layout:Fe}=t.CreateVertexBuffer({name:"vertexColor",format:"unorm8x4"},R,void 0,"mainVertex");t.CreatePipeline({fragment:t.CreateFragmentState(xe),vertex:t.CreateVertexState(xe,"mainVertex",[Te,Ge,Me,Fe])});const Oe=new je({renderer:t,innerRadius:120,radius:240,segments:y}).Update().Vertices,re=new Float32Array(ee.size/Float32Array.BYTES_PER_ELEMENT);t.AddVertexBuffers([Z,ee,ve]);{const n=Z.size/R,f=new Uint8Array(Z.size);for(let h=0;h<R;++h)f.set([E(255),E(255),E(255),255],n*h+D),ce.push({scale:E(.2,.5),offset:[E(-.9,.9),E(-.9,.9)],velocity:[E(-.1,.1),E(-.1,.1)]});t.WriteBuffer(Z,f)}{const n=new oe(1644825),f=new oe(16777215),h=new Uint8Array((y+1)*8);for(let G=0,x=0;G<=y;G++,x+=8)h.set(n.RGBA,x),h.set(f.RGBA,x+4);t.WriteBuffer(ve,h)}function E(n,f){return n===void 0?(n=0,f=1):f===void 0&&(f=n,n=0),Math.random()*(f-n)+n}function Se(n){n*=.001;const f=n-fe,h=performance.now(),G=ee.size/R/4;for(let x=0;x<te.objects;x++){const{scale:Be,offset:N,velocity:Ce}=ce[x];N[0]=Ae.EuclideanModulo(N[0]+Ce[0]*f+1.5,3)-1.5,N[1]=Ae.EuclideanModulo(N[1]+Ce[1]*f+1.5,3)-1.5;const ye=x*G;re.set(N,ye+K),re.set([Be,Be],ye+X)}t.WriteBuffer(ee,re),t.Render([Oe,te.objects],!1),t.DestroyCurrentPass(),r&&(t.ResolveQuerySet(c,u),l.mapState==="unmapped"&&t.CopyBufferToBuffer(u,l)),t.SubmitCommandBuffer(),t.SetCommandEncoder(void 0),r&&l.mapState==="unmapped"&&l.mapAsync(GPUMapMode.READ).then(()=>{const x=new BigInt64Array(l.getMappedRange());W=Number(x[1]-x[0]),me.addSample(W/1e3),l.unmap()}),pe.addSample(1/f),de.addSample(performance.now()-h),ue.textContent=`FPS: ${pe.get().toFixed(1)}`,he.textContent=`JS: ${de.get().toFixed(1)}ms`,le.textContent=`GPU: ${`${r&&me.get().toFixed(1)}Âµs`||"N/A"}`,requestAnimationFrame(Se),fe=n}new ResizeObserver(n=>{for(const f of n){const{inlineSize:h,blockSize:G}=f.contentBoxSize[0];t.SetCanvasSize(h,G)}requestAnimationFrame(Se)}).observe(i)})(document.getElementById("lesson"));
