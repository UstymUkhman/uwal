var j=Object.defineProperty;var k=(s,e,t)=>e in s?j(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var V=(s,e,t)=>(k(s,typeof e!="symbol"?e+"":e,t),t),w=(s,e,t)=>{if(!e.has(s))throw TypeError("Cannot "+t)};var i=(s,e,t)=>(w(s,e,"read from private field"),t?t.call(s):e.get(s)),u=(s,e,t)=>{if(e.has(s))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(s):e.set(s,t)},C=(s,e,t,a)=>(w(s,e,"write to private field"),a?a.call(s,t):e.set(s,t),t);var p=(s,e,t)=>(w(s,e,"access private method"),t);function b(s){const e={};for(let t in s)e[t]={value:s[t]};return Object.freeze(Object.create(null,e))}const q=b({DEVICE_LOST:"Device::Lost"}),O=b({WEBGPU_NOT_SUPPORTED:"WEBGPU_NOT_SUPPORTED",ADAPTER_NOT_FOUND:"ADAPTER_NOT_FOUND",DEVICE_NOT_FOUND:"DEVICE_NOT_FOUND",DEVICE_NOT_REQUESTED:"DEVICE_NOT_REQUESTED",DEVICE_LOST:"DEVICE_LOST",CANVAS_NOT_FOUND:"CANVAS_NOT_FOUND",CONTEXT_NOT_FOUND:"CONTEXT_NOT_FOUND",COMMAND_ENCODER_NOT_FOUND:"COMMAND_ENCODER_NOT_FOUND"}),L=b({WEBGPU_NOT_SUPPORTED:"WebGPU is not supported in this browser.",ADAPTER_NOT_FOUND:"Failed to get a GPUAdapter.",DEVICE_NOT_FOUND:"Failed to get a GPUDevice.",DEVICE_NOT_REQUESTED:"GPUDevice was not requested.",DEVICE_LOST:"WebGPU device was lost.",CANVAS_NOT_FOUND:"Failed to get a WebGPU canvas.",CONTEXT_NOT_FOUND:"Failed to get a WebGPU context.",COMMAND_ENCODER_NOT_FOUND:"Failed to get a GPUCommandEncoder."}),W=b({WEBGPU_NOT_SUPPORTED:0,ADAPTER_NOT_FOUND:1,DEVICE_NOT_FOUND:2,DEVICE_NOT_REQUESTED:3,DEVICE_LOST:4,CANVAS_NOT_FOUND:5,CONTEXT_NOT_FOUND:6,COMMAND_ENCODER_NOT_FOUND:7});function z(s,e){console.warn(L[s]+(e??""))}function N(s,e){throw new Error(L[s]+(e??""),{cause:W[s]})}var m,h,g;class x{constructor(e,t){u(this,m,void 0);u(this,h,void 0);V(this,"Device");V(this,"BindGroups",[]);u(this,g,void 0);!e&&N(O.DEVICE_NOT_REQUESTED),this.Device=e,C(this,m,t),C(this,h,this.CreateProgramLabel("Command Encoder"))}CreateProgramLabel(e){return i(this,m)&&e&&`${i(this,m)} ${e}`||""}CreateBuffer(e){const t=e.label??this.CreateProgramLabel("Buffer");return this.Device.createBuffer({...e,label:t})}WriteBuffer(e,t,a=0,n,c){this.Device.queue.writeBuffer(e,a,t,n,c)}CopyBufferToBuffer(e,t,a,n=0,c=0){this.CommandEncoder.copyBufferToBuffer(e,n,t,c,a)}CreateShaderModule(e,t,a,n){t??(t=this.CreateProgramLabel("Shader Module"));const c=Array.isArray(e)&&e.join(`

`)||e;return this.Device.createShaderModule({label:t,code:c,sourceMap:a,compilationHints:n})}CreateBindGroupEntries(e){return Array.isArray(e)&&e.map((t,a)=>({binding:a,resource:t}))||[{binding:0,resource:e}]}CreateBindGroup(e){const t=e.label??this.CreateProgramLabel("Bind Group");return this.Device.createBindGroup({...e,label:t})}AddBindGroups(e){this.BindGroups=Array.isArray(e)&&e||[e]}CreateCommandEncoder(){return C(this,g,this.Device.createCommandEncoder({label:i(this,h)}))}SubmitCommandBuffer(){this.Device.queue.submit([this.CommandEncoder.finish()])}set CommandEncoderLabel(e){C(this,h,e)}get CommandEncoder(){if(!i(this,g)){const e=` ${i(this,h)&&`Label: "${i(this,h)}". `}`;return z(O.COMMAND_ENCODER_NOT_FOUND,e+"Creating a new one."),this.CreateCommandEncoder()}return i(this,g)}get ProgramName(){return i(this,m)}}m=new WeakMap,h=new WeakMap,g=new WeakMap;var A,f,D;class H extends x{constructor(t,a,n){super(t,a);u(this,A,[]);u(this,f,void 0);u(this,D,void 0);C(this,f,n)}CreateColorAttachment(t,a="load",n="store",c,o,l){return{view:t,loadOp:a,storeOp:n,clearValue:c,resolveTarget:o,depthSlice:l}}CreateRenderPassDescriptor(t,a,n,c,o,l){const G=Array.isArray(t)&&t||[t];return a??(a=this.CreateProgramLabel("Render Pass")),{colorAttachments:G,depthStencilAttachment:n,occlusionQuerySet:c,timestampWrites:o,maxDrawCount:l,label:a}}CreateVertexBufferAttribute(t,a=0,n=0){return{format:t,shaderLocation:a,offset:n}}CreateVertexState(t,a="vertex",n,c){return n=Array.isArray(n)?n:[n],{module:t,entryPoint:a,buffers:n,constants:c}}CreateFragmentColorTarget(t=i(this,f),a,n){return{format:t,blend:a,writeMask:n}}CreateFragmentState(t,a="fragment",n,c){return n??(n=[this.CreateFragmentColorTarget()]),n=Array.isArray(n)?n:[n],{module:t,entryPoint:a,targets:n,constants:c}}CreateRenderPipeline(t){const a=t.layout??"auto",n=t.label??this.CreateProgramLabel("Render Pipeline");return this.Device.createRenderPipeline({...t,label:n,layout:a})}SetVertexBuffers(t){C(this,A,Array.isArray(t)&&t||[t])}Render(t,a,n,c=!0){if(!i(this,D)){const o=this.CreateCommandEncoder();C(this,D,o.beginRenderPass(t)),i(this,D).setPipeline(a)}for(let o=0,l=i(this,A).length;o<l;++o)i(this,D).setVertexBuffer(o,i(this,A)[o]);for(let o=0,l=this.BindGroups.length;o<l;++o)i(this,D).setBindGroup(o,this.BindGroups[o]);i(this,D).draw(...Array.isArray(n)&&n||[n]),c&&(i(this,D).end(),C(this,D,void 0),this.SubmitCommandBuffer())}get CurrentPass(){return i(this,D)}}A=new WeakMap,f=new WeakMap,D=new WeakMap;var R;class J extends x{constructor(t,a){super(t,a);u(this,R,[1])}CreateComputePassDescriptor(t,a,n,c){return t??(t=this.CreateProgramLabel("Compute Pass")),{label:t,timestampWrites:a?{querySet:a,beginningOfPassWriteIndex:n,endOfPassWriteIndex:c}:void 0}}CreateComputePipeline(t){const a=t.layout??"auto",n=t.label??this.CreateProgramLabel("Compute Pipeline");return this.Device.createComputePipeline({label:n,layout:a,compute:t})}Compute(t,a){const n=this.CommandEncoder.beginComputePass(a);n.setPipeline(t);for(let c=0,o=this.BindGroups.length;c<o;++c)n.setBindGroup(c,this.BindGroups[c]);n.dispatchWorkgroups(...i(this,R)),n.end()}set Workgroups(t){C(this,R,Array.isArray(t)&&t||[t])}}R=new WeakMap;/**
 * @module UWAL
 * @author Ustym Ukhman <ustym.ukhman@gmail.com>
 * @description Unopinionated WebGPU Abstraction Library
 * @version 0.0.2
 * @license MIT
 */var U,T,E,P,v,F,d,y,I,B,$,_,Q,S,X;const r=class r{static SetAdapterOptions(e,t=!1){i(r,F).powerPreference=e,i(r,F).forceFallbackAdapter=t}static SetDeviceDescriptor(e,t=[],a={}){i(r,d).label=e,i(r,d).requiredFeatures=t,i(r,d).requiredLimits=a}static SetCanvasSize(e=innerWidth,t=innerHeight){!i(r,E)&&N(O.CANVAS_NOT_FOUND),!i(r,T)&&N(O.DEVICE_NOT_FOUND);const{maxTextureDimension2D:a}=i(r,T).limits;e=Math.max(1,Math.min(e,a)),t=Math.max(1,Math.min(t,a)),(i(r,E).width!==e||i(r,E).height!==t)&&(i(r,E).height=t,i(r,E).width=e)}static RenderPipeline(e,t="",a={}){return i(r,d).label=p(this,y,I).call(this,t),(async()=>{const n=await r.Device,c=e.getContext("webgpu");!c&&N(O.CONTEXT_NOT_FOUND);const o=a.format??i(r,v),l={...a,format:o};return c.configure({device:n,...l}),C(r,E,e),C(r,P,c),new Proxy(H,{construct(G){return new G(n,t,o)}})})()}static ComputePipeline(e=""){return i(r,d).label=p(this,y,I).call(this,e),(async()=>{const t=await r.Device;return new Proxy(J,{construct(a){return new a(t,e)}})})()}static Destroy(e,t,a){var n,c;e=Array.isArray(e)&&e||[e],e.forEach(o=>o==null?void 0:o.destroy()),t=Array.isArray(t)&&t||[t],t.forEach(o=>o==null?void 0:o.destroy()),a=Array.isArray(a)&&a||[a],a.forEach(o=>o==null?void 0:o.destroy()),(n=i(r,P))==null||n.unconfigure(),(c=i(r,T))==null||c.destroy()}static get Adapter(){return(async()=>{var e;return i(r,U)??await p(e=r,B,$).call(e)()})()}static get Device(){return(async()=>{var e;return i(r,T)??await p(e=r,_,Q).call(e)()})()}static get Canvas(){return i(r,E)}static get Context(){return i(r,P)}static get AspectRatio(){return!i(r,E)&&N(O.CANVAS_NOT_FOUND),i(r,E).width/i(r,E).height}static get CurrentTexture(){return i(r,P).getCurrentTexture()}static get CurrentTextureView(){return r.CurrentTexture.createView()}static get PreferredCanvasFormat(){return i(r,v)}static get VERSION(){return"0.0.2"}};U=new WeakMap,T=new WeakMap,E=new WeakMap,P=new WeakMap,v=new WeakMap,F=new WeakMap,d=new WeakMap,y=new WeakSet,I=function(e){return i(r,d).label??(e&&`${e} Device`||"")},B=new WeakSet,$=function(){return!navigator.gpu&&N(O.WEBGPU_NOT_SUPPORTED),C(r,v,navigator.gpu.getPreferredCanvasFormat()),async()=>{const e=await navigator.gpu.requestAdapter(i(r,F));return!e&&N(O.ADAPTER_NOT_FOUND),C(r,U,e)}},_=new WeakSet,Q=function(){return async()=>{const{requiredFeatures:e,requiredLimits:t,label:a}=i(r,d),n=await(await r.Adapter).requestDevice({requiredFeatures:e,requiredLimits:t,defaultQueue:{label:a}});return!n&&N(O.DEVICE_NOT_FOUND),n.lost.then(p(r,S,X)),C(r,T,n)}},S=new WeakSet,X=function(e){if(r.OnDeviceLost)return r.OnDeviceLost(e);i(r,E).dispatchEvent(new CustomEvent(q.DEVICE_LOST,{detail:e}));const t=(e.message&&` | Message: ${e.message}`)??".";N(O.DEVICE_LOST,` Reason: ${e.reason}`+t)},u(r,y),u(r,B),u(r,_),u(r,S),u(r,U,null),u(r,T,null),u(r,E,void 0),u(r,P,void 0),u(r,v,void 0),u(r,F,{powerPreference:void 0,forceFallbackAdapter:!1}),u(r,d,{label:void 0,requiredFeatures:[],requiredLimits:{}}),V(r,"OnDeviceLost");let M=r;console.info("%cUWAL v0.0.2","background:#005a9c;padding:3px;color:#fff;");export{M as U};
