import{_ as e,a as t,b as n,c as r,d as i,f as a,g as o,h as s,i as c,l,m as u,n as d,p as f,y as p}from"./lib-DY3i1ENJ.js";import{n as m,t as h}from"./F-BudG6IPd.js";var g=class extends m{#e=s.create();#t=s.create();#n=s.set(0,1,0);#r=u.create();#i=a.create();#a=1;constructor(e,t=`SpotLight`){super(t),this.Position=e||this.#t}LookAt(e){return a.aim(this.#t,e,this.#n,this.#i),s.copy(this.#i.slice(8,11),this.#e)}set Position(e){s.copy(e,this.#t)}get Position(){return this.#t}set Intensity(e){this.#a=Math.max(e,f.EPSILON)}get Intensity(){return this.#a}set Limit(e){this.#r.set(e.toSorted().map(Math.cos))}get Limit(){return this.#r}},_=`struct VertexOutput{@location(0)normal: vec3f,@location(1)lightDirection: vec3f,@location(2)cameraDirection: vec3f,@builtin(position)position: vec4f};@group(0)@binding(2)var<uniform>Light: LightUniforms;@group(0)@binding(3)var<uniform>Camera: CameraUniforms;@vertex fn meshVertex(@location(0)position: vec4f,@location(1)normal: vec3f)->VertexOutput {var output: VertexOutput;output.position=GetVertexClipSpace(position);let worldPosition=GetVertexWorldPosition(position);output.lightDirection=GetLightDirection(worldPosition,Light.position);output.cameraDirection=GetCameraDirection(worldPosition,Camera.position);output.normal=GetVertexNormal(MeshUniforms.worldNormal,normal);return output;}@fragment fn meshFragment(vertex: VertexOutput)->@location(0)vec4f {let spotLightColor=GetSpotLightColor(SpotLight(vertex.normal,Light.intensity,vertex.lightDirection,vertex.cameraDirection,Light.direction,Light.limit),color.rgb);return vec4f(spotLightColor,color.a);}`;(async function(a){let s;try{s=new(await(o.Renderer(a,`Spot Lighting`)))}catch(e){alert(e)}let u=new t,f=new GUI;f.onChange(L),s.CreatePassDescriptor(s.CreateColorAttachment(),s.CreateDepthStencilAttachment());let m=new d,v=new r,y=new s.Pipeline,b=[void 0,`meshVertex`],x={innerLimit:i.DegreesToRadians(15),outerLimit:i.DegreesToRadians(25),rotation:i.DegreesToRadians(0),aimOffsetX:-10,aimOffsetY:10,shininess:30},S=y.CreateShaderModule([p,n,e,_]),{Camera:C,buffer:w}=y.CreateUniformBuffer(`Camera`),{Light:T,buffer:E}=y.CreateUniformBuffer(`Light`),D=new c(v,new l(3407667)),O={min:-360,max:360,step:1,converters:GUI.converters.radToDeg},k={min:0,max:90,minRange:1,step:1,converters:GUI.converters.radToDeg},A=[y.CreateVertexBufferLayout({name:`position`,format:`float32x3`},...b),y.CreateVertexBufferLayout({name:`normal`,format:`float32x3`},...b)];D.SetRenderPipeline(await s.AddPipeline(y,{fragment:y.CreateFragmentState(S,void 0,void 0,`meshFragment`),vertex:y.CreateVertexState(S,A,...b),depthStencil:y.CreateDepthStencilState(),primitive:y.CreatePrimitiveState()}),[E,w]);let{vertexData:j,normalData:M,vertices:N}=h(),P=y.CreateVertexBuffer(M);f.add(x,`rotation`,O),f.add(x,`shininess`,{min:1,max:250}),GUI.makeMinMaxPair(f,x,`innerLimit`,`outerLimit`,k),f.add(x,`aimOffsetX`,-50,50),f.add(x,`aimOffsetY`,-50,50),v.CreateVertexBuffer(y,j),y.WriteBuffer(P,M),y.AddVertexBuffers(P),v.SetDrawParams(N);let F=new g([-10,30,100]);T.position.set(F.Position);let I=[0,35,0];u.Add(D);function L(){C.position.set(m.Position),T.intensity[0]=F.Intensity=x.shininess;let{aimOffsetX:e,aimOffsetY:t}=x,{innerLimit:n,outerLimit:r}=x;F.Limit=[n,r],T.limit.set(F.Limit),T.direction.set(F.LookAt([I[0]+e,I[1]+t,I[2]])),y.WriteBuffer(E,T.position.buffer),y.WriteBuffer(w,C.position),D.Rotation=[0,x.rotation,0],s.Render(u)}new ResizeObserver(e=>{for(let t of e){let{inlineSize:e,blockSize:n}=t.contentBoxSize[0];s.SetCanvasSize(e,n),m.AspectRatio=s.AspectRatio,m.UpdateViewProjectionMatrix(),m.Position=[100,150,200],m.LookAt(I),u.AddCamera(m)}L()}).observe(document.body)})(document.getElementById(`lesson`));