import{C as K,a as J,b as de,N as Q,f as y,T as le,E as me,G as pe,S as xe,g as Ce,M as I,D as Be,d as be,h as we}from"./index-DFT86U3m.js";import{addButtonLeftJustified as ge}from"https://webgpufundamentals.org/webgpu/resources/js/gui-helpers.js";let G=class{#s;#t;#r;Transparent=!1;#i=crypto.randomUUID();#n;#o;#e=new K(0,0);constructor(e=16777215,t="Mesh"){this.Color=e,this.#s=t}CreateColorBuffer(e,t=this.#s){const{color:n,buffer:i}=e.CreateUniformBuffer("color",{label:`${t} Color Buffer`});this.#t=n,this.#r=e,this.#o=i,this.#t.set(this.#n),e.WriteBuffer(i,n)}SetBlendConstant(e){if(!e?.BlendConstant||!this.#e.Equals(e.BlendConstant))return this.#r.BlendConstant=this.#e}set BlendConstant(e){typeof e=="number"&&this.#e.Set(e)||(this.#e.rgba=J(e))}get BlendConstant(){return this.#e}get ColorBuffer(){return this.#o}set Color(e){this.#n=typeof e=="number"&&de(e)||J(e),this.#t?.fill(1).set(this.#n),this.#r?.WriteBuffer(this.#o,this.#t)}get Color(){return this.#n}get ID(){return this.#i}Destroy(){this.#r=void 0,this.#o?.destroy(),this.#o=void 0}},ye=class extends Q{#s;Visible=!0;#t;#r;#i;#n=[];constructor(e,t,n="Mesh",i=null){super(n,i),this.#s=e,this.#r=t===void 0&&new G||t}SetRenderPipeline(e,t){this.#t=e,this.#s.CreateBuffers(e),this.#r?.CreateColorBuffer(e),this.#o(t)}#o(e,t){const{projection:n,buffer:i}=this.#t.CreateUniformBuffer("meshModelViewProjection",{label:`${this.Label} Projection Buffer`,...t});this.ProjectionMatrix=y.identity(n),this.#i=i,e=pe(e),this.#n=this.#t.SetBindGroupFromResources([i,this.#r?.ColorBuffer,...e].filter(Boolean),0,0,`${this.Label} Bind Group`)}UpdateProjectionMatrix(e){const t=super.UpdateProjectionMatrix(e);this.#t.WriteBuffer(this.#i,t)}SetBindGroups(){!this.#t&&le(me.PIPELINE_NOT_FOUND,"RenderPipeline.\n            Call `Mesh.SetRenderPipeline` method before setting its data."),this.#t.BindGroups=this.#n}get ProjectionBuffer(){return this.#i}get Geometry(){return this.#s}get Material(){return this.#r}get Pipeline(){return this.#t}Destroy(){this.#s.Destroy(),this.#r?.Destroy(),this.#t=void 0,this.#n.splice(0),this.#i.destroy(),this.#i=void 0}};class Ve{Label;DrawParams=[];IndexFormat;#s=crypto.randomUUID();VertexBuffers;IndexBuffer;constructor(e="Mesh",t){this.IndexFormat=t,this.Label=e}SetDrawParams(e,t,n,i,m){return xe(this.DrawParams,...arguments)}CreateVertexBuffer(e,t,n=this.Label){const i=e.CreateVertexBuffer(t,{label:`${n} Vertex Buffer`});this.VertexBuffers=e.SetVertexBuffers(i),e.WriteBuffer(i,t)}CreateIndexBuffer(e,t,n=this.Label){const i=e.CreateIndexBuffer(t,{label:`${n} Index Buffer`});e.SetDrawParams.apply(e,this.SetDrawParams(t.length)),this.IndexBuffer=e.SetIndexBuffer(i,this.IndexFormat),e.WriteBuffer(i,t)}get Vertices(){return this.DrawParams[0]}get ID(){return this.#s}Destroy(){this.IndexBuffer?.buffer.destroy(),this.IndexBuffer=void 0,this.VertexBuffers&&(this.VertexBuffers[0]?.buffer.destroy(),this.VertexBuffers.splice(0),this.VertexBuffers=void 0)}}class ve extends Ve{#s;#t;constructor(e="Cube"){super(e,"uint16")}GetPositionBufferLayout(e,t={name:"position",format:"float32x3"},n="vertex",i="vertex"){return e.CreateVertexBufferLayout(t,n,i)}CreateTextureCoordsBuffer(e,t,n="vertex",i="vertex"){!Array.isArray(t)&&t?.name,t??="textureCoords";const m=new Float32Array([.5,.5,.75,.5,.5,1,.75,1,.25,.5,.5,.5,.25,1,.5,1,0,0,0,.5,.25,0,.25,.5,.5,0,.5,.5,.75,0,.75,.5,0,.5,.25,.5,0,1,.25,1,.25,0,.5,0,.25,.5,.5,.5]);return this.AddVertexBuffer(e,m,t,n,i)}AddVertexBuffer(e,t,n,i="vertex",m="vertex"){const{buffer:b,layout:v}=e.CreateVertexBuffer(n,this.Vertices,i,m);return this.VertexBuffers=e.AddVertexBuffers(b),e.WriteBuffer(b,t),{buffer:b,layout:v}}#r(e,t=this.Label){super.CreateVertexBuffer(e,this.#t??new Float32Array([-.5,.5,.5,.5,.5,.5,-.5,.5,-.5,.5,.5,-.5,.5,-.5,.5,-.5,-.5,.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,.5,-.5,-.5,.5,.5,.5,.5,.5,-.5,.5,.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,-.5,-.5,.5,-.5,.5]),t)}#i(e,t=this.Label){super.CreateIndexBuffer(e,this.#s??new Uint16Array([0,1,2,2,1,3,4,5,6,6,5,7,8,9,10,10,9,11,12,13,14,14,13,15,16,17,18,18,17,19,20,21,22,22,21,23]),t)}CreateBuffers(e,t=this.Label){this.#r(e,t),this.#i(e,t)}set VertexData(e){this.#t=e}set IndexData(e){this.#s=e}get Vertices(){return(this.#t&&this.#t.length/3)??this.#s?.length??super.Vertices??24}Destroy(){super.Destroy(),this.#s=void 0,this.#t=void 0}}class Pe extends Q{#s=Ce.set(0,1,0);#t=60;#r=1;#i=1e3;#n=innerWidth/innerHeight;#o=y.identity();#e=new Float32Array(24);#a=y.identity();constructor(e=60,t=1,n=1e3,i=innerWidth/innerHeight){super("PerspectiveCamera"),this.#t=e,this.#r=t,this.#i=n,this.#n=typeof i!="number"?i.AspectRatio:i,this.UpdateProjectionMatrix()}#h(e=!1){const[t,n,i,m,b,v,P,w,S,j,c,R,p,x,C,d]=this.#a;if(this.#e[0]=p+S,this.#e[1]=x+j,this.#e[2]=C+c,this.#e[3]=d+R,this.#e[4]=p-S,this.#e[5]=x-j,this.#e[6]=C-c,this.#e[7]=d-R,this.#e[8]=p-b,this.#e[9]=x-v,this.#e[10]=C-P,this.#e[11]=d-w,this.#e[12]=p-t,this.#e[13]=x-n,this.#e[14]=C-i,this.#e[15]=d-m,this.#e[16]=p+b,this.#e[17]=x+v,this.#e[18]=C+P,this.#e[19]=d+w,this.#e[20]=p+t,this.#e[21]=x+n,this.#e[22]=C+i,this.#e[23]=d+m,!e)return this.#e;for(let M=0;M<6;++M){const B=M*4,g=Math.hypot(this.#e[B+0],this.#e[B+1],this.#e[B+2])||1;this.#e[B+0]/=g,this.#e[B+1]/=g,this.#e[B+2]/=g,this.#e[B+3]/=g}return this.#e}UpdateViewProjectionMatrix(){return y.inverse(this.LocalMatrix,this.#o),y.multiply(this.ProjectionMatrix,this.#o,this.#a),this.#h(),this.#a}UpdateProjectionMatrix(){const e=I.DegreesToRadians(this.#t);return y.perspective(e,this.#n,this.#r,this.#i,this.ProjectionMatrix)}LookAt(e,t=this.#s){return y.lookAt(this.Position,e,t,this.#o),y.multiply(this.ProjectionMatrix,this.#o,this.#a)}get ViewProjectionMatrix(){return this.#a}get Frustum(){return this.#e}set FieldOfView(e){this.#t=e,this.UpdateProjectionMatrix()}get FieldOfView(){return this.#t}set AspectRatio(e){this.#n=typeof e!="number"?e.AspectRatio:e,this.UpdateProjectionMatrix()}get AspectRatio(){return this.#n}set Near(e){this.#r=e,this.UpdateProjectionMatrix()}get Near(){return this.#r}set Far(e){this.#i=e,this.UpdateProjectionMatrix()}get Far(){return this.#i}}var Se="struct VertexInput{@location(0)position: vec4f,@location(1)color: vec4f};struct VertexOutput{@location(0)color: vec4f,@builtin(position)position: vec4f};@vertex fn cubeVertex(input: VertexInput)->VertexOutput {return VertexOutput(input.color,GetVertexClipSpace(input.position));}@fragment fn cubeFragment(vertex: VertexOutput)->@location(0)vec4f {return vertex.color*color;}";/**
 * @module Scene Graphs
 * @author Ustym Ukhman <ustym.ukhman@gmail.com>
 * @description This lesson is reproduced from WebGPU Scene Graphs
 * {@link https://webgpufundamentals.org/webgpu/lessons/webgpu-scene-graphs.html}&nbsp;
 * and developed by using a version listed below. Please note that this code
 * may be simplified in future thanks to more recent library APIs.
 * @version 0.2.0
 * @license MIT
 */(async function(V){let e;V.style.backgroundColor="#000";try{e=new(await Be.Renderer(V,"Scene Graphs"))}catch(s){alert(s)}const t={min:-90,max:90,step:1,converters:GUI.converters.radToDeg},n={min:-180,max:180,step:1,converters:GUI.converters.radToDeg},i=new K,m=new G,b=new G(i.Set(8355711)),v=new G(i.Set(12566463,191)),[P,w,S]=[0,1,2],j=new Set([0,1,2]),c=[40,30,50],R=[10,2,2],p=4,x=[];let C=!1,d,M;const B=5;let g,O=0;const o={cameraRotation:I.DegreesToRadians(-45),animate:!1,showMeshNodes:!1,showAllTransforms:!1,position:I.Vec3.create(),rotation:I.Vec3.create(),scale:I.Vec3.set(1,1,1)},U=new be,D=new GUI().onChange($);D.add(o,"cameraRotation",n).onChange(q),D.add(o,"animate").onChange(s=>u.enable(!s)),D.add(o,"showMeshNodes").onChange(Z),D.add(o,"showAllTransforms").onChange(Y);const u=D.addFolder("Orientation");u.onChange(()=>g.Transform=[o.position,o.rotation,o.scale]);const ee=[u.add(o.position,"0",-200,200,1).name("Position X"),u.add(o.position,"1",-200,200,1).name("Position Y"),u.add(o.position,"2",-200,200,1).name("Position Z"),u.add(o.rotation,"0",t).name("Rotation X"),u.add(o.rotation,"1",t).name("Rotation Y"),u.add(o.rotation,"2",t).name("Rotation Z"),u.add(o.scale,"0",.1,100).name("Scale X"),u.add(o.scale,"1",.1,100).name("Scale Y"),u.add(o.scale,"2",.1,100).name("Scale Z")],te=[0,c[w]/3*2-c[w]/2,R[S]/2+c[S]/2],E=c[P]+10,W=c[w]+3,L=[c[P]+6,W*p+6,c[S]+4],A=new Pe,T=new ve,l=new e.Pipeline,re=(L[P]+E)/2*(B-1)/2+4,z=l.CreateShaderModule([we,Se]),{layout:se,buffer:ie}=oe();await e.AddPipeline(l,{primitive:l.CreatePrimitiveState(),depthStencil:l.CreateDepthStencilState(),fragment:l.CreateFragmentState(z,void 0,void 0,"cubeFragment"),vertex:l.CreateVertexState(z,[T.GetPositionBufferLayout(l),se],void 0,"cubeVertex")}),Array.from({length:5}).forEach((s,r)=>he(U,r));const ne=k(D.addFolder("Nodes"),U);e.CreatePassDescriptor(e.CreateColorAttachment(),e.CreateDepthStencilAttachment()),_(U.Children[0]),Y(!1),Z(!1);function k(s,r,a,h){const f=[],H=h===void 0;if(r.Label!=="Scene"){const N=`${H?"":`${h} +-`}${r.Label}`;f.push(ge(s,N,()=>_(r)))}return h=H?"":`${h}${a?"   ":" | "}`,f.push(...r.Children.map((N,ue)=>k(s,N,ue===r.Children.length-1,h))),f.flat()}function q(s){A.Transform=[[re,20,0],[0,s,0]],A.Position=[0,0,300],A.UpdateViewProjectionMatrix()}function X(){const{Position:s,Rotation:r,Scaling:a}=g;o.position.set(s),o.rotation.set(r),o.scale.set(a),u.updateDisplay()}function oe(){const r=new Uint8Array(96),a=[200,200,70,90,130,110,70,200,210,160,160,220,200,70,120,80,70,200];for(let h=0,f=0;h<24;f=(++h/4|0)*3)r.set(a.slice(f,f+3),h*4),r[h*4+3]=255;return T.AddVertexBuffer(l,r,{name:"color",format:"unorm8x4"},void 0,"cubeVertex")}function _(s){g=s,u.name(`Orientation: ${s.Label}`),X()}function Y(s){ee.forEach((r,a)=>r.show(s||j.has(a)))}function Z(s){for(const r of ne)r.domElement.textContent.includes("mesh")&&r.show(s)}function F(s,r,a,h){const f=new ye(T,h??m,s,r);return f.SetRenderPipeline(l),l.AddVertexBuffers(ie),f.Transform=a,f}function ae(s,r){const a=`drawer${r}`,h=L[w]/2-c[w]/2-5,f=F(a,s,[[0,W*r-h,3]]);x.push(f),F(`${a}-drawer-mesh`,f,[void 0,void 0,c]),F(`${a}-handle-mesh`,f,[te,void 0,R],b)}function he(s,r){const a=`cabinet${r}`,h=F(a,s,[[r*E,0,0]]);F(`${a}-mesh`,h,[void 0,void 0,L],v);for(let f=0;f<p;++f)ae(h,f)}function $(){d||(d=requestAnimationFrame(ce))}function fe(){x.forEach((s,r)=>s.Position[2]=I.Lerp(3,c[2]*.8,Math.sin(O+r)*.5+.5))}function ce(){d=void 0,e.Render(U);const s=o.animate,r=performance.now()*.001,a=C&&r-M||0;M=r,C=s,s&&(O+=a),o.animate&&(fe(),X(),$())}new ResizeObserver(s=>{for(const r of s){const{inlineSize:a,blockSize:h}=r.contentBoxSize[0];e.SetCanvasSize(a,h),A.AspectRatio=e.AspectRatio,q(o.cameraRotation),U.AddCamera(A)}$()}).observe(document.body)})(document.getElementById("lesson"));
