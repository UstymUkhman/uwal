import{a as e,d as t,f as n,o as r,r as i,t as a}from"./lib-dOc1RxJQ.js";import{t as o}from"./F-MrgAg4yl.js";var s=`struct Uniforms{color: vec4f,light: vec3f,camera: vec3f,world: mat4x4f,normal: mat3x3f,direction: vec3f,intensity: f32,limit: vec2f};struct VertexOutput{@location(0)normal: vec3f,@location(1)lightVector: vec3f,@location(2)cameraVector: vec3f,@builtin(position)position: vec4f};@group(0)@binding(1)var<uniform>uniforms: Uniforms;@group(0)@binding(0)var<uniform>shapeModelViewProjection: mat3x3f;fn GetVertexClipSpace(position: vec2f)->vec4f{return vec4f((shapeModelViewProjection*vec3f(position,1)).xy,0,1);}@vertex fn vertex(@location(0)position: vec2f)->VertexOutput {var output: VertexOutput;let worldPosition=(uniforms.world*vec4f(position,0,0)).xyz;output.lightVector=uniforms.light-worldPosition;output.cameraVector=uniforms.camera-worldPosition;output.position=GetVertexClipSpace(position);output.normal=uniforms.normal*vec3f(0,0,1);return output;}@fragment fn fragment(vertex: VertexOutput)->@location(0)vec4f {let normal=normalize(vertex.normal);let lightDirection=normalize(vertex.lightVector);let direction=dot(lightDirection,-uniforms.direction);let inside=smoothstep(uniforms.limit.y,uniforms.limit.x,direction);let light=dot(normal,lightDirection)*inside;let cameraDirection=normalize(vertex.cameraVector);var specular=dot(normal,normalize(lightDirection+cameraDirection));specular=pow(max(0,specular),uniforms.intensity)*inside;let color=uniforms.color.rgb*light+specular;return vec4f(color,uniforms.color.a);}`;(async function(c){let l;try{l=new(await(n.Renderer(c,`2D Spot Lighting`)))}catch(e){alert(e)}let u=new GUI;u.onChange(C);let d=new e,f=new a,p={shininess:60,innerLimit:t.DegreesToRadians(10),outerLimit:t.DegreesToRadians(30),aimOffsetX:45,aimOffsetY:65},m={min:0,max:90,minRange:1,step:1,converters:GUI.converters.radToDeg},h=new l.Pipeline,{vertexData:g,indexData:_}=o(),v=h.CreateShaderModule(s),{uniforms:y,buffer:b}=h.CreateUniformBuffer(`uniforms`),x=new r({radius:75,indexFormat:`uint32`});GUI.makeMinMaxPair(u,p,`innerLimit`,`outerLimit`,m),x.IndexData=_,x.VertexData=g,await l.AddPipeline(h,{fragment:h.CreateFragmentState(v),vertex:h.CreateVertexState(v,x.GetPositionBufferLayout(h))});let S=new i(x,null);S.SetRenderPipeline(h,b),u.add(p,`shininess`,{min:1,max:250}),u.add(p,`aimOffsetX`,-50,100),u.add(p,`aimOffsetY`,-50,150),t.Mat4.identity(y.normal),t.Mat4.identity(y.world),y.color.set([.5,1,.5,1]),y.light.set([60,65,70]),S.Position=[300,200],S.Origin=[50,75],d.Add(S);function C(){y.intensity[0]=p.shininess,y.camera.set([...f.Position,200]),y.limit[0]=Math.cos(p.innerLimit),y.limit[1]=Math.cos(p.outerLimit);let e=[p.aimOffsetX,p.aimOffsetY,0];y.direction.set(t.Mat4.aim(y.light,e,[0,1,0]).slice(8,11)),h.WriteBuffer(b,y.normal.buffer),l.Render(d)}new ResizeObserver(e=>{for(let t of e){let{inlineSize:e,blockSize:n}=t.contentBoxSize[0];l.SetCanvasSize(e,n),f.Size=l.CanvasSize,d.AddCamera(f)}C()}).observe(document.body)})(document.getElementById(`lesson`));