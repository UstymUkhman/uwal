import{U as x,A as U,F as l}from"./index-BwDKQVXi.js";import{G as z}from"./GPUMipmaps-Sf4roZHW.js";import{v as L,m as s}from"./wgpu-matrix.module-CNlPNSC1.js";import{C as D}from"./Color-DRvW8-9j.js";import{Q as O}from"./Quad-VFYOTGYq.js";/**
 * @module Loading Canvas
 * @author Ustym Ukhman <ustym.ukhman@gmail.com>
 * @description This lesson is reproduced from WebGPU Loading Images into Textures
 * {@link https://webgpufundamentals.org/webgpu/lessons/webgpu-importing-textures.html#loading-canvas}&nbsp;
 * and developed by using a version listed below. Please note that this code
 * may be simplified in future thanks to more recent library APIs.
 * @version 0.0.5
 * @license MIT
 */(async function(p){let r;try{r=new(await x.RenderPipeline(p,"Loading Canvas"))}catch(e){alert(e)}const n=256,u=n/2,B=0,d=[],E=1,T=2e3,y=[0,1,0],I=[0,0,0],A=Math.PI*60/180,M=[0,0,2],R=L.set(1.2,.7),m=s.perspective(A,r.AspectRatio,E,T),v=s.inverse(s.lookAt(M,I,y)),S=s.multiply(m,v),a=document.createElement("canvas").getContext("2d");a.canvas.width=a.canvas.height=n;const f=new(await x.Texture());f.SetRenderer(r);const C=F(a.canvas,!0);r.CreatePipeline({module:r.CreateShaderModule([O,z])});const P=r.CreateColorAttachment();P.clearValue=new D(5000268).rgba,r.CreatePassDescriptor(P);for(let e=0;e<8;e++){const t=f.CreateSampler({addressModeU:U.REPEAT,addressModeV:U.REPEAT,magFilter:e&1?l.LINEAR:l.NEAREST,minFilter:e&2?l.LINEAR:l.NEAREST,mipmapFilter:e&4?l.LINEAR:l.NEAREST}),o=16*Float32Array.BYTES_PER_ELEMENT,c=r.CreateBuffer({usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,size:o}),i=new Float32Array(o/Float32Array.BYTES_PER_ELEMENT),h=i.subarray(B,16);r.AddBindGroups(r.CreateBindGroup(r.CreateBindGroupEntries([t,C.createView(),{buffer:c}]))),d.push({matrixBuffer:c,matrixValues:i,matrix:h})}const N=(e,t,o)=>`hsl(${e*360|0}, ${t*100}%, ${o*100|0}%)`;function F(e,t=!1){return f.CopyImageToTexture(e,{create:{usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST,format:"rgba8unorm",mipmaps:t}})}function G(e){a.clearRect(0,0,n,n),a.save(),a.translate(u,u);const t=20;for(let o=0;o<t;o++)a.fillStyle=N(o/t*.2+e*.1,1,o%2*.5),a.fillRect(-u,-u,n,n),a.rotate(e*.5),a.scale(.85,.85),a.translate(n/16,0);a.restore()}function g(e){G(e*1e-4),requestAnimationFrame(g),f.CopyImageToTexture(a.canvas,{texture:C}),d.forEach(({matrix:t,matrixBuffer:o,matrixValues:c},i)=>{const b=i%4-1.5,w=+(i<4)*2-1,_=[b*R[0],w*R[1],-50*.5];s.translate(S,_,t),s.rotateX(t,Math.PI*.5,t),s.scale(t,[1,50*2,1],t),s.translate(t,[-.5,-.5,0],t),r.WriteBuffer(o,c),r.SetActiveBindGroups(i),r.Render(6,!1)}),r.Submit()}new ResizeObserver(e=>{for(const t of e){const{inlineSize:o,blockSize:c}=t.contentBoxSize[0];r.SetCanvasSize(o,c)}s.perspective(A,r.AspectRatio,E,T,m),s.multiply(m,v,S),requestAnimationFrame(g)}).observe(p)})(document.getElementById("lesson"));
