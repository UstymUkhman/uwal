import{addButtonLeftJustified as Me}from"https://webgpufundamentals.org/webgpu/resources/js/gui-helpers.js";import{D as De,b as p,U as N,a as V}from"./index-CWG6eoQD.js";import{c as Pe}from"./ConeVertices-DQO7wRFY.js";import{S as G,T as oe}from"./Transform-neAPMyd6.js";import{C as Ue,a as je}from"./Cube-Uz7Qg183.js";import{P as Ie}from"./PerspectiveCamera-MopHud7N.js";/**
 * @module Making a Hand
 * @author Ustym Ukhman <ustym.ukhman@gmail.com>
 * @description This lesson is reproduced from WebGPU Scene Graphs
 * {@link https://webgpufundamentals.org/webgpu/lessons/webgpu-scene-graphs.html#a-hand}&nbsp;
 * and developed by using a version listed below. Please note that this code
 * may be simplified in future thanks to more recent library APIs.
 * @version 0.1.0
 * @license MIT
 */(async function($){let i;$.style.backgroundColor="#000";try{i=new(await De.Renderer($,"Hand",{alphaMode:"premultiplied"}))}catch(e){alert(e)}const y={min:-90,max:90,step:1,converters:GUI.converters.radToDeg},ne={min:-180,max:180,step:1,converters:GUI.converters.radToDeg},re=new Set([0,1,3]),ae=[1,1,1,1],se=100;let F=!1;const M=[];let D,L,S=0;const x=[],c=[];let P,ie=0,W=0;const a={cameraRotation:N.DegreesToRadians(-45),animate:!1,showMeshNodes:!1,showAllTransforms:!1,translation:p.zero(),rotation:p.zero(),scale:p.create(1,1,1)},C=new G("root"),u=new GUI().onChange(T),z=(e,t,o)=>(t-e)*o+e;u.add(a,"cameraRotation",ne),u.add(a,"animate").onChange(e=>s.enable(!e)),u.add(a,"showMeshNodes").onChange(ee),u.add(a,"showAllTransforms").onChange(Q),u.addButton("Fire!",Re);const s=u.addFolder("Orientation");s.onChange(Se);const ce=[s.add(a.translation,"0",-200,200,1).name("Translation X"),s.add(a.translation,"1",-200,200,1).name("Translation Y"),s.add(a.translation,"2",-200,200,1).name("Translation Z"),s.add(a.rotation,"0",y).name("Rotation X"),s.add(a.rotation,"1",y).name("Rotation Y"),s.add(a.rotation,"2",y).name("Rotation Z"),s.add(a.scale,"0",.1,100).name("Scale X"),s.add(a.scale,"1",.1,100).name("Scale Y"),s.add(a.scale,"2",.1,100).name("Scale Z")],d=new Ie(60,1,2e3);let O=d.UpdateViewProjection();i.CreatePassDescriptor(i.CreateColorAttachment(),i.CreateDepthStencilAttachment());const R=new je,de=15,r=new i.Pipeline,E=r.CreateShaderModule(Ue),{layout:le,buffer:k}=r.CreateVertexBuffer({name:"color",format:"unorm8x4"},36);R.SetRenderPipeline(await i.AddPipeline(r,{primitive:{cullMode:"back"},fragment:r.CreateFragmentState(E),depthStencil:r.CreateDepthStencilState(),vertex:r.CreateVertexState(E,void 0,[R.GetPositionBufferLayout(r),le])}));const fe=[200,200,70,90,130,110,70,200,210,160,160,220,200,70,120,80,70,200],Y=R.UV.length/2,U=new Uint8Array(Y*4);for(let e=0,t=0;e<Y;t=(++e/4|0)*3){const o=fe.slice(t,t+3);U.set(o,e*4),U[e*4+3]=255}const{vertexData:q,colorData:ue,vertices:me}=Pe(10,20),X=r.CreateVertexBuffer(q),{buffer:Z}=r.CreateVertexBuffer({name:"color",format:"unorm8x4"},me);r.WriteBuffer(Z,ue),r.WriteBuffer(X,q),r.WriteBuffer(k,U),R.AddVertexBuffers(k);const he=[X,Z],pe=Object.values(r.IndexBuffer),Ce=r.VertexBuffers.map(({buffer:e})=>e),b=[N.DegreesToRadians(15),0,0],j=B("wrist",C,[[0,-35,0]]),w=B("palm",j,[[0,68,0]]),we=[j,w,...v("thumb",w,2,20,[[-50,-8,3.33],b]),...v("index finger",w,3,30,[[-25,-3,3.33],b]),...v("middle finger",w,3,35,[[-0,-1,3.33],b]),...v("ring finger",w,3,33,[[25,-2,3.33],b]),...v("pinky",w,3,25,[[45,-6,3.33],b])];I(B("palm mesh",j,[void 0,void 0,[100,100,10]]));const J=B("finger tip",C.Find("index finger-2"),[[0,15,0]]),Be=u.addFolder("Nodes"),ge=_(Be,C);K(C.Children[0]),Q(!1),ee(!1);function _(e,t,o,n){const l=[],m=n===void 0;if(t.Transform instanceof oe){const f=`${m?"":`${n} +-`}${t.Label}`;l.push(Me(e,f,()=>K(t)))}return n=m?"":`${n}${o?"   ":" | "}`,l.push(...t.Children.map((f,h)=>_(e,f,h===t.Children.length-1,n))),l.flat()}function Se(){const e=P.Transform;e.Translation.set(a.translation),e.Rotation.set(a.rotation),e.Scale.set(a.scale)}function H(){const e=P.Transform;a.translation.set(e.Translation),a.rotation.set(e.Rotation),a.scale.set(e.Scale),s.updateDisplay()}function K(e){P=e,s.name(`Orientation: ${e.Label}`),H()}function Q(e){ce.forEach((t,o)=>t.show(e||re.has(o)))}function ee(e){for(const t of ge)t.domElement.textContent.includes("mesh")&&t.show(e)}function xe(e){x.splice(x.indexOf(e),1)}function I(e,t=Ce,o=pe){const n=x.push({node:e,vertexBuffers:t,indexBuffer:o});return x[n-1]}function B(e,t,o=[]){const n=new G(e,new oe(...o));return t&&(n.Parent=t),n}function v(e,t,o,n,l){const m=e,f=[];for(let h=0;h<o;++h){const g=B(e,t,l),A=B(`${e}-mesh`,g,[void 0,void 0,[10,n,10]]);e=`${m}-${h+1}`,I(A),f.push(g),t=g,l=[[0,n,3.33],[N.DegreesToRadians(15),0,0]]}return f}function be(e,t,o){if(S===M.length){const{projection:h,buffer:g}=r.CreateUniformBuffer("projection"),{color:A,buffer:te}=r.CreateUniformBuffer("color");r.AddBindGroups(r.CreateBindGroup(r.CreateBindGroupEntries([te,g]))),M.push({projectionValue:h,projectionBuffer:g,colorValue:A,colorBuffer:te})}const{projectionValue:n,projectionBuffer:l,colorValue:m,colorBuffer:f}=M[S];m.set(ae),r.WriteBuffer(f,m),V.multiply(O,e,n),r.WriteBuffer(l,n),r.SetActiveBindGroups(S),r.SetVertexBuffers(t),r.SetIndexBuffer(...o),S=++S%(de+c.length),i.Render(!1)}function T(){D||(D=requestAnimationFrame(ye))}function ve(e){const{node:t,vertexBuffers:o,indexBuffer:n}=e;be(t.WorldMatrix,o,n)}function Te(e,t){if(c.length){for(T();c.length&&c[0].endTime<=e;){const o=c.shift();o.node.Parent=null,xe(o.mesh)}for(const o of c){const n=p.mulScalar(o.velocity,t);V.multiply(V.translation(n),o.node.LocalMatrix,o.node.LocalMatrix)}}}function Re(){const e=new G(`shot-${ie++}`),t=I(e,he,[]);V.translate(J.WorldMatrix,[0,20,0],e.LocalMatrix);const o=p.mulScalar(p.normalize(p.getAxis(J.WorldMatrix,1)),se);e.Parent=C;const n=performance.now()*.001+5;c.push({node:e,mesh:t,velocity:o,endTime:n}),T()}function Ve(){we.forEach((e,t)=>{const o=Math.sin(W+t*.1)*.5+.5;e.Transform.Translation[2]=z(0,10,o),e.Transform.Rotation[0]=z(0,Math.PI*.25,o)})}function ye(){D=void 0,d.ResetMatrix(),d.Translate([60,20,0]),d.RotateY(a.cameraRotation),d.Translate([0,0,300]),O=d.UpdateViewProjection(),C.UpdateWorldMatrix();for(const n of x)ve(n);i.Submit();const e=a.animate||c.length,t=performance.now()*.001,o=F&&t-L||0;L=t,e&&(W+=o),F=e,a.animate&&(Ve(),H(),T()),Te(t,o)}new ResizeObserver(e=>{for(const t of e){const{inlineSize:o,blockSize:n}=t.contentBoxSize[0];i.SetCanvasSize(o,n),d.AspectRatio=i.AspectRatio,d.UpdateViewProjection()}T()}).observe(document.body)})(document.getElementById("lesson"));
