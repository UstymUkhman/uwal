var ge=Object.defineProperty;var Ee=h=>{throw TypeError(h)};var Fe=(h,t,e)=>t in h?ge(h,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):h[t]=e;var q=(h,t,e)=>Fe(h,typeof t!="symbol"?t+"":t,e),he=(h,t,e)=>t.has(h)||Ee("Cannot "+e);var r=(h,t,e)=>(he(h,t,"read from private field"),e?e.call(h):t.get(h)),o=(h,t,e)=>t.has(h)?Ee("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(h):t.set(h,e),n=(h,t,e,i)=>(he(h,t,"write to private field"),i?i.call(h,e):t.set(h,e),e),p=(h,t,e)=>(he(h,t,"access private method"),e);const Te=U({RAD:Math.PI/180,DEG:180/Math.PI,HPI:Math.PI/2,TAU:Math.PI*2});function U(h){for(let t in h)h[t]={value:h[t]};return Object.freeze(Object.create(null,h))}function ye(h){return Te.RAD*h}function xe(h){return Te.DEG*h}const Ge={CANVAS_NOT_FOUND:"CANVAS_NOT_FOUND",CONTEXT_NOT_FOUND:"CONTEXT_NOT_FOUND",COMMAND_ENCODER_NOT_FOUND:"COMMAND_ENCODER_NOT_FOUND",VERTEX_STATE_NOT_FOUND:"VERTEX_STATE_NOT_FOUND",PIPELINE_NOT_FOUND:"PIPELINE_NOT_FOUND"},Le={CANVAS_NOT_FOUND:"Failed to get a WebGPU canvas.",CONTEXT_NOT_FOUND:"Failed to get a WebGPU context.",COMMAND_ENCODER_NOT_FOUND:"Failed to get a GPUCommandEncoder.",VERTEX_STATE_NOT_FOUND:"Failed to get a GPUVertexState.",PIPELINE_NOT_FOUND:"Failed to get a GPU"},Be={CANVAS_NOT_FOUND:5,CONTEXT_NOT_FOUND:6,COMMAND_ENCODER_NOT_FOUND:7,VERTEX_STATE_NOT_FOUND:8,PIPELINE_NOT_FOUND:9},Me={RENDER_PIPELNE_NOT_FOUND:"RENDER_PIPELNE_NOT_FOUND",TEXTURE_SIZE_NOT_FOUND:"TEXTURE_SIZE_NOT_FOUND",TEXTURE_NOT_FOUND:"TEXTURE_NOT_FOUND"},we={RENDER_PIPELNE_NOT_FOUND:'"UWAL.RenderPipeline" is required in `Texture` when generating mipmaps.\n        Use `Texture.Renderer` setter before creating a ',TEXTURE_SIZE_NOT_FOUND:"`size` array or a `width` value is required in `options` parameter of ",TEXTURE_NOT_FOUND:"CopyImageToTexture `options` is required to have a `texture` value or a `create` entry."},Ie={REQUIRED_SEGMENTS:"REQUIRED_SEGMENTS"},be={REQUIRED_SEGMENTS:"Shape `segments` is required to be an integer value."};U({DEVICE_LOST:"Device::Lost"});const E=U({WEBGPU_NOT_SUPPORTED:"WEBGPU_NOT_SUPPORTED",ADAPTER_NOT_FOUND:"ADAPTER_NOT_FOUND",FEATURE_NOT_FOUND:"FEATURE_NOT_FOUND",DEVICE_NOT_FOUND:"DEVICE_NOT_FOUND",DEVICE_NOT_REQUESTED:"DEVICE_NOT_REQUESTED",DEVICE_LOST:"DEVICE_LOST",...Ge,...Me,...Ie}),De=U({WEBGPU_NOT_SUPPORTED:"WebGPU is not supported in this browser.",ADAPTER_NOT_FOUND:"Failed to get a GPUAdapter.",DEVICE_NOT_FOUND:"Failed to get a GPUDevice.",FEATURE_NOT_FOUND:"Failed to get a GPUFeature ",DEVICE_NOT_REQUESTED:"GPUDevice was not requested.",DEVICE_LOST:"WebGPU device was lost. ",...Le,...we,...be}),Ve=U({WEBGPU_NOT_SUPPORTED:0,ADAPTER_NOT_FOUND:1,DEVICE_NOT_FOUND:2,DEVICE_NOT_REQUESTED:3,DEVICE_LOST:4,...Be});function me(h,t){console.warn(De[h]+(t??""))}function T(h,t){throw new Error(De[h]+(t??""),{cause:Ve[h]})}var Q,w,F,y,j,Y,I,oe,Ne;class Ce{constructor(t,e,i){o(this,oe);o(this,Q);o(this,w);o(this,F);q(this,"Device");q(this,"BindGroups",[]);o(this,y);q(this,"Pipeline");q(this,"Descriptor");o(this,j);o(this,Y);o(this,I,[]);!t&&T(E.DEVICE_NOT_REQUESTED),n(this,Q,i),this.Device=t,n(this,w,e),n(this,F,this.CreatePipelineLabel("Command Encoder"))}CreatePipelineLabel(t){return r(this,w)&&t&&`${r(this,w)} ${t}`||""}CreatePipelineLayout(t,e){e??(e=this.CreatePipelineLabel(`${r(this,Q)} Pipeline Layout`));const i=Array.isArray(t)&&t||[t];return this.Device.createPipelineLayout({label:e,bindGroupLayouts:i})}CreateShaderModule(t,e,i,s){e??(e=this.CreatePipelineLabel("Shader Module"));const a=Array.isArray(t)&&t.join(`

`)||t;return this.Device.createShaderModule({label:e,code:a,sourceMap:i,compilationHints:s})}CreateBuffer(t){const e=t.label??this.CreatePipelineLabel("Buffer");return this.Device.createBuffer({...t,label:e})}WriteBuffer(t,e,i=0,s,a){this.Device.queue.writeBuffer(t,i,e,s,a)}CopyBufferToBuffer(t,e,i,s=0,a=0){this.GetCommandEncoder(!0).copyBufferToBuffer(t,s,e,a,i)}CreateBindGroupLayout(t,e){e??(e=this.CreatePipelineLabel("Bind Group Layout")),t=Array.isArray(t)&&t.map((s,a)=>({...s,binding:s.binding??a}))||[{...t,binding:t.binding??0}];const i=t;return this.Device.createBindGroupLayout({entries:i,label:e})}CreateBindGroupEntries(t,e=0){return Array.isArray(t)&&t.map((i,s)=>({binding:(e==null?void 0:e[s])??s,resource:i}))||[{binding:e,resource:t}]}CreateBindGroup(t,e=0,i){return i??(i=this.CreatePipelineLabel("Bind Group")),typeof e=="number"&&(e=this.Pipeline?this.Pipeline.getBindGroupLayout(e):T(E.PIPELINE_NOT_FOUND,`${r(this,Q)}Pipeline.`)),this.Device.createBindGroup({entries:t,label:i,layout:e})}SetBindGroups(t,e){Array.isArray(e)?e[0].length||(e=e.map(i=>[i])):e=[e],this.BindGroups=Array.isArray(t)&&t.map((i,s)=>({bindGroup:i,dynamicOffsets:e[s],active:!0}))||[{bindGroup:t,dynamicOffsets:e[0],active:!0}]}AddBindGroups(t,e){return Array.isArray(e)?e[0].length||(e=e.map(i=>[i])):e=[e],this.BindGroups.push(...Array.isArray(t)&&t.map((i,s)=>({bindGroup:i,dynamicOffsets:e[s],active:!0}))||[{bindGroup:t,dynamicOffsets:e[0],active:!0}])}SetActiveBindGroups(t){t=Array.isArray(t)&&t||[t];for(let e=this.BindGroups.length;e--;)this.BindGroups[e].active=t.includes(e)}ClearBindGroups(){this.BindGroups.splice(0)}CreateCommandEncoder(){return n(this,y,this.Device.createCommandEncoder({label:r(this,F)}))}SetCommandEncoder(t){n(this,y,t)}GetCommandEncoder(t=!1){if(!r(this,y)){if(t){const e=`${r(this,F)&&`Label: "${r(this,F)}".`}`;me(E.COMMAND_ENCODER_NOT_FOUND,` ${e} Creating a new one.`)}return this.CreateCommandEncoder()}return r(this,y)}SubmitCommandBuffer(){this.Device.queue.submit([r(this,y).finish()])}SavePipelineState(){n(this,Y,this.Pipeline),n(this,j,this.Descriptor),n(this,I,[...this.BindGroups])}ResetPipelineState(){this.ClearBindGroups()}RestorePipelineState(){this.Descriptor=r(this,j),this.Pipeline=r(this,Y),p(this,oe,Ne).call(this)}set CommandEncoderLabel(t){n(this,F,t)}get ProgramName(){return r(this,w)}}Q=new WeakMap,w=new WeakMap,F=new WeakMap,y=new WeakMap,j=new WeakMap,Y=new WeakMap,I=new WeakMap,oe=new WeakSet,Ne=function(){const t=r(this,I).map(({bindGroup:a})=>a),e=r(this,I).map(({dynamicOffsets:a})=>a),i=e.some(a=>typeof a=="number")&&e||void 0,s=r(this,I).map(({active:a},u)=>a&&u).filter(a=>typeof a=="number");this.SetBindGroups(t,i),this.SetActiveBindGroups(s)};U({ALL:"all",STENCIL:"stencil-only",DEPTH:"depth-only"});const We=U({CLAMP:"clamp-to-edge",REPEAT:"repeat",MIRROR:"mirror-repeat"}),pe=U({NEAREST:"nearest",LINEAR:"linear"});U({NEVER:"never",LESS:"less",EQUAL:"equal",LESS_EQUAL:"less-equal",GREATER:"greater",NOT_EQUAL:"not-equal",GREATER_EQUAL:"greater-equal",ALWAYS:"always"});var $e="const QUAD=array(vec2f(-1.0,-1.0),vec2f(1.0,-1.0),vec2f(1.0,1.0),vec2f(1.0,1.0),vec2f(-1.0,1.0),vec2f(-1.0,-1.0));fn GetQuadCoord(index: u32)->vec2f{return QUAD[index];}struct VertexOutput{@builtin(position)position: vec4f,@location(0)textureCoord: vec2f};@group(0)@binding(0)var Sampler: sampler;@group(0)@binding(1)var Texture: texture_2d<f32>;@vertex fn vertex(@builtin(vertex_index)index: u32)->VertexOutput {let position=GetQuadCoord(index);let coord=(position+1)*0.5;var output: VertexOutput;output.position=vec4f(position,0.0,1.0);output.textureCoord=vec2f(coord.x,1-coord.y);return output;}@fragment fn fragment(@location(0)textureCoord: vec2f)->@location(0)vec4f {return textureSample(Texture,Sampler,textureCoord);}",A,X,v,x,G,l,C,Pe,ae,ue,ce;class Oe{constructor(t,e){o(this,C);o(this,A);o(this,X);o(this,v);o(this,x);o(this,G);o(this,l);!t&&T(E.DEVICE_NOT_REQUESTED),n(this,X,e),n(this,A,t)}CreateTexture(t){const e=t.label??p(this,C,Pe).call(this,"Texture");return r(this,A).createTexture({...t,label:e})}WriteTexture(t,e){const{texture:i,mipLevel:s,origin:a,aspect:u,offset:d,bytesPerRow:N,rowsPerImage:f}=e;r(this,A).queue.writeTexture({texture:i,mipLevel:s,origin:a,aspect:u},t,{offset:d,bytesPerRow:N,rowsPerImage:f},p(this,C,ue).call(this,e,"WriteTexture"))}CreateBitmapImage(t,e){return createImageBitmap(t,e)}CreateTextureFromSource(t,e){const i=e.mipLevelCount??(e.mipmaps&&this.GetMipmapLevels(t)||void 0),s=e.size,a=e.size,u=Array.isArray(e.size)||!e.size?s??p(this,C,ae).call(this,t):[a.width,a.height];return this.CreateTexture({mipLevelCount:i,size:u,...e})}ImportExternalTexture(t,e,i){return r(this,A).importExternalTexture({source:t,label:e,colorSpace:i})}CreateMultisampleTexture(t=!1,e=4,i){var d;!r(this,l)&&T(E.RENDER_PIPELNE_NOT_FOUND,"multisample texture.");const{width:s,height:a,format:u}=r(this,l).CurrentTexture;return(t||!r(this,v)||r(this,v).width!==s||r(this,v).height!==a)&&((d=r(this,v))==null||d.destroy(),n(this,v,this.CreateTexture({usage:GPUTextureUsage.RENDER_ATTACHMENT,label:i??"Multisample Texture",size:[s,a],sampleCount:e,format:u}))),r(this,v)}CopyImageToTexture(t,e){let{texture:i}=e;const[s,a]=p(this,C,ae).call(this,t),{create:u,flipY:d,mipLevel:N,aspect:f,colorSpace:Ue,premultipliedAlpha:fe,generateMipmaps:ve=!0}=e;return!i&&!u&&T(E.TEXTURE_NOT_FOUND),i??(i=this.CreateTextureFromSource(t,u)),r(this,A).queue.copyExternalImageToTexture({source:t,origin:e.sourceOrigin,flipY:d},{texture:i,mipLevel:N,origin:e.destinationOrigin,aspect:f,colorSpace:Ue,premultipliedAlpha:fe},p(this,C,ue).call(this,{width:s,height:a,...e},"CopyImageToTexture")),ve&&1<i.mipLevelCount&&(i.depthOrArrayLayers===1?this.GenerateMipmaps(i):this.GenerateCubeMipmaps(i)),i}GenerateCubeMipmaps(t){p(this,C,ce).call(this,t,{minMagFilter:pe.LINEAR},e=>{for(let i=0;i<t.depthOrArrayLayers;++i)r(this,l).SetBindGroups(r(this,l).CreateBindGroup(r(this,l).CreateBindGroupEntries([r(this,x),t.createView({arrayLayerCount:1,baseArrayLayer:i,mipLevelCount:1,dimension:"2d",baseMipLevel:e})]))),r(this,l).CreatePassDescriptor(r(this,l).CreateColorAttachment(t.createView({baseMipLevel:e+1,arrayLayerCount:1,baseArrayLayer:i,mipLevelCount:1,dimension:"2d"}))),r(this,l).Render(6,!1),r(this,l).DestroyCurrentPass()})}GenerateMipmaps(t){p(this,C,ce).call(this,t,{minFilter:pe.LINEAR},e=>{r(this,l).SetBindGroups(r(this,l).CreateBindGroup(r(this,l).CreateBindGroupEntries([r(this,x),t.createView({baseMipLevel:e++,mipLevelCount:1})]))),r(this,l).CreatePassDescriptor(r(this,l).CreateColorAttachment(t.createView({baseMipLevel:e,mipLevelCount:1}))),r(this,l).Render(6,!1),r(this,l).DestroyCurrentPass()})}CreateSampler(t){if(!t)return r(this,A).createSampler();const{addressModeUV:e,addressMode:i,minMagFilter:s,filter:a}=t;return e&&(t.addressModeU=t.addressModeV=e),i&&(t.addressModeU=t.addressModeV=t.addressModeW=i),s&&(t.minFilter=t.magFilter=s),a&&(t.minFilter=t.magFilter=t.mipmapFilter=a),r(this,A).createSampler(t)}GetMipmapLevels(t){const[e,i]=p(this,C,ae).call(this,t);return(Math.log2(Math.max(e,i))|0)+1}set Renderer(t){n(this,l,t)}SetRenderer(t){this.Renderer=t}}A=new WeakMap,X=new WeakMap,v=new WeakMap,x=new WeakMap,G=new WeakMap,l=new WeakMap,C=new WeakSet,Pe=function(t){return r(this,X)&&t&&`${r(this,X)} ${t}`||""},ae=function(t){return t instanceof HTMLVideoElement?[t.videoWidth,t.videoHeight]:t instanceof VideoFrame?[t.codedWidth,t.codedHeight]:[t.width,t.height]},ue=function(t,e){const{size:i,width:s,height:a,depthOrArrayLayers:u}=t;return!i&&!s&&T(E.TEXTURE_SIZE_NOT_FOUND,`\`${e}\` method.`),i??{width:s,height:a,depthOrArrayLayers:u}},ce=function(t,e,i){!r(this,l)&&T(E.RENDER_PIPELNE_NOT_FOUND,"texture with mipmaps."),(!r(this,G)||!r(this,x))&&(n(this,G,r(this,l).CreateShaderModule($e)),n(this,x,this.CreateSampler(e)));let s=0,a=t.width,u=t.height;for(r(this,l).SavePipelineState(),r(this,l).ResetPipelineState(),r(this,l).CreatePipeline({vertex:r(this,l).CreateVertexState(r(this,G)),fragment:r(this,l).CreateFragmentState(r(this,G),void 0,{format:t.format})});1<a||1<u;)a=Math.max(a*.5|0,1),u=Math.max(u*.5|0,1),i(s++);r(this,l).SubmitCommandBuffer(),r(this,l).SetCommandEncoder(void 0),r(this,l).RestorePipelineState(),n(this,G,n(this,x,void 0))};var Z,L,W,B,m,b,z,J,R,_,D,P,K,g,ee,te,re,ie,M,$,le,Ae;class qe extends Ce{constructor(e,i,s,a){super(e,i,"Render");o(this,$);o(this,Z);o(this,L,!1);o(this,W,new Float32Array(2));o(this,B,!1);o(this,m);o(this,b);o(this,z);o(this,J);o(this,R);o(this,_);o(this,D);o(this,P);o(this,K);o(this,g,[]);o(this,ee);o(this,te);o(this,re);o(this,ie);o(this,M);!s&&T(E.CANVAS_NOT_FOUND);const u=s.getContext("webgpu");!u&&T(E.CONTEXT_NOT_FOUND),u.configure({device:e,...a}),n(this,z,this.CreateBuffer({size:r(this,W).length*Float32Array.BYTES_PER_ELEMENT,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,label:"Render Pipeline Resolution Buffer"})),n(this,m,s),n(this,b,u),p(this,$,le).call(this),n(this,K,a.format)}SetCanvasSize(e,i){!this.Device&&T(E.DEVICE_NOT_FOUND),!r(this,m)&&T(E.CANVAS_NOT_FOUND);const{maxTextureDimension2D:s}=this.Device.limits;e=Math.max(1,Math.min(e,s)),i=Math.max(1,Math.min(i,s)),(r(this,m).width!==e||r(this,m).height!==i)&&(r(this,m).width=e,r(this,m).height=i,p(this,$,le).call(this))}CreateColorAttachment(e,i="clear",s="store",a,u,d){return{view:e,loadOp:i,storeOp:s,clearValue:a,resolveTarget:u,depthSlice:d}}CreateDepthAttachment(e,i=1,s="clear",a="store",u){return n(this,B,!0),n(this,J,new Oe(this.Device,"Depth Texture")),{view:e,depthClearValue:i,depthLoadOp:s,depthStoreOp:a,depthReadOnly:u}}CreateStencilAttachment(e,i="clear",s="store",a){return{stencilClearValue:e,stencilLoadOp:i,stencilStoreOp:s,stencilReadOnly:a}}CreatePassDescriptor(e,i,s,a,u,d){const N=Array.isArray(e)&&e||[e];return n(this,L,!N.some(({view:f})=>!!f)),i??(i=this.CreatePipelineLabel("Render Pass")),this.Descriptor={colorAttachments:N,depthStencilAttachment:s,occlusionQuerySet:a,timestampWrites:u,maxDrawCount:d,label:i}}CreateVertexBufferAttribute(e,i=0,s=0){return{format:e,shaderLocation:i,offset:s}}CreateVertexState(e,i="vertex",s,a){return s=Array.isArray(s)&&s||[s],{module:e,entryPoint:i,buffers:s,constants:a}}CreateFragmentColorTarget(e=r(this,K),i,s){return{format:e,blend:i,writeMask:s}}CreateFragmentState(e,i="fragment",s,a){return s??(s=[this.CreateFragmentColorTarget()]),s=Array.isArray(s)&&s||[s],{module:e,entryPoint:i,targets:s,constants:a}}CreatePipeline(e){const i=e.layout??"auto";let{module:s,vertex:a,fragment:u}=e;s&&(a??(a=this.CreateVertexState(s)),u??(u=this.CreateFragmentState(s))),!s&&!a&&T(E.VERTEX_STATE_NOT_FOUND);const d=e.label??this.CreatePipelineLabel("Render Pipeline");return this.Pipeline=this.Device.createRenderPipeline({...e,vertex:a,fragment:u,label:d,layout:i})}SavePipelineState(){super.SavePipelineState(),n(this,M,r(this,P)),n(this,ee,r(this,g)),n(this,ie,r(this,_)),n(this,te,r(this,L)),n(this,re,r(this,B)),r(this,M)&&n(this,M,Object.values(r(this,M)))}ResetPipelineState(){super.ResetPipelineState(),n(this,L,!1),n(this,B,!1),this.SetIndexBuffer(n(this,_,void 0))}RestorePipelineState(){super.RestorePipelineState(),n(this,g,r(this,ee)),n(this,_,r(this,ie)),n(this,L,r(this,te)),n(this,B,r(this,re)),this.SetIndexBuffer(...Array.isArray(r(this,M))&&r(this,M)||[void 0])}SetVertexBuffers(e,i,s){i=Array.isArray(i)&&i||[i],s=Array.isArray(s)&&s||[s],n(this,g,Array.isArray(e)&&e.map((a,u)=>({buffer:a,offset:i[u],size:s[u]}))||[{buffer:e,offset:i[0],size:s[0]}])}AddVertexBuffers(e,i,s){i=Array.isArray(i)&&i||[i],s=Array.isArray(s)&&s||[s],r(this,g).push(...Array.isArray(e)&&e.map((a,u)=>({buffer:a,offset:i[u],size:s[u]}))||[{buffer:e,offset:i[0],size:s[0]}])}SetIndexBuffer(e,i="uint32",s,a){n(this,P,e&&{buffer:e,format:i,offset:s,size:a})}Render(e,i=!0){r(this,B)&&p(this,$,Ae).call(this),r(this,D)||(r(this,_)?(this.Descriptor.colorAttachments[0].view=r(this,_).createView(),this.Descriptor.colorAttachments[0].resolveTarget=this.CurrentTextureView):r(this,L)&&(this.Descriptor.colorAttachments[0].view=this.CurrentTextureView),n(this,D,this.GetCommandEncoder().beginRenderPass(this.Descriptor)),r(this,D).setPipeline(this.Pipeline),n(this,Z,r(this,P)?r(this,D).drawIndexed.bind(r(this,D)):r(this,D).draw.bind(r(this,D))));for(let s=0,a=r(this,g).length;s<a;++s){const{buffer:u,offset:d,size:N}=r(this,g)[s];r(this,D).setVertexBuffer(s,u,d,N)}r(this,P)&&r(this,D).setIndexBuffer(r(this,P).buffer,r(this,P).format,r(this,P).offset,r(this,P).size);for(let s=0,a=0,u=this.BindGroups.length;s<u;++s){const{bindGroup:d,dynamicOffsets:N,active:f}=this.BindGroups[s];f&&r(this,D).setBindGroup(a++,d,N)}r(this,Z).call(this,...Array.isArray(e)&&e||[e]),i&&this.Submit()}DestroyCurrentPass(){var e;(e=r(this,D))==null||e.end(),n(this,D,void 0)}Submit(){this.DestroyCurrentPass(),this.SubmitCommandBuffer(),this.SetCommandEncoder(void 0)}Destroy(){var e;this.DestroyCurrentPass(),(e=r(this,b))==null||e.unconfigure()}get Canvas(){return r(this,m)}get Context(){return r(this,b)}get AspectRatio(){return!r(this,m)&&T(E.CANVAS_NOT_FOUND),r(this,m).width/r(this,m).height}get DepthTexture(){return r(this,R)}get CurrentTexture(){return r(this,b).getCurrentTexture()}get CurrentTextureView(){return this.CurrentTexture.createView()}set MultisampleTexture(e){n(this,_,e)}get MultisampleTexture(){return r(this,_)}get ResolutionBuffer(){return r(this,z)}get CurrentPass(){return r(this,D)}}Z=new WeakMap,L=new WeakMap,W=new WeakMap,B=new WeakMap,m=new WeakMap,b=new WeakMap,z=new WeakMap,J=new WeakMap,R=new WeakMap,_=new WeakMap,D=new WeakMap,P=new WeakMap,K=new WeakMap,g=new WeakMap,ee=new WeakMap,te=new WeakMap,re=new WeakMap,ie=new WeakMap,M=new WeakMap,$=new WeakSet,le=function(){r(this,W).set([r(this,m).width,r(this,m).height]),this.WriteBuffer(r(this,z),r(this,W))},Ae=function(){var a;const e=this.CurrentTexture,{width:i,height:s}=e;(!r(this,R)||r(this,R).width!==i||r(this,R).height!==s)&&((a=r(this,R))==null||a.destroy(),n(this,R,r(this,J).CreateTextureFromSource(e,{usage:GPUTextureUsage.RENDER_ATTACHMENT,format:"depth24plus"}))),this.Descriptor.depthStencilAttachment.view=r(this,R).createView()};var se;class Qe extends Ce{constructor(e,i){super(e,i,"Compute");o(this,se,[1])}CreatePassDescriptor(e,i,s,a){return e??(e=this.CreatePipelineLabel("Compute Pass")),this.Descriptor={label:e,timestampWrites:i?{querySet:i,beginningOfPassWriteIndex:s,endOfPassWriteIndex:a}:void 0}}SetPassDescriptor(e){this.Descriptor=e}CreatePipeline(e){const i=e.layout??"auto",s=e.label??this.CreatePipelineLabel("Compute Pipeline");return this.Pipeline=this.Device.createComputePipeline({label:s,layout:i,compute:e})}Compute(e=!1){const i=this.GetCommandEncoder().beginComputePass(this.Descriptor);i.setPipeline(this.Pipeline);for(let s=0,a=0,u=this.BindGroups.length;s<u;++s){const{bindGroup:d,dynamicOffsets:N,active:f}=this.BindGroups[s];f&&i.setBindGroup(a++,d,N)}i.dispatchWorkgroups(...r(this,se)),i.end(),e&&this.Submit()}Submit(){this.SubmitCommandBuffer(),this.SetCommandEncoder(void 0)}set Workgroups(e){n(this,se,Array.isArray(e)&&e||[e])}}se=new WeakMap;/**
 * @module UWAL
 * @author Ustym Ukhman <ustym.ukhman@gmail.com>
 * @description Unopinionated WebGPU Abstraction Library
 * @version 0.0.6
 * @license MIT
 */var V,H,k,S,O,ne,Re,_e,Se;const c=class c{static RenderPipeline(t,e="",i={}){return i.format??(i.format=c.PreferredCanvasFormat),p(this,O,ne).call(this,e),(async()=>{const s=await c.Device;return new Proxy(qe,{construct(a){return new a(s,e,t,i)}})})()}static ComputePipeline(t=""){return p(this,O,ne).call(this,t),(async()=>{const e=await c.Device;return new Proxy(Qe,{construct(i){return new i(e,t)}})})()}static Texture(t=""){return p(this,O,ne).call(this,t),(async()=>{const e=await c.Device;return new Proxy(Oe,{construct(i){return new i(e,t)}})})()}static Destroy(t,e,i){var s;t=Array.isArray(t)&&t||[t],t.forEach(a=>a==null?void 0:a.destroy()),e=Array.isArray(e)&&e||[e],e.forEach(a=>a==null?void 0:a.destroy()),i=Array.isArray(i)&&i||[i],i.forEach(a=>a==null?void 0:a.destroy()),(s=r(c,V))==null||s.destroy(),n(c,H,n(c,V,null)),c.PowerPreference=c.ForceFallbackAdapter=void 0,c.DescriptorLabel=r(c,S).requiredFeatures=c.RequiredLimits=void 0}static set PowerPreference(t){r(c,k).powerPreference=t}static set ForceFallbackAdapter(t){r(c,k).forceFallbackAdapter=t}static set DescriptorLabel(t){r(c,S).label=t}static async SetRequiredFeatures(t){const e=(await c.Adapter).features,i=r(c,S).requiredFeatures??[];return t=Array.isArray(t)&&t||[t],t.forEach(s=>e.has(s)?i.push(s):me(E.FEATURE_NOT_FOUND,`"${s}".
It will be skipped when requesting a GPUDevice.`)),r(c,S).requiredFeatures=i}static set RequiredLimits(t){r(c,S).requiredLimits=t}static get PreferredCanvasFormat(){return!navigator.gpu&&T(E.WEBGPU_NOT_SUPPORTED),navigator.gpu.getPreferredCanvasFormat()}static get Adapter(){return(async()=>{var t;return r(c,H)??await p(t=c,O,_e).call(t)()})()}static get Device(){return(async()=>{var t;return r(c,V)??await p(t=c,O,Se).call(t)()})()}static get VERSION(){return"0.0.6"}};V=new WeakMap,H=new WeakMap,k=new WeakMap,S=new WeakMap,O=new WeakSet,ne=function(t){var e;(e=r(c,S)).label??(e.label=t&&`${t} Device`||"")},Re=function(t){if(c.OnDeviceLost)return c.OnDeviceLost(t);const e=(t.message&&` | Message: ${t.message}`)??".";T(E.DEVICE_LOST,`Reason: ${t.reason}`+e)},_e=function(){return!navigator.gpu&&T(E.WEBGPU_NOT_SUPPORTED),async()=>{const t=await navigator.gpu.requestAdapter(r(c,k));return!t&&T(E.ADAPTER_NOT_FOUND),n(c,H,t)}},Se=function(){return async()=>{const{requiredFeatures:t,requiredLimits:e,label:i}=r(c,S),s=await(await c.Adapter).requestDevice({requiredFeatures:t,requiredLimits:e,defaultQueue:{label:i}});return!s&&T(E.DEVICE_NOT_FOUND),s.lost.then(p(c,O,Re)),n(c,V,s)}},o(c,O),o(c,V,null),o(c,H,null),o(c,k,{powerPreference:void 0,forceFallbackAdapter:!1}),q(c,"OnDeviceLost"),o(c,S,{label:void 0,requiredFeatures:void 0,requiredLimits:void 0});let de=c;U({TRIANGLE:3,SQUARE:4,PENTAGON:5,HEXAGON:6,HEPTAGON:7,OCTAGON:8,NONAGON:9,DECAGON:10,DODECAGON:12});const ze={DegreesToRadians:ye,RadiansToDegrees:xe};console.info("%cUWAL v0.0.6","background:#005a9c;padding:3px;color:#fff;");export{We as A,pe as F,de as U,ze as a};
