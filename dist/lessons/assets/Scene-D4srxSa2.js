import{d as i,e as h,G as d,f as r,E as o}from"./index-CMZei-k1.js";var L="@group(0)@binding(0)var<uniform>projection: mat4x4f;fn GetVertexClipSpace(position: vec4f)->vec4f{return projection*position;}@vertex fn vertex(@location(0)position: vec4f)->@builtin(position)vec4f {return GetVertexClipSpace(position);}",u="@group(0)@binding(1)var<uniform>color: vec4f;@fragment fn fragment()->@location(0)vec4f {return color;}",p="@group(0)@binding(0)var<uniform>projection: mat3x3f;fn GetVertexClipSpace(position: vec2f)->vec4f{let coords=projection*vec3f(position,1);return vec4f(coords.xy,0,1);}@vertex fn vertex(@location(0)position: vec2f)->@builtin(position)vec4f {return GetVertexClipSpace(position);}",m="@group(0)@binding(1)var<uniform>color: vec4f;@fragment fn fragment()->@location(0)vec4f {return color;}";const C=`${L}

${u}`,A=`${p}

${m}`;class g{Children=[];Label;#e=null;RotationOrder="XYZ";TransformationOrder="TRS";ProjectionMatrix=i.identity();#t=i.identity();#i=i.identity();#r=h.set(1,1,1);#o=h.create();#a=h.create();constructor(t,e=null){this.Label=t,this.Parent=e}Add(t){t=d(t),t.forEach(e=>e.Parent=this)}Remove(t){t=d(t),t.forEach(e=>e.Parent=null)}Find(t){let e=null;return this.Traverse(a=>{if(a.Label===t)return e=a}),e}Traverse(t){if(!t(this))for(let e=0,a=this.Children.length;e<a;++e)this.Children[e].Traverse(t)}ResetLocalMatrix(){this.#t=i.identity()}UpdateWorldMatrix(){this.#n(),this.#e?i.multiply(this.#e.WorldMatrix,this.#t,this.#i):i.copy(this.#t,this.#i),this.Children.forEach(t=>t.UpdateWorldMatrix())}#n(){this.#t=i.identity();const t=this.TransformationOrder.split("");for(let e=0,a=t.length;e<a;e++)switch(t[e]){case"T":i.translate(this.#t,this.#o,this.#t);break;case"R":for(let n=0,s=this.RotationOrder.length;n<s;++n){const c=this.RotationOrder[n],l=this.#a[c.charCodeAt()-88];i[`rotate${c}`](this.#t,l,this.#t)}break;case"S":i.scale(this.#t,this.#r,this.#t);break}}UpdateProjectionMatrix(t){const e=this.#e&&this.#i||this.#t;return i.multiply(t,e,this.ProjectionMatrix)}ResetProjectionMatrix(){this.ProjectionMatrix=i.identity()}RotateAxis(t,e){i.rotate(this.#t,t,e,this.#t)}RotateX(t){i.rotateX(this.#t,t,this.#t)}RotateY(t){i.rotateY(this.#t,t,this.#t)}RotateZ(t){i.rotateZ(this.#t,t,this.#t)}Scale(t){i.scale(this.#t,t,this.#t)}set Transform(t){this.#t=i.identity();const[e,a,n]=t,s=this.TransformationOrder.split("");for(let c=0,l=s.length;c<l;c++)switch(s[c]){case"T":e&&(this.Position=e);break;case"R":a&&(this.Rotation=a);break;case"S":n&&(this.Scaling=n);break}}set Position(t){h.copy(t,this.#o),i.translate(this.#t,t,this.#t)}get Position(){return this.#o}set Rotation(t){h.copy(t,this.#a);for(let e=0,a=this.RotationOrder.length;e<a;++e){const n=this.RotationOrder[e],s=t[n.charCodeAt()-88];i[`rotate${n}`](this.#t,s,this.#t)}}get Rotation(){return this.#a}set Scaling(t){h.copy(t,this.#r),i.scale(this.#t,t,this.#t)}get Scaling(){return this.#r}get LocalMatrix(){return this.#t}get WorldMatrix(){return this.#i}set Parent(t){if(this.#e){const e=this.#e.Children.indexOf(this);0<=e&&this.#e.Children.splice(e,1)}t&&t.Children.push(this),this.#e=t}get Parent(){return this.#e}}class R extends g{#e=new Set;MainCamera;constructor(t="Scene"){super(t),Reflect.deleteProperty(this,"ProjectionMatrix")}Find(t){let e=super.Find(t);if(e)return e;for(const a of this.#e)if(a.Label===t)return a;return null}AddCamera(t){this.#e.add(t),this.#e.size===1&&(this.MainCamera=t)}RemoveCamera(t){this.#e.delete(t),this.MainCamera===t&&(this.MainCamera=void 0)}ResetLocalMatrix(){r(o.INVALID_CALL,"method: `Scene.ResetLocalMatrix`.")}UpdateProjectionMatrix(t){r(o.INVALID_CALL,"method: `Scene.UpdateProjectionMatrix`.")}ResetProjectionMatrix(){r(o.INVALID_CALL,"method: `Scene.ResetProjectionMatrix`.")}RotateAxis(t,e){r(o.INVALID_CALL,"method: `Scene.RotateAxis`.")}RotateX(t){r(o.INVALID_CALL,"method: `Scene.RotateX`.")}RotateY(t){r(o.INVALID_CALL,"method: `Scene.RotateY`.")}RotateZ(t){r(o.INVALID_CALL,"method: `Scene.RotateZ`.")}Rotate(t){r(o.INVALID_CALL,"method: `Scene.Rotate`.")}Scale(t){r(o.INVALID_CALL,"method: `Scene.Scale`.")}Destroy(){this.Traverse(t=>this!==t&&t.Destroy?.()),this.MainCamera=void 0,this.Children.splice(0),this.#e.clear()}set Transform(t){r(o.INVALID_CALL,"setter: `Scene.Transform`.")}set Position(t){r(o.INVALID_CALL,"setter: `Scene.Position`.")}get Position(){r(o.INVALID_CALL,"getter: `Scene.Position`.")}set Rotation(t){r(o.INVALID_CALL,"setter: `Scene.Rotation`.")}get Rotation(){r(o.INVALID_CALL,"getter: `Scene.Rotation`.")}set Scaling(t){r(o.INVALID_CALL,"setter: `Scene.Scaling`.")}get Scaling(){r(o.INVALID_CALL,"getter: `Scene.Scaling`.")}get LocalMatrix(){r(o.INVALID_CALL,"getter: `Scene.LocalMatrix`.")}}export{C,g as N,R as S,A as a};
