(function(s,u){typeof exports=="object"&&typeof module<"u"?module.exports=u():typeof define=="function"&&define.amd?define(u):(s=typeof globalThis<"u"?globalThis:s||self,s.UWAL=u())})(this,function(){"use strict";var $=Object.defineProperty;var k=(s,u,o)=>u in s?$(s,u,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[u]=o;var B=(s,u,o)=>(k(s,typeof u!="symbol"?u+"":u,o),o),I=(s,u,o)=>{if(!u.has(s))throw TypeError("Cannot "+o)};var a=(s,u,o)=>(I(s,u,"read from private field"),o?o.call(s):u.get(s)),O=(s,u,o)=>{if(u.has(s))throw TypeError("Cannot add the same private member more than once");u instanceof WeakSet?u.add(s):u.set(s,o)},d=(s,u,o,v)=>(I(s,u,"write to private field"),v?v.call(s,o):u.set(s,o),o);var G=(s,u,o)=>(I(s,u,"access private method"),o);var l,g,A,C,F,R,p,D,m,U,P,f,y,b,V,M,S,x;function s(N){const e={};for(let t in N)e[t]={value:N[t]};return Object.freeze(Object.create(null,e))}const u=s({DEVICE_LOST:"Device::Lost"}),o=s({WEBGPU_NOT_SUPPORTED:"WEBGPU_NOT_SUPPORTED",ADAPTER_NOT_FOUND:"ADAPTER_NOT_FOUND",DEVICE_NOT_FOUND:"DEVICE_NOT_FOUND",DEVICE_NOT_REQUESTED:"DEVICE_NOT_REQUESTED",DEVICE_LOST:"DEVICE_LOST",CANVAS_NOT_FOUND:"CANVAS_NOT_FOUND",CONTEXT_NOT_FOUND:"CONTEXT_NOT_FOUND",COMMAND_ENCODER_NOT_FOUND:"COMMAND_ENCODER_NOT_FOUND"}),v=s({WEBGPU_NOT_SUPPORTED:"WebGPU is not supported in this browser.",ADAPTER_NOT_FOUND:"Failed to get a GPUAdapter.",DEVICE_NOT_FOUND:"Failed to get a GPUDevice.",DEVICE_NOT_REQUESTED:"GPUDevice was not requested.",DEVICE_LOST:"WebGPU device was lost.",CANVAS_NOT_FOUND:"Failed to get a WebGPU canvas.",CONTEXT_NOT_FOUND:"Failed to get a WebGPU context.",COMMAND_ENCODER_NOT_FOUND:"Failed to get a GPUCommandEncoder."}),L=s({WEBGPU_NOT_SUPPORTED:0,ADAPTER_NOT_FOUND:1,DEVICE_NOT_FOUND:2,DEVICE_NOT_REQUESTED:3,DEVICE_LOST:4,CANVAS_NOT_FOUND:5,CONTEXT_NOT_FOUND:6,COMMAND_ENCODER_NOT_FOUND:7});function Q(N,e){console.warn(v[N]+(e??""))}function T(N,e){throw new Error(v[N]+(e??""),{cause:L[N]})}class w{constructor(e,t){O(this,l,void 0);B(this,"Device");B(this,"BindGroups",[]);O(this,g,void 0);!e&&T(o.DEVICE_NOT_REQUESTED),this.Device=e,d(this,l,t)}CreateBuffer(e){return this.Device.createBuffer(e)}WriteBuffer(e,t,n=0,i,c){this.Device.queue.writeBuffer(e,n,t,i,c)}CopyBufferToBuffer(e,t,n,i=0,c=0){this.CommandEncoder.copyBufferToBuffer(e,i,t,c,n)}CreateShaderModule(e,t="",n,i){const c=Array.isArray(e)?e.join(`

`):e;return this.Device.createShaderModule({label:t,code:c,sourceMap:n,compilationHints:i})}CreateBindGroupEntries(e){return Array.isArray(e)?e.map((t,n)=>({binding:n,resource:t})):[{binding:0,resource:e}]}CreateBindGroup(e){return this.Device.createBindGroup(e)}AddBindGroups(e){this.BindGroups=Array.isArray(e)?e:[e]}CreateCommandEncoder(){return d(this,g,this.Device.createCommandEncoder({label:a(this,l)}))}SubmitCommandBuffer(){this.Device.queue.submit([this.CommandEncoder.finish()])}get CommandEncoder(){if(!a(this,g)){const e=` ${a(this,l)&&`Label: "${a(this,l)}". `}`;return Q(o.COMMAND_ENCODER_NOT_FOUND,e+"Creating a new one."),this.CreateCommandEncoder()}return a(this,g)}}l=new WeakMap,g=new WeakMap;class W extends w{constructor(t,n,i){super(t,n);O(this,A,void 0);O(this,C,void 0);d(this,A,i)}CreateColorAttachment(t,n="load",i="store",c,E,h){return{view:t,loadOp:n,storeOp:i,clearValue:c,resolveTarget:E,depthSlice:h}}CreateRenderPassDescriptor(t,n="",i,c,E,h){return t=Array.isArray(t)?t:[t],{colorAttachments:t,label:n,depthStencilAttachment:i,occlusionQuerySet:c,timestampWrites:E,maxDrawCount:h}}CreateVertexState(t,n="vertex",i,c){return{module:t,entryPoint:n,constants:i,buffers:c}}CreateFragmentState(t,n="fragment",i,c){return i??(i=[{format:a(this,A)}]),{module:t,entryPoint:n,targets:i,constants:c}}CreateRenderPipeline(t){const n=t.layout??"auto";return this.Device.createRenderPipeline({...t,layout:n})}Render(t,n,i,c=!0){if(!a(this,C)){const E=this.CreateCommandEncoder();d(this,C,E.beginRenderPass(t)),a(this,C).setPipeline(n)}for(let E=0,h=this.BindGroups.length;E<h;++E)a(this,C).setBindGroup(E,this.BindGroups[E]);i=typeof i=="number"?{vertexCount:i}:i,a(this,C).draw(i.vertexCount,i.instanceCount,i.firstVertex,i.firstInstance),c&&(a(this,C).end(),d(this,C,void 0),this.SubmitCommandBuffer())}get CurrentPass(){return a(this,C)}}A=new WeakMap,C=new WeakMap;class j extends w{constructor(t,n){super(t,n);O(this,F,[1])}CreateComputePassDescriptor(t="",n,i,c){return{label:t,timestampWrites:n?{querySet:n,beginningOfPassWriteIndex:i,endOfPassWriteIndex:c}:void 0}}CreateComputePipeline(t){const n=t.layout??"auto";return this.Device.createComputePipeline({label:t.label,layout:n,compute:t})}Compute(t,n){const i=this.CommandEncoder.beginComputePass(n);i.setPipeline(t);for(let c=0,E=this.BindGroups.length;c<E;++c)i.setBindGroup(c,this.BindGroups[c]);i.dispatchWorkgroups(...a(this,F)),i.end()}set Workgroups(t){d(this,F,Array.isArray(t)?t:[t])}}F=new WeakMap;/**
 * @module UWAL
 * @author Ustym Ukhman <ustym.ukhman@gmail.com>
 * @description Unopinionated WebGPU Abstraction Library
 * @version 0.0.1
 * @license MIT
 */const r=class r{static SetAdapterOptions(e=void 0,t=!1){a(r,P).powerPreference=e,a(r,P).forceFallbackAdapter=t}static SetDeviceDescriptor(e="",t=[],n={}){a(r,f).label=e,a(r,f).requiredFeatures=t,a(r,f).requiredLimits=n}static SetCanvasSize(e=innerWidth,t=innerHeight){!a(r,D)&&T(o.CANVAS_NOT_FOUND),!a(r,p)&&T(o.DEVICE_NOT_FOUND);const{maxTextureDimension2D:n}=a(r,p).limits;e=Math.max(1,Math.min(e,n)),t=Math.max(1,Math.min(t,n)),(a(r,D).width!==e||a(r,D).height!==t)&&(a(r,D).height=t,a(r,D).width=e)}static RenderPipeline(e,t="",n={}){return(async()=>{const i=await r.Device,c=e.getContext("webgpu");!c&&T(o.CONTEXT_NOT_FOUND);const E=n.format??a(r,U),h={...n,format:E};return c.configure({device:i,...h}),d(r,D,e),d(r,m,c),new Proxy(W,{construct(X){return new X(i,t,E)}})})()}static ComputePipeline(e=""){return(async()=>{const t=await r.Device;return new Proxy(j,{construct(n){return new n(t,e)}})})()}static Destroy(e,t,n){var i,c;e=Array.isArray(e)?e:[e],e.forEach(E=>E==null?void 0:E.destroy()),t=Array.isArray(t)?t:[t],t.forEach(E=>E==null?void 0:E.destroy()),n=Array.isArray(n)?n:[n],n.forEach(E=>E==null?void 0:E.destroy()),(i=a(r,m))==null||i.unconfigure(),(c=a(r,p))==null||c.destroy()}static get Adapter(){return(async()=>{var e;return a(r,R)??await G(e=r,y,b).call(e)()})()}static get Device(){return(async()=>{var e;return a(r,p)??await G(e=r,V,M).call(e)()})()}static get Canvas(){return a(r,D)}static get Context(){return a(r,m)}static get AspectRatio(){return!a(r,D)&&T(o.CANVAS_NOT_FOUND),a(r,D).width/a(r,D).height}static get CurrentTexture(){return a(r,m).getCurrentTexture()}static get CurrentTextureView(){return r.CurrentTexture.createView()}static get VERSION(){return"0.0.1"}};R=new WeakMap,p=new WeakMap,D=new WeakMap,m=new WeakMap,U=new WeakMap,P=new WeakMap,f=new WeakMap,y=new WeakSet,b=function(){return!navigator.gpu&&T(o.WEBGPU_NOT_SUPPORTED),d(r,U,navigator.gpu.getPreferredCanvasFormat()),async()=>{const e=await navigator.gpu.requestAdapter(a(r,P));return!e&&T(o.ADAPTER_NOT_FOUND),d(r,R,e)}},V=new WeakSet,M=function(){return async()=>{const{requiredFeatures:e,requiredLimits:t,label:n}=a(r,f),i=await(await r.Adapter).requestDevice({requiredFeatures:e,requiredLimits:t,defaultQueue:{label:n}});return!i&&T(o.DEVICE_NOT_FOUND),i.lost.then(G(r,S,x)),d(r,p,i)}},S=new WeakSet,x=function(e){if(r.OnDeviceLost)return r.OnDeviceLost(e);a(r,D).dispatchEvent(new CustomEvent(u.DEVICE_LOST,{detail:e}));const t=(e.message&&` | Message: ${e.message}`)??".";T(o.DEVICE_LOST,` Reason: ${e.reason}`+t)},O(r,y),O(r,V),O(r,S),O(r,R,null),O(r,p,null),O(r,D,void 0),O(r,m,void 0),O(r,U,void 0),O(r,P,{powerPreference:void 0,forceFallbackAdapter:!1}),O(r,f,{label:"",requiredFeatures:[],requiredLimits:{}}),B(r,"OnDeviceLost");let _=r;return console.info(`%cUWAL v${_.VERSION}`,"background:#005a9c;padding:3px;color:#fff;"),_});
//# sourceMappingURL=uwal.umd.cjs.map
